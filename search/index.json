[{"content":" # 1. Computers only know binary code Two ways to convert human-readable code to binary code:\nCompilation: The code is converted to binary code before it is executed. Interpretation: The code is converted to binary code as it is executed. # Why a compiled binary code cannot be run on a different OS? # ISA (Instruction Set Architecture) ISA: The CPU has a set of predefined actions called the instruction set or ISA (instruction set architecture). source\nPopular ISAs:\nx86: Intel and AMD processors, high performance. Not the case in nowadays, ARM is also used in high-performance devices. One reason os that some powerful GPUs, such as NVIDIA works better with x86 processors. ARM: Often used in the devices with small battery, such as smartphones, embedded systems, such as snapdragon, and Apple\u0026rsquo;s A-series chips, and Raspberry Pi, STM32. M-series chips. MIPS: used in switches and routers, and some embedded systems. # OS (Operating System) Different OSs have different system calls. We use standard libraries to make system calls, such as printf in C.\n# Cross-compilation Cross-compilation is the process of compiling code for a platform different from the one on which the compiler is running.\n# Why cross-compilation? Some machines are not powerful enough to compile the code. For example, compiling code for a micro-controller on a Raspberry Pi.\n# How to cross-compile? # Cross platform Java - Write once, run anywhere. Benefits from the JVM.\nPython - Benefits from the Python interpreter.\nC, C++ - Cross-compile the code.\n# References For many years, the typical answer to the \u0026ldquo;ARM CPU vs. x86?\u0026rdquo; question was that x86es are better suited to desktop and high-performance computing, while ARM chips were better suited for mobile devices. That perception changed when Apple released its ARM-based M1 chips in 2020, followed by the powerful M2 series in 2022. source\nx86 processors typically operate independently of peripheral components, such as RAM and GPUs. But ARM processors were designed to package these additional components into a central unit. That\u0026rsquo;s why ARM processors operate as part of a System on Chip (SOC). source\nWhen you communicate with GPUs, you typically use graphics libraries such as OpenGL, Vulkan, or DirectX. The company that sold you the graphics card also provides a graphics driver that translates commands from these graphics libraries into instructions that the GPU can understand. The instructions that your graphics driver generate are in a proprietary protocol known only to a few wizards at NVIDIA and AMD who actually understand how GPUs work on a low level. Us mere mortals don\u0026rsquo;t get to look under the hood at these instructions. Interestingly, many modern CPUs operate the same way. They take your x86 code and internally translate it into something better, faster, and chip specific. Adopted from source\n","date":"2024-04-25T21:30:17Z","permalink":"https://blog.yorforger.cc/p/compiled-and-interpreted-languages-video-draft/","title":"Compiled and Interpreted Languages - Video Draft"},{"content":" # Basic Theory MongoDB stores its information in documents rather than rows. Where relational databases have tables, MongoDB has collections.\nEvery MongoDB document requires an _id, and if one isnâ€™t present when the document is created, a special MongoDB ObjectID will be generated and added to the document at that time. You can set your own _id by setting it in the document you insert, the ObjectID is just MongoDBâ€™s default.\nIndexes donâ€™t come for free; they take up some space and can make your inserts slightly more expensive, but they are an essential tool for query optimization.\nMongoDB store documents in a collection in no particular order. To get documents in a particular order, you must can use the sort() method or the $sort aggregation pipeline stage. Learn more: natural order â€” MongoDB Manual\nå…³äº foreign key çš„æ¦‚å¿µå¸¸å‡ºç°åœ¨ one to many å…³ç³»ä¸­, æ¯”å¦‚è¯„è®ºè¡¨å’Œç”¨æˆ·, ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè¯„è®º, ä½†ä¸€ä¸ªè¯„è®ºåªèƒ½æœ‰ä¸€ä¸ªç”¨æˆ·. åœ¨ä¼ ç»Ÿæ•°æ®åº“ä¸­, è¯„è®ºè¡¨ä¸­ä¼šæœ‰ä¸€ä¸ª user_id å­—æ®µ, æˆ‘ä»¬å«å®ƒå¤–é”®, æ¯æ¬¡æŸ¥è¯¢æ—¶å¯ä»¥é€šè¿‡ join æ“ä½œå°†ç”¨æˆ·ä¿¡æ¯å’Œè¯„è®ºä¿¡æ¯å…³è”èµ·æ¥ (å³è·å–å†™äº†è¿™ä¸ªè¯„è®ºçš„ç”¨æˆ·å…·ä½“ä¿¡æ¯å’Œè¯„è®ºçš„å…·ä½“å†…å®¹).\nMongoDB æ²¡æœ‰ä¼ ç»Ÿæ•°æ®åº“ä¸­ join æ“ä½œå’Œ foreign key, ä½†å¯ä»¥é€šè¿‡ embedded documents æˆ–è€… reference æ¥è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³», ä¹Ÿå¯ä½¿ç”¨èšåˆæ¥å®ç°ç±»ä¼¼ Join çš„åŠŸèƒ½. å…·ä½“å®˜æ–¹æ–‡æ¡£æœ‰è§£é‡Š: Model One-to-Many Relationships with Embedded Documents, Model One-to-Many Relationships with Document References\nå…³äºä¸€å¯¹å¤š, å¤šå¯¹å¤šå…³ç³»å‚è€ƒ: SQL Server Tutorial - One-to-many and many-to-many table relationships\nå…³äºå¤–é”®è¯·å‚è€ƒ: Learning MySQL - FOREIGN KEY CONSTRAINTS\nå…³äº join æ“ä½œè¯·å‚è€ƒ: SQL Joins Explained\n# Examples in the Book # Reviews - One to Many Relationship Each product can have many reviews, and you create this relationship by storing a product_id in each review, as shown in the sample document:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { _id: ObjectId(\u0026#34;4c4b1476238d3b4dd5000041\u0026#34;), product_id: ObjectId(\u0026#34;4c4b1476238d3b4dd5003981\u0026#34;), date: new Date(2010, 5, 7), title: \u0026#34;Amazing\u0026#34;, text: \u0026#34;Has a squeaky wheel, but still a darn good wheelbarrow.\u0026#34;, rating: 4, user_id: ObjectId(\u0026#34;4c4b1476238d3b4dd5000042\u0026#34;), username: \u0026#34;dgreenthumb\u0026#34;, helpful_votes: 3, voter_ids: [ ObjectId(\u0026#34;4c4b1476238d3b4dd5000033\u0026#34;), ObjectId(\u0026#34;7a4f0376238d3b4dd5000003\u0026#34;), ObjectId(\u0026#34;92c21476238d3b4dd5000032\u0026#34;) ] } But it may come as a surprise that you store the username as well. If this were an RDBMS, youâ€™d be able to pull in the username with a join on the users table. Because you donâ€™t have the join option with MongoDB, you can proceed in one of two ways: either query against the user collection for each review or accept some denormalization. Issuing a query for every review might be unnecessarily costly when username is extremely unlikely to change, so here weâ€™ve chosen to optimize for query speed rather than normalization.\nAlso noteworthy is the decision to store votes in the review document itself. Itâ€™s common for users to be able to vote on reviews. Here, you store the object ID of each voting user in an array of voter IDs. This allows you to prevent users from voting on a review more than once, and it also gives you the ability to query for all the reviews a user has voted on. You cache the total number of helpful votes, which among other things allows you to sort reviews based on helpfulness. Caching is useful, a query to sort reviews by helpful votes, for example, is much easier if the size of the voting array is cached in the helpful_votes field.\nç”¨æˆ·åä¿¡æ¯åŸæœ¬å¯ä»¥é€šè¿‡ç”¨æˆ·ID (user_id) åœ¨ç”¨æˆ·é›†åˆ(users collection)ä¸­æŸ¥åˆ°, ä½†è¿™æ ·æ¯æ¬¡åˆ·æ–°è¯„è®ºéƒ½è¦é‡æ–°æŸ¥ä¸€æ¬¡ç”¨æˆ·å.\nè¿™æ®µæåˆ°äº†ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼šç¼“å­˜ï¼ˆCachingï¼‰, è¿™é‡Œçš„ â€œç¼“å­˜â€ æ˜¯æŒ‡åœ¨æ–‡æ¡£ä¸­ç›´æ¥å­˜å‚¨ä¸€ä¸ªé¢å¤–çš„æ•°æ®é¡¹ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯â€œæœ‰å¸®åŠ©çš„æŠ•ç¥¨æ•°â€ï¼‰ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æŸ¥è¯¢æ—¶è®¡ç®—è¿™ä¸ªæ•°å€¼ã€‚\n# Student \u0026amp; Courses - Many to Many Relationship student:\n1 2 3 4 5 6 7 8 9 10 { _id: \u0026lt;number\u0026gt;, name: : \u0026lt;string\u0026gt;, otherDetails: { ... }, courses: [ { courseId: \u0026lt;number\u0026gt;, courseName: \u0026lt;string\u0026gt; }, { courseId: \u0026lt;number\u0026gt;, courseName: \u0026lt;string\u0026gt; }, ... ] } course:\n1 2 3 4 5 6 { _id: \u0026lt;number\u0026gt;, name: \u0026lt;string\u0026gt;, description: \u0026lt;string\u0026gt;, otherDetails: { ... } } Now, your application has some queries. To start with some queries I can think about is, get all students in a particular course and get all courses for a particular student. These are simple queries.\nTo get all courses for a specific student, the query would be:\n1 db.students.find( { name: \u0026#34;John Doe\u0026#34; }, { courses: 1, name: 1 } ) To get all students enrolled for a specific course, your query can be like this:\n1 db.students.find( { \u0026#34;courses.courseName\u0026#34;: \u0026#34;Database Design\u0026#34; } ) This example is from Many to many relationship and linked table/collection - Working with Data - MongoDB Developer Community Forums\n# Query Operators å‰é¢ä»‹ç»äº†findå‡½æ•°çš„åŸºæœ¬ç”¨æ³•å’Œprojectionå‚æ•°, åœ¨å®é™…æŸ¥è¯¢ä¸­, æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ä¸€äº›æ“ä½œç¬¦æ¥æ„å»ºæ›´å¤æ‚çš„æŸ¥è¯¢æ¡ä»¶, æ¥ä¸‹æ¥ä¸€ä¸€ä»‹ç».\nLearn more: Query and Projection Operators â€” MongoDB Manual\n# Set operators $in, $nin, $all\n1 2 3 4 5 6 7 8 9 10 11 12 13 // $in: Matches any of the values specified in an array. db.products.find({ \u0026#39;main_cat_id\u0026#39;: { \u0026#39;$in\u0026#39;: [ ObjectId(\u0026#34;6a5b1476238d3b4dd5000048\u0026#34;), ObjectId(\u0026#34;6a5b1476238d3b4dd5000051\u0026#34;), ObjectId(\u0026#34;6a5b1476238d3b4dd5000057\u0026#34;) ] } }, null, null) // Query nested documents db.products.find({\u0026#39;details.color\u0026#39;: {$in: [\u0026#39;blue\u0026#39;, \u0026#39;Green\u0026#39;]}}) # Boolean operators $or, $and, $not, $nor, $exists\n1 2 3 4 5 6 7 8 // $or: matches if any of the supplied set of query terms is true // Finding all products that are either blue or made by Acme requires: db.products.find({ \u0026#39;$or\u0026#39;: [ {\u0026#39;details.color\u0026#39;: \u0026#39;blue\u0026#39;}, {\u0026#39;manufacturer\u0026#39;: \u0026#39;Acme\u0026#39;}, ] }) # Update, atomic operations, and delete - Action in MongoDB chapter 7 # Update You can either replace the document altogether, or you can use update operators to modify specific fields within the document.\nmodify by replacement:\n1 2 3 4 5 user_id = ObjectId(\u0026#34;4c4b1476238d3b4dd5003981\u0026#34;) doc = db.users.findOne({_id: user_id}) doc[\u0026#39;email\u0026#39;] = \u0026#39;mongodb-user@mongodb.com\u0026#39; print(\u0026#39;updating \u0026#39; + user_id) db.users.update({_id: user_id}, doc) The final line says, â€œFind the document in the users collection with the given _id, and replace that document with the one weâ€™ve provided.â€\nmodify by operator:\n1 2 user_id = ObjectId(\u0026#34;4c4b1476238d3b4dd5000001\u0026#34;) db.users.update({_id: user_id},Â {$set: {email: \u0026#39;mongodb-user2@mongodb.com\u0026#39;}}) Performance-conscious users may balk at the idea of re-aggregating all product reviews for each update. Much of this depends on the ratio of reads to writes; itâ€™s likely that more users will see product reviews than write their own, so it makes sense to re-aggregate on a write.\n# Standard update operators Certainly! Let\u0026rsquo;s go through each MongoDB update operator with an explanation followed by a real-world example:\n$set: Used to set the value of a field in a document. If the field does not exist, $set will add a new field with the specified value.\nExample: Updating a user\u0026rsquo;s email address.\n1 db.users.update({ username: \u0026#39;johndoe\u0026#39; }, { $set: { email: \u0026#39;johndoe@example.com\u0026#39; } }); $unset: Removes the specified field from a document.\nExample: Removing a phone number field from a user\u0026rsquo;s profile.\n1 db.users.update({ username: \u0026#39;johndoe\u0026#39; }, { $unset: { phoneNumber: \u0026#34;\u0026#34; } }); $inc: Increments the value of a field by the specified amount. If the field does not exist, it is set to the increment amount.\nExample: Incrementing a user\u0026rsquo;s reward points.\n1 db.users.update({ username: \u0026#39;johndoe\u0026#39; }, { $inc: { rewardPoints: 100 } }); $push: Adds an element to an array. If the field is not an array, this operator will create an array with one element.\nExample: Adding a new product to a user\u0026rsquo;s wishlist.\n1 db.users.update({ username: \u0026#39;johndoe\u0026#39; }, { $push: { wishlist: \u0026#39;productId1234\u0026#39; } }); $pull: Removes all instances of a value from an existing array.\nExample: Removing an item from a user\u0026rsquo;s shopping cart.\n1 db.users.update({ username: \u0026#39;johndoe\u0026#39; }, { $pull: { shoppingCart: \u0026#39;itemId5678\u0026#39; } }); $addToSet: Adds a value to an array unless the value is already present, in which case $addToSet does nothing to ensure uniqueness.\nExample: Adding a tag to a blog post without creating duplicates.\n1 db.blogPosts.update({ title: \u0026#39;MongoDB Tips\u0026#39; }, { $addToSet: { tags: \u0026#39;NoSQL\u0026#39; } }); $rename: Renames a field.\nExample: Changing a field name in a contact document.\n1 db.contacts.update({ name: \u0026#39;Jane Doe\u0026#39; }, { $rename: { \u0026#39;cellphone\u0026#39;: \u0026#39;mobileNumber\u0026#39; } }); $mul: Multiplies the value of the field by the specified amount. If the field does not exist, the operation sets the field to zero.\nExample: Updating the price of a product in inventory.\n1 db.products.update({ productId: \u0026#39;A123\u0026#39; }, { $mul: { price: 2 } }); # Slow queries - Chapter 8 å€¼å¾—åå¤é˜…è¯» Finding slow queries is easy with MongoDBâ€™s profiler. Discovering why these queries are slow is trickier and may require some detective work. As mentioned, the causes of slow queries are manifold. If youâ€™re lucky, resolving a slow query may be as easy as adding an index. In more difficult cases, you might have to rearrange indexes, restructure the data model, or upgrade hardware.\nMongoDBâ€™s explain command provides detailed information about a given queryâ€™s path.\n1 2 3 4 5 6 7 8 9 10 11 12 db.values.find({}).sort({close: -1}).limit(1).explain() { \u0026#34;cursor\u0026#34; : \u0026#34;BasicCursor\u0026#34;,Â \u0026#34;isMultiKey\u0026#34; : false,Â â€œÂ \u0026#34;n\u0026#34; : 1,Â #A Number returned \u0026#34;nscannedObjects\u0026#34; : 4308303,Â \u0026#34;nscanned\u0026#34; : 4308303,Â #B Number scanned \u0026#34;nscannedObjectsAllPlans\u0026#34; : 4308303, \u0026#34;scanAndOrder\u0026#34; : true,Â \u0026#34;millis\u0026#34; : 10927,Â #C Time in milliseconds, 11 seconds this query took ...Â }Â The cursor field tells you that youâ€™ve been using a BasicCursor, which only confirms that youâ€™re scanning the collection itself and not an index. If you had used an index, the value wouldâ€™ve been BTreeCursor.\nA second datum here further explains the slowness of the query: the scanAndOrder field. This indicator appears when the query optimizer canâ€™t use an index to return a sorted result set. Therefore, in this case, not only does the query engine have to scan the collection, it also has to sort the result set manually.\nAvoid scanAndOrder. If the query includes a sort, attempt to sort using an index. Satisfy all fields with useful indexing constraintsâ€”attempt to use indexes for the fields in the query selector. If the query implies a range or includes a sort, choose an index where that last key used can help satisfy the range or sort. å½“æåˆ°â€œlast key usedâ€è¿™ä¸ªæœ¯è¯­ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­å…³äºé€‰æ‹©ç´¢å¼•ä»¥ä¼˜åŒ–èŒƒå›´æŸ¥è¯¢æˆ–æ’åºæ“ä½œçš„è®¨è®ºä¸­ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨å¤åˆç´¢å¼•ä¸­çš„æœ€åä¸€ä¸ªå­—æ®µã€‚åœ¨å¤åˆç´¢å¼•ä¸­ï¼Œå­—æ®µçš„é¡ºåºæ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºå®ƒå†³å®šäº†æ•°æ®åº“å¦‚ä½•ç»„ç»‡å’Œè®¿é—®ç´¢å¼•æ•°æ®ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šè¿™ä¸ªæ¦‚å¿µã€‚\nå‡è®¾ä½ æœ‰ä¸€ä¸ªMongoDBé›†åˆï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼ša, b, å’Œ cã€‚ç°åœ¨ï¼Œå‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªå¤åˆç´¢å¼• { a: 1, b: 1, c: 1 }ã€‚åœ¨è¿™ä¸ªç´¢å¼•ä¸­ï¼š\na æ˜¯ç¬¬ä¸€ä¸ªé”®ï¼Œ b æ˜¯ç¬¬äºŒä¸ªé”®ï¼Œ c æ˜¯â€œlast keyâ€æˆ–æœ€åä¸€ä¸ªé”®ã€‚ åœ¨å¤„ç†æŸ¥è¯¢æ—¶ï¼Œå¦‚æœæŸ¥è¯¢æ¶‰åŠåˆ°è¿™ä¸‰ä¸ªå­—æ®µä¸­çš„ä»»æ„ä¸€ä¸ªçš„èŒƒå›´æ¡ä»¶æˆ–æ’åºè¦æ±‚ï¼Œç´¢å¼•çš„æ•ˆç‡å°†å–å†³äºè¿™äº›æ¡ä»¶æ˜¯å¦‚ä½•ä¸ç´¢å¼•ä¸­çš„é”®åŒ¹é…çš„ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ å¸Œæœ›æŸ¥è¯¢ä¸­çš„èŒƒå›´æˆ–æ’åºæ“ä½œç›´æ¥å¯¹åº”äºå¤åˆç´¢å¼•ä¸­çš„æœ€åä¸€ä¸ªé”®ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥æœ€å¤§åŒ–ç´¢å¼•çš„æ•ˆç”¨ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹æŸ¥è¯¢ï¼š\n1 db.collection.find({ a: 10, b: { $gt: 5 } }).sort({ c: 1 }) åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼š\na æ˜¯ä¸€ä¸ªç²¾ç¡®åŒ¹é…æ¡ä»¶ï¼Œ b æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢æ¡ä»¶ï¼Œ c æ˜¯ä¸€ä¸ªæ’åºæ¡ä»¶ã€‚ ç´¢å¼• { a: 1, b: 1, c: 1 } åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯é«˜æ•ˆçš„ï¼Œå› ä¸ºï¼š\nå®ƒé¦–å…ˆä½¿ç”¨ a æ¥å¿«é€Ÿå®šä½æ•°æ®ï¼ˆç¬¬ä¸€ä¸ªé”®ï¼‰ï¼Œ æ¥ç€ï¼Œåˆ©ç”¨ b æ¥è¿›ä¸€æ­¥è¿‡æ»¤èŒƒå›´å†…çš„è®°å½•ï¼ˆç¬¬äºŒä¸ªé”®ï¼‰ï¼Œ æœ€åï¼Œä½¿ç”¨ c è¿›è¡Œæ’åºï¼ˆâ€œlast keyâ€æˆ–æœ€åä¸€ä¸ªé”®ï¼‰ã€‚ åœ¨è¿™é‡Œï¼Œâ€œlast keyâ€ (c) ä½¿å¾—æŸ¥è¯¢å¯ä»¥åœ¨ä½¿ç”¨ç´¢å¼•çš„åŒæ—¶å®Œæˆæ’åºï¼Œä»è€Œé¿å…äº†é¢å¤–çš„æ’åºæ­¥éª¤ï¼Œæé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚æ‰€ä»¥ï¼Œâ€œlast keyâ€åœ¨å¤åˆç´¢å¼•ä¸­æŒ‡çš„æ˜¯æœ€åä¸€ä¸ªè¢«ç”¨æ¥æ”¯æŒæŸ¥è¯¢ä¸­çš„èŒƒå›´æˆ–æ’åºæ¡ä»¶çš„å­—æ®µã€‚\n","date":"2024-04-24T18:29:30Z","permalink":"https://blog.yorforger.cc/p/mongodb-in-action-reading-note/","title":"MongoDB in Action Reading Note"},{"content":" # Bson \u0026amp; Marshalling \u0026amp; Unmarshalling The process of converting a Go type to BSON is called marshalling, while the reverse process is called unmarshalling.\nWhy need convert Go type to BSON? MongoDB stores documents in BSON, when we store data (our struct) into MongoDB, MongoDB Go-driver convert our struct value into bson automatically.\nThe Go driver provides four main types for working with BSON data:\nD: An ordered representation of a BSON document (slice) M: An unordered representation of a BSON document (map) \u0026hellip; D is an ordered representation of a BSON document. This type should be used when the order of the elements matters, such as MongoDB command documents. If the order of the elements does not matter, an M should be used instead. This usually used as filter in a query operation.\nLike what we said before, our Go struct value needs to be converted to bson, there are Struct Tags, which is used to modify the default marshalling and unmarshalling behavior of a struct field.\nAfter we read data from MongoDB, we need to convert bson to Go struct, this is called unmarshalling. You can unmarshal BSON documents by using the Decode() method on the result of the FindOne method or any *mongo.Cursor instance.\nNote that when using FindOne() it returns a bson document, so you need decode it back to a Go struct value.\nMethod Find() returns a *mongo.Cursor, we usually iterate through it so get more than one (probably) result. And *mongo.Cursor needs to be closed usually to free resources.\nLearn more:\nmongodb - bson.D vs bson.M for find queries - Stack Overflow\nWork with BSON - Go Driver v1.15\n# Read Operation - Cursor To match a subset of documents, specify a query filter. In a query filter, you can match fields with literal values or with query operators. When you don\u0026rsquo;t know which method you should use, you can go to the mongo driver go API to check how to use them.\n# *mongo.Cursor A cursor is used to iterate over database results from read operations. A cursor is not goroutine safe. Do not use the same cursor in multiple goroutines at the same time. Method Find() returns a cursor.\nYou can retrieve results individually or get all results at a time, it depends on if the number of the result is very large.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 cursor, _ := coll.Find(context.TODO(), bson.D{}) // retrieve results individually for cursor.Next(context.TODO()) { var result MyStruct if err := cursor.Decode(\u0026amp;result); err != nil { log.Fatal(err) } fmt.Printf(\u0026#34;%+v\\n\u0026#34;, result) } // get all results at a time var results []MyStruct if err = cursor.All(context.TODO(), \u0026amp;results); err != nil { panic(err) } If the number and size of documents returned by your query exceeds available application memory, your program will crash. If you except a large result set, you should consume your cursor iteratively.\nWhen your application no longer requires a cursor, close the cursor with the Close() method. This method frees the resources your cursor consumes in both the client application and the MongoDB server. Close the cursor when you retrieve documents individually because those methods make a cursor tailable.\n# Others If the necessary database and collection don\u0026rsquo;t exist when you perform a write operation, the server implicitly creates them. So you don\u0026rsquo;t need to create database explicitly when use MongoDB.\ncollection: you can use it concurrentlly\n1 2 3 4 5 6 7 8 9 10 11 12 type Repository struct { db *mongo.Client //Collection is safe for concurrent use by multiple goroutines. PokemonColl *mongo.Collection } func NewRepository(db *mongo.Client) *Repository { return \u0026amp;Repository{ db: db, PokemonColl: db.Database(\u0026#34;pokemon\u0026#34;).Collection(\u0026#34;pokemons\u0026#34;), } } modify behvavior when query: opts third parameter\n1 2 3 // Note that there is three parameters, last is optional. func (coll *Collection) Find(ctx context.Context, filter interface{}, opts ...*options.FindOptions) (cur *Cursor, err error) findByIdAndUpdate(): FindOneAndUpdate returns the original document before updating.\n1 2 3 opts := options.FindOneAndUpdate().SetReturnDocument(options.After) result := coll.FindOneAndUpdate(context.TODO(), filter, update, opts) ... You may wonder how do I know opts := options.FindOneAndUpdate().SetReturnDocument(options.After) this to create an operation? And how can I know the behavior of a method? The answer is the mongo-api, you can see there is the behavor and example and all the thing you need to know before you use it.\nAnd you can check the FindOneAndUpdateOptions just click, to check what is it:\nYou can see this option is in the options package, and you can create it with FindOneAndUpdate(), so it\u0026rsquo;s not difficult to write the codes like this:\n1 2 3 opts := options.FindOneAndUpdate().SetReturnDocument(options.After) result := coll.FindOneAndUpdate(context.TODO(), filter, update, opts) ... # References mongo package - go.mongodb.org/mongo-driver/mongo - Go Packages\nCRUD Operations - Go Driver v1.15\n","date":"2024-04-23T08:38:35Z","permalink":"https://blog.yorforger.cc/p/mongodb-docs-golang-basics/","title":"MongoDB Docs - Golang Basics"},{"content":" # 1. Virtual Memory What is virtual memory? Indirection between the program\u0026rsquo;s addresses and the RAM addresses. Mapping disk space into memory. Virtual memory addresses (VA) and Physical memory addresses (PA). VA is the address that the program uses. PA is the address in RAM. The MMU translates VA to PA. A memory management unit (MMU) is a computer hardware unit that examines all memory references on the memory bus, translating these requests, known as virtual memory addresses, into physical addresses in main memory. Memory management unit\n# 1.1. Example 1 ld r1, 400(r2) This instruction means to load data into register r1 from the address calculated by adding an offset of 400 to the content of register r2.\nCalculate the Virtual Address: Assume the register r2 currently holds the virtual address 0x1000 (4096 in decimal). The offset 400 (in decimal) is added to the content of r2. Therefore, the calculated virtual address is 0x1000 + 0x190 = 0x1190 (virtual address). Virtual to Physical Address Translation: The MMU receives the virtual address 0x1190 and begins to look up the page table for the current process. Suppose the page table entry shows that this virtual address maps to the physical address 0x5000. The page offset (offset within the page) remains 0x190. Thus, the complete physical address is 0x5000 + 0x190 = 0x5190. Access Physical Memory and Execute Instruction: Once the physical address is determined, the MMU instructs the system to load data from physical address 0x5190. The data is loaded into register r1. # 1.2. Other Concepts Both MIPS and ARM are types of RISC architectures. RISC is a type of microprocessor design. MIPS gives each program its own 32-bit address space. Programs can only access any byte in their own address space. What if we don\u0026rsquo;t have enough memory? Holes in our address space? Keeping programs secure with virtual memory. (1) Virtual Memory: 4 How Does Virtual Memory Work?\n# Segment Fault A segmentation fault is a specific type of error that occurs when a program tries to access a segment of memory that it doesnâ€™t have the permissions to access or that doesnâ€™t exist, leading to the programâ€™s abrupt termination by the operating system.\nUnderstanding Segmentation Fault: What it is \u0026amp; How to Fix it\n# How does a game that is several hundred gigabytes run on a computer with only a few gigabytes of memory? # How does user mode switch to kernel mode? Reference: è‰è‰ä¸åç«¯æœåŠ¡å™¨goå¼€å‘å®ä¹ ç”Ÿä¸€é¢äºŒé¢æŒ‚ - çŸ¥ä¹\n","date":"2024-04-20T09:58:10Z","permalink":"https://blog.yorforger.cc/p/os-related/","title":"OS Related"},{"content":" # 1. Test real time network IO and disk IO 1 2 dstat -d # check the disk speed at real time dsat -n # check the network speed at real time # 2. Check the network speed speedtest-cli and iperf3: speedtest-cli measures speeds to public servers, reflecting general internet performance to the user; iperf3 can perform tests between any two points, ideal for in-depth performance testing in private or internal networks.\n1 2 3 4 iperf3 -s -p 5202 # server iperf3 -c server_ip_address -p 5202 # test the upload speed (client upload to server) iperf3 -c server_ip_address -p 5202 -R # test the download speed (client download from server) # Why the result of iperf3 is different from speedtest-cli? 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # run iperf3 on the client to test speed between client and server: â¯ iperf3 -c 104.152.xxx.122 Connecting to host 104.152.xxx.122, port 5201 [ 5] local 192.168.2.15 port 64062 connected to 104.152.xxx.122 port 5201 [ ID] Interval Transfer Bitrate [ 5] 0.00-1.00 sec 8.38 MBytes 70.1 Mbits/sec [ 5] 1.00-2.00 sec 15.0 MBytes 126 Mbits/sec [ 5] 2.00-3.00 sec 9.12 MBytes 76.6 Mbits/sec â¯ iperf3 -c 104.152.xxx.122 -R Connecting to host 104.152.xxx.122, port 5201 Reverse mode, remote host 104.152.xxx.122 is sending [ 5] local 192.168.2.15 port 64067 connected to 104.152.xxx.122 port 5201 [ ID] Interval Transfer Bitrate [ 5] 0.00-1.00 sec 128 KBytes 1.04 Mbits/sec [ 5] 1.00-2.00 sec 256 KBytes 2.10 Mbits/sec [ 5] 2.00-3.00 sec 256 KBytes 2.10 Mbits/sec [ 5] 3.00-4.00 sec 384 KBytes 3.14 Mbits/sec # run speedtest-cli on the server: âœ ~ speedtest-cli Retrieving speedtest.net configuration... Testing from WebNX (104.152.50.122)... Retrieving speedtest.net server list... Selecting best server based on ping... Hosted by S\u0026amp;A Telephone (Allen, KS) [175.61 km]: 49.106 ms Testing download speed................................................................................ Download: 425.75 Mbit/s Testing upload speed...................................................................................................... Upload: 138.52 Mbit/s Test Server Differences:\nSpeedtest-cli connects to servers likely hosted within your ISP\u0026rsquo;s network or well-connected data centers. Iperf3 results depend on endpoints you specify, which might not have optimal network paths or server capabilities. Use of Parallel Connections:\nIperf3 can run multiple concurrent connections, potentially showing higher bandwidth capacities compared to speedtest-cli. # 3. Find which process is using the port 1 sudo lsof -i :8080 lsof: Stands for \u0026ldquo;list open files.\u0026rdquo; The lsof command is used to list currently open \u0026ldquo;files,\u0026rdquo; where in this context, a network port is also considered a \u0026ldquo;file.\u0026rdquo;\n-i: This is an option for the lsof command that restricts the output to only show information related to network connections.\n:8080: Specifies the port number to examine. Here, :8080 indicates port number 8080.\n","date":"2024-04-13T12:40:56Z","permalink":"https://blog.yorforger.cc/p/tools-commonly-used-on-linux/","title":"Tools Commonly Used on Linux"},{"content":" # 1. Problem description Considering the limitation of the RAM on my VPS, when user attempting to upload a large file, I want to handle the file in chunks, so that I can read the file in small pieces and write them to the disk. And this process is called streaming.\nThe code snippet is like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 func (s *server) handleUpload(w http.ResponseWriter, r *http.Request, currentDir string) (errs []uploadError) { // limit the size of incoming request bodies. r.Body = \u0026amp;LimitedReader{r: r.Body, n: int64(s.maxFileSize * 1024 * 1024)} reader, err := r.MultipartReader() if err != nil {...} for { // reader.NextPart() will close the previous part automatically. part, err := reader.NextPart() if err != nil {...} // not a file, move to the next part. if part.FileName() == \u0026#34;\u0026#34; { continue } filename := getAvailableName(currentDir, part.FileName()) dstPath := filepath.Join(currentDir, filename) dst, err := os.Create(dstPath) if err != nil {...} // io.Copy() will stream the file to dst, multipart.Part is an io.Reader. _, err = io.Copy(dst, part) if err != nil {...} if err = dst.Close(); err != nil { ... } } return } But when I try to upload a file of 1.6GB, it takes a long time to finish (about 2 minutes), I thought it may caused by the CPU speed of my VPS or the I/O speed of the disk or the network speed.\nBut at the browser side, the uploading progress bar is always at 100%, and the browser is waiting for the response from the server, which indicates that the uploading process is finished, but the server is still processing the file.\nI use htop to check the CPU usage of my VPS, it\u0026rsquo;s around 20% when uploading the file (consists of network IO and disk IO), which indicates that the CPU is not the bottleneck.\nThen I use dd to test the I/O speed of my disk, it\u0026rsquo;s around 488MB/s, which is not bad.\nThen why the server is still processing the file so long?\nBesides, when my server is processing the file, if I refresh the page, the RAM and cpu usage of my VPS will increase to 100%, and the server will get killed by the OS. This is super weird.\n# 2. Solution for high CPU usage The error output (call stack) looks like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 goroutine 12 [running]: runtime.systemstack_switch() /Users/David/sdk/go1.20.4/src/runtime/asm_amd64.s:463 fp=0xc00004b7b8 sp=0xc00004b7b0 pc=0x4643e0 runtime.(*mheap).alloc(0x1c036000?, 0xe01b?, 0x78?) /Users/David/sdk/go1.20.4/src/runtime/mheap.go:955 +0x65 fp=0xc00004b800 sp=0xc00004b7b8 pc=0x427025 runtime.(*mcache).allocLarge(0x47047e?, 0x1c036000, 0x0) /Users/David/sdk/go1.20.4/src/runtime/mcache.go:234 +0x85 fp=0xc00004b848 sp=0xc00004b800 pc=0x4167e5 runtime.mallocgc(0x1c036000, 0x757080, 0x1) /Users/David/sdk/go1.20.4/src/runtime/malloc.go:1053 +0x4fe fp=0xc00004b8b0 sp=0xc00004b848 pc=0x40d6de runtime.growslice(0xc05ca3c000, 0x15?, 0xc00004b9c0?, 0x1?, 0x757080) /Users/David/sdk/go1.20.4/src/runtime/slice.go:274 +0x4e9 fp=0xc00004b910 sp=0xc00004b8b0 pc=0x44c3a9 main.(*server).handleUpload(0xc00005c240, {0x0?, 0x820a00?}, 0xc000138600, {0xc000098008, 0x8}) /Users/David/Codes/GoLand/file-server/handleFile.go:87 +0x2ad fp=0xc00004ba00 sp=0xc00004b910 pc=0x70290d main.(*server).taskDelegation(0xc00005c240, {0x823000, 0xc000012140}, 0xc000138600) /Users/David/Codes/GoLand/file-server/route.go:25 +0x252 fp=0xc00004bbc0 sp=0xc00004ba00 pc=0x704652 main.(*server).ServeHTTP(0xc00005c240, {0x823000, 0xc000012140}, 0xc000138600) /Users/David/Codes/GoLand/file-server/server.go:144 +0x4eb fp=0xc00004bca0 sp=0xc00004bbc0 pc=0x70608b net/http.serverHandler.ServeHTTP({0xc00001a0a8?}, {0x823000, 0xc000012140}, 0xc000138600) /Users/David/sdk/go1.20.4/src/net/http/server.go:2936 +0x316 fp=0xc00004bd50 sp=0xc00004bca0 pc=0x6a2ff6 net/http.initALPNRequest.ServeHTTP({{0x8232b8?, 0xc0001588a0?}, 0xc00010e700?, {0xc000146000?}}, {0x823000, 0xc000012140}, 0xc000138600) /Users/David/sdk/go1.20.4/src/net/http/server.go:3545 +0x245 fp=0xc00004bed8 sp=0xc00004bd50 pc=0x6a4ee5 net/http.(*initALPNRequest).ServeHTTP(0x40b5b6?, {0x823000?, 0xc000012140?}, 0x0?) \u0026lt;autogenerated\u0026gt;:1 +0x55 fp=0xc00004bf20 sp=0xc00004bed8 pc=0x6b3fb5 net/http.Handler.ServeHTTP-fm({0x823000?, 0xc000012140?}, 0xc00001c2e8?) \u0026lt;autogenerated\u0026gt;:1 +0x42 fp=0xc00004bf50 sp=0xc00004bf20 pc=0x6b4dc2 It seems that the server is trying to allocate memory to a slice, and the size of the slice is too large, so the server is killed by the OS.\nCheck the code snippet I provided before, there is:\n1 2 3 4 5 6 7 8 9 10 11 12 13 for { // reader.NextPart() will close the previous part automatically. part, err := reader.NextPart() if err != nil { if err == io.EOF { // finish reading all parts, exit the loop break } errs = append(errs, uploadError{Message: fmt.Sprintf(\u0026#34;reader.NextPart(): %v\u0026#34;, err)}) continue } } What if the error is not io.EOF, but other errors? Then there will be a infinite loop, this is the reason why the CPU usage is high. What I do is to limit the size of the error message:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 if err != nil { if err == io.EOF { // finish reading all parts, exit the loop break } errs = append(errs, uploadError{Message: fmt.Sprintf(\u0026#34;reader.NextPart(): %v\u0026#34;, err)}) // too many errors, stop uploading, you must limit the number of errors in case of infinite loop. if len(errs) \u0026gt;= 10 { errs = append(errs, uploadError{Message: \u0026#34;Maximum error limit reached\u0026#34;}) return } continue } # 3. Solution for slow uploading speed I ask this question in Go community that I joined, and I got a suggestion:\nForm Upload(multipart/form-data) is not good for large files, when uploading a large file, we usually use Binary Stream Uploads(application/octet-stream) instead, use r.Body directly to read the file content, and write the content to the disk this is real streaming.\nActually, with multipart/form-data, the file content is read by block, not the real streaming, you can check the code I provided before: part, err := reader.NextPart().\nSo use PUT with application/octet-stream instead of multipart/form-data to upload large files.\nBut after I change the code to use POST with application/octet-stream, the uploading speed is still slow.\nThen I monitor the disk I/O speed and network speed and found the reason, the network speed is around 7MB/s, which is the bottleneck.\n1 2 dstat -d # check the disk speed at real time dsat -n # check the network speed at real time But why the speedtest-cli shows the network speed is fast but the real speed is slow?\n1 2 3 Download: 298.52 Mbit/s Testing upload speed...................................................................................................... Upload: 192.82 Mbit/s ","date":"2024-04-12T10:42:22Z","permalink":"https://blog.yorforger.cc/p/an-analysis-of-high-cpu-and-ram-usage-caused-by-go-program/","title":"An Analysis of high CPU and RAM usage caused by Go Program"},{"content":"æˆ‘æ­£ä½¿ç”¨ github pages è‡ªå®šä¹‰åŸŸååŠŸèƒ½, ç„¶åæˆ‘ä¸ºæˆ‘çš„åŸŸåyorforger.cc æ·»åŠ äº†ä¸€ä¸ª CNAME è®°å½•å³: blog.yorforger.cc -\u0026gt; shwezhu.github.io\nç„¶åæˆ‘åœ¨ GitHub pages çš„è‡ªå®šä¹‰åŸŸåé¡µé¢å¡«å…¥ blog.yorforger.cc, ç„¶åä¸€åˆ‡å·¥ä½œæ­£å¸¸, æˆ‘å¯ä»¥é€šè¿‡ blog.yorforger.cc æ¥è®¿é—®æˆ‘éƒ¨ç½²åœ¨ GitHub pages ä¸Šçš„åšå®¢.\næˆ‘è¿˜æœ‰ä¸ªåŸŸå yorblogger.top æ‰˜ç®¡åœ¨äº† Cloudflare, æˆ‘å°±æƒ³ æ˜¯ä¸æ˜¯ æˆ‘å¯ä»¥ç»™å®ƒæ·»åŠ ä¸€ä¸ª CNAME è®°å½•, æ¯”å¦‚: blog.yorblogger.top -\u0026gt; blog.yorforger.cc\nè¿™æ ·å½“æˆ‘è®¿é—® blog.yorblogger.top, DNS æœåŠ¡å™¨ä¼šå»æŸ¥è¯¢ blog.yorforger.cc çš„åœ°å€, æœ€åæ‰¾åˆ° shwezhu.github.io ç„¶åè®¿é—®æˆ‘çš„åšå®¢, ä½†æ˜¯å½“æˆ‘å°è¯•åœ¨æµè§ˆå™¨è®¿é—®blog.yorblogger.top çš„æ—¶å€™, github æç¤º 404: There isn\u0026rsquo;t a GitHub Pages site here.\nå¯ä»¥çœ‹åˆ°æˆ‘ç¡®å®é€šè¿‡ blog.yorblogger.top è®¿é—®åˆ°äº† shwezhu.github.io, ä½†æ˜¯ GitHub Pages æœåŠ¡å™¨è¿”å›äº† 404 é”™è¯¯, è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?\næˆ‘çœ‹åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ Can github pages CNAME file contain more than one domain? - Stack Overflow\nNo, this is not possible. See the GitHub Help docs that explain this: Ensure you only have one domain listed in your CNAME file. If you wish to have multiple domains pointing to the same Pages, you will need to set up redirects for the other domains. Most domain registrars and DNS hosts offer this service to their customers.\næ ¹æ®æ–‡æ¡£, æˆ‘ä»¬éœ€è¦è®¾ç½®é‡å®šå‘, åˆšå¥½ Cloudflare ä¹Ÿæä¾›äº†è¿™ä¸ªæœåŠ¡, å…·ä½“å¯å‚è€ƒ: Redirect one domain to another\næ ¹æ®æ–‡æ¡£, éšä¾¿ä¸ºæˆ‘çš„åŸŸåæ·»åŠ äº†ä¸ª A è®°å½•, ç„¶åè®¾ç½®é‡å®šå‘è§„åˆ™, å…·ä½“å¦‚ä¸‹:\næ­¤æ—¶, å½“æˆ‘è®¿é—® yorblogger.top æ—¶, ä¼šè‡ªåŠ¨é‡å®šå‘åˆ° blog.yorforger.cc, ä¸€åˆ‡å·¥ä½œæ­£å¸¸.\nåæ¥æˆ‘æƒ³è®© blog.yorblogger.top é‡å®šå‘åˆ° blog.yorforger.cc, ç„¶åç®€å•è®¾ç½®äº†ä¸€ä¸‹:\nåœ¨ DNS Record æŠŠ www è®°å½•æ”¹ä¸º blog å» Rules -\u0026gt; Redirect Rules æ·»åŠ ä¸€ä¸ªè§„åˆ™, ä¸ä¸Šå›¾ç›¸åŒåªæ˜¯æŠŠ hostname=yorblogger.top æ”¹ä¸º hostname=blog.yorblogger.top ","date":"2024-04-07T21:43:22Z","permalink":"https://blog.yorforger.cc/p/cname-%E6%8C%87%E5%90%91-github-pages-%E9%97%AE%E9%A2%98/","title":"CNAME æŒ‡å‘ GitHub Pages é—®é¢˜"},{"content":" # 1. DNS Hierarchy DNSæœåŠ¡å™¨æ€ä¹ˆä¼šçŸ¥é“æ¯ä¸ªåŸŸåçš„IPåœ°å€å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ†çº§æŸ¥è¯¢, ä»”ç»†çœ‹ä¸‹é¢DNSè§£æè¿‡ç¨‹ï¼Œæ¯ä¸ªåŸŸåçš„å°¾éƒ¨éƒ½å¤šäº†ä¸€ä¸ªç‚¹.\nå¤šå‡ºçš„é‚£ä¸ª.æ˜¯Root Level Domain, æ¯”å¦‚www.example.comçœŸæ­£çš„åå­—æ˜¯www.example.com.rootç„¶åä¸Šå›¾å°±ç®€å†™ä¸ºwww.example.com. å› ä¸ºæ ¹åŸŸå.rootå¯¹äºæ‰€æœ‰åŸŸåéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¹³æ—¶æ˜¯çœç•¥çš„ã€‚\nåŸŸåçš„å±‚çº§ç»“æ„: hostname.SLD.TLD.root, hostname ä¹Ÿå« subdomain.\n# 2. HOSTNAME vs SLD HOSTNAME å’ŒäºŒçº§åŸŸå(SLD)æ˜¯ä¸ä¸€æ ·çš„, äºŒçº§åŸŸåæ˜¯æŒ‡example.comé‡Œé¢çš„example, è€ŒHOSTNAMEæ˜¯æŒ‡www.example.comé‡Œé¢çš„www.\nHOSTNAME çš„ä½œç”¨æ˜¯ä¸ºäº†åŒºåˆ†åŒä¸€ä¸ªåŸŸåä¸‹çš„ä¸åŒæœåŠ¡, æ¯”å¦‚www.example.comå’Œblog.example.comæ˜¯åŒä¸€ä¸ªåŸŸåä¸‹çš„ä¸åŒæœåŠ¡, ç°åœ¨éƒ½æ˜¯é‡‡ç”¨å¾®æœåŠ¡åˆ†å¸ƒå¼æ¶æ„, å³æ¯ä¸ªæœåŠ¡é€šå¸¸ä¸åœ¨ä¸€ä¸ªä¸»æœº, è¿™æ ·ç”¨æˆ·è®¿é—®www.example.comå’Œblog.example.comæ—¶å°±ä¼šè®¿é—®åˆ°ä¸åŒçš„æœåŠ¡å™¨, ä»è€Œæä¾›ä¸åŒçš„æœåŠ¡. å¦‚ä¸‹å›¾å¯ä»¥çœ‹å‡ºä¸€ä¸ª HOSTNAME å¯ä»¥å¯¹åº”ä¸€ä¸ª IP:\n# 3. DNS Records # 3.1. A Record å¸¸è§çš„ DNS Records æœ‰ A, CNAME, TXT, å…¶ä¸­ A è®°å½•æ˜¯æœ€å¸¸è§çš„, ç”¨äºå°†åŸŸåæŒ‡å‘ä¸€ä¸ª ipv4 IPåœ°å€, CNAME è®°å½•ç”¨äºå°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸå.\nå½“ä½ æƒ³ç»™åŸŸåæ·»åŠ ä¸€ä¸ª ip åœ°å€æ—¶, åªèƒ½æ·»åŠ  A è®°å½•. æ·»åŠ  A è®°å½•æ—¶éœ€è¦æŒ‡å®š HOSTNAME å’Œ IP, å…¶ä¸­ HOSTNAME å¯ä»¥å¡«@æˆ–è€…wwwæˆ–blogç­‰, @ä»£è¡¨ç©ºå³ä¸å¡«,\nä¸€èˆ¬åŸŸåè‡ªå¸¦é»˜è®¤çš„ DNS Records, æ‰€ä»¥ä¹°äº†åŸŸåä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹å°±åº”è¯¥åˆ é™¤è¿™äº›é»˜è®¤è®°å½•, ä¸ç„¶ç­‰ä½ åˆæ·»åŠ äº†ä¸€ä¸ªAè®°å½•, è¿™æ—¶å€™ä½ çš„åŸŸåå°±ä¼šè¢«è§£æåˆ°å¤šä¸ªIP(é»˜è®¤çš„å’Œä½ åˆšæ·»åŠ çš„), é‚£æµè§ˆå™¨è®¿é—®ä½ åŸŸåçš„æ—¶å€™, é€‰æ‹©å“ªä¸ªå‘¢? æˆ‘æŸ¥äº†ä¸€ä¸‹è®ºå›, æœ‰äººè¯´æ˜¯choose randomly, æ‰€ä»¥å¦‚æœä½ ä¸åˆ é™¤åŸŸåæ‰€æœ‰çš„é»˜è®¤DNS Records, é‚£æµè§ˆå™¨è®¿é—®ä½ åŸŸåçš„æ—¶å€™å°±æœ‰å¯èƒ½é€‰æ‹©â€œé”™è¯¯â€çš„ip,\nYes you can. It is called round-robin DNS, and the browser just chooses one of them randomly. It is a well used method of getting cheap load balancing, but if one host goes down, users will still try to access it. https://serverfault.com/q/528742/761923\n# 3.2. CNAME Record Use a CNAME record instead of an A record when one domain or subdomain is just another name for a different domain. All CNAME records must point to a domain, never to an IP address.\ndomain: example.com, subdomain: blog.example.com\nå‡è®¾ä½ æœ‰ä¸ªä¸»ç½‘ç«™ example.comï¼Œå®ƒæœ‰ä¸€ä¸ªAè®°å½•æŒ‡å‘IPåœ°å€ 123.45.67.89ã€‚è‹¥ä½ è¿˜æƒ³é€šè¿‡ www.example.com è®¿é—®è¿™ä¸ªç½‘ç«™ï¼Œä½ å¯ä»¥ä¸º www è®¾ç½®ä¸€ä¸ªCNAMEè®°å½•ï¼ŒæŒ‡å‘ example.comï¼Œè€Œä¸æ˜¯å†æ¬¡åˆ›å»ºä¸€ä¸ªAè®°å½•æŒ‡å‘ 123.45.67.89ã€‚\nè¿™æ ·çš„è®¾ç½®å¦‚ä¸‹ï¼š\nexample.com Aè®°å½• -\u0026gt; 123.45.67.89 www.example.com CNAMEè®°å½• -\u0026gt; example.com å½“ç”¨æˆ·å°è¯•è®¿é—® www.example.com æ—¶ï¼ŒDNSè§£ææµç¨‹å¦‚ä¸‹ï¼š\nDNSæŸ¥æ‰¾ www.example.com çš„è®°å½•ã€‚ æ‰¾åˆ°CNAMEè®°å½•ï¼Œäº†è§£åˆ° www.example.com æ˜¯ example.com çš„åˆ«åã€‚ æ¥ç€ï¼ŒDNSä¼šè§£æ example.com çš„Aè®°å½•ï¼Œè·å–å…¶IPåœ°å€ 123.45.67.89ã€‚ ç”¨æˆ·çš„è¯·æ±‚æœ€ç»ˆè¢«å®šå‘åˆ°IPåœ°å€ 123.45.67.89ï¼Œä¹Ÿå°±æ˜¯ example.com æ‰€åœ¨çš„æœåŠ¡å™¨ã€‚ ä½ å¯èƒ½ä¼šå¥½å¥‡, ä¸ºä»€ä¹ˆä¸ç›´æ¥ç»™ www.example.com æ·»åŠ ä¸€ä¸ª A è®°å½•, æŒ‡å‘ 123.45.67.89 å‘¢?\nå†æ¬¡åˆ›å»ºä¸€ä¸ªAè®°å½•æŒ‡å‘ 123.45.67.89 ä»¥é€šè¿‡ www.example.com è®¿é—®ç½‘ç«™æ˜¯å®Œå…¨å¯è¡Œçš„ã€‚ ç„¶è€Œï¼Œé€‰æ‹©ä¸º www ä½¿ç”¨CNAMEè®°å½•è€Œä¸æ˜¯å¦ä¸€ä¸ªAè®°å½•ä¸»è¦æ˜¯ä¸ºäº†ç»´æŠ¤ç®€ä¾¿æ€§ï¼šæ¯”å¦‚å¦‚æœä½ çš„æœåŠ¡å™¨IPåœ°å€å‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶åªéœ€è¦æ›´æ–° example.com çš„Aè®°å½•ã€‚æ‰€æœ‰æŒ‡å‘ example.com çš„CNAMEè®°å½•ï¼ˆå¦‚ www.example.comï¼‰å°†è‡ªåŠ¨æŒ‡å‘æ–°çš„IPåœ°å€ã€‚å¦‚æœä½¿ç”¨Aè®°å½•ï¼Œä½ éœ€è¦æ‰‹åŠ¨æ›´æ–° example.com å’Œ www.example.com çš„Aè®°å½•ã€‚\nGithub Pages çš„ custom domain å°±å¯ä»¥ä½¿ç”¨ CNAME è®°å½•, å³åªéœ€ç®€å•ç»™ä½ çš„åŸŸåæ·»åŠ ä¸€ä¸ª CNAME è®°å½•, æŒ‡å‘ username.github.io å³å¯. æ³¨æ„æ·»åŠ  CNAME è®°å½•æ—¶, æˆ‘çš„ HOSTNAME å¡«çš„æ˜¯ blog, å³ blog.example.com æŒ‡å‘ username.github.io, ä½ ä¹Ÿå¯ä»¥æŠŠ HOSTNAME è®¾ç½®ä¸ºç©º, è‹¥ä¸ºç©ºåˆ™ä»£è¡¨ä½ çš„ä¸»åŸŸå example.com æŒ‡å‘ username.github.io, æ ¹æ®ä¸ªäººå–œå¥½æ¥è®¾ç½®.\n# 3.3. TTL Field å¦å¤– DNS Records æœ‰ä¸€ä¸ªå­—æ®µå« TTL, è¿™é‡Œä»‹ç»ä¸€ä¸‹: Time to Live (TTL) is a field on DNS records that controls how long each record is valid and â€” as a result â€” how long it takes for record updates to reach your end users. Longer TTLs speed up DNS lookups by increasing the chance of cached results, but a longer TTL also means that updates to your records take longer to go into effect.\n# 4. æ€»ç»“ ä¹°è¿‡æ¥åŸŸå, æ ¹æ®ä¸åŒæƒ…å†µå¯èƒ½åšçš„ä¿®æ”¹å¦‚ä¸‹:\næ— æ‰˜ç®¡åŸŸå, åˆ™ç›´æ¥å»ä½ çš„åŸŸåæ³¨å†Œå•†é‚£é‡Œæ·»åŠ  DNS Records, ä¸€èˆ¬æ˜¯æ·»åŠ  A è®°å½•, æŒ‡å‘ä½ çš„æœåŠ¡å™¨ IP åœ°å€ å³å¯. è‹¥è¦å°†åŸŸåæ‰˜ç®¡åˆ°å…¶ä»–åœ°æ–¹ (å¦‚ Cloudflare), åˆ™åªéœ€è¦ä¿®æ”¹åŸŸåçš„ Nameserver ä¸º Cloudflare æŒ‡å®šçš„çš„ Nameserver å³å¯. ä¹‹ååœ¨ Cloudflare ä¸Šå³æ·»åŠ ç®¡ç†ä¸åŒç±»ä¼¼çš„ DNS Records. References:\nTime to Live (TTL) Â· Cloudflare DNS docs ä»€ä¹ˆæ˜¯ DNS CNAME è®°å½•ï¼Ÿ | Cloudflare What is DNS Hierarchy? ","date":"2024-04-07T00:15:30Z","permalink":"https://blog.yorforger.cc/p/dns-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/","title":"DNS åŸºç¡€æ¦‚å¿µ"},{"content":" # R2 vs S3 Cloudflare R2 vs AWS S3 | Review Pricing \u0026amp; Features | Cloudflare\n# Install mc (MinIO Client) 1 2 3 4 # just install minio client not minio server brew install minio/stable/mc mc alias set r2 R2-URL AccessKey SecretKey The MinIO client provides identical commands to Unix file management commands, such as cp and ls, but is designed for both local and remote storage systems. Itâ€™s fully compatible with AWS S3.\n# Common Commands 1 2 3 4 5 mc ls \u0026lt;ALIAS\u0026gt;/\u0026lt;BucketName\u0026gt;: List all objects in a bucket. mc cp -r \u0026lt;LOCAL-FOLDER-PATH\u0026gt; \u0026lt;ALIAS\u0026gt;/\u0026lt;BUCKET\u0026gt;/\u0026lt;REMOTE-FOLDER-PATH\u0026gt;: Upload a folder to a bucket. mc rm \u0026lt;ALIAS\u0026gt;/\u0026lt;BUCKET\u0026gt;/\u0026lt;OBJECT\u0026gt;: Remove an object. # PicGo with R2 You need install a S3 plugin to use R2 as a storage service.\nHere is how to configure S3:\nè‡ªå®šä¹‰åŸŸåä¸ä¸€å®šéè¦å¡«ä½ è‡ªå·±ä¹°çš„åŸŸå, ä½ ä½¿ç”¨ R2 æœåŠ¡, CF å·²ç»ç»™ä½ ä¸€ä¸ªè‡ªå®¶çš„ subdomain äº†, å¯ä»¥ç›´æ¥å¡«åœ¨è¿™. éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯: å¡«å†™è‡ªå®šä¹‰åŸŸåçš„çš„æ—¶å€™éœ€è¦åœ¨ååŠ ä¸€ä¸ª /blogs, å› ä¸ºæ­¤æ’ä»¶ä¸Šä¼ æ–‡ä»¶æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸ bucket åŒåçš„æ–‡ä»¶å¤¹, å¹¶ä¸æ˜¯ç›´æ¥åœ¨æ ¹ç›®å½•ä¸Šä¼ æ–‡ä»¶, ç„¶åæ¯æ¬¡ä¸Šä¼ å®Œè‡ªåŠ¨å¤åˆ¶çš„ url å¹¶ä¸å¸¦ /blogs, æ‰€ä»¥éœ€è¦æ‰‹åŠ¨åŠ ä¸Š, å¯ä»¥æ ¹æ®ä½ çš„å®é™…æƒ…å†µæ¥æ·»åŠ è·¯å¾„,\nReleases Â· Molunerfinn/PicGo\nMacOS cannot open the app because it is from an unidentified developer, check the solution\nCloudFlare R2æ­å»ºä¸ªäººå›¾åºŠ\n","date":"2024-04-06T18:28:22Z","permalink":"https://blog.yorforger.cc/p/cloudflare-r2/","title":"Cloudflare R2"},{"content":" # 1. Issue When I use wget to download some files, I got the following error:\n1 2 $sh -c \u0026#34;$(wget https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)\u0026#34; Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|2606:50c0:8002::154|:443... You can use curl to replace wget, or you can get the ip address of the domain and add it to /etc/hosts file.\n1 185.199.108.133 raw.githubusercontent.com You can find the ip address with dig/ping command or on the some online tool website. ping probably won\u0026rsquo;t work.\n","date":"2024-03-29T20:28:22Z","permalink":"https://blog.yorforger.cc/p/wget-connecting-timeout-issue/","title":"Wget Connecting Timeout Issue"},{"content":" # 1. Minor tricks # 1.1. array It is useful to remember which operations on arrays mutate them, and which donâ€™t. For example, push, pop, reverse, and sort will mutate the original array, but slice, filter, and map will create a new one.\nfilter() creates a shallow copy of a portion of a given array.\n1 2 3 4 5 6 7 8 if (isEmpty) { postList = \u0026lt;h1\u0026gt;No posts found.\u0026lt;/h1\u0026gt; } else { // return a new array postList = posts.map(post =\u0026gt; ( \u0026lt;SimplePostCard post={post} key={post._id} onDelete={() =\u0026gt; handleDeletePost(post._id)}/\u0026gt; )); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // state åæœŸå¯ä»¥ç”¨æ•°æ®åº“ä»£æ›¿ const UsersState = { users: [], setUsers: function (newUsersArray) { this.users = newUsersArray } } // ä»UsersStateä¸­åˆ é™¤æŒ‡å®šçš„ç”¨æˆ· function userLeavesApp(id) { UsersState.setUsers( // filter è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ æµ…æ‹·è´ shallow copy // filter() creates a shallow copy of a portion of a given array UsersState.users.filter(user =\u0026gt; user.id !== id) ) } // åœ¨ç”¨æˆ·åŠ å…¥èŠå¤©å®¤æ—¶æ¿€æ´»ç”¨æˆ·ï¼Œå¹¶ç¡®ä¿ UsersState ä¸­æ²¡æœ‰é‡å¤çš„ç”¨æˆ· function activateUser(id, name, room) { const user = { id, name, room } UsersState.setUsers([ ...UsersState.users.filter(user =\u0026gt; user.id !== id), user ]) return user } # 1.2. string length The length of a String value is the length of the string in UTF-16 code units not the number of characters. learn more: String: length - JavaScript | MDN\n1 2 3 console.log(\u0026#39;a\u0026#39;.length); // 1 console.log(\u0026#39;æ±‰\u0026#39;.length); // 1 console.log(\u0026#39;ğŸ˜€\u0026#39;.length); // 2 1 UTF-16 code unit = 16 bits = 2 bytes\n# 1.3. encding string to utf-8 in JS TextEncoder: TextEncoder - Web APIs | MDN\n# 1.4. localStorage localStorage calculates its size limit based on the number of UTF-16 code units, not bytes. You can use the length property to get the number of code units in a string.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function setLocalStorageSize() { localStorage.clear(); if (localStorage \u0026amp;\u0026amp; !localStorage.getItem(\u0026#39;size\u0026#39;)) { let i = 0; try { // Roughly 10240000 UTF-16 code units. for (i = 250; i \u0026lt;= 10000; i += 250) { // A character is 1B, (i * 1024) = i * 1KB localStorage.setItem(\u0026#39;test\u0026#39;, new Array((i * 1024) + 1).join(\u0026#39;a\u0026#39;)); } } catch (e) { localStorage.removeItem(\u0026#39;test\u0026#39;); // size in utf-16 code units, not bytes. localStorage.setItem(\u0026#39;size\u0026#39;, String(i - 250)); console.log(\u0026#39;localStorage size: \u0026#39; + (i - 250) + \u0026#39;*1024 code units\u0026#39;); } } } // will print: 5000*1024 code units If you change the code above to:\n1 localStorage.setItem(\u0026#39;test\u0026#39;, new Array((i * 1024) + 1).join(\u0026#39;æ±‰\u0026#39;)); Stil will print: 5000*1024 code units, because æ±‰ is 1 UTF-16 code unit same as a.\nBut if you change the code above to:\n1 localStorage.setItem(\u0026#39;test\u0026#39;, new Array((i * 1024) + 1).join(\u0026#39;ğŸ˜€\u0026#39;)); Will print: 2500*1024 code units, because ğŸ˜€ is 2 UTF-16 code units.\n# 2. Spread operator Spread operator ...:\nFunction arguments list (myFunction(a, \u0026hellip;iterableObj, b)) Array literals ([1, \u0026hellip;iterableObj, \u0026lsquo;4\u0026rsquo;, \u0026lsquo;five\u0026rsquo;, 6]) Object literals ({ \u0026hellip;obj, key: \u0026lsquo;value\u0026rsquo; }) 1 2 3 4 5 6 7 8 9 10 // We pass a function as argument to setPost(), like a callback, which will return a new state object. // React will call this callback with the previous state `post` as argument. setPost(prevPost =\u0026gt; ({ ...prevPost, // object spread syntax comments: [data, ...prevPost.comments], // array spread syntax engagement: { ...prevPost.engagement, // object spread syntax numComments: prevPost.engagement.numComments + 1, } })); Arrow function will return the value of the expression by default, so we don\u0026rsquo;t need to use return keyword.\n# 3. Falsy values In JavaScript, we have 6 falsy values:\nfalse 0 (zero) â€˜â€™ or â€œâ€ (empty string) null undefined NaN All these return false when they are evaluated.\n1 2 3 4 // this just for simplicity, no this syntax if(false/0/\u0026#39;\u0026#39;/null/undefined/NaN) { console.log(\u0026#34;never executed\u0026#34;) } # 4. Catching errors # 4.1. Catching errors in async functions In JavaScript, try...catch blocks are designed to handle errors in synchronous code. However, they do not work as expected with asynchronous code, unless used in conjunction with async/await.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 function fetchData() { return new Promise((resolve, reject) =\u0026gt; { // Simulate an asynchronous operation that fails setTimeout(() =\u0026gt; reject(new Error(\u0026#34;Failed to fetch data\u0026#34;)), 1000); }); } // The catch block here does not catch the error from fetchData() function main() { try { fetchData().then((data) =\u0026gt; { console.log(data); }); } catch (error) { console.error(\u0026#39;Error:\u0026#39;); } } Correct approach:\n1 2 3 fetchData() .then(data =\u0026gt; console.log(data)) .catch(error =\u0026gt; console.error(\u0026#39;Error:\u0026#39;, error)); 1 2 3 4 5 6 7 8 async function loadData() { try { const data = await fetchData(); console.log(data); } catch (error) { console.error(\u0026#39;Error:\u0026#39;, error); } } # 4.2. Forget catching errors in neasted promises 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 function fetchPosts() { fetch(`/posts`, { method: \u0026#39;GET\u0026#39;, }) .then((res) =\u0026gt; { if (res.status === 401) { return redirect(\u0026#39;/login\u0026#39;); } // Catch block here does not catch errors from res.json() res.json().then(data =\u0026gt; setPosts(data)); }) .catch((err) =\u0026gt; { console.error(\u0026#39;error fetching post:\u0026#39;, err); }); } Your current code handles errors from the fetchcall itself but does not handle potential errors that may occur during the parsing of the response withres.json(). This could be improved by adding a .catch` block specifically for this parsing stage.\nSince you are using .then() for promise resolution, it\u0026rsquo;s fine. However, consider using an async function with await for better readability and easier error handling. This is more of a stylistic choice but can improve the clarity of your code.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 async function fetchPosts() { try { const res = await fetch(`/posts/${props.id}/`, { method: \u0026#39;GET\u0026#39;, credentials: \u0026#39;include\u0026#39;, }); if (!res.ok) { if (res.status === 401) { // Handle unauthorized access return redirectToLogin(); // Assuming redirectToLogin is a defined function } throw new Error(\u0026#39;Network response was not ok.\u0026#39;); } const data = await res.json(); setPosts(data); } catch (err) { console.error(\u0026#39;Error fetching posts:\u0026#39;, err); // Handle the error gracefully here } } # 5. await xxxx won\u0026rsquo;t return a promise but the actual result of the promise 1 2 3 4 5 6 7 8 9 async function handleGetPosts(req, res) { const posts = await fetchPosts(10); posts .then(...) .catch(...); } // You will get TypeError: posts.then is not a function The issue in your code is that you\u0026rsquo;re using await incorrectly with the fetchPosts function. When you use await, it waits for the promise to resolve and returns the result directly. Therefore, posts in your code is not a promise but the actual result of the promise.\n1 2 3 4 5 6 7 8 async function handleGetPosts(req, res) { try { const posts = await fetchPosts(10); ... } catch (err) { ... } } ","date":"2024-03-12T10:55:20Z","permalink":"https://blog.yorforger.cc/p/tricks-mistakes-in-javascript/","title":"Tricks \u0026 Mistakes in Javascript"},{"content":" # e.preventDefault() 1 2 3 4 5 6 7 8 9 10 11 function sendMessage(e) { e.preventDefault() // Submitting form would refresh the page, so we prevent page reload const input = document.querySelector(\u0026#39;input\u0026#39;) if (input.value) { ws.send(input.value) input.value = \u0026#34;\u0026#34; } input.focus() // Focus the input after sending the message } document.querySelector(\u0026#39;form\u0026#39;).addEventListener(\u0026#39;submit\u0026#39;, sendMessage) Usually used to prevent page reload when submit form.\n# defer attribute of \u0026lt;script\u0026gt; 1 2 3 4 5 6 7 \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Chat APP\u0026lt;/title\u0026gt; \u0026lt;script defer src=\u0026#34;js/app.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; ... A boolean value used to execute the script only after the browser completes the rendering activity.\nNote: The defer attribute can only be used when JavaScript is externally linked to the HTML file using the src attribute of the \u0026lt;script\u0026gt; tag.\n# innerHTML property innerHTML is a property of every element. It tells you what is between the starting and ending tags of the element, and it also let you sets the content of the element.\n1 2 3 4 5 6 \u0026lt;p class=\u0026#34;myp\u0026#34;\u0026gt;\u0026lt;a\u0026gt;hello hi ni\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;script\u0026gt; const myp = document.querySelector(\u0026#39;.myp\u0026#39;) console.log(myp.innerHTML) \u0026lt;/script\u0026gt; This will print a stirng:\n1 \u0026lt;a\u0026gt;hello hi ni\u0026lt;/a\u0026gt; The innerHTML property is part of the Document Object Model (DOM) that allows Javascript code to manipulate a website being displayed. Specifically, it allows reading and replacing everything within a given DOM element (HTML tag).\nReferences:\nWhat is the use of the defer attribute in the HTML ","date":"2024-03-07T20:02:10Z","permalink":"https://blog.yorforger.cc/p/html-basics/","title":"HTML Basics"},{"content":" 1 2 3 4 5 6 7 8 9 # make sure npm and node.js are install npm -v node -v # create folder and init node.js project mkdir ws-chat \u0026amp;\u0026amp; cd ws-chat npm init # execute js file touch index.js node xxx.js # or use \u0026#39;npm start\u0026#39; predefined in package.json # 1. Intro Node. js is not a programming language. Rather, it\u0026rsquo;s a runtime environment that\u0026rsquo;s used to run JavaScript outside the browser. For example on the server or in the command line.\nRecall a paragraph which introduces js engine:\nThe use of JavaScript engines is not limited to browsers. For example, the V8 engine is a core component of the Node.js. V8 is the Javascript engine inside of node.js that parses and runs your Javascript. The same V8 engine is used inside of Chrome to run javascript in the Chrome browser. Both chrome browser and node.js have v8 inside.\nA Node.js app runs in a single process, without creating a new thread for every request. Node.js provides a set of asynchronous I/O primitives in its standard library that prevent JavaScript code from blocking and generally, libraries in Node.js are written using non-blocking paradigms, making blocking behavior the exception rather than the norm.\n# 2. Install 1 2 3 4 # which will insatll both nodejs and npm brew install node # uninstall brew uninstall node Another way: go to Download | Node.js, note that when you install, the install pragram will reminds you:\n1 2 3 This package will install: â€¢\tNode.js v16.17.0 to /usr/local/bin/node â€¢\tnpm v8.15.0 to /usr/local/bin/npm # 3. npm npm is the package manager for JavaScript, commonly used with Node.js. It is widely used for managing dependencies in JavaScript projects and for running scripts defined in a project\u0026rsquo;s package.json file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 npm init: This command initializes a new Node.js project. It creates a package.json file which holds various metadata relevant to the project. npm install: This command is used to install dependencies listed in the package.json file. When used with the --save flag, it also updates the package.json file with the newly installed package. npm install \u0026lt;package-name\u0026gt;: This command installs a specific package. For example, npm install express installs the Express framework. npm install -g \u0026lt;package-name\u0026gt;: The -g flag installs the package globally, making it available as a command line tool. npm uninstall \u0026lt;package-name\u0026gt;: This command removes a package from the node_modules directory and updates the package.json file. npm update: This command updates the installed packages to their latest versions based on the version range specified in the package.json file. npm list: This command displays a tree of every package installed in the current project. References:\nAbout npm | npm Docs https://nodejs.dev/en/learn/ ","date":"2024-03-07T14:06:27Z","permalink":"https://blog.yorforger.cc/p/nodejs-intro/","title":"Nodejs Intro"},{"content":" # æµè§ˆå™¨ JS å¼‚æ­¥æ‰§è¡Œçš„åŸç† JS æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½åšä¸€ä»¶äº‹æƒ…ï¼Œä¸ºä»€ä¹ˆæµè§ˆå™¨å¯ä»¥åŒæ—¶æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡å‘¢ï¼Ÿ\nå› ä¸ºæµè§ˆå™¨æ˜¯å¤šçº¿ç¨‹çš„ï¼Œå½“ JS éœ€è¦æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œæµè§ˆå™¨ä¼šå¦å¤–å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œâ€œJS æ˜¯å•çº¿ç¨‹çš„â€æŒ‡çš„æ˜¯æ‰§è¡Œ JS ä»£ç çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œæ˜¯æµè§ˆå™¨æä¾›çš„ JS å¼•æ“çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ã€‚æµè§ˆå™¨ä¸­è¿˜æœ‰å®šæ—¶å™¨çº¿ç¨‹å’Œ HTTP è¯·æ±‚çº¿ç¨‹ç­‰ï¼Œè¿™äº›çº¿ç¨‹ä¸»è¦ä¸æ˜¯æ¥è·‘ JS ä»£ç çš„ã€‚\nä»¥ Chrome ä¸ºä¾‹ï¼Œæµè§ˆå™¨ä¸ä»…æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œè¿˜æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œå¦‚æ¸²æŸ“è¿›ç¨‹ã€GPU è¿›ç¨‹å’Œæ’ä»¶è¿›ç¨‹ç­‰ã€‚è€Œæ¯ä¸ª tab æ ‡ç­¾é¡µéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“è¿›ç¨‹ï¼Œæ‰€ä»¥ä¸€ä¸ª tab å¼‚å¸¸å´©æºƒåï¼Œå…¶ä»– tab åŸºæœ¬ä¸ä¼šè¢«å½±å“ã€‚ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œä¸»è¦é‡ç‚¹å…³æ³¨å…¶æ¸²æŸ“è¿›ç¨‹ï¼Œæ¸²æŸ“è¿›ç¨‹ä¸‹åŒ…å«äº† JS å¼•æ“çº¿ç¨‹ã€HTTP è¯·æ±‚çº¿ç¨‹å’Œå®šæ—¶å™¨çº¿ç¨‹ç­‰ï¼Œè¿™äº›çº¿ç¨‹ä¸º JS åœ¨æµè§ˆå™¨ä¸­å®Œæˆå¼‚æ­¥ä»»åŠ¡æä¾›äº†åŸºç¡€ã€‚\n# äº‹ä»¶é©±åŠ¨æµ…æ æµè§ˆå™¨å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡ŒåŸç†èƒŒåå…¶å®æ˜¯ä¸€å¥—äº‹ä»¶é©±åŠ¨çš„æœºåˆ¶ã€‚NodeJS å’Œæµè§ˆå™¨çš„è®¾è®¡éƒ½æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ç”±ç‰¹å®šçš„äº‹ä»¶æ¥è§¦å‘ç‰¹å®šçš„ä»»åŠ¡ï¼Œè¿™é‡Œçš„äº‹ä»¶å¯ä»¥æ˜¯ç”¨æˆ·çš„æ“ä½œè§¦å‘çš„ï¼Œå¦‚ click äº‹ä»¶ï¼›ä¹Ÿå¯ä»¥æ˜¯ç¨‹åºè‡ªåŠ¨è§¦å‘çš„ï¼Œæ¯”å¦‚æµè§ˆå™¨ä¸­å®šæ—¶å™¨çº¿ç¨‹åœ¨è®¡æ—¶ç»“æŸåä¼šè§¦å‘å®šæ—¶å™¨äº‹ä»¶ã€‚\näº†è§£æ›´å¤š: é¢è¯•å¿…é—®ä¹‹ JS äº‹ä»¶å¾ªç¯(Event Loop)ï¼Œçœ‹è¿™ä¸€ç¯‡è¶³å¤Ÿ - çŸ¥ä¹\n# JavaScript Event Loop æµè§ˆå™¨ nodes.js çš„äº‹ä»¶å¾ªç¯ä¸æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯æœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œåªè®¨è®ºæµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯ã€‚\nè°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ï¼š\nè°ƒç”¨æ ˆæ˜¯ä¸€ä¸ªLIFOï¼ˆåè¿›å…ˆå‡ºï¼‰ç»“æ„ï¼Œç”¨äºè·Ÿè¸ªç¨‹åºä¸­çš„å‡½æ•°è°ƒç”¨ã€‚ å½“ä¸€ä¸ªå‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œå®ƒè¢«æ·»åŠ åˆ°è°ƒç”¨æ ˆçš„é¡¶éƒ¨ï¼›å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå®ƒè¢«ä»æ ˆé¡¶ç§»é™¤ã€‚ äº‹ä»¶é˜Ÿåˆ—ï¼ˆEvent Queueï¼‰ï¼š\nå½“å¼‚æ­¥äº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ã€æ–‡ä»¶è¯»å–ç­‰ï¼‰å‘ç”Ÿæ—¶ï¼Œç›¸å…³çš„å›è°ƒå‡½æ•°è¢«æ·»åŠ åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚ äº‹ä»¶é˜Ÿåˆ—æ˜¯ä¸€ç§FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ç»“æ„ã€‚ äº‹ä»¶é˜Ÿåˆ—åˆ†ä¸ºä¸¤ç§ï¼šå®ä»»åŠ¡ï¼ˆMacro Tasksï¼‰å’Œå¾®ä»»åŠ¡ï¼ˆMicro Tasksï¼‰é˜Ÿåˆ—. å®ä»»åŠ¡ï¼ˆMacro Tasksï¼‰ä¸å¾®ä»»åŠ¡ï¼ˆMicro Tasksï¼‰ï¼š\nå®ä»»åŠ¡åŒ…æ‹¬è„šæœ¬æ‰§è¡Œã€setTimeoutã€setIntervalç­‰ã€‚ å¾®ä»»åŠ¡é€šå¸¸æ¥è‡ªPromiseã€MutationObserverç­‰ã€‚ åœ¨æ¯æ¬¡å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå¤„ç†æ‰€æœ‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶åå†æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚ ä¹Ÿæœ‰äººè¿™æ ·å»ç†è§£ï¼šå¾®ä»»åŠ¡æ˜¯åœ¨å½“å‰äº‹ä»¶å¾ªç¯çš„å°¾éƒ¨å»æ‰§è¡Œï¼›å®ä»»åŠ¡æ˜¯åœ¨ä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„å¼€å§‹å»æ‰§è¡Œã€‚ äº‹ä»¶å¾ªç¯çš„ä½œç”¨æ˜¯ç›‘æ§ Call Stack å’Œ Event Queue. å¦‚æœ Call Stack ä¸ºç©ºï¼Œäº‹ä»¶å¾ªç¯ä¼šæŸ¥çœ‹ Event Queueã€‚å¦‚æœäº‹ä»¶é˜Ÿåˆ—ä¸­æœ‰ç­‰å¾…çš„å›è°ƒå‡½æ•°ï¼Œäº‹ä»¶å¾ªç¯ä¼šå°†å®ƒä»¬ä¾æ¬¡ç§»åŠ¨åˆ° Call Stack ä¸­è¿›è¡Œæ‰§è¡Œã€‚è¿™ä¸ªå¾ªç¯è¿‡ç¨‹æ˜¯æŒç»­ä¸æ–­çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒè¢«ç§°ä¸ºâ€œäº‹ä»¶å¾ªç¯â€ã€‚\nReferences:\né¢è¯•å¿…é—®ä¹‹ JS äº‹ä»¶å¾ªç¯(Event Loop)ï¼Œçœ‹è¿™ä¸€ç¯‡è¶³å¤Ÿ - çŸ¥ä¹ Difference between the Event Loop in Browser and Node Js? - DEV Community The event loop - JavaScript | MDN The Node.js Event Loop, Timers, and process.nextTick() | Node.js ","date":"2024-01-27T22:54:02Z","permalink":"https://blog.yorforger.cc/p/event-loop-in-browser/","title":"Event Loop in Browser"},{"content":" # Definition In simple words, a loop invariant is some predicate (condition) that holds for every iteration of the loop. For example, let\u0026rsquo;s look at a simple for loop that looks like this:\n1 2 3 int j = 9; for(int i=0; i\u0026lt;10; i++) j--; In this example it is true (for every iteration) that i + j == 9. A weaker invariant that is also true is that i \u0026gt;= 0 \u0026amp;\u0026amp; i \u0026lt;= 10.\nAs people point out, the loop invariant must be true:\nbefore the loop starts before each iteration of the loop after the loop terminates å°±æ˜¯æ­£ç¡®çš„ç®—æ³•åœ¨å¾ªç¯çš„å„ä¸ªé˜¶æ®µ, æ€»æ˜¯å­˜åœ¨ä¸€ä¸ªå›ºå®šä¸å˜çš„ç‰¹æ€§, æ‰¾å‡ºè¿™ä¸ªç‰¹æ€§å¹¶ä¸”ä½ å†™çš„ä»£ç å¯ä»¥è¯æ˜å…¶å›ºå®šä¸å˜, åˆ™å¯æ¨æ–­å‡ºä½ å†™çš„ä»£ç æ˜¯æ­£ç¡®çš„. å¦‚ä½•è¯æ˜é‚£ä¸ªç‰¹æ€§(å¾ªç¯ä¸å˜å¼)å›ºå®šä¸å˜å‘¢? å…·ä½“çš„è¯´å°±æ˜¯è¯æ˜å®ƒæ»¡è¶³ä¸Šé¢çš„ä¸‰ä¸ªæ¡ä»¶.\n( although it can temporarily be false during the body of the loop ). On the other hand the loop conditional must be false after the loop terminates, otherwise the loop would never terminate. Thus the loop invariant and the loop conditional must be different conditions.\n# Example # Binary Search ç¬¬ä¸€æ­¥ç¡®å®šå¾ªç¯ä¸å˜é‡ï¼šåœ¨æ¯æ¬¡è¿­ä»£å¼€å§‹æ—¶ä»¥åŠå¾ªç¯ç»“æŸæ—¶ï¼Œå¦‚æœç›®æ ‡å…ƒç´ å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œåˆ™å®ƒå¿…å®šä½äºæ•°ç»„çš„ [low, high] ç´¢å¼•èŒƒå›´å†… (å·¦é—­å³é—­åŒºé—´)\nç¬¬äºŒæ­¥æ ¹æ®å¾ªç¯ä¸å˜é‡æ¥éªŒè¯è‡ªå·±å†™å¥½çš„ä»£ç  (æˆ–è€…å†™ä»£ç çš„æ—¶å€™å°±å¼€å§‹éªŒè¯):\n1 2 3 4 5 6 7 8 9 10 11 12 def search(self, nums, target): left = 0 right = len(nums) - 1 # è®°å¾—å‡1, å› ä¸ºæˆ‘ä»¬å¾ªç¯ä¸å˜é‡ä¸ºå·¦é—­å³é—­åŒºé—´ while left \u0026lt; right: m = (left + right) // 2 if target \u0026gt; nums[m]: left = m + 1 elif target \u0026lt; nums[m]: right = m - 1 else: return m return -1 ç¬¬ä¸‰æ­¥éªŒè¯ï¼š\nbefore the loop startsï¼šè‹¥ç›®æ ‡åœ¨æ•°ç»„ä¸­, åˆ™å…¶å¿…åœ¨ [left, high] åŒºé—´å†…, å› æ­¤å¾ªç¯ä¸å˜é‡æˆç«‹ before each iteration of the loop: æ¯æ¬¡è¿­ä»£å¼€å§‹æ—¶, æˆ‘ä»¬éƒ½ä¼šå°†æœç´¢åŒºé—´å‡åŠ, left = m + 1 æˆ– right = m - 1, æ’é™¤äº†å½“å‰ä¸­é—´å…ƒç´ , å› æ­¤å¾ªç¯ä¸å˜é‡æˆç«‹ after the loop terminates: å¾ªç¯ç»“æŸå, æœ‰å¯èƒ½æ˜¯ left == right, æ¯”å¦‚ [3, 3], è‹¥å…ƒç´ çš„indexå°±æ˜¯3, åˆ™é”™è¿‡äº†, å¾ªç¯ä¸å˜é‡ä¸æˆç«‹, å› æ­¤è¦ while ç»“æŸçš„æ¡ä»¶è¦æ”¹ä¸º left \u0026lt;= right è€Œä¸æ˜¯ left \u0026lt; right æ³¨æ„, å¾ªç¯ä¸å˜é‡æœ¬èº«ç”¨äºç¡®ä¿ç®—æ³•é€»è¾‘çš„æ­£ç¡®æ€§ï¼Œè€Œä¸ç›´æ¥æ¶‰åŠåˆ°å¦‚ä½•é¿å…æ­»å¾ªç¯, è‹¥ä¸Šé¢ä»£ç æ”¹ä¸ºå¦‚ä¸‹, åˆ™ä¼šæ­»å¾ªç¯:\n1 2 3 4 if target \u0026gt; nums[m]: left = m elif target \u0026lt; nums[m]: right = m è€Œæ­¤æ—¶å¾ªç¯ä¸å˜é‡ä»ç„¶æˆç«‹: è‹¥å­˜åœ¨, ç›®æ ‡å…ƒç´ åœ¨ [left, right] åŒºé—´å†…,\nã€‰ left = m + 1, æˆ– right = m - 1 ä¿è¯äº†æ¯æ¬¡è¿­ä»£éƒ½ä¼šæ’é™¤è‡³å°‘ä¸€ä¸ªå…ƒç´ , é¿å…äº†æ­»å¾ªç¯çš„å‘ç”Ÿ\nç»“åˆä»¥ä¸Šå„ä¸ªç®—æ³•ï¼Œå¯ä»¥æ‰¾å‡ºæ ¹æ®éœ€è¦å†™äºŒåˆ†æŸ¥æ‰¾çš„è§„å¾‹å’Œå…·ä½“æ­¥éª¤ï¼Œæ¯”æ­»è®°ç¡¬èƒŒè¦å¼ºä¸å°‘ï¼Œä¸‡å˜ä¸ç¦»å…¶å®—å˜›ï¼š\n(1)å¤§ä½“æ¡†æ¶å¿…ç„¶æ˜¯äºŒåˆ†ï¼Œé‚£ä¹ˆå¾ªç¯çš„keyä¸array[mid]çš„æ¯”è¾ƒå¿…ä¸å¯å°‘ï¼Œè¿™æ˜¯åŸºæœ¬æ¡†æ¶;\n(2)å¾ªç¯çš„æ¡ä»¶å¯ä»¥å…ˆå†™ä¸€ä¸ªç²—ç•¥çš„ï¼Œæ¯”å¦‚åŸå§‹çš„while(left\u0026lt;=right)å°±è¡Œï¼Œè¿™ä¸ªå¾ªç¯æ¡ä»¶åœ¨åé¢å¯èƒ½éœ€è¦ä¿®æ”¹ï¼›\n(3)ç¡®å®šæ¯æ¬¡äºŒåˆ†çš„è¿‡ç¨‹ï¼Œè¦ä¿è¯æ‰€æ±‚çš„å…ƒç´ å¿…ç„¶ä¸åœ¨è¢«æ’é™¤çš„å…ƒç´ ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œæ‰€æ±‚çš„å…ƒç´ è¦ä¹ˆåœ¨ä¿ç•™çš„å…¶ä½™å…ƒç´ ä¸­ï¼Œè¦ä¹ˆå¯èƒ½ä»ä¸€å¼€å§‹å°±ä¸å­˜åœ¨äºåŸå§‹çš„å…ƒç´ ä¸­ï¼›\n(4)æ£€æŸ¥æ¯æ¬¡æ’é™¤æ˜¯å¦ä¼šå¯¼è‡´ä¿ç•™çš„å€™é€‰å…ƒç´ ä¸ªæ•°çš„å‡å°‘ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œåˆ†æè¿™ä¸ªè¾¹ç•Œæ¡ä»¶ï¼Œå¦‚æœå®ƒèƒ½å¯¼è‡´å¾ªç¯çš„ç»“æŸï¼Œé‚£ä¹ˆæ²¡æœ‰é—®é¢˜ï¼›å¦åˆ™ï¼Œå°±ä¼šé™·å…¥æ­»å¾ªç¯ã€‚ä¸ºäº†é¿å…æ­»å¾ªç¯ï¼Œéœ€è¦ä¿®æ”¹å¾ªç¯æ¡ä»¶ï¼Œä½¿è¿™äº›æƒ…å†µèƒ½å¤Ÿç»ˆç»“ã€‚æ–°çš„å¾ªç¯æ¡ä»¶å¯èƒ½æœ‰å¤šç§é€‰æ‹©ï¼šwhile(left\u0026lt; right)ã€while(left\u0026lt; right-1)ç­‰ç­‰ï¼Œè¿™äº›å¾ªç¯æ¡ä»¶çš„å˜ç§åŒæ—¶æ„å‘³ç€å¾ªç¯ç»ˆæ­¢æ—¶å€™é€‰æ•°ç»„çš„å½¢æ€ã€‚\n(5)ç»“åˆæ–°çš„å¾ªç¯æ¡ä»¶ï¼Œåˆ†æç»ˆæ­¢æ—¶çš„å€™é€‰å…ƒç´ çš„å½¢æ€ï¼Œå¹¶å¯¹åˆ†æè¦æŸ¥æ‰¾çš„ä¸‹æ ‡æ˜¯å¦å®ƒä»¬ä¹‹ä¸­ã€åŒæ—¶æ˜¯å¦‚ä½•è¡¨ç¤ºçš„ã€‚\nå¯¹äº(3)ï¼Œæœ‰ä¸€äº›äºŒåˆ†ç®—æ³•å®ç°ä¸æ˜¯è¿™æ ·çš„ï¼Œå®ƒä¼šä½¿leftæˆ–rightåœ¨æœ€åä¸€æ¬¡å¾ªç¯æ—¶è¶Šç•Œï¼Œç›¸åº”çš„leftæˆ–rightæ˜¯æŸ¥æ‰¾çš„ç›®æ ‡çš„æœ€ç»ˆå€™é€‰ï¼Œè¿™ä¸€ç‚¹åœ¨ç†è§£æ—¶éœ€è¦æ³¨æ„ã€‚å½“ç„¶ï¼Œä¸åˆ©ç”¨è¿™ä¸ªæ€è·¯ä¹Ÿå¯ä»¥å†™å‡ºèƒ½å®ŒæˆåŠŸèƒ½çš„äºŒåˆ†æŸ¥æ‰¾ï¼Œè€Œä¸”æ˜“äºç†è§£ã€‚\nReferences:\nalgorithm - What is a loop invariant? - Stack Overflow åˆ©ç”¨å¾ªç¯ä¸å˜å¼å†™å‡ºæ­£ç¡®çš„äºŒåˆ†æŸ¥æ‰¾åŠå…¶è¡ç”Ÿç®—æ³• â€“ KelvinMao Blog ","date":"2024-01-19T20:32:25Z","permalink":"https://blog.yorforger.cc/p/loop-invariant/","title":"Loop Invariant"},{"content":" # 1. Quick start Execute the following commands at your terminal, you don\u0026rsquo;t need to execute them under your project folder, just execute them anywhere, it will install the protoc compiler and the protoc-gen-go and protoc-gen-go-grpc plugins into your $GOPATH/bin folder.\n1 2 3 4 5 6 7 # install protoc compiler $ brew install protobuf $ protoc --version # Ensure compiler version is 3+ # install plugins for $ go install google.golang.org/protobuf/cmd/protoc-gen-go@latest $ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest Update your $PATH so that the protoc compiler can find the plugins: export PATH=\u0026quot;$PATH:$(go env GOPATH)/bin\u0026quot;\n# 2. Usage protoc å‘½ä»¤çš„åŸºæœ¬ç”¨æ³•æ˜¯ protoc [OPTION] PROTO_FILES, å…¶ä¸­ OPTION åŒ…æ‹¬æœç´¢è·¯å¾„å‚æ•°, è¯­è¨€æ’ä»¶å‚æ•°ç­‰, PROTO_FILES æ˜¯è¦ç¼–è¯‘çš„ .proto æ–‡ä»¶. å¯ä»¥é€šè¿‡ protoc --help æŸ¥çœ‹æ‰€æœ‰å‚æ•°. ä¸‹é¢ä¸»è¦ä»‹ç» [OPTION] å‚æ•°.\n# 2.1. æœç´¢è·¯å¾„å‚æ•° -IPATH æˆ– --proto_path=PATH: æŒ‡å®šæœç´¢ .proto æ–‡ä»¶çš„ç›®å½• å¦‚: -I. è¡¨ç¤ºåœ¨å½“å‰ç›®å½•ä¸‹æœç´¢ å¦‚æœä¸æŒ‡å®šè¯¥å‚æ•°ï¼Œåˆ™é»˜è®¤åœ¨å½“å‰è·¯å¾„ä¸‹è¿›è¡Œæœç´¢ # 2.2. è¯­è¨€æ’ä»¶ protoc-gen-go protoc æœ¬èº«æ”¯æŒå¤šç§è¯­è¨€, \u0026ndash;cpp_out=ï¼Œ\u0026ndash;python_out=ç­‰, ä½†ä¸æ”¯æŒ Go ç”±googleç»´æŠ¤ï¼Œéœ€è¦å®‰è£… protoc æ’ä»¶ï¼š\n1 $ go install google.golang.org/protobuf/cmd/protoc-gen-go@latest ä¹‹å‰ä»‹ç»äº† go installä¼šæŠŠ protoc-gen-go å®‰è£…åˆ° $GOPATH/bin ç›®å½•ä¸‹, ä¹‹åå°±å¯ä»¥åœ¨ protoc å‘½ä»¤ä¸­ä½¿ç”¨ --go_out ç­‰å‚æ•°äº†.\næ³¨æ„: protoc-gen-go è¦æ±‚ pb (.proto) æ–‡ä»¶ä¸­å¿…é¡»æŒ‡å®š go åŒ…çš„è·¯å¾„, ä¾‹å¦‚ option go_package = \u0026quot;github.com/shwezhu/consignment-service/proto/consignment\u0026quot;. æ–‡ä»¶ç»“æ„: consignment-service/proto/consignment/consignment.proto\n1 2 3 4 5 6 7 8 $ protoc I. --go_out=. --go_opt=paths=source_relative \\ --go-grpc_out=. --go-grpc_opt=paths=source_relative \\ chat.proto # or $ protoc I. --go_out=. --go_opt=paths=import \\ --go-grpc_out=. --go-grpc_opt=paths=import \\ chat.proto è§£é‡Š:\n--go_out=. ä½œç”¨: æŒ‡å®šgoä»£ç ç”Ÿæˆçš„åŸºæœ¬è·¯å¾„ å±äºå“ªä¸ªæ’ä»¶ï¼šè¿™ä¸ªå‚æ•°æ˜¯ä¸º protoc-gen-go æ’ä»¶è®¾ç½®çš„ --go_opt=paths=source_relative å±äºå“ªä¸ªæ’ä»¶ï¼šè¿™åŒæ ·æ˜¯ä¸º protoc-gen-go æ’ä»¶è®¾ç½®çš„ ä¸€èˆ¬æœ‰ä¸¤ä¸ªå€¼: paths=source_relative å’Œ paths=import paths=source_relative: ä¾‹å¦‚ä½ çš„ .proto æ–‡ä»¶ä½äº proto/myapp/myproto.proto, è‹¥ä½¿ç”¨ paths=source_relative é€‰é¡¹ï¼Œç”Ÿæˆçš„ Go æ–‡ä»¶å°†ä¼šåœ¨ç±»ä¼¼ myapp/myproto.pb.go çš„è·¯å¾„ä¸‹ paths=import: ä¾‹å¦‚ä½ åœ¨ myproto.proto æ–‡ä»¶ä¸­æŒ‡å®šäº† option go_package = \u0026quot;github.com/example/project/proto\u0026quot;;ï¼Œé‚£ä¹ˆæ— è®º .proto æ–‡ä»¶çš„å®é™…ä½ç½®åœ¨å“ªé‡Œï¼Œç”Ÿæˆçš„ Go æ–‡ä»¶éƒ½å°†ä½¿ç”¨è¿™ä¸ªè·¯å¾„ä½œä¸ºåŒ…è·¯å¾„ --go-grpc_out=. å±äºå“ªä¸ªæ’ä»¶ï¼šè¿™ä¸ªå‚æ•°æ˜¯ä¸º protoc-gen-go-grpc æ’ä»¶è®¾ç½®çš„ --go-grpc_opt=paths=source_relative å±äºå“ªä¸ªæ’ä»¶ï¼šè¿™æ˜¯ä¸º protoc-gen-go-grpc æ’ä»¶è®¾ç½®çš„ protoc-gen-go vs protoc-gen-go-grpc: The old-way is using protoc-gen-go that generates both serialization of the protobuf messages and grpc code. Now protoc-gen-go no longer supports generating gRPC service definitions. For gRPC code, a new plugin called protoc-gen-go-grpc was developed by Go gRPC project. source\n# 2.3. grpc go æ’ä»¶ protoc-gen-go çº¯ç²¹ç”¨æ¥ç”Ÿæˆpb(.proto)åºåˆ—åŒ–ç›¸å…³çš„æ–‡ä»¶, ä¸å†æ‰¿è½½ gRPC ä»£ç ç”ŸæˆåŠŸèƒ½, ç”ŸæˆgRPCç›¸å…³ä»£ç éœ€è¦å®‰è£… grpc-go ç›¸å…³çš„æ’ä»¶ protoc-gen-go-grpc, å®‰è£…å‘½ä»¤å¦‚ä¸‹:\n1 $ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest æ’ä»¶ protoc-gen-go-grpc ä¹Ÿæœ‰ä¸¤ä¸ªå‚æ•°, ç±»ä¼¼ protoc-gen-go æ’ä»¶çš„ --go_out, --go_opt å‚æ•°, åˆ†åˆ«æ˜¯ --go-grpc_out, --go-grpc_opt, ç”¨æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„,\n# 3. Example æ–‡ä»¶ç»“æ„å¦‚ä¸‹:\n1 2 3 4 5 6 â¯ tree -L 4 . â”œâ”€â”€ Makefile â”œâ”€â”€ go.mod â”œâ”€â”€ proto â”‚Â â””â”€â”€ calculator.proto calculator.proto:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 syntax = \u0026#34;proto3\u0026#34;; // \u0026#34;./pb\u0026#34; æŒ‡å®šäº†ç”Ÿæˆçš„ Go æ–‡ä»¶å°†è¢«æ”¾ç½®åœ¨ç›¸å¯¹è·¯å¾„ ./pb çš„ç›®å½•ä¸‹ // è¿™é‡Œçš„ç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äº protoc å‘½ä»¤æ‰§è¡Œçš„ç›®å½•, è€Œä¸æ˜¯ç›¸å¯¹äº .proto æ–‡ä»¶çš„ç›®å½• // protoc-gen-go è¦æ±‚ `.proto` æ–‡ä»¶å¿…é¡»æŒ‡å®š go åŒ…çš„è·¯å¾„ option go_package = \u0026#34;./pb\u0026#34;; service Calculator { rpc Add(CalculationRequest) returns (CalculationResponse); rpc Subtract(CalculationRequest) returns (CalculationResponse); rpc Multiply(CalculationRequest) returns (CalculationResponse); rpc Divide(CalculationRequest) returns (CalculationResponse); rpc Sum(NumbersRequest) returns (CalculationResponse); } message CalculationRequest { int64 a = 1; int64 b = 2; } message CalculationResponse { int64 result = 1; } message NumbersRequest { repeated int64 numbers = 1; } Makefile:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # run: make generate generate: protoc --proto_path=proto proto/*.proto --go_out=. --go-grpc_out=. # 1. ä¸Šé¢ä½¿ç”¨çš„æ‰€æœ‰è·¯å¾„éƒ½æ˜¯ç›¸å¯¹ protoc å‘½ä»¤æ‰§è¡Œæ—¶æ‰€åœ¨çš„ç›®å½• # 2. --proto_path=proto: æŒ‡å®š .proto æ–‡ä»¶çš„æœç´¢è·¯å¾„, åœ¨è¿™ï¼Œç¼–è¯‘å™¨ä¼šåœ¨åä¸º proto çš„ç›®å½•ä¸‹æŸ¥æ‰¾ .proto æ–‡ä»¶, # ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ -IPATH å‘½ä»¤è¡Œå‚æ•°æ¥æŒ‡å®šæœç´¢è·¯å¾„ å¦‚ protoc -I. --go_out=. --go-grpc_out=. proto/*.proto # proto/*.proto : æŒ‡å®šè¦ç¼–è¯‘çš„ .proto æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº† proto ç›®å½•ä¸‹çš„æ‰€æœ‰ .proto æ–‡ä»¶, # ä¸æŒ‡å®šä¼šæŠ¥é”™, å› ä¸º protoc éœ€è¦çŸ¥é“è¦ç¼–è¯‘å“ªä¸ªæ–‡ä»¶, ä½ å¯ä»¥ä½¿ç”¨å¦‚ proto/xxx.proto # 3. --go_out=.: è¿˜è®°å¾—æˆ‘ä»¬åœ¨ .proto æ–‡ä»¶ä¸­æŒ‡å®šäº† go_package=\u0026#34;./pb\u0026#34; å—, # --go_out=. ä¸º go_package æŒ‡å®šäº†æ‰€åœ¨çš„å·¥ä½œç›®å½•, ä¸¾ä¾‹: # è‹¥ä½ ä½¿ç”¨ --go_out=abc, go_package=\u0026#34;./pb\u0026#34;, åˆ™ç”Ÿæˆçš„æ–‡ä»¶ä¼šæ”¾åœ¨ abc/pb ç›®å½•ä¸‹, å‰ææ˜¯ä½ å¾—å…ˆåˆ›å»º abc ç›®å½• # æˆ‘ä»¬åœ¨è¿™æŒ‡å®šçš„æ˜¯ --go_out=., æ‰€ä»¥æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶ä¼šæ”¾åˆ° ./pb ç›®å½•ä¸‹ æ‰§è¡Œ make generate å‘½ä»¤, æ–‡ä»¶ç»“æ„å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 â¯ tree -L 4 . â”œâ”€â”€ Makefile â”œâ”€â”€ go.mod â”œâ”€â”€ pb â”‚Â â”œâ”€â”€ calculator.pb.go â”‚Â â””â”€â”€ calculator_grpc.pb.go â”œâ”€â”€ proto â”‚Â â””â”€â”€ calculator.proto å®‰è£… grpc åŒ…, ç¼–å†™ç¨‹åº:\n1 â¯ go get google.golang.org/grpc åˆ›å»ºæ–‡ä»¶ server/main.go (æˆ‘çœç•¥äº†ä¸€äº›ä»£ç ):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package main type server struct { pb.UnimplementedCalculatorServer } func (s *server) Add( ctx context.Context, in *pb.CalculationRequest, ) (*pb.CalculationResponse, error) { return \u0026amp;pb.CalculationResponse{ Result: in.GetA() + in.GetB(), }, nil } func main() { listener, err := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8080\u0026#34;) if err != nil { log.Fatalln(\u0026#34;failed to create listener:\u0026#34;, err) } s := grpc.NewServer() // binds the Calculator service implementation to the gRPC server s. pb.RegisterCalculatorServer(s, \u0026amp;server{}) if err := s.Serve(listener); err != nil { log.Fatalln(\u0026#34;failed to serve:\u0026#34;, err) } } æœ€åæ–‡ä»¶ç»“æ„å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 â¯ tree -L 4 . â”œâ”€â”€ Makefile â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â”œâ”€â”€ pb â”‚Â â”œâ”€â”€ calculator.pb.go â”‚Â â””â”€â”€ calculator_grpc.pb.go â”œâ”€â”€ proto â”‚Â â””â”€â”€ calculator.proto â””â”€â”€ server â””â”€â”€ main.go è¿è¡ŒæœåŠ¡å™¨:\n1 â¯ go run server/main.go # 4. References (1) When RESTful architecture isn\u0026rsquo;t enough\u0026hellip;\n","date":"2024-01-19T00:01:08Z","permalink":"https://blog.yorforger.cc/p/ptotocol-buffers/","title":"Ptotocol Buffers"},{"content":" # go build vs go install The go install command builds and installs the packages named by the paths on the command line. Executables (main packages) are installed to the directory named by the GOBIN environment variable, which defaults to $GOPATH/bin or $HOME/go/bin if the GOPATH environment variable is not set.\nThe go install command behaves almost identically to go build, but instead of leaving the executable in the current directory, or a directory specified by the -o flag, it places the executable into the $GOPATH/bin directory.\n1 2 3 # check the $GOPATH â¯ go env GOPATH /Users/David/go Since go install will place generated executables into $GOPATH/bin, this directory must be added to the $PATH environment variable so that you can run the executables from the command line anywhere.\n# Commands commonly used in Go Modules go mod init github.com/your-username/your-repo-name (enabling dependency tracking in your code) To track and manage the dependencies you add, you begin by putting your code in its own module. This creates a go.mod file at the root of your source tree. Dependencies you add will be listed in that file.\ngo get (adding a dependency) The following describes a few examples.\nTo add all dependencies for a package in your module, run a command like the one below (\u0026quot;.\u0026quot; refers to the package in the current directory):\n1 $go get . To add a specific dependency, specify its module path as an argument to the command:\n1 $ go get github.com/example/xxmodule go mod tidy go mod tidy ensures that the go.mod file matches the source code in the module. It adds any missing module requirements necessary to build the current moduleâ€™s packages and dependencies, and it removes requirements on modules that donâ€™t provide any relevant packages. It also adds any missing entries to go.sum and removes unnecessary entries.\nReferences:\nGo Modules Reference - The Go Programming Language Managing dependencies - The Go Programming Language ","date":"2024-01-18T22:12:20Z","permalink":"https://blog.yorforger.cc/p/go-modules-and-environment/","title":"Go Modules and Environment"},{"content":" # Store string The most commonly used string data types in the context of databases are CHAR and VARCHAR. TEXT and LONGTEXT are also commonly used string data types.\nchar(10) vs varchar(10) When you define a column as CHAR(10), it will always occupy 10 characters of storage, regardless of the actual data length. If you store a string shorter than 10 characters, it will be padded with spaces to fill up the remaining space.\nWhen you define a column as VARCHAR(10), you store a string shorter than 10 characters, it will use only the necessary amount of storage, without any padding.\nIn general, the performance difference between CHAR and VARCHAR is usually negligible unless you\u0026rsquo;re dealing with extremely large datasets or have specific performance requirements.\nWhen the length of strings to be written to the field is explicitly specified choose CHAR as the data type. When the number of strings that users will input is not fixed, but there is a limit based on the number of characters, use VARCHAR as the data type. For example, for a username that can vary in length, VARCHAR is used as the data type.\n# å­˜å‚¨æ—¶é—´ # ä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸ å­—ç¬¦ä¸²å ç”¨çš„ç©ºé—´æ›´å¤§ å­—ç¬¦ä¸²å­˜å‚¨çš„æ—¥æœŸæ¯”è¾ƒæ•ˆç‡æ¯”è¾ƒä½ï¼ˆé€ä¸ªå­—ç¬¦è¿›è¡Œæ¯”å¯¹ï¼‰ï¼Œæ— æ³•ç”¨æ—¥æœŸç›¸å…³çš„ API è¿›è¡Œè®¡ç®—å’Œæ¯”è¾ƒ # Datetime and Timestamp Datetime å’Œ Timestamp æ˜¯ MySQL æä¾›çš„ä¸¤ç§æ¯”è¾ƒç›¸ä¼¼çš„ä¿å­˜æ—¶é—´çš„æ•°æ®ç±»å‹, é€šå¸¸æˆ‘ä»¬éƒ½ä¼šé¦–é€‰ Timestamp. å› ä¸ºDateTimeç±»å‹æ²¡æœ‰æ—¶åŒºä¿¡æ¯çš„, è€ŒTimestampå¯ä»¥å­˜å‚¨time zoneä¿¡æ¯, å¹¶ä¸”åšè½¬æ¢.\nTimestamp åªéœ€è¦ä½¿ç”¨ 4 ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ˜¯ DateTime éœ€è¦è€—è´¹ 8 ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åŒæ ·é€ æˆäº†ä¸€ä¸ªé—®é¢˜ï¼ŒTimestamp è¡¨ç¤ºçš„æ—¶é—´èŒƒå›´æ›´å°ã€‚\nDateTime ï¼š1000-01-01 00:00:00 ~ 9999-12-31 23:59:59 Timestampï¼š 1970-01-01 00:00:01 ~ 2037-12-31 23:59:59 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 CREATE TABLE `time_zone_test` ( `id` int NOT NULL AUTO_INCREMENT, `date_time` datetime DEFAULT NULL, `time_stamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`) ); INSERT INTO time_zone_test(date_time) VALUES(NOW()); select * from time_zone_test; +----+---------------------+---------------------+ | id | date_time | time_stamp | +----+---------------------+---------------------+ | 1 | 2023-04-01 10:45:04 | 2023-04-01 10:45:04 | +----+---------------------+---------------------+ è¿™ä¹Ÿè¯´æ˜äº†ä¸€ä¸ªé—®é¢˜, å°±æ˜¯æˆ‘ä»¬æ’å…¥æ•°æ®çš„æ—¶å€™, æ²¡å¿…è¦åœ¨é€»è¾‘ä¸Šè·å–æ—¶é—´å†åŠ å…¥, æˆ‘ä»¬åªéœ€è¦åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™è®¾ç½®ä¸€ä¸ªtime columnå¹¶ä¸ºå…¶è®¾ç½®defaultå€¼, å³å¯, æ¯æ¬¡åªç”¨åœ¨Javaä»£ç ä¸­æ’å…¥å…¶ä»–column, ç„¶åæ—¶é—´ä¼šè¢«mysqlè‡ªåŠ¨åŠ ä¸Šå».\nå¯¹äºä¸Šé¢çš„æ•°æ®, æˆ‘ä»¬ä¿®æ”¹ä¼šè¯çš„æ—¶åŒº, å¯ä»¥çœ‹åˆ°æ—¶é—´å°±å˜äº†:\n1 2 3 4 5 6 7 set time_zone=\u0026#39;+8:00\u0026#39;; +----+---------------------+---------------------+ | id | date_time | time_stamp | +----+---------------------+---------------------+ | 1 | 2023-04-01 10:45:04 | 2023-04-01 21:45:04 | +----+---------------------+---------------------+ # æŸ¥çœ‹ MySQL Warning æœ‰æ—¶å€™æˆ‘ä»¬åˆ›å»ºè¡¨çš„æ—¶å€™æˆ–è€…æ‰§è¡ŒSQLè¯­å¥, è™½ç„¶æ‰§è¡ŒæˆåŠŸäº†ä½†æ˜¯ä¼šæ˜¾ç¤ºæœ‰è­¦å‘Š,ä½†æ˜¯è¿˜ä¸å‘Šè¯‰ä½ è­¦å‘Šå†…å®¹, è¿™æ—¶å€™ä½ éœ€è¦ç«‹åˆ»æ‰§è¡ŒSHOW WARNINGS;è¯­å¥, å¦åˆ™ä½ æ‰§è¡Œäº†å…¶ä»–è¯­å¥å†æ‰§è¡Œè¿™ä¸ªshow, é‚£ç°å®çš„å°±ä¸æ˜¯ä¸Šä¸€ä¸ªè¯­å¥çš„warningsäº†, å¦‚ä¸‹å›¾:\n# Default vs NOT NULL æœ‰æ²¡æœ‰æƒ³è¿‡, å»ºè¡¨çš„æ—¶å€™default å’Œ not nullä¸€èµ·ä½¿ç”¨, æ˜¯ä¸æ˜¯æœ‰ç‚¹redundant? å› ä¸ºæ¯”å¦‚ä½ ä¸æ’å…¥å€¼çš„æ—¶å€™mysqlä¼šå¸®ä½ æ’å…¥é»˜è®¤å€¼,\nå…¶å®è¿™ä¹ˆæƒ³ä½ å°±é”™äº†, ä½ æƒ³çš„æ˜¯æˆ‘ä¸æ’å…¥, mysqlå°±ä¼šå¸®æˆ‘æ’å…¥ä¸ªé»˜è®¤å€¼, æ‰€ä»¥ä¼¼ä¹not nullæ²¡èµ·ä½œç”¨, ä½†æ˜¯ä½ æœ‰æ²¡æœ‰æƒ³è¿‡å¦‚æœä½ åªè®¾ç½®äº†defaultè€Œæ²¡æœ‰è®¾ç½®not nullé™åˆ¶, é‚£è¿™æ—¶å€™æˆ‘æ’å…¥nullä¸ªå‘¢, æ˜¾ç„¶å¯ä»¥æ’å…¥æˆåŠŸ, ä½†æœ‰æ—¶å€™ä¸ºnull, æ¯”å¦‚ä¸€ä¸ªæ—¥æœŸ, å½“æˆ‘ä»¬åœ¨å†™Javaæˆ–è€…å…¶ä»–ä»£ç çš„æ—¶å€™æŸ¥è¯¢æ•°æ®ç„¶åæŠŠdateè½¬ä¸ºstring, å¦‚æœæ•°æ®ä¸ºnullå¯èƒ½å°±ä¼šå‘ç”Ÿå¼‚å¸¸~\n# Naming conventions General\nUsing lowercase will help speed typing, avoid mistakes as MYSQL is case sensitive.\nSpace replaced with Underscore â€” Using space between words is not advised.\nNumbers are not for names â€” While naming, it is essential that it contains only Alpha English alphabets.\nTable\nTable names are lower case, uses underscores to separate words, and are singular (e.g. foo, foo_bar, etc. Columns\nAlways use the singular name. Always use lowercase except where it may make sense not to such as proper nouns. Where possible avoid simply using id as the primary identifier for the table. Do not add a column with the same name as its table and vice versa. I generally (not always) have a auto increment PK. I use the following convention: tablename_id (e.g. foo_id, foo_bar_id, etc.). å‚è€ƒ:\nMYSQL Naming Conventions. What is MYSQL? | by Centizen Nationwide | Medium Is there a naming convention for MySQL? - Stack Overflow SQL style guide by Simon Holywell MySQLæ•°æ®åº“ä¸­å¸¸è§çš„å‡ ç§è¡¨å­—æ®µæ•°æ®ç±»å‹ - æ˜é‡‘ è€ç”Ÿå¸¸è°ˆï¼æ•°æ®åº“å¦‚ä½•å­˜å‚¨æ—¶é—´ï¼Ÿä½ çœŸçš„çŸ¥é“å—ï¼Ÿ - æ˜é‡‘ ","date":"2024-01-10T23:06:36Z","permalink":"https://blog.yorforger.cc/p/practice-of-mysql/","title":"Practice of MySQL"},{"content":" # Denormalization # Normalization é¦–å…ˆï¼Œäº†è§£ä»€ä¹ˆæ˜¯ Normalization å¾ˆé‡è¦ã€‚åœ¨å…³ç³»å‹æ•°æ®åº“è®¾è®¡ä¸­ï¼ŒNormalization æ˜¯ä¸€ä¸ªç»„ç»‡æ•°æ®çš„è¿‡ç¨‹ï¼Œç›®çš„æ˜¯å‡å°‘æ•°æ®å†—ä½™å’Œæé«˜æ•°æ®å®Œæ•´æ€§ã€‚å®ƒæ¶‰åŠå°†æ•°æ®åˆ†è§£æˆå¤šä¸ªç›¸äº’å…³è”çš„è¡¨ã€‚è¿™ç§è®¾è®¡å‡å°‘äº†æ•°æ®çš„é‡å¤ï¼Œä½†é€šå¸¸ä¼šå¯¼è‡´æ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œå› ä¸ºéœ€è¦å¤šä¸ªJOINæ“ä½œæ¥é‡å»ºåŸå§‹ä¿¡æ¯ã€‚\n# Denormalization Denormalization æ˜¯ Normalization çš„å¯¹ç«‹é¢ã€‚å®ƒæ¶‰åŠå°†æ•°æ®ä»å¤šä¸ªè¡¨åˆå¹¶åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œæœ‰æ—¶é€šè¿‡æ·»åŠ å†—ä½™æ•°æ®æ¥å®ç°ã€‚åœ¨éå…³ç³»å‹æ•°æ®åº“ï¼Œå¦‚MongoDBä¸­ï¼ŒDenormalization é€šå¸¸è¡¨ç°ä¸ºï¼š\nåµŒå…¥å­æ–‡æ¡£ï¼šå°†ç›¸å…³çš„æ•°æ®ç›´æ¥åµŒå…¥åˆ°ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬åˆ†æ•£åˆ°å¤šä¸ªé›†åˆï¼ˆè¡¨ï¼‰ä¸­ã€‚ä¾‹å¦‚ï¼Œè€Œä¸æ˜¯åœ¨å•ç‹¬çš„é›†åˆä¸­ç»´æŠ¤ç”¨æˆ·åœ°å€ï¼Œå¯ä»¥å°†åœ°å€ä½œä¸ºå­æ–‡æ¡£ç›´æ¥åµŒå…¥åˆ°ç”¨æˆ·æ–‡æ¡£ä¸­ã€‚\nä½¿ç”¨æ•°ç»„ï¼šåœ¨æ–‡æ¡£ä¸­ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨ç›¸å…³é¡¹çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªäº§å“æ–‡æ¡£å¯èƒ½åŒ…å«ä¸€ä¸ªè¯„è®ºçš„æ•°ç»„ï¼Œè€Œä¸æ˜¯å°†è¯„è®ºå­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„é›†åˆä¸­ã€‚\n# Denormalization çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ ä¼˜ç‚¹ï¼š\næé«˜æŸ¥è¯¢æ€§èƒ½ï¼šç”±äºç›¸å…³æ•°æ®æ›´ç´§å¯†åœ°å­˜å‚¨åœ¨ä¸€èµ·ï¼Œå› æ­¤å‡å°‘äº†æŸ¥è¯¢æ‰€éœ€çš„JOINæ“ä½œæˆ–è·¨æ–‡æ¡£æŸ¥æ‰¾ã€‚ ç®€åŒ–æŸ¥è¯¢é€»è¾‘ï¼šæ•°æ®æ¨¡å‹æ›´ç›´è§‚ï¼Œå®¹æ˜“ç†è§£å’Œæ“ä½œï¼Œç‰¹åˆ«æ˜¯å¯¹äºæ–‡æ¡£æ•°æ®åº“ã€‚ ç¼ºç‚¹ï¼š\næ•°æ®å†—ä½™(Data Redundancy)ï¼šç›¸åŒçš„æ•°æ®åœ¨å¤šä¸ªåœ°æ–¹é‡å¤ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®åŒæ­¥é—®é¢˜ã€‚ æ›´æ–°æ“ä½œå¤æ‚åŒ–(Complexity in Updates)ï¼šå½“éœ€è¦æ›´æ–°å†—ä½™æ•°æ®æ—¶ï¼Œå¯èƒ½éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹è¿›è¡Œæ›´æ–°ï¼Œå¢åŠ äº†å¤æ‚æ€§ã€‚ # ç»“è®º åœ¨MongoDBè¿™æ ·çš„éå…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œåè§„èŒƒåŒ–æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®å»ºæ¨¡æŠ€æœ¯ï¼Œç‰¹åˆ«é€‚ç”¨äºè¯»å–æ“ä½œè¿œå¤šäºå†™å…¥æ“ä½œçš„åœºæ™¯ã€‚å®ƒé€šè¿‡ç‰ºç‰²ä¸€å®šç¨‹åº¦çš„æ•°æ®å†—ä½™æ¥æ¢å–è¯»å–æ€§èƒ½çš„æå‡å’ŒæŸ¥è¯¢é€»è¾‘çš„ç®€åŒ–ã€‚ç„¶è€Œï¼Œè®¾è®¡æ—¶éœ€è¦å¹³è¡¡å†—ä½™å¸¦æ¥çš„ç®¡ç†å¤æ‚æ€§å’Œæ€§èƒ½ä¼˜åŠ¿ã€‚\n# Join \u0026amp; Foreign Key Join: MySQL: JOINS are easy (INNER, LEFT, RIGHT) Foreign Key is used to ensure the consistency and integrity of data. æ—¢ç„¶æœ‰äº† join, ä¸ºä»€ä¹ˆè¿˜éœ€è¦ foreign key: https://chat.openai.com/share/419afe95-279b-477f-8afa-8f75ab76edad MongoDB æ²¡æœ‰ join å’Œ foreign key çš„çš„æ¦‚å¿µ, ä½†æ˜¯å¯ä»¥é€šè¿‡åµŒå¥—æ–‡æ¡£æ¥å®ç°ç±»ä¼¼ Join çš„åŠŸèƒ½, ä»¥åŠä½¿ç”¨ Reference æ¥å®ç°ç±»ä¼¼ Foreign Key çš„åŠŸèƒ½.\nJOINæ“ä½œç»å¸¸åˆ©ç”¨å¤–é”®æ¥è¿æ¥ä¸¤ä¸ªè¡¨, è™½ç„¶JOINæ“ä½œä¸ä¸€å®šè¦æ±‚å­˜åœ¨å¤–é”®çº¦æŸ, ä½†å¤–é”®ä¸ºJOINæä¾›äº†è‡ªç„¶çš„è¿æ¥ç‚¹, å¦‚ä¸‹ä¾‹å­:\nUsersè¡¨ å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼šUserID (ç”¨æˆ·IDï¼Œä¸»é”®), UserName (ç”¨æˆ·å) Ordersè¡¨ å­˜å‚¨è®¢å•ä¿¡æ¯ï¼šOrderID (è®¢å•IDï¼Œä¸»é”®) OrderDate (è®¢å•æ—¥æœŸ) UserID (ç”¨æˆ·IDï¼Œå¤–é”®) åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼ŒOrders.UserID æ˜¯ä¸€ä¸ªå¤–é”®ï¼Œå®ƒæŒ‡å‘Users.UserIDã€‚è¿™æ„å‘³ç€æ¯ä¸ªè®¢å•éƒ½ä¸ä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·ç›¸å…³è”ï¼Œå¤–é”®ä¿è¯äº†æ¯ä¸ªè®¢å•ä¸­çš„UserIDéƒ½å¯¹åº”äºä¸€ä¸ªæœ‰æ•ˆçš„ç”¨æˆ·ã€‚å‡è®¾æˆ‘ä»¬æƒ³è·å–è®¢å•ä¿¡æ¯ä»¥åŠä¸‹å•çš„ç”¨æˆ·çš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLæŸ¥è¯¢ï¼š\n1 2 3 SELECT Users.UserName, Orders.OrderID, Orders.OrderDate FROM Orders JOIN Users ON Orders.UserID = Users.UserID; è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼š\nJOIN Users ON Orders.UserID = Users.UserIDè¿™ä¸€å¥æ˜¯JOINçš„æ ¸å¿ƒï¼Œå®ƒè¯´æ˜äº†å¦‚ä½•è¿æ¥è¿™ä¸¤ä¸ªè¡¨ã€‚æˆ‘ä»¬é€šè¿‡Ordersè¡¨ä¸­çš„UserIDï¼ˆå¤–é”®ï¼‰ä¸Usersè¡¨ä¸­çš„UserIDï¼ˆä¸»é”®ï¼‰è¿›è¡ŒåŒ¹é…ã€‚ ç”±äºä½¿ç”¨äº†JOINï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶ä»Ordersè¡¨å’ŒUsersè¡¨ä¸­é€‰æ‹©æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªæŸ¥è¯¢ç»“æœä¸­åŒæ—¶çœ‹åˆ°ç”¨æˆ·çš„åå­—å’Œä»–ä»¬çš„è®¢å•ä¿¡æ¯ã€‚ # One to Many \u0026amp; Many to Many ä¸€å¯¹å¤šå…³ç³»ï¼šé€šè¿‡åœ¨â€œå¤šâ€çš„ä¸€æ–¹è¡¨ä¸­è®¾ç½®å¤–é”®æŒ‡å‘â€œä¸€â€çš„ä¸€æ–¹çš„ä¸»é”®æ¥å®ç°ã€‚ å¤šå¯¹å¤šå…³ç³»ï¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªé¢å¤–çš„å…³è”è¡¨ï¼Œå…¶ä¸­åŒ…å«æŒ‡å‘ä¸¤ä¸ªç›¸å…³è¡¨ä¸»é”®çš„å¤–é”®æ¥å®ç°ã€‚ åœ¨ä¸€å¯¹å¤šå…³ç³»ä¸­ï¼Œä¸€ä¸ªè®°å½•åœ¨ä¸€ä¸ªè¡¨ä¸­å¯¹åº”ç€å¤šä¸ªè®°å½•åœ¨å¦ä¸€ä¸ªè¡¨ä¸­ã€‚è¿™ç§å…³ç³»é€šå¸¸é€šè¿‡åœ¨â€œå¤šâ€çš„ä¸€æ–¹ä½¿ç”¨å¤–é”®ï¼ˆForeign Keyï¼‰æ¥å®ç°ã€‚å¦‚ Posts è¡¨å’Œ Comments è¡¨, æ­¤æ—¶ Comments è¡¨ä¸­çš„ PostID å°±æ˜¯ä¸€ä¸ªå¤–é”®, å®ƒæŒ‡å‘ Posts è¡¨ä¸­çš„ PostID. é€šè¿‡è¿™ä¸ªå¤–é”®, æˆ‘ä»¬å¯ä»¥è¿½è¸ªå“ªä¸ªè¯„è®ºå±äºå“ªä¸ªå¸–å­, ä»è€Œå®ç°ä¸€å¯¹å¤šå…³ç³»ã€‚\nå¤šå¯¹å¤šå…³ç³»æ˜¯æŒ‡ä¸¤ä¸ªè¡¨ä¸­çš„è®°å½•å¯ä»¥ç›¸äº’å…³è”, åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­, è¿™ç§å…³ç³»é€šå¸¸é€šè¿‡ç¬¬ä¸‰ä¸ªè¡¨ï¼ˆç§°ä¸ºå…³è”è¡¨æˆ–è¿æ¥è¡¨ï¼‰æ¥å®ç°ï¼Œè¿™ä¸ªè¡¨åŒ…å«äº†ä¸¤ä¸ªè¡¨çš„å¤–é”®. å‡è®¾æœ‰ä¸¤ä¸ªè¡¨ï¼šStudents å’Œ Courses:\nStudentsè¡¨ å­˜å‚¨å­¦ç”Ÿçš„ä¿¡æ¯ï¼Œå¦‚ï¼š\nStudentID (ä¸»é”®) StudentName Coursesè¡¨ å­˜å‚¨è¯¾ç¨‹çš„ä¿¡æ¯ï¼Œå¦‚ï¼š\nCourseID (ä¸»é”®) CourseName Enrollmentsè¡¨ ä½œä¸ºå…³è”è¡¨ï¼Œå­˜å‚¨å­¦ç”Ÿå’Œè¯¾ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚ï¼š\nEnrollmentID (ä¸»é”®) StudentID (å¤–é”®ï¼ŒæŒ‡å‘Studentsè¡¨) CourseID (å¤–é”®ï¼ŒæŒ‡å‘Coursesè¡¨) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯ä¸ªå­¦ç”Ÿå¯ä»¥é€‰ä¿®å¤šä¸ªè¯¾ç¨‹ï¼ŒåŒæ—¶æ¯ä¸ªè¯¾ç¨‹ä¹Ÿå¯ä»¥è¢«å¤šä¸ªå­¦ç”Ÿé€‰ä¿®ã€‚é€šè¿‡Enrollmentsè¡¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿½è¸ªå“ªä¸ªå­¦ç”Ÿé€‰ä¿®äº†å“ªä¸ªè¯¾ç¨‹ï¼Œä»è€Œå®ç°å¤šå¯¹å¤šå…³ç³»ã€‚\n# One-to-Many and Many-to-Many in NoSQL MongoDB # One-to-Many ä¸€å¯¹å¤šå…³ç³»åœ¨MongoDBä¸­é€šå¸¸æœ‰ä¸¤ç§è¡¨ç¤ºæ–¹å¼ï¼š\nåµŒå…¥æ–‡æ¡£ï¼ˆEmbedded Documentsï¼‰:\nåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œ\u0026lsquo;å¤š\u0026rsquo;çš„éƒ¨åˆ†ä½œä¸ºå­æ–‡æ¡£åµŒå…¥åˆ°\u0026rsquo;ä¸€\u0026rsquo;çš„éƒ¨åˆ†ä¸­ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªåœ°å€ï¼Œé‚£ä¹ˆåœ°å€å¯ä»¥ç›´æ¥åµŒå…¥åˆ°ç”¨æˆ·æ–‡æ¡£ä¸­ã€‚ ç¤ºä¾‹:\n1 2 3 4 5 6 7 8 { \u0026#34;_id\u0026#34;: \u0026#34;userId123\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;addresses\u0026#34;: [ {\u0026#34;street\u0026#34;: \u0026#34;123 Apple St\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;New York\u0026#34;}, {\u0026#34;street\u0026#34;: \u0026#34;456 Orange Ave\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;Boston\u0026#34;} ] } å¼•ç”¨ï¼ˆReferencesï¼‰:\nåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œ\u0026lsquo;å¤š\u0026rsquo;çš„ä¸€æ–¹ä¼šåŒ…å«æŒ‡å‘\u0026rsquo;ä¸€\u0026rsquo;æ–¹çš„å¼•ç”¨ï¼ˆé€šå¸¸æ˜¯IDï¼‰ã€‚ è¿™ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„å¤–é”® ç¤ºä¾‹:\n1 2 3 4 5 6 7 8 9 10 11 // User document { \u0026#34;_id\u0026#34;: \u0026#34;userId123\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34; } // Address documents [ {\u0026#34;_id\u0026#34;: \u0026#34;addressId1\u0026#34;, \u0026#34;userId\u0026#34;: ObjectID(\u0026#34;userId123\u0026#34;), \u0026#34;street\u0026#34;: \u0026#34;123 Apple St\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;New York\u0026#34;}, {\u0026#34;_id\u0026#34;: \u0026#34;addressId2\u0026#34;, \u0026#34;userId\u0026#34;: ObjectID(\u0026#34;userId123\u0026#34;), \u0026#34;street\u0026#34;: \u0026#34;456 Orange Ave\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;Boston\u0026#34;} ] Looking at how you model users and orders illustrates another common relationship: one-to-many. That is, every user has many orders. In an RDBMS, youâ€™d use a foreign key in your orders table; here, the convention is similar. Learn more: Action in MongoDB: 4.2.2 Users and orders (one-to-many)\n# Many-to-Many å¤šå¯¹å¤šå…³ç³»åœ¨MongoDBä¸­é€šå¸¸é€šè¿‡å¼•ç”¨æ¥è¡¨ç¤º, æ¯ä¸ªæ–‡æ¡£å­˜å‚¨ä¸ä¹‹ç›¸å…³è”çš„å…¶ä»–æ–‡æ¡£çš„ID, an array of object IDs.\näº†è§£æ›´å¤š: MongoDB in Action: 4.2.1 Many-to-many relationships\n# ç¤ºä¾‹ å‡è®¾æœ‰å­¦ç”Ÿå’Œè¯¾ç¨‹ï¼Œæ¯ä¸ªå­¦ç”Ÿå¯ä»¥é€‰ä¿®å¤šé—¨è¯¾ç¨‹ï¼Œæ¯é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥ç”±å¤šä¸ªå­¦ç”Ÿé€‰ä¿®ã€‚\nå­¦ç”Ÿæ–‡æ¡£å¯èƒ½åŒ…å«å®ƒä»¬æ‰€é€‰è¯¾ç¨‹çš„IDåˆ—è¡¨ã€‚\n1 2 3 4 5 { \u0026#34;_id\u0026#34;: \u0026#34;studentId1\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Alice\u0026#34;, \u0026#34;courses\u0026#34;: [\u0026#34;courseId1\u0026#34;, \u0026#34;courseId2\u0026#34;] } è¯¾ç¨‹æ–‡æ¡£å¯èƒ½åŒ…å«é€‰ä¿®è¯¥è¯¾ç¨‹çš„å­¦ç”ŸIDåˆ—è¡¨ã€‚\n1 2 3 4 5 { \u0026#34;_id\u0026#34;: \u0026#34;courseId1\u0026#34;, \u0026#34;courseName\u0026#34;: \u0026#34;Mathematics\u0026#34;, \u0026#34;students\u0026#34;: [\u0026#34;studentId1\u0026#34;, \u0026#34;studentId3\u0026#34;] } åµŒå…¥æ–‡æ¡£å¯ä»¥æé«˜è¯»å–æ€§èƒ½ï¼Œå› ä¸ºæ‰€æœ‰ç›¸å…³æ•°æ®éƒ½åœ¨ä¸€ä¸ªæ–‡æ¡£å†…ï¼›è€Œå¼•ç”¨æ›´çµæ´»ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°ç»´æŠ¤å¤§é‡åŠ¨æ€å…³è”æ•°æ®ã€‚\n","date":"2024-01-10T11:51:35Z","permalink":"https://blog.yorforger.cc/p/basic-mysql/","title":"Basic MySQL"},{"content":" # setState åŒæ­¥ OR å¼‚æ­¥ æˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç¡®, ä» API å±‚é¢ä¸Šè¯´, å®ƒå°±æ˜¯æ™®é€šçš„è°ƒç”¨æ‰§è¡Œçš„å‡½æ•°, è‡ªç„¶æ˜¯åŒæ­¥çš„. è¿™é‡Œæ‰€è¯´çš„åŒæ­¥å’Œå¼‚æ­¥æŒ‡çš„æ˜¯ API è°ƒç”¨åæ›´æ–° DOM æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„.\nå¦‚æœ setState åœ¨ React èƒ½å¤Ÿæ§åˆ¶çš„èŒƒå›´è¢«è°ƒç”¨ï¼Œå®ƒå°±æ˜¯å¼‚æ­¥çš„ã€‚ ä¾‹å¦‚ï¼šåˆæˆäº‹ä»¶å¤„ç†å‡½æ•°, ç”Ÿå‘½å‘¨æœŸå‡½æ•°, æ­¤æ—¶ä¼šè¿›è¡Œæ‰¹é‡æ›´æ–°, ä¹Ÿå°±æ˜¯å°†çŠ¶æ€åˆå¹¶åå†è¿›è¡Œ DOM æ›´æ–°ã€‚ å¦‚æœ setState åœ¨åŸç”Ÿ JavaScript æ§åˆ¶çš„èŒƒå›´è¢«è°ƒç”¨ï¼Œå®ƒå°±æ˜¯åŒæ­¥çš„ã€‚ ä¾‹å¦‚ï¼šåŸç”Ÿäº‹ä»¶å¤„ç†å‡½æ•°ä¸­, å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­, Ajax å›è°ƒå‡½æ•°ä¸­, æ­¤æ—¶ setState è¢«è°ƒç”¨åä¼šç«‹å³æ›´æ–° DOM ã€‚ ä¸€æ–‡å½»åº•ææ‡‚Reactçš„setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ - æ˜é‡‘\nReact é€šè¿‡å¼‚æ­¥æ›´æ–°çŠ¶æ€ï¼Œå¯ä»¥æ‰¹é‡å¤„ç†å¤šä¸ªçŠ¶æ€æ›´æ–°ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªçŠ¶æ€æ›´æ–°éƒ½é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚è¿™ç§æ‰¹å¤„ç†æ–¹å¼å‡å°‘äº†ä¸å¿…è¦çš„æ¸²æŸ“æ¬¡æ•°ï¼Œæé«˜äº†åº”ç”¨çš„æ€§èƒ½ã€‚(batch multiple state updates together, instead of re-rendering components for each individual state update.)\n# setState çš„å‘ åˆšå¼€å§‹å¾ˆå®¹æ˜“å†™å‡ºä»¥ä¸‹é”™è¯¯ä»£ç :\n1 2 3 4 5 const [age, setAge] = useState(0); function handleClick() { setAge(() =\u0026gt; age + 1); // ... è¿™æ ·è®¿é—®å‡†ç¡®æ¥è¯´å¹¶ä¸æ˜¯ä¸Šä¸€æ¬¡çš„state, è€Œæ˜¯ç»„ä»¶åœ¨å®ƒå½“æ—¶çŠ¶æ€å€¼, å› ä¸ºæœ‰å¯èƒ½å‘ç”Ÿå¤šæ¬¡è¿ç»­çš„çŠ¶æ€æ›´æ–°, æ¯”å¦‚å…¶å®ƒ event handler ä¹Ÿè°ƒç”¨äº† setAge å‡½æ•°, ä¸è¦å¿˜äº†è¿™äº› setXXX() æ˜¯å¼‚æ­¥çš„, ä¼šè¢«Reacté›†ä¸­åˆ°ä¸€èµ·æ‰§è¡Œ, æ‰€ä»¥è¦ç¡®ä¿ setAge() æ›´æ–°çš„æ˜¯ä¸Šä¸€æ¬¡çš„å€¼, è¦ä½¿ç”¨ï¼ˆå³ setXXX(previousState =\u0026gt; newState)ï¼‰ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„æ›´æ–°åŸºäºæœ€æ–°çš„çŠ¶æ€å€¼ã€‚\næ­£ç¡®æ–¹å¼å¦‚ä¸‹:\n1 2 3 4 5 const [age, setAge] = useState(0); function handleClick() { setAge(age =\u0026gt; age + 1); // ... æ³¨æ„ç¬¬äºŒä¸ª setXXX() çš„å‚æ•°æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°, è¿™ä¸ªåŒ¿åå‡½æ•°çš„å‚æ•°æ˜¯ä¸Šä¸€æ¬¡çš„ state, ç”± React è´Ÿè´£ä¼ å…¥, è¿”å›å€¼æ›´æ–°åçš„ state,\n# ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ This process of requesting and serving UI has three steps:\nTriggering a render A render is triggered when a componentâ€™s props or state changes. A render can also be triggered by its parent component re-rendering. è¿™é‡Œæ³¨æ„, ä½¿ç”¨è‡ªå®šä¹‰ hook æ—¶, å…¶è¿”å›çš„ state å˜åŒ–æ—¶, ä¹Ÿä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“. å¹¶ä¸æ˜¯è‡ªå®šä¹‰ hook çš„çŠ¶æ€æ”¹å˜è€Œå¯¼è‡´çš„é‡æ–°æ¸²æŸ“, è€Œæ˜¯è‡ªå®šä¹‰ hook è¿”å›çš„ state æ”¹å˜è€Œå¯¼è‡´çš„é‡æ–°æ¸²æŸ“. è‡ªå®šä¹‰ Hooks çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºå®ƒä»¬å…è®¸ä½ é‡ç”¨çŠ¶æ€é€»è¾‘ï¼Œè€Œä¸æ˜¯åˆ›å»ºå…¨æ–°çš„çŠ¶æ€æœºåˆ¶ã€‚æ¯æ¬¡åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ (è‹¥è¯¥ hook ä¸­å®šä¹‰äº† state const [xxx, setXXX] = useState(xx)) ï¼Œéƒ½ç›¸å½“äºåœ¨è¯¥ç»„ä»¶å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç‹¬ç«‹çŠ¶æ€ xxx, å› æ­¤å½“ hook ä¸­è°ƒç”¨ setXXX æ—¶, ä¼šè§¦å‘è¯¥ç»„ä»¶çš„é‡æ–°æ¸²æŸ“.\nRendering the component\nThe process of rendering is recursive. React commits changes to the DOM\nReact will apply the minimal necessary operations (calculated while rendering!) to make the DOM match the latest rendering output. Think the clock and input example. The default behavior of rendering all components nested within the updated component is not optimal for performance if the updated component is very high in the tree. If you run into a performance issue, there are several opt-in ways to solve it described in the Performance section. Donâ€™t optimize prematurely!\nWhen developing in â€œStrict Modeâ€, React calls each componentâ€™s function twice, which can help surface mistakes caused by impure functions. Source\nLearn more: Render and Commit â€“ React\n# ç»„ä»¶æ¸²æŸ“ä¼šå¯¼è‡´å¼‚æ­¥å‡½æ•°æš‚åœå— Reactç»„ä»¶çš„é‡æ–°æ¸²æŸ“ä¸ä¼šå¯¼è‡´å…¶ä¸­æ­£åœ¨æ‰§è¡Œçš„å¼‚æ­¥å‡½æ•°æš‚åœæˆ–ä¸­æ–­,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 function MyComponent() { console.log(\u0026#39;ç»„ä»¶å¼€å§‹æ¸²æŸ“\u0026#39;); // å¼‚æ­¥å‡½æ•° setTimeout(() =\u0026gt; { console.log(\u0026#39;å¼‚æ­¥å‡½æ•°æ‰§è¡Œ\u0026#39;); }, 0); console.log(\u0026#39;ç»„ä»¶æ¸²æŸ“ä¸­\u0026#39;); // ç»„ä»¶æ¸²æŸ“çš„è¿”å› return \u0026lt;div\u0026gt;Hello World\u0026lt;/div\u0026gt;; } // å½“MyComponentè¢«æ¸²æŸ“æ—¶ ReactDOM.render(\u0026lt;MyComponent /\u0026gt;, document.getElementById(\u0026#39;root\u0026#39;)); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“MyComponentç»„ä»¶å¼€å§‹æ¸²æŸ“æ—¶ï¼Œå®ƒé¦–å…ˆæ‰“å°\u0026quot;ç»„ä»¶å¼€å§‹æ¸²æŸ“\u0026quot;ã€‚æ¥ä¸‹æ¥ï¼Œå°½ç®¡æœ‰ä¸€ä¸ªsetTimeoutå¼‚æ­¥å‡½æ•°ï¼Œå®ƒä¸ä¼šç«‹å³æ‰§è¡Œã€‚ç›¸åï¼Œç»„ä»¶ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€è¡ŒåŒæ­¥ä»£ç ï¼Œæ‰“å°\u0026quot;ç»„ä»¶æ¸²æŸ“ä¸­\u0026quot;ã€‚åªæœ‰åœ¨æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œå³ç»„ä»¶æ¸²æŸ“å®Œæˆåï¼Œäº‹ä»¶å¾ªç¯æ‰ä¼šå¤„ç†setTimeoutä¸­çš„å¼‚æ­¥å›è°ƒï¼Œæ‰“å°\u0026quot;å¼‚æ­¥å‡½æ•°æ‰§è¡Œ\u0026quot;ã€‚\nå› æ­¤ï¼Œåœ¨Reactä¸­ï¼Œç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹æ˜¯ä¸ä¼šè¢«å…¶ä¸­çš„å¼‚æ­¥å‡½æ•°æ‰€æ‰“æ–­çš„ã€‚åŒæ­¥ä»£ç æ€»æ˜¯åœ¨å¼‚æ­¥ä»£ç ä¹‹å‰æ‰§è¡Œå®Œæ¯•ã€‚è¿™ä¿è¯äº†ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘çš„ä¸€è‡´æ€§å’Œå¯é¢„æµ‹æ€§ã€‚\n","date":"2024-01-07T19:27:22Z","permalink":"https://blog.yorforger.cc/p/rendering-react/","title":"Rendering - React"},{"content":" # State When you call useState, you are telling React that you want this component to remember something:\n1 const [index, setIndex] = useState(0); In this case, you want React to remember index.\nState is tied to a position in the render tree: When you give a component state, you might think the state â€œlivesâ€ inside the component. But the state is actually held inside React. React associates each piece of state itâ€™s holding with the correct component by where that component sits in the render tree. source\nHereâ€™s how that happens in action:\n1 const [index, setIndex] = useState(0); Your component renders the first time. Because you passed 0 to useState as the initial value for index, it will return [0, setIndex]. React remembers 0 is the latest state value. You update the state. When a user clicks the button, it calls setIndex(index + 1). index is 0, so itâ€™s setIndex(1). This tells React to remember index is 1 now and triggers another render. Your componentâ€™s second render. React still sees useState(0), but because React remembers that you set index to 1, it returns [1, setIndex] instead. State is local to a component instance on the screen. In other words, if you render the same component twice, each copy will have completely isolated state! Changing one of them will not affect the other.\nLearn more:\nState as a Snapshot â€“ React Queueing a Series of State Updates â€“ React # ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ Anything that results in changes that can be observed when the calculation is completed, beside the return value of the calculation itself, is a side effect. Calculation should return just result of the calculation. Anything else is side-effect. source\nComponents should only return their JSX, and not change any objects or variables that existed before renderingâ€”that would make them impure!\nWhile functional programming relies heavily on purity, at some point, somewhere, something has to change. Thatâ€™s kind of the point of programming! These changesâ€”updating the screen, starting an animation, changing the data (call setState)â€”are called side effects. Theyâ€™re things that happen â€œon the sideâ€, not during rendering.\næ‰€ä»¥ä¸¥æ ¼æ¥è¯´ console.log ä¹Ÿæ˜¯å‰¯ä½œç”¨.\nIn React, side effects usually belong inside event handlers. Event handlers are functions that React runs when you perform some actionâ€”for example, when you click a button. Even though event handlers are defined inside your component, they donâ€™t run during rendering! So event handlers donâ€™t need to be pure.\nIf youâ€™ve exhausted all other options and canâ€™t find the right event handler for your side effect, you can still attach it to your returned JSX with a useEffect call in your component. This tells React to execute it later, after rendering, when side effects are allowed. However, this approach should be your last resort.\nä¿®æ”¹æˆ–è¯»å–å¤–éƒ¨å˜é‡, ä¿®æ”¹ props æ˜¯ä¸è¢«å…è®¸çš„, åœ¨å“ªéƒ½ä¸è¡Œ, ä½ å¯ä»¥æŠŠ å¤–éƒ¨å˜é‡é€šè¿‡ props ä¼ è¿›æ¥, ç„¶ååœ¨ç»„ä»¶å†…éƒ¨è¯»å–.\nLearn more: Keeping Components Pure â€“ React\n# å‡½æ•°ç»„ä»¶æ— å‰¯ä½œç”¨ # Render logic must not Same inputs, same output: å‡½æ•°ç»„ä»¶çš„è¾“å‡ºï¼ˆå³æ¸²æŸ“çš„UIï¼‰ä»…ä¾èµ–äºå®ƒçš„propså’Œstateã€‚æ¢å¥è¯è¯´ï¼Œç»™å®šç›¸åŒçš„propså’Œstateï¼Œç»„ä»¶å°†å§‹ç»ˆæ¸²æŸ“ç›¸åŒçš„è¾“å‡ºã€‚\nä¸æ”¹å˜å¤–éƒ¨çŠ¶æ€: åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œå‡½æ•°ç»„ä»¶ä¸åº”è¯¥æ”¹å˜å¤–éƒ¨çŠ¶æ€ï¼Œä¸åº”è¯¥ç›´æ¥ä¿®æ”¹ä¼ å…¥çš„propsæˆ–å¤–éƒ¨çš„å…¨å±€å˜é‡ã€‚\næ³¨æ„ props, å’Œ å¤–éƒ¨çš„å˜é‡ å°±æ˜¯ä¸å…è®¸è¢«ä¿®æ”¹çš„, å³ä½¿åœ¨ event handler ä¸­, ä¹Ÿä¸èƒ½ä¿®æ”¹, è¿™æ˜¯ React çš„è®¾è®¡å“²å­¦ state æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„, ä½†æ˜¯åªèƒ½é€šè¿‡ setState åœ¨ event handler æˆ–ä¸€äº› hooksä¸­ä¿®æ”¹, ä¸èƒ½åœ¨æ¸²æŸ“é€»è¾‘ä¸­ä¿®æ”¹, å¦åˆ™ä¼šå¯¼è‡´æ­»å¾ªç¯. å®˜æ–¹æ–‡æ¡£æœ‰ä¾‹å­, åœ¨æ–‡ç« æœ€å: https://react.dev/learn/keeping-components-pure The React philosophy is that props should be immutable and top-down. This means that a parent can send whatever prop values it likes to a child, but the child cannot modify its own props. What you do is react to the incoming props and then, if you want to, modify your child\u0026rsquo;s state based on incoming props. source\næ— å‰¯ä½œç”¨æ“ä½œ: å‡½æ•°ç»„ä»¶åœ¨å…¶ä¸»ä½“å†…(æ¸²æŸ“é€»è¾‘ä¸­)ä¸åº”è¯¥æ‰§è¡Œæœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ç›´æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ã€è®¢é˜…äº‹ä»¶ã€ç›´æ¥æ“ä½œDOMç­‰ã€‚è¿™äº›æ“ä½œåº”è¯¥æ”¾åœ¨ event handlers æˆ–é’©å­ï¼ˆå¦‚useEffectï¼‰ä¸­ã€‚ Can event handlers have side effects? Absolutely! Event handlers are the best place for side effects. Unlike rendering functions, event handlers donâ€™t need to be pure, so itâ€™s a great place to change somethingâ€”for example, change an inputâ€™s value in response to typing, or change a list in response to a button press. However, in order to change some information, you first need some way to store it. In React, this is done by using state, a componentâ€™s memory. You will learn all about it on the next page. source\n# Render logic may Mutate objects that were newly created while rendering 1 2 3 4 5 const MyComponent = () =\u0026gt; { const user = { name: \u0026#39;Alice\u0026#39; }; user.name = \u0026#39;Bob\u0026#39;; // Mutating a local object is fine return \u0026lt;div\u0026gt;{user.name}\u0026lt;/div\u0026gt;; }; Throw errors 1 2 3 4 5 6 const MyComponent = ({ id }) =\u0026gt; { if (!id) { throw new Error(\u0026#39;ID is required\u0026#39;); } return \u0026lt;div\u0026gt;ID: {id}\u0026lt;/div\u0026gt;; }; Strive to express your componentâ€™s logic in the JSX you return. When you need to â€œchange thingsâ€, youâ€™ll usually want to do it in an event handler. As a last resort, you can useEffect. source\nIt is useful to remember which operations on arrays mutate them, and which donâ€™t. For example, push, pop, reverse, and sort will mutate the original array, but slice, filter, and map will create a new one. source\n","date":"2024-01-07T10:27:22Z","permalink":"https://blog.yorforger.cc/p/pure-function-state-event-loop-react/","title":"Pure Function \u0026 State \u0026 Event Loop - React"},{"content":" # 1. flex-none ç”±äº flex items ä¸‰å±æ€§ flex-grow, flex-shrink, flex-basis çš„é»˜è®¤å€¼åˆ†åˆ«æ˜¯ 0, 1, auto, å³ flex items é»˜è®¤å…è®¸åœ¨å¿…è¦æƒ…å†µä¸‹ç¼©å°, æ¯”å¦‚æœ‰å·¦å³ä¸¤ä¸ª flex items, å½“å·¦è¾¹çš„ flex items çš„å†…å®¹å¾ˆå¤š, è€Œå³è¾¹çš„ flex items çš„å†…å®¹å¾ˆå°‘, æ­¤æ—¶å³è¾¹çš„ flex items ä¼šè¢«å‹ç¼©, ä»¥é€‚åº” flex container çš„å®½åº¦, å³ä½¿å³è¾¹çš„ flex items è®¾ç½®äº†å®½åº¦, ä¹Ÿä¼šè¢«å‹ç¼©.\nè¿™å°±å¯¼è‡´æœ‰æ—¶å€™ä¼šé‡åˆ°æ˜æ˜è®¾ç½®äº†å®½åº¦, å´â€œä¸èµ·ä½œç”¨â€çš„æƒ…å†µ, å…¶å®å°±æ˜¯è¢«å‹ç¼©äº†, è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ flex-none (0 0 auto) æ¥ç¦æ­¢ flex items åœ¨å¿…è¦æƒ…å†µä¸‹ç¼©å°, ä»è€Œä¿è¯ flex items çš„å®½åº¦ä¸ä¼šè¢«å‹ç¼©.\nå¦‚ä¸‹, è‹¥æ²¡æœ‰ flex-none, å› ä¸ºæ®µè½å†…å®¹è¾ƒå¤š, ä¼šå¯¼è‡´imageè¢«å‹ç¼©, å³ä½¿è®¾ç½®äº†å®½åº¦,\n1 2 3 4 5 6 7 8 \u0026lt;div className={\u0026#39;flex items-start p-3 max-h-80 border-b-2\u0026#39;}\u0026gt; \u0026lt;a href={`#`} className=\u0026#34;flex-none\u0026#34;\u0026gt; \u0026lt;img src={\u0026#39;#\u0026#39;} alt=\u0026#34;User avatar\u0026#34; className=\u0026#34;rounded-full h-11 w-11\u0026#34;/\u0026gt; \u0026lt;/a\u0026gt; \u0026lt;p className={\u0026#39;mt-2\u0026#39;}\u0026gt; Compound indexes collect and sort data from two or more fields in each document in a collection. Data is grouped by the first field in the index and then by each subsequent field. \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ","date":"2024-01-06T22:35:10Z","permalink":"https://blog.yorforger.cc/p/tailwind-css-tricks/","title":"Tailwind CSS Tricks"},{"content":" # Block and Inline block å…ƒç´ ç‹¬å ä¸€è¡Œ, å®½åº¦é»˜è®¤æ˜¯çˆ¶å…ƒç´ çš„ 100%, é«˜åº¦ç”±å†…å®¹å†³å®š\nç‰¹æ®Šæƒ…å†µ: button é»˜è®¤æ˜¯ inline-block, æ”¯æŒè®¾ç½®å®½é«˜, å³ä½¿æŠŠ button çš„ display è®¾ç½®ä¸º block, å…¶å®½åº¦ä¾ç„¶ä¸ä¼šæ˜¯çˆ¶å…ƒç´ çš„ 100%, è€Œæ˜¯ç”±å†…å®¹å†³å®šçš„. å…¶ä»–çš„ inline å…ƒç´ , å¦‚ \u0026lt;span\u0026gt;, \u0026lt;a\u0026gt;, \u0026lt;strong\u0026gt;, å¦‚æœè®¾ç½®ä¸º block, åˆ™å…¶å®½åº¦ä¼šè‡ªåŠ¨å˜ä¸ºçˆ¶å…ƒç´ çš„ 100%. inline å…ƒç´ ä¸ä¼šç‹¬å ä¸€è¡Œ, å®½é«˜åº¦ç”±å†…å®¹å†³å®š\nä¸èƒ½è®¾ç½®å®½é«˜, è‹¥è¦è®¾ç½®å®½å’Œé«˜, éœ€è¦å°†å…¶è½¬æ¢ä¸ºå—çº§å…ƒç´ . å¦‚ display: block æˆ– display: inline-block. ä¸å¯ä»¥è®¾ç½®ä¸Šä¸‹ padding å’Œ margin, å¯ä»¥è®¾ç½®å·¦å³ padding å’Œ margin. ç‰¹æ®Šæƒ…å†µ: margin-left: auto, margin-right: auto æ— æ³•é€‚ç”¨ inline å…ƒç´ . è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ tailwind css ä¸­ mx-auto ä½¿ inline å…ƒç´ æ°´å¹³å±…ä¸­çš„åŸå› . inline-block, æ—¢å¯ä»¥è®¾ç½®å®½é«˜, ä¹Ÿå¯ä»¥è®¾ç½®æ‰€æœ‰ padding å’Œ margin, å…¶ä»–ä¸ inline å…ƒç´ ä¸€æ ·.\nflex å­å…ƒç´ æ—¢ä¸æ˜¯å—çº§å…ƒç´ , ä¹Ÿä¸æ˜¯å†…è”å…ƒç´ , è€Œæ˜¯ flex å…ƒç´ , æœ‰è‡ªå·±çš„ç‰¹æ€§. è‹¥åŒåœ¨ flex boxå†…, åˆ™ \u0026lt;a\u0026gt; ä¸ \u0026lt;div\u0026gt; åœ¨æ˜¾ç¤ºä¸Šæ˜¯å®Œå…¨ä¸€æ ·çš„, å› ä¸ºä»–ä»¬éƒ½æ˜¯ flex items. æ³¨æ„ flex å­å…ƒç´ çš„é»˜è®¤å€¼æ˜¯ flex: 0 1 auto, å³ flex-grow: 0, flex-shrink: 1, flex-basis: auto, å³é»˜è®¤æƒ…å†µä¸‹, flex å­å…ƒç´ æ˜¯å…è®¸åœ¨å¿…è¦æƒ…å†µä¸‹ç¼©å°çš„, è€Œä¸ä¼šå¢é•¿, ä»è€Œå¯¼è‡´ flex å­å…ƒç´ çš„å®½åº¦ä¸æ˜¯çˆ¶å…ƒç´ çš„ 100%, è€Œæ˜¯ç”±å†…å®¹å†³å®šçš„.\n# Flex Flex æœ‰å¾ˆå¤šæ€§è´¨, è¦åŒºåˆ†å“ªäº›æ€§è´¨æ˜¯ç”¨åˆ° Flex Box ä¸Šçš„, å“ªäº›æ˜¯ç”¨åˆ° Flex Items ä¸Šçš„. å¯ç›´æ¥è§‚çœ‹: https://youtu.be/fYq5PXgSsbE?si=yeeW9PDx-Als9CWX\n# flex box flex-direction: row | row-reverse | column | column-reverse;\nTailwind CSS: flex-row, flex-col justify-content: flex-start | flex-end | center | space-between | space-around | space-evenly;\nTailwind CSS: justify-start, justify-end, justify-center, justify-between, align-items: flex-start | flex-end | center\nTailwind CSS: items-start, items-end, items-center å¸¸ç”¨æŠ€å·§:\njustify-between ä¸»è¦æ˜¯ç”¨æ¥è®¾ç½® flex items ä¹‹é—´çš„é—´è·, ä¸€èˆ¬æ˜¯è®©ä¸¤ä¸ªå…ƒç´ åˆ†å¸ƒåœ¨å®¹å™¨å·¦å³æˆ–ä¸Šä¸‹ä¸¤ç«¯, èŠå¤©è½¯ä»¶, è‡ªå·±ä¿¡æ¯é å³, å¯¹æ–¹ä¿¡æ¯é å·¦, ä¸å¯ä»¥ä½¿ç”¨ justify-self æˆ– align-self, å‰è€…æ˜¯ç”¨äº Grid å¸ƒå±€çš„, åè€…æ˜¯ç”¨äº Flex å¸ƒå±€çš„äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼. æ›´ä¸å¯ä»¥å•ç‹¬å¯¹ä¸€ä¸ªå…ƒç´ è®¾ç½® justify-start æˆ– justify-end, å› ä¸ºè¿™æ˜¯ flex box çš„å±æ€§, ä¼šå½±å“æ‰€æœ‰çš„ flex items, è€Œä¸æ˜¯å•ä¸ªå…ƒç´ . ä½ å¯ä»¥ä½¿ç”¨ margin-left: auto æˆ– margin-right: auto æ¥å®ç°è¿™ä¸ªæ•ˆæœ. mx-auto ç”¨äºæ°´å¹³å±…ä¸­, my-auto ç”¨äºå‚ç›´å±…ä¸­, ä¹Ÿå¯ä½¿ç”¨ order å±æ€§æ¥è°ƒæ•´å…ƒç´ çš„é¡ºåº, é…åˆ justify-between ä½¿ç”¨ (æ§åˆ¶åœ¨ä¸¤ç«¯, ä¸€å·¦ä¸€å³), åªæœ‰ä¸¤ä¸ªå…ƒç´ è¿™ç§ç®€å•æƒ…å†µä¸‹æ¨èä½¿ç”¨. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 export default function Message({role, text, time}) { const messageClass = role === \u0026#39;bot\u0026#39; ? \u0026#39;mr-auto bg-gray-300 text-black\u0026#39; : \u0026#39;ml-auto bg-blue-300 text-white\u0026#39; const timePos = role === \u0026#39;bot\u0026#39; ? \u0026#39;order-2\u0026#39; : \u0026#39;order-1\u0026#39; const rolePos = role === \u0026#39;bot\u0026#39; ? \u0026#39;order-1\u0026#39; : \u0026#39;order-2\u0026#39; const sentTime = new Date(time).toLocaleString() return ( \u0026lt;div className={messageClass} \u0026gt; \u0026lt;div className={\u0026#39;flex flex-row justify-between\u0026#39;}\u0026gt; \u0026lt;span className={rolePos}\u0026gt;{role}\u0026lt;/span\u0026gt; \u0026lt;span className={timePos}\u0026gt;{sentTime}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;p\u0026gt;{text}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ) } # flex items flex-grow: ç”¨æ¥æŒ‡å®šä¸€ä¸ª flex å­é¡¹ï¼ˆflex itemï¼‰ç›¸å¯¹äºå…¶ä»–å­é¡¹åœ¨å¯ç”¨ç©ºé—´ä¸­çš„æ‰©å±•æ¯”ä¾‹, æ²¿ä¸»è½´æ–¹å‘ã€‚ Tailwind CSS ç±»å:flex-grow, flex-grow-0 align-self: ç”¨æ¥æŒ‡å®šflexå­é¡¹åœ¨äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼, ä¼šè¦†ç›–çˆ¶å®¹å™¨çš„ align-items å±æ€§ã€‚ å¾ˆå¥½ç†è§£, align-self æ˜¯ç”¨æ¥æŒ‡å®šå•ä¸ª flex item åœ¨äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼, è€Œ align-items æ˜¯ç”¨æ¥æŒ‡å®šæ‰€æœ‰ flex items åœ¨äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼. å‰è€…ç”¨åœ¨ itemä¸Š, åè€…ç”¨åœ¨ flex box ä¸Š, å‰è€…ä¼šè¦†ç›–åè€…. Tailwind CSS ç±»å: self-auto, self-start, self-center, self-end, self-stretch äº†è§£æ›´å¤š: Align Self - Tailwind CSS å¸¸ç”¨æŠ€å·§-1: æŠŠ navigator å’Œ footer è®¾ç½®ä¸º flex-grow: 0, ç„¶åä¸­é—´çš„å†…å®¹è®¾ç½®ä¸º flex-grow: 1, è¿™æ ·ä¸­é—´çš„å†…å®¹ä¼šå æ®å‰©ä½™çš„ç©ºé—´, ä»è€Œå®ç°ä¸­é—´å†…å®¹è‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´çš„æ•ˆæœ. (å‰ææ˜¯ä»–ä»¬éƒ½æ˜¯ flex items, å³ä»–ä»¬éƒ½åœ¨ flex box å†…)\nå¸¸ç”¨æŠ€å·§-2: é€šå¸¸æŠŠå…ƒç´ è®¾ç½®ä¸º flex-grow å, ä¼šè‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´, ä½†å¦‚æœè¯¥å…ƒç´ çš„å†…å®¹å¾ˆå¤š, å°±ä¼šå¯¼è‡´æº¢å‡º, æ¯”å¦‚å¯¹è¯æ¡†, æ­¤æ—¶åº”è¯¥ä¼šæƒ³åˆ°åŠ ä¸ª overflow å±æ€§, ä½†æ˜¯è¿™æ ·å¹¶ä¸ä¼šèµ·ä½œç”¨, åŸå› æ˜¯ä½ æ²¡è®¾ç½®è¯¥å…ƒç´ çš„é«˜åº¦, æ­¤æ—¶å¯ä»¥ç»™ä¸ªé«˜åº¦0, è¿™æ ·å³ä½¿å†…å®¹ä¸ºç©ºå› ä¸º flex-grow ä¼šè‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´, è‹¥å†…å®¹æº¢å‡ºå› ä¸ºå®šä¹‰äº†é«˜åº¦, overflow å±æ€§å°±ä¼šèµ·ä½œç”¨äº†. äº†è§£æ›´å¤š: https://stackoverflow.com/a/14964944/16317008\næ˜“é”™ç‚¹-1: flex-grow æ˜¯ flex items çš„å±æ€§, ç”¨æ¥æ§åˆ¶ flex tiems å¦‚ä½•åœ¨ä¸»è½´æ–¹å‘ä¸Šå¢é•¿, ä¸è¦ç®€å•çš„ä»¥ä¸ºæ˜¯ç”¨æ¥æ§åˆ¶åœ¨æ°´å¹³æ–¹å‘ä¸Šå¢é•¿çš„. æ¯”å¦‚åœ¨ flex-col çš„æƒ…å†µä¸‹ï¼Œflex-grow å½±å“çš„æ˜¯itemsçš„é«˜åº¦ï¼Œè€Œä¸æ˜¯å®½åº¦ï¼Œå› ä¸ºä¸»è½´æ˜¯å‚ç›´çš„.\næ˜“é”™ç‚¹-2: justify-items å’Œ justify-self ä¸“é—¨ç”¨äºGridå¸ƒå±€, ä¸ç”¨äºFlexå¸ƒå±€, äº†è§£æ›´å¤š: Justify Items - Tailwind CSS\n# Position # absolute æœ€è¿‘å†™èœå•æ çš„æ—¶å€™, èœå•æ å±•å¼€åä¼šå°†ä¸‹é¢çš„å†…å®¹æŒ¤ä¸‹å», åƒä¸‹é¢è¿™æ ·:\nåŸºæœ¬ä¸Šèœå•æ éƒ½å¾ˆçª„, æ‰€ä»¥å½“èœå•æ å±•å¼€æ—¶, æˆ‘å¸Œæœ›çš„æ˜¯ä¸å½±å“ä¸‹é¢çš„å†…å®¹, ä½†æ˜¯æ­£å¸¸æƒ…å†µä¸‹ä¸¤ä¸ªå…ƒç´ è¦ä¹ˆæ˜¯ inline é‚£ç§å¯ä»¥åœ¨åŒä¸€è¡Œ, è¦ä¹ˆæ˜¯ block é‚£ç§ç‹¬å ä¸€è¡Œ, æ— æ³•å®ç°æˆ‘æƒ³è¦çš„æ•ˆæœ. æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ absolute æ¥å®ç°, å¦‚ä¸‹:\nAbsolute positioned elements are removed from the normal flow, and can overlap elements.\næ­¤æ—¶ä¹Ÿåº”è¯¥æ³¨æ„è¦†ç›–çš„é—®é¢˜, è‹¥å¯¹è¯æ¡†å®½åº¦ä¸º 100vw, å¯èƒ½ä¼šè¦†ç›–æ‰å¯¹è¯æ¡†, å› æ­¤è¦å°† z-index è®¾ç½®å¤§ä¸€äº›.\n","date":"2024-01-06T20:46:20Z","permalink":"https://blog.yorforger.cc/p/tailwind-css-flex/","title":"Tailwind CSS Flex"},{"content":" # 1. Main axis and cross axis - Flex 1 2 3 4 5 6 7 \u0026lt;div className=\u0026#34;flex flex-col\u0026#34;\u0026gt; ... \u0026lt;/div\u0026gt; \u0026lt;div className=\u0026#34;flex flex-row\u0026#34;\u0026gt; ... \u0026lt;/div\u0026gt; ä¸ºä»€ä¹ˆä½¿ç”¨ class=\u0026ldquo;flex flex-row\u0026rdquo; åªæ˜¯ç”¨ class=\u0026ldquo;flex-row\u0026rdquo; ä¸è¡Œå—? flex ç¡®ä¿å…ƒç´ å˜æˆä¸€ä¸ª Flex å®¹å™¨ã€‚flex-row ç¡®ä¿è¯¥å®¹å™¨å†…çš„é¡¹ç›®æ²¿ç€æ°´å¹³è½´æ’åˆ—ã€‚\nå¦å¤–æ³¨æ„, flex items ä¼šè‡ªåŠ¨å¡«å……æ»¡å…¶ flex container çš„æ²¿ç€äº¤å‰è½´æ–¹å‘çš„ç©ºé—´, ä¹Ÿå°±æ˜¯è¯´, flex items çš„å®½åº¦æˆ–é«˜åº¦ä¼šç­‰äºäº¤å‰è½´çš„é•¿åº¦, å…·ä½“æ˜¯é«˜åº¦è¿˜æ˜¯å®½åº¦, å–å†³äºä¸»è½´æ–¹å‘, å› ä¸ºäº¤å‰è½´æ–¹å‘å°±æ˜¯ä¸»è½´æ–¹å‘çš„å‚ç›´æ–¹å‘.\næ ¹æ®ä¸‹é¢è¿™ä¸ªä¾‹å­, å› ä¸ºä¸»è½´æ–¹å‘æ˜¯æ°´å¹³, å› æ­¤ flex items çš„é«˜åº¦ä¼šç­‰äº flex container çš„é«˜åº¦, è‡³äºå®½åº¦, åˆ™æ˜¯ç”±å…¶å†…å®¹å†³å®šçš„ (flex-grow é»˜è®¤å€¼ä¸º 0).\n1 2 3 4 \u0026lt;div className=\u0026#34;flex flex-row h-64 border-2\u0026#34;\u0026gt; \u0026lt;button className={\u0026#39;border-2\u0026#39;}\u0026gt;hello\u0026lt;/button\u0026gt; \u0026lt;button className={\u0026#39;border-2\u0026#39;}\u0026gt;hello\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; flex items çš„ä¸‰ä¸ªå±æ€§ flex-grow, flex-shrink, flex-basis çš„é»˜è®¤å€¼æ˜¯ flex-grow: 0, flex-shrink: 1, flex-basis: auto. æ³¨æ„è¿™æ˜¯ flex items çš„å±æ€§, ä¸æ˜¯ flex container çš„å±æ€§.\n# 2. æ°´å¹³å’Œå‚ç›´å±…ä¸­ - Flex # 2.1 æ°´å¹³å±…ä¸­ å¯¹äº flex-row ä¸»è½´å°±æ˜¯æ°´å¹³æ–¹å‘, ç®€å•ä½¿ç”¨ justify-center (æ²¿ä¸»è½´æ–¹å‘æ“ä½œ flex items) å³å¯ä½¿ flex items æ°´å¹³å±…ä¸­.\n1 2 3 \u0026lt;div className=\u0026#34;flex flex-row justify-center\u0026#34;\u0026gt; ... \u0026lt;/div\u0026gt; å¯¹äº flex-col ä¸»è½´å°±æ˜¯å‚ç›´æ–¹å‘, ä½¿ç”¨ items-center (æ²¿äº¤å‰è½´æ–¹å‘æ“ä½œ flex items) å³å¯ä½¿ flex items æ°´å¹³å±…ä¸­.\n1 2 3 4 \u0026lt;div className=\u0026#34;flex flex-col items-center h-64 border-2\u0026#34;\u0026gt; \u0026lt;button className={\u0026#39;border-2\u0026#39;}\u0026gt;hello\u0026lt;/button\u0026gt; \u0026lt;button className={\u0026#39;border-2\u0026#39;}\u0026gt;hello\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ mx-auto, ä½† mx-auto åªä½œç”¨äºå—çº§å…ƒç´ , å› æ­¤ä½ å¯èƒ½éœ€è¦æŠŠ flex items æ”¹ä¸ºå—çº§å…ƒç´ , åˆ«å¿˜äº† flex items æ—¢ä¸æ˜¯å—çº§å…ƒç´ ä¹Ÿä¸æ˜¯è¡Œå†…å…ƒç´ , ä½ éœ€è¦å°†å…¶çˆ¶çš„ display: flex å»æ‰.\n# 2.2 å‚ç›´å±…ä¸­ ä¸ä¸Šé¢ç±»ä¼¼, ä¸å†èµ˜è¿°\n# 3. å®½åº¦é«˜åº¦å†…è¾¹è·å¤–è¾¹è· å®½åº¦ï¼ˆWidthï¼‰:\nTailwind ä½¿ç”¨ w-{size} çš„æ¨¡å¼æ¥è®¾ç½®å®½åº¦ï¼Œå…¶ä¸­ {size} å¯ä»¥æ˜¯å…·ä½“çš„æ•°å€¼æˆ–è€…ç™¾åˆ†æ¯”ã€‚ä¾‹å¦‚ï¼š w-1/2ï¼šå…ƒç´ å®½åº¦ä¸ºå®¹å™¨å®½åº¦çš„ 50%ã€‚ w-4ï¼šå…ƒç´ å®½åº¦ä¸º 1remï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„å°ºå¯¸éƒ½åŸºäº 4 å€ä½“ç³»ï¼‰ã€‚ w-fullï¼šå…ƒç´ å®½åº¦ä¸º 100%ã€‚ é«˜åº¦ï¼ˆHeightï¼‰:\né«˜åº¦çš„è®¾ç½®æ–¹å¼ä¸å®½åº¦ç±»ä¼¼ï¼Œä½¿ç”¨ h-{size} çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼š h-10ï¼šé«˜åº¦ä¸º 2.5remã€‚ h-screenï¼šé«˜åº¦ä¸ºè§†å£çš„é«˜åº¦ã€‚ å†…è¾¹è·ï¼ˆPaddingï¼‰:\nå†…è¾¹è·ä½¿ç”¨ p-{size} çš„æ ¼å¼ï¼Œé’ˆå¯¹æ‰€æœ‰å››ä¸ªæ–¹å‘ï¼Œæˆ–è€…ä½¿ç”¨ px-ã€py-ã€pt-ã€pb-ã€pl-ã€pr- åˆ†åˆ«è®¾ç½®æ°´å¹³ã€å‚ç›´ã€ä¸Šã€ä¸‹ã€å·¦ã€å³çš„å†…è¾¹è·ã€‚ä¾‹å¦‚ï¼š p-4ï¼šæ‰€æœ‰æ–¹å‘çš„å†…è¾¹è·éƒ½æ˜¯ 1remã€‚ px-2ï¼šæ°´å¹³æ–¹å‘ï¼ˆå·¦å³ï¼‰çš„å†…è¾¹è·æ˜¯ 0.5remã€‚ å¤–è¾¹è·ï¼ˆMarginï¼‰:\nå¤–è¾¹è·çš„è®¾ç½®ä¸å†…è¾¹è·ç±»ä¼¼ï¼Œä½¿ç”¨ m-{size}ï¼Œæˆ–è€… mx-ã€my-ã€mt-ã€mb-ã€ml-ã€mr- æ¥åˆ†åˆ«è®¾ç½®ã€‚ä¾‹å¦‚ï¼š m-5ï¼šæ‰€æœ‰æ–¹å‘çš„å¤–è¾¹è·éƒ½æ˜¯ 1.25remã€‚ mt-3ï¼šä¸Šæ–¹å¤–è¾¹è·æ˜¯ 0.75remã€‚ # 4. Breakpoints åœ¨ Tailwind CSS ä¸­ï¼Œæ–­ç‚¹ï¼ˆbreakpointsï¼‰ç”¨äºåˆ›å»ºå“åº”å¼è®¾è®¡ï¼Œå…è®¸åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹åº”ç”¨ä¸åŒçš„æ ·å¼è§„åˆ™ã€‚ä»¥ä¸‹æ˜¯ Tailwind CSS ä¸­ä¸€äº›å¸¸è§æ–­ç‚¹çš„ç”¨æ³•åŠå…¶è§£é‡Šï¼š\nsmï¼ˆSmallï¼‰: sm: å‰ç¼€ç”¨äºå°å±å¹•è®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œw-full md:w-1/2 : å°å±å¹•éƒ½ä¼šè‡ªåŠ¨åº”ç”¨ w-full, å®½åº¦å¤§äº md çš„, å®½åº¦è‡ªåŠ¨å˜ä¸º w-1/2 ","date":"2024-01-06T12:46:22Z","permalink":"https://blog.yorforger.cc/p/tailwind-css-commonly-used-class/","title":"Tailwind CSS Commonly Used Class"},{"content":" # 1. Post Schema # 1.1. Likes Field The limit of the document in MongoDB is 16mb, which is pretty huge. Unless you\u0026rsquo;re trying to create the next Facebook, putting the IDs in the array won\u0026rsquo;t be an issue. I have production workflows with 10k+ IDs in a single document array, have no issues. source\n","date":"2024-01-04T17:51:35Z","permalink":"https://blog.yorforger.cc/p/design-of-database-schema/","title":"Design of Database Schema"},{"content":" # Aggregate framework The aggregation framework is MongoDBâ€™s advanced query language, and it allows you to transform and combine data from multiple documents to generate new information not available in any single document.\n# Common aggregation stages Below is a list of common MongoDB aggregation pipeline stages and their typical order:\n$match Stage\nUsually at the beginning of the pipeline. Filters the documents as early as possible, which reduces the amount of data processed by subsequent stages. $sort Stage\nAfter $match and before $limit if sorting the entire dataset is necessary. Be aware that $sort can be memory-intensive. If used before $limit, it sorts the entire dataset filtered by $match. $limit Stage\nUse $limit as early as possible, but after $match and $sort if sorting is needed. $project Stage\nReduces the number of fields in the documents, decreasing the amount of data processed in later stages. Keep in mind that some fields might be needed in subsequent stages. You can use $project more than once in a pipeline, you have to speficify all the fields you want to keep in each $project stage, even you have already specified them in the previous $project stage. If you need to add new fields, consider using $addFields instead wich has more flexibility. $group Stage\nAfter $match, $sort, $limit, and $project. Groups documents by specified fields after they have been filtered and shaped. $unwind Stage\nUsed to expand array fields into separate documents. 1 2 3 4 5 6 7 db.inventory.insertOne({ \u0026#34;_id\u0026#34; : 1, \u0026#34;item\u0026#34; : \u0026#34;ABC1\u0026#34;, sizes: [ \u0026#34;S\u0026#34;, \u0026#34;M\u0026#34;, \u0026#34;L\u0026#34;] }) db.inventory.aggregate( [ { $unwind : \u0026#34;$sizes\u0026#34; } ] ) // The operation returns the following results: { \u0026#34;_id\u0026#34; : 1, \u0026#34;item\u0026#34; : \u0026#34;ABC1\u0026#34;, \u0026#34;sizes\u0026#34; : \u0026#34;S\u0026#34; } { \u0026#34;_id\u0026#34; : 1, \u0026#34;item\u0026#34; : \u0026#34;ABC1\u0026#34;, \u0026#34;sizes\u0026#34; : \u0026#34;M\u0026#34; } { \u0026#34;_id\u0026#34; : 1, \u0026#34;item\u0026#34; : \u0026#34;ABC1\u0026#34;, \u0026#34;sizes\u0026#34; : \u0026#34;L\u0026#34; } $lookup Stage\nOrder: After filtering and limiting stages like $match and $limit. Reason: Performs a join to another collection, which can be data-intensive. Considerations: Can significantly increase data volume, so use after reducing the dataset size. $addFields / $set Stage\nOrder: After $project, $unwind, or $group. Reason: Adds new fields or modifies existing ones, often based on existing fields. Considerations: Useful for adding calculated fields. Similar to $project, but adds fields without removing existing ones. The code below will result in an error \u0026ldquo;$size cannot be used for not array type\u0026rdquo;, because during the project stage filters out the likes and comments fields, which results the likes and comments fields to be null instead of an array.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { $project: { text: 1, images: 1, comments: 1, createdAt: 1, } }, { $addFields: { engagement: { numLikes: { $size: \u0026#34;$likes\u0026#34; }, numComments: { $size: \u0026#34;$comments\u0026#34; }, isLiked: { $in: [new mongoose.Types.ObjectId(userId), \u0026#34;$likes\u0026#34;] }, } } } So in this case, you should put the $addFields stage before the $project stage.\n","date":"2024-01-04T17:51:35Z","permalink":"https://blog.yorforger.cc/p/mongodb-aggregate/","title":"MongoDB Aggregate"},{"content":" # 1. Common used commands 1 2 3 4 5 6 $apt install nginx # ubuntu $apk add nginx # Alpine Linux # start $sudo systemctl start/stop/restart/status nginx $sudo service nginx start/stop/restart/status # 2. Basic configurations # 2.1. Configuration file 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $vi /etc/nginx/http.d/default.conf # Alpine Linux server { listen 2087 ssl; server_name shaowenzhu.top www.shaowenzhu.top; ssl_certificate /root/tls/cert.pem; ssl_certificate_key /root/tls/cert.key; location / { root /var/www/html; try_files $uri $uri/ /index.html; } # You may need this to prevent return 404 recursion. location = /404.html { internal; } } You can get free TLS certificate from Cloudflare but you need get a domain first. Learn more: Coudflare TLS encryption 520 Error Code \u0026amp; too Many Redirections - David\u0026rsquo;s Blog\nBecause the 443 port is used by my file server, so I use 2087 port for my gbtbot server. I use Cloudflare for reverse proxy, Cloudflare only allows the following ports: 443, 2053, 2083, 2087, 2096, 8443. So I choose 2087 port for this app.\nDon\u0026rsquo;t forget allow 2087 port on your server firewall with command sudo ufw allow 2087.\n# 2.2. Static website Then access my website by https://shaowenzhu.top:2087/ will get the static html file under /var/www/html.\nWith Vite, you can use vite build to build your project, then copy the dist folder to /var/www/html.\n1 2 3 4 5 6 âœ /etc tree -L 3 /var/www/html /var/www/html â”œâ”€â”€ assets â”‚Â â””â”€â”€ index-r4STm7R-.js â”œâ”€â”€ index.html â””â”€â”€ vite.svg ","date":"2023-12-30T14:01:50Z","permalink":"https://blog.yorforger.cc/p/nginx/","title":"Nginx"},{"content":" # ä¸ºä»€ä¹ˆ useEffect ä¸èƒ½æ˜¯å¼‚æ­¥å‡½æ•° å¼‚æ­¥å‡½æ•°éšå¼åœ°è¿”å›ä¸€ä¸ªPromiseï¼Œè€ŒuseEffectçš„è®¾è®¡æ˜¯æœŸæœ›è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°æˆ–è€…ä»€ä¹ˆéƒ½ä¸è¿”å›ï¼ˆundefinedï¼‰ã€‚è¿™ä¸ªè®¾è®¡åŸåˆ™ç¡®ä¿äº†Reactèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å‰¯ä½œç”¨å’Œå®ƒä»¬çš„æ¸…ç†é€»è¾‘ã€‚\nå¦‚æœä½ éœ€è¦åœ¨useEffectä¸­æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œæ­£ç¡®çš„åšæ³•æ˜¯åœ¨useEffectçš„å‡½æ•°ä½“å†…å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå¹¶åœ¨è¯¥å‡½æ•°å†…æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œç„¶åç«‹å³è°ƒç”¨è¿™ä¸ªå¼‚æ­¥å‡½æ•°ã€‚ä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 useEffect(() =\u0026gt; { async function fetchData() { // å¼‚æ­¥æ“ä½œ const data = await fetchSomeData(); // ä½¿ç”¨æ•°æ®æ›´æ–°çŠ¶æ€ setState(data); } fetchData(); // æ¸…ç†å‡½æ•°ï¼ˆå¦‚æœéœ€è¦ï¼‰ return () =\u0026gt; { // æ¸…ç†é€»è¾‘ }; }, [/* ä¾èµ–åˆ—è¡¨ */]); è¿™ç§æ¨¡å¼å…è®¸åœ¨useEffectå†…éƒ¨ä½¿ç”¨å¼‚æ­¥æ“ä½œï¼ŒåŒæ—¶éµå¾ªReactçš„å‰¯ä½œç”¨å¤„ç†è§„åˆ™ã€‚\nå‡½æ•°ç»„ä»¶åœ¨å…¶ä¸»ä½“å†…ä¸åº”è¯¥æ‰§è¡Œæœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ç›´æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ã€è®¢é˜…äº‹ä»¶ã€ç›´æ¥æ“ä½œDOMç­‰ã€‚è¿™äº›æ“ä½œåº”è¯¥æ”¾åœ¨ç‰¹å®šçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æˆ–é’©å­ï¼ˆå¦‚useEffectï¼‰\n# 2. When useEffect is called What does useEffect do? By using this Hook, you tell React that your component needs to do something after render. React will remember the function setup you passed, and call it later after performing the DOM updates.\nuseEffect æ˜¯åœ¨æ¸²æŸ“é€»è¾‘ä¹‹åæ‰§è¡Œçš„, æ˜¯å¯ä»¥æœ‰å‰¯ä½œç”¨çš„. å¯ä»¥çœ‹å‡º, useEffect å¤©ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜.\n1 useEffect(setup, dependencies?) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 function MyComponent() { const [count, setCount] = useState(0); console.log(\u0026#34;1. Component function is running (render phase)\u0026#34;); useEffect(() =\u0026gt; { setTimeout(() =\u0026gt; { console.log(\u0026#34;3. useEffect is called (after DOM updates)\u0026#34;); }, 2000); }); return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;You clicked {count} times\u0026lt;/p\u0026gt; \u0026lt;button onClick={() =\u0026gt; setCount(count + 1)}\u0026gt; Click me \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ); } When you reload the page, you will see the following in the console (Don\u0026rsquo;t use StrictMode):\n1 2 1. Component function is running (render phase) 2. useEffect is called (after DOM updates) # 2 seconds later will print When you click the button, you will see the following in the console:\n1 2 3 1. Component function is running (render phase) You clicked 1 times 3. useEffect is called (after DOM updates) # 2 seconds later will print Here\u0026rsquo;s a simplified sequence of what happens:\nComponent Function Executes: The function component runs. During this execution, it can render JSX and call hooks like useState. (Reload page, in example above)\nRender to DOM: React updates the DOM and the screen based on the returned JSX from the function. (\u0026lsquo;You click x times\u0026rsquo;, in example above)\nAfter Render: Once the rendering is complete and the DOM has been updated, useEffect is called. This is done asynchronously; it doesn\u0026rsquo;t block the browser from updating the screen. (2 seconds later, in example above)\n# 3. å‰¯ä½œç”¨æ“ä½œå®ä¾‹ fetch data 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import { useState, useEffect } from \u0026#39;react\u0026#39;; import { fetchBio } from \u0026#39;./api.js\u0026#39;; export default function Page() { const [person, setPerson] = useState(\u0026#39;Alice\u0026#39;); const [bio, setBio] = useState(null); useEffect(() =\u0026gt; { fetchBio(person).then(result =\u0026gt; { setBio(result); }); }, [person]); return ( \u0026lt;\u0026gt; \u0026lt;select value={person} onChange={e =\u0026gt; { setPerson(e.target.value); }}\u0026gt; \u0026lt;option value=\u0026#34;Alice\u0026#34;\u0026gt;Alice\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;Bob\u0026#34;\u0026gt;Bob\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;Taylor\u0026#34;\u0026gt;Taylor\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;hr /\u0026gt; \u0026lt;p\u0026gt;\u0026lt;i\u0026gt;{bio ?? \u0026#39;Loading...\u0026#39;}\u0026lt;/i\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/\u0026gt; ); } There is a trick, \u0026lt;p\u0026gt;\u0026lt;i\u0026gt;{bio ?? 'Loading...'}\u0026lt;/i\u0026gt;\u0026lt;/p\u0026gt;, \u0026lsquo;Loading\u0026hellip;\u0026rsquo; will be used if bio is null or undefined. We write it in this way because useEffect is called after the initial rendering, so bio will be null or undefined at the first render.\n# 4. Race conditions in useEffect You would typically notice a race condition (in React) when two slightly different requests for data have been made, and the application displays a different result depending on which request completes first.\nWith cleanup function, we can \u0026ldquo;cancel\u0026rdquo; the previous request (because active is false, setData(newData); in the previous useEffect won\u0026rsquo;t be called), and only use the result of the latest request.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 useEffect(() =\u0026gt; { let active = true; const fetchData = async () =\u0026gt; { setTimeout(async () =\u0026gt; { const response = await fetch(`https://swapi.dev/api/people/${props.id}/`); const newData = await response.json(); if (active) { setFetchedId(props.id); setData(newData); } }, Math.round(Math.random() * 12000)); }; fetchData(); return () =\u0026gt; { active = false; }; }, [props.id]); Your setup code runs when your component is added to the page (mounts), this is useEffect gets called after the render phase. After every re-render of your component where the dependencies have changed: First, your cleanup code runs with the old props and state. Then, your setup code runs with the new props and state. Your cleanup code runs one final time after your component is removed from the page (unmounts). So, in the above example, the cleanup function of the previous useEffect call is called before the setup function of the current useEffect is called.\nLearn more: Race Condition useEffect\n","date":"2023-12-26T19:49:22Z","permalink":"https://blog.yorforger.cc/p/useeffect-hook-in-react/","title":"useEffect Hook in React"},{"content":" # 1. å¯¹è§’çº¿æ„å›¾ åŠ¨æ™¯æ¯”è¾ƒé€‚åˆ, æ¯”å¦‚æ²™æ»©çš„æµ·æµª, æµ·ä¸Šä¸€ç¾¤æµ·é¸¥è¿æˆçº¿,\n(PS. ä¸‹é¢è¿™å¼ æ˜¯ç½‘å›¾\nå¦å¤–ä¹Ÿæœ‰å¯¹ç§°çº¿æ„å›¾, ä¹Ÿå¯ä»¥æ‰¾å…¶ä»–ç‰©ä½“è¡¬æ‰˜, ä¸»è¦çœ‹æ„Ÿè§‰,\n# 2. ç•™ç™½æ„å›¾ è¿˜æ²¡å®è·µ\u0026hellip;\n# 3. å…¶ä»–åˆ†ç±» å‚è€ƒ:\n6åˆ†é’Ÿè®©ä½ å­¦ä¼šæ„å›¾ï¼Œæ‹ç…§èŒæ–°å˜æ‘„å½±å¤§å¸ˆï¼ï¼ˆæ‰‹æœºæ‘„å½±å’Œç›¸æœºæ‘„å½±æ„å›¾æŠ€å·§ï¼‰_å“”å“©å“”å“©_bilibili ","date":"2023-12-20T22:50:37Z","permalink":"https://blog.yorforger.cc/p/%E6%8B%8D%E7%85%A7%E6%9E%84%E5%9B%BE%E6%8A%80%E5%B7%A7/","title":"æ‹ç…§æ„å›¾æŠ€å·§"},{"content":" # 1. Create project with Vite 1 2 3 4 npm create vite@latest name-of-your-project -- --template react cd \u0026lt;your new project directory\u0026gt; npm install react-router-dom localforage match-sorter sort-by npm run dev/npm run build The Proxy in vite.config.js just works for development mode. In production mode it doesn\u0026rsquo;t work.\nThe production mode means you run npm run build which will generate a dist folder. Then you can deploy that folder into your server.\n# 2. Deploy to server 1 scp -rp dist/* root@129.18.30.20:/var/www/html/ Then follow this: Nginx - David\u0026rsquo;s Blog\n","date":"2023-12-20T19:44:22Z","permalink":"https://blog.yorforger.cc/p/vite-deployment-react/","title":"Vite \u0026 Deployment - React"},{"content":" # 1. Error handling with promise objects # 1.1. Rejection handler In JavaScript, when a promise is rejected, the control is passed to the nearest rejection handler. This is typically managed through .catch() blocks or through the rejection parameter in .then() method.\nThe error will be catght by the rejection parameter of the then() method: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 const promise1 = new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { reject(\u0026#39;Error in promise1\u0026#39;); }, 1000); }); const promise2 = promise1.then( value =\u0026gt; console.log(value), error =\u0026gt; { console.error(\u0026#39;Caught in first handler:\u0026#39;, error); // not re-throwing or returning another rejected promise, so flow goes to next then\u0026#39;s fulfillment handler } ).then( () =\u0026gt; console.log(\u0026#39;This will still execute.\u0026#39;), error =\u0026gt; console.error(\u0026#39;Caught in second handler:\u0026#39;, error) ).catch( error =\u0026gt; console.error(\u0026#39;Caught in catch:\u0026#39;, error) ); Output:\n1 2 Caught in first handler: Error in promise1 This will still execute. The error will be catght through .catch() blocks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 const promise1 = new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { reject(\u0026#39;Error in promise1\u0026#39;); }, 1000); }); const promise2 = promise1.then( value =\u0026gt; console.log(value), ).then( () =\u0026gt; console.log(\u0026#39;This will still execute.\u0026#39;), error =\u0026gt; console.error(\u0026#39;Caught in second handler:\u0026#39;, error) ).catch( error =\u0026gt; console.error(\u0026#39;Caught in catch:\u0026#39;, error) ); Output:\n1 Caught in second handler: Error in promise1 # 1.2. Any errors will be caught before catch() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // any errors happen in main block, will be caught main().catch(err =\u0026gt; console.log(err)); async function main() { await simulateDatabaseConnection(); console.log(\u0026#39;Connected to the database successfully\u0026#39;) } async function simulateDatabaseConnection() { // Simulating a database connection attempt that could fail let isConnected = false; // Simulating an asynchronous operation using a Promise return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { if (isConnected) { resolve(\u0026#39;Connected to the database successfully\u0026#39;); } else { reject(\u0026#39;Failed to connect to the database\u0026#39;); } }, 1000); // Simulating a delay of 1 second }); } // print: Failed to connect to the database. Another example:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 fetch(\u0026#39;/article/promise-chaining/user.json\u0026#39;) .then(response =\u0026gt; response.json()) .then(user =\u0026gt; fetch(`https://api.github.com/users/${user.name}`)) .then(response =\u0026gt; response.json()) .then(githubUser =\u0026gt; new Promise((resolve, reject) =\u0026gt; { let img = document.createElement(\u0026#39;img\u0026#39;); img.src = githubUser.avatar_url; img.className = \u0026#34;promise-avatar-example\u0026#34;; document.body.append(img); setTimeout(() =\u0026gt; { img.remove(); resolve(githubUser); }, 3000); })) .catch(error =\u0026gt; alert(error.message)); Normally, such .catch doesnâ€™t trigger at all. But if any of the promises above rejects (a network problem or invalid json or whatever), then it would catch it.\n# 2. try \u0026amp; catch This is similar to other languages, any errors happen in the try block will be caught by catch:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 const promise = new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { reject(\u0026#39;Error in promise\u0026#39;); }, 1000); }); async function exampleFunction() { try { await promise; console.log(\u0026#39;This line will not execute if promise rejects\u0026#39;); } catch (error) { console.error(\u0026#39;Error caught in async function:\u0026#39;, error); } } (async () =\u0026gt; { await exampleFunction() })() // Error caught in async function: Error in promise Error handling with promises\n","date":"2023-12-17T23:30:29Z","permalink":"https://blog.yorforger.cc/p/error-handling-javascript/","title":"Error Handling Javascript"},{"content":"Google Cloud Page: https://console.cloud.google.com/welcome/new?organizationId=0\nSelect your project or create a new one, then enable some APIs \u0026amp; Services for this project:\nI selected a already existed project Gemini-Test, now you can see its details as below:\nCheck enabled API \u0026amp; Services, you can click the enabled one then disable it:\nOr you can search some new APIs \u0026amp; Services and eanble it:\n","date":"2023-12-15T11:28:22Z","permalink":"https://blog.yorforger.cc/p/google-cloud-get-started/","title":"Google Cloud Get Started"},{"content":" # 1. Type Admin isn\u0026rsquo;t *Adimin I found an interesting question on stackoverflow, this is the code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 type User interface { Name() string SetName(name string) } type Admin struct { name string } func (a *Admin) Name() string { return a.name } func (a *Admin) SetName(name string) { a.name = name } OP tries to copy user1\u0026rsquo;s value below:\n1 2 3 4 5 6 7 8 9 10 11 12 13 func main() { var user1 User user1 = \u0026amp;Admin{name:\u0026#34;user1\u0026#34;} fmt.Printf(\u0026#34;User1\u0026#39;s name: %s\\n\u0026#34;, user1.Name()) var user2 User user2 = user1 user2.SetName(\u0026#34;user2\u0026#34;) fmt.Printf(\u0026#34;User2\u0026#39;s name: %s\\n\u0026#34;, user2.Name()) // print: \u0026#34;user2\u0026#34; fmt.Printf(\u0026#34;User1\u0026#39;s name: %s\\n\u0026#34;, user1.Name()) // print: \u0026#34;user2\u0026#34; too, How to make the user1 name does not changeï¼Ÿ } Everything pass by value in Golang, even assignment will make a copy. Therefore, I tried something like this:\n1 2 3 4 5 var user1 User user1 = \u0026amp;Admin{name:\u0026#34;user1\u0026#34;} fmt.Printf(\u0026#34;User1\u0026#39;s name: %s\\n\u0026#34;, user1.Name()) var user2 User user2 = *user1 // got an error: Invalid indirect of \u0026#39;user1\u0026#39; (type \u0026#39;User\u0026#39;) The erorr says that user\u0026rsquo;s type is User not *User, so cannot dereference it. Why user1 = \u0026amp;Admin{name:\u0026quot;user1\u0026quot;} works fine?\nAn error occurred again below:\n1 2 3 var user1 User user1 = Admin{name:\u0026#34;user1\u0026#34;} // error: Cannot use \u0026#39;Admin{name:\u0026#34;user1\u0026#34;}\u0026#39; (type Admin) as the type User Type does not implement \u0026#39;User\u0026#39; as the \u0026#39;Name\u0026#39; method has a pointer receiver. This is confusing, it says type Admin doesn\u0026rsquo;t implement interface User. You may wonder, you lied, Admin has implemented all methods of User, but wait, really?\nIn fact, it\u0026rsquo;s not type Admin implementing interface User but type *Admin. Checking the definition of Name() and SetName() above, both of these two method have a pointer receiver, not a value receiver. This means the Name() and GetName() method are in the method set of the *Admin type, but not in that of Admin.\n# 2. Any types can implement an interface \u0026ldquo;Any types can implement an interface.\u0026rdquo; is not accurate.\nAny type can have its method set, and if there are all the methods of an interfacce in that type\u0026rsquo;s method set, we say this type implements this interface. This type can be a struct, function, map, array even an integer.\n# 2.1. Array Get multiple parameters from cli with flag package:\n1 func Var(value Value, name string, usage string) According to the docs, custom a type userFlag to implement interface flag.Value:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 type usersFlag []user func (u *usersFlag) String() string { return fmt.Sprintf(\u0026#34;%v\u0026#34;, *u) } func (u *usersFlag) Set(value string) error { values := strings.Split(value, \u0026#34;:\u0026#34;) if len(values) != 3 { return fmt.Errorf(\u0026#34;wrong format of auth, format: path:username:password\u0026#34;) } *u = append( *u, user{ username: values[1], password: values[2], path: formatPath(values[0]), }, ) return nil } Then you can use as follows:\n1 2 3 4 5 6 7 8 9 10 11 12 13 type Param struct { users []user } func (p *Param) init() { var users usersFlag flag.Var(\u0026amp;users, \u0026#34;auth\u0026#34;, fmt.Sprintf(\u0026#34;-auth \u0026lt;path:username:password\u0026gt;\\n\u0026#34;+ \u0026#34;specify user for HTTP Basic Auth\u0026#34;)) flag.Parse() p.users = users } # 2.2. function There is another function called http.Handle() can be used to set routing info and callback, which has a different parameter compared with function http.HandleFunc():\n1 func Handle(pattern string, handler Handler) The second pamrameter is a Handler which is an interface type defined in http package:\n1 2 3 type Handler interface { ServeHTTP(ResponseWriter, *Request) } Function type customHandler implements interface http.Handler:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 type customHandler func(http.ResponseWriter, *http.Request) func (mwh customHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { if r.Method != \u0026#34;POST\u0026#34; { http.Error(w, \u0026#34;method not supported\u0026#34;, http.StatusMethodNotAllowed) return } _, _ = fmt.Fprintf(w, \u0026#34;do something before custom handler mwh(w, r)\u0026#34;) mwh(w, r) } func main() { callback := customHandler(func(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprintf(w, \u0026#34;hello there\u0026#34;) }) // customHandler implemented interface http.Handler, so its object can passed here http.Handle(\u0026#34;/hello\u0026#34;, callback) log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil)) } NOTE: for struct, when you gengerate a value (\u0026ldquo;object\u0026rdquo;) you should use curly brcket {} as below:\n1 2 3 4 5 6 type Cat struct { name string age int } cat := Cat{name: \u0026#34;Kitten\u0026#34;, age: 3} for a function type, we use parentheses to produce a value of that type:\n1 2 3 4 5 type myWebHandler func(http.ResponseWriter, *http.Request) callback := myWebHandler(func(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprintf(w, \u0026#34;hello there\u0026#34;) }) # 3. Essence of interface variables An interface is conceptually a struct with two fields. If we were to describe an interface in Go, it would look something like this.\n1 2 3 4 type interface struct { Type uintptr // points to the type of the interface implementation Data uintptr // holds the data for the interface\u0026#39;s receiver } Type points to a structure that describes the type of the value that implements this interface. Data points to the value of the implementation itself. The contents of Data are passed as the receiver of any method called via the interface.\nThe Go memory model says that writes to a single machine word will be atomic, but interfaces are two word values. It is possible that another goroutine may observe the contents of the interface value while it is being changed.\nLearn more: https://dave.cheney.net/2014/06/27/ice-cream-makers-and-data-races\n","date":"2023-12-07T15:12:32Z","permalink":"https://blog.yorforger.cc/p/interfaces-basics-go/","title":"Interfaces Basics - Go"},{"content":"You should learn how to read the documentation provided Go, it\u0026rsquo;s very important:\n# 1. static language Go is statically typed. Every variable has only one static type, that is, exactly one type known and fixed at compile time: int, float32, *MyType, []byte, and so on. If we declare\n1 2 3 4 type MyInt int var i int var j MyInt then i has type int and j has type MyInt. The variables i and j have distinct static types and, although they have the same underlying type, they cannot be assigned to one another without a conversion.\nThis is also true for an interface:\n1 2 3 4 // Reader is an interface defined in io package type Reader interface { Read(p []byte) (n int, err error) } Statically typed means that before source code is compiled, the type associated with each and every single variable must be known.\n# 2. value \u0026amp; variable There is no object in Go, just variable and the value of a variable. We usually use variable and value as a same thing verbally.\nI think is true in Go/C++/C : A variable is just an adress location. When assignments happens str=\u0026quot;hello world\u0026quot; : Instead of telling the computer store this series of bits in 0x015c5c15c1c5, you tell him to store it in str. str is just a nicer name of a memory adress location.\nThe computer doesn\u0026rsquo;t care and will replace them when compiling, str won\u0026rsquo;t exists, it\u0026rsquo;s all 0x015c5c15c1c5.\nSource: Does operator := always cause a new copy to be created if assign without reference?\n# 3. reference-type vs value-type Keep in mind these two things:\nThere is just value-type in Go, no reference type, reference-type vs value-type is just for easy understanding and catagorizing, because reference is a very common concept in other languages like Java/Python.\nEverything passed by value in Go.\nAll copy is shallow copy, that is, only the value of the variable is copied, not the underlying data. Goâ€™s arrays are values. An array variable denotes the entire array; And everything passed by value, so when you assign or pass around an array variable you will make a copy of its all elements.\nSlice is just a struct, it consists of three fields: a pointer to a underlying array, and its length and capacity. So When you assign or pass around a slice variable, the value of this variable is copied, but this is very cheap, just 3 words.\nDid you catch that? All passed by value.\nThe terminology reference type has been removed from Go specification since Apr 3rd, 2013 (with the commit message: spec: Go has no \u0026lsquo;reference types\u0026rsquo;), the terminology is still popularly used in Go community. https://github.com/go101/go101/wiki/About-the-terminology-%22reference-type%22-in-Go\n# 3.1. reference-type A slice does not store any data, it just describes a section of an underlying array. Therefore, your function can return a slice directly or accept a slice as a argument. In Go, a string is in effect a read-only slice of bytes. Only use *string if you have to distinguish an empty string from no strings. A map value is a pointer to a runtime.hmap structure. A map is just a pointer itself, therefore, you don\u0026rsquo;t need returen a pinter of a map value. Like maps, channels are allocated with make, and the resulting value acts as a reference to an underlying data structure. Interface, a value of interface type is a pointer actually, not just a pointer, but consists of it. A variable of interface type stores a pair: the concrete value assigned to the variable, and that valueâ€™s type descriptor. You don\u0026rsquo;t need to return a pointer to a reference-type for better performance.\n# 3.2. value-type Actually, all are value-type in Go, but I\u0026rsquo;ll list some you may mistake them as reference-type:\narray 1 2 3 4 5 6 7 8 9 10 11 12 func main() { arr_1 := [3]int{0, 0, 0} arr_2 := arr_1 arr_2[0] = 99 arr_2[1] = 99 fmt.Println(\u0026#34;arr_1:\u0026#34;, arr_1) fmt.Println(\u0026#34;arr_2:\u0026#34;, arr_2) } // output: arr_1: [0 0 0] arr_2: [99 99 0] struct 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 type Cat struct { Name string Age int } func main() { cat_1 := Cat{ Name: \u0026#34;Coco\u0026#34;, Age: 1, } cat_2 := cat_1 cat_2.Name = \u0026#34;Bella\u0026#34; fmt.Println(\u0026#34;cat_1:\u0026#34;, cat_1) fmt.Println(\u0026#34;cat_2:\u0026#34;, cat_2) } // output: cat_1: {Coco 1} cat_2: {Bella 1} As you can see, when do modification on cat_2, cat_1 is not affected.\n# 4. value size Kinds of Types Value Size Required by Go Specification bool 1 byte not specified int8, uint8 (byte) 1 byte 1 byte int, uint 1 word architecture dependent, 4 bytes on 32-bit architectures and 8 bytes on 64-bit architectures string 2 words slice 3 words pointer 1 word map 1 word NOTE: Here I call it value size not type size, this word is important, var a int, a is a variable/value whose type is int, and the size of this variable/value is 1 word on my arm64 cpmputer its size is 8 bytes.\n# 5. how the size of a struct value is calculated? The size of a value means how many bytes the direct part of the value will occupy in memory. The indirect underlying parts of a value don\u0026rsquo;t contribute to the size of the value.\nI\u0026rsquo;ll give you an example,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 func main() { cat := Cat{ name: \u0026#34;Coco\u0026#34;, age: 1, s: []int{1, 3, 4, 5, 6, 7}, } fmt.Printf(\u0026#34;cat: %T, %d\\n\u0026#34;, cat, unsafe.Sizeof(cat)) fmt.Printf(\u0026#34;a.age: %T, %d\\n\u0026#34;, cat.age, unsafe.Sizeof(cat.age)) fmt.Printf(\u0026#34;a.name: %T, %d\\n\u0026#34;, cat.name, unsafe.Sizeof(cat.name)) fmt.Printf(\u0026#34;cat.s: %T, %d\\n\u0026#34;, cat.s, unsafe.Sizeof(cat.s)) } cat: main.Cat, 48 cat.s: []int, 24 a.age: int, 8 a.name: string, 16 The sizes of two string values are always equal, same as string, the sizes of two slice values are also always equal. Values of a specified type always have the same value size.\nLearn more: Go Value Copy Costs -Go 101\n# 6. Variable declarations # 6.1. := vs var The := can only be used in inside a function, which is called short variable declarations.\nA var statement can be at package or function level, which is called regular variable declarations.\n# 6.2. Zero value Variables declared without an explicit initial value are given their zero value. The zero value is:\n0 for numeric types, false for the boolean type, and \u0026quot;\u0026quot; (the empty string) for strings. nil for pointer nil for map and slice 1 2 3 4 5 6 7 8 9 10 11 12 func main() { var i int var f float64 var b bool var s string var p *string var sl []int var m map[string]string fmt.Printf(\u0026#34;%v %v %v %q %v %v %v \\n\u0026#34;, i, f, b, s, p, sl==nil, m==nil) } // 0 0 false \u0026#34;\u0026#34; \u0026lt;nil\u0026gt; true true Dereferencing a nil pinter will cause panic, don\u0026rsquo;t do that.\n1 2 3 4 kitten := Cat{Name: \u0026#34;Coco\u0026#34;} // nil is zero value for a pointer var cat *Cat *cat = kitten // runtime error: invalid memory address or nil pointer dereference # 6.3. var vs new vs make It\u0026rsquo;s a little harder to justify new. The main thing it makes easier is creating pointers to non-composite types. The two functions below are equivalent. One\u0026rsquo;s just a little more concise:\n1 2 3 4 5 6 func newInt1() *int { return new(int) } func newInt2() *int { var i int return \u0026amp;i } new() returns a pointer to the value it created, a pointer to map, channel and slice is thought as useless, so don\u0026rsquo;t use new() with these types, just use it with non-composite types. And always use make() when create slice, map and channnel.\nWhen create a custom type, you can use literal:\n1 2 3 4 5 6 7 type ListNode struct { Val int Next *ListNode } res := ListNode{} res := \u0026amp;ListNode{} Conclusion is that don\u0026rsquo;t use new(), it\u0026rsquo;s a little confusing, just use make() and var, :=\nwhy new(): https://softwareengineering.stackexchange.com/a/216582\nnew vs make: https://stackoverflow.com/a/9322182/16317008\nvar vs make: https://davidzhu.xyz/post/golang/basics/003-collections/#5-var-vs-make\n# 7. type conversions The expression T(v) converts the value v to the type T. Some numeric conversions:\n1 2 3 var i int = 42 var f float64 = float64(i) var u uint = uint(f) Or, put more simply:\n1 2 3 i := 42 f := float64(i) u := uint(f) Unlike in C, in Go assignment between items of different type requires an explicit conversion, this enchances the type safety of Golang.\n# 8. Type assertions # 8.1. Basic syntax 1 str := value.(string) If it turns out that the value does not contain a string, the program will crash with a run-time error. To guard against that, use the \u0026ldquo;comma, ok\u0026rdquo; idiom to test, safely, whether the value is a string:\n1 2 3 4 5 6 str, ok := value.(string) if ok { fmt.Printf(\u0026#34;string value is: %q\\n\u0026#34;, str) } else { fmt.Printf(\u0026#34;value is not a string\\n\u0026#34;) } similar syntax - 1:\n1 2 3 4 5 6 7 8 9 10 users := make(map[string]int) users[\u0026#34;jack\u0026#34;] = 13 users[\u0026#34;john\u0026#34;] = 15 user, ok := users[\u0026#34;milo\u0026#34;] if ok { fmt.Println(user) } else { fmt.Println(\u0026#34;no such user\u0026#34;) } similar syntax - 2:\n1 ele, ok:= \u0026lt;-channel_name Type assertion provides access to an interface value\u0026rsquo;s underlying concrete value. So it only can be used when value\u0026rsquo;s type is interface:\n1 2 var m map[interface{}]interface{} _, isMap := m.(map[interface{}]interface{}) The snippet above will cause error: Invalid type assertion: m.(map[interface{}]interface{}) (non-interface type map[interface{}]interface{} on the left.\nThe code below works fine:\n1 2 3 4 5 6 var m map[interface{}]interface{} var t interface{} t = m _, isMap := t.(map[interface{}]interface{}) fmt.Println(isMap) // print: true # 8.2. use case 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 func Copy(dst Writer, src Reader) (written int64, err error) { return copyBuffer(dst, src, nil) } func copyBuffer(dst Writer, src Reader, buf []byte) (written int64, err error) { // If the reader has a WriteTo method, use it to do the copy. // Avoids an allocation and a copy. if wt, ok := src.(WriterTo); ok { return wt.WriteTo(dst) } // Similarly, if the writer has a ReadFrom method, use it to do the copy. if rt, ok := dst.(ReaderFrom); ok { return rt.ReadFrom(src) } ... } bytes.Reader implements io.WriterTo interface and io.Copy uses that for optimized copying. source\n","date":"2023-12-07T10:00:20Z","permalink":"https://blog.yorforger.cc/p/value-variable-and-types-go/","title":"Value, Variable and Types - Go"},{"content":" # 1. Basic concepts A map value is a pointer to a runtime.hmap structure, when you write the statement:\n1 m := make(map[int]int) The compiler replaces it with a call to runtime.makemap, which has the signature\n1 2 3 4 5 6 // makemap implements a Go map creation make(map[k]v, hint) // If the compiler has determined that the map or the first bucket // can be created on the stack, h and/or bucket may be non-nil. // If h != nil, the map can be created directly in h. // If bucket != nil, bucket can be used as the first bucket. func makemap(t *maptype, hint int64, h *hmap, bucket unsafe.Pointer) *hmap 1 2 3 4 5 func main() { var m map[int]int var p uintptr fmt.Println(unsafe.Sizeof(m), unsafe.Sizeof(p)) // 8 8 (linux/amd64) } âš ï¸ Map value just a pointer, therefore, we don\u0026rsquo;t need to pass a pointer to a map for better performance. This is similar to slices, slice just a struct that has a pointer element which pointer to an underlaying array, so we don\u0026rsquo;t need to set a pointer of slice as a paramter. This also applys function\u0026rsquo;s return type.\nMaps, like channels, but unlike slices, are just pointers to runtime types. As you saw above, a map is just a pointer to a runtime.hmap structure.\nLearn more: maps | Dave Cheney\n# 2. var vs make() In previous post we know that you can append a nil slice directly, but this is not the case in a map:\n1 2 3 var cats map[string]int // panic: assignment to entry in nil map cats[\u0026#34;Coco\u0026#34;] = 3 Therefore, for map you should use make or map literal\n1 2 3 // They are equivlent cats := map[string]int{} dogs := make(map[string]int) # 3. Commone usage of map # 3.1. Use map as a counter 1 2 3 4 5 6 7 8 // as a counter counts := make(map[string]int) for name := range users { counts[name]++ } // check if exist, O(1) ele, ok := m[\u0026#34;key\u0026#34;] if !ok {...} # 3.2. Copy map Find a blog talks copy map, share it here:\nLike slices, maps hold references to an underlying data structure. So by assigning its value to another variable, only the reference will be passed. To copy the map, it is necessary to create another map and copy each value:\n1 2 3 4 5 6 7 8 9 10 11 12 // Create the original map originalMap := make(map[string]int) originalMap[\u0026#34;one\u0026#34;] = 1 originalMap[\u0026#34;two\u0026#34;] = 2 // Create the target map targetMap := make(map[string]int) // Copy from the original map to the target map for key, value := range originalMap { targetMap[key] = value } Deep copy a map or slice: encoding/gob \u0026amp; encoding/json in golang - David\u0026rsquo;s Blog\n# 4. Map in concurrent programming First version:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 func (s *memoryStore) monitorExpiredSessions() { for { // detect every seconds time.Sleep(time.Second) memoryMutex.Lock() if len(s.sessions) == 0 { memoryMutex.Unlock() continue } for k, info := range s.sessions { if info.expiresTimestamp \u0026lt;= time.Now().Unix() { delete(s.sessions, k) } } memoryMutex.Unlock() } } // in other place will call this method go s.monitorExpiredSessions() This is not good, as the size of s.sessions grows, the time to iterate through s.sessions will increase, leading to longer lock holding times. We can optimize lock usage, possibly by using more granular locks or lock-free structures.\nSecond version:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 func (s *memoryStore) monitorExpiredSessions() { ticker := time.NewTicker(time.Second) defer ticker.Stop() for range ticker.C { if s.isEmpty() { continue } for k, info := range s.sessions { if info.expiresTimestamp \u0026lt;= time.Now().Unix() { s.delete(k) } } } } func (s *memoryStore) delete(k string) { memoryMutex.Lock() defer memoryMutex.Unlock() delete(s.sessions, k) } func (s *memoryStore) isEmpty() bool { memoryMutex.RLock() defer memoryMutex.RUnlock() return len(s.sessions) == 0 } Some problems:\nThere is no lock when ranging map s.sessions You cannot require a RLock or Lock before range, if you do that, the memoryMutex.Lock() residing in s.delete() will block forever. Because you have hold a lock before the loop, which havn\u0026rsquo;t been released yet, and you cannot acquire another lock in the loop. Third version:\nI find fiber memory storage on github which suits my condition provided by a gopher.\nI\u0026rsquo;ll share the code here:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // Adopted from: https://github.com/gofiber/storage/blob/main/memory/memory.go func (s *cookieStore) gc() { ticker := time.NewTicker(s.gcInterval) defer ticker.Stop() var expired []string for range ticker.C { if s.isEmpty() { continue } mutex.RLock() for k, session := range s.sessions { if session.expiry \u0026lt;= time.Now().Unix() { expired = append(expired, k) } } mutex.RUnlock() mutex.Lock() // Double-checked locking. // User might have reset the max age of the session in the meantime. for i := range expired { v := s.sessions[expired[i]] if v.expiry \u0026lt;= time.Now().Unix() { delete(s.sessions, expired[i]) } } mutex.Unlock() } } func (s *cookieStore) isEmpty() bool { mutex.RLock() defer mutex.RUnlock() return len(s.sessions) == 0 } When I test this, the codes get panic sometimes:\nAt v.expiry \u0026lt;= time.Now().Unix() :\n1 2 3 4 v := s.sessions[expired[i]] if v.expiry \u0026lt;= time.Now().Unix() { ... } 1 panic: runtime error: invalid memory address or nil pointer dereference This means we get a nil session from s.sessions[expired[i]], so there is a problem with slice expired, I was thinking if its length is 0, the range still iterate it. Turns out the range won\u0026rsquo;t iterate an empty slice, just do nothing.\nThen I realize that I did\u0026rsquo;t update the slice, woops, we need drop the useless element in last round:\n1 2 3 4 5 6 ... for range ticker.C { // drop the useless elements. expired = expired[:0] ..... } ","date":"2023-12-06T23:43:50Z","permalink":"https://blog.yorforger.cc/p/map-go/","title":"map - Go"},{"content":" # 1. Array An array\u0026rsquo;s length is part of its type, so arrays cannot be resized. Its length is part of its type ([4]int and [5]int are distinct, incompatible types).\nGoâ€™s arrays are values. An array variable denotes the entire array; it is not a pointer to the first array element (as would be the case in C). This means that when you assign or pass around an array value you will make a copy of its contents. (To avoid the copy you could pass a pointer to the array, but then thatâ€™s a pointer to an array, not an array.)\n# 2. Slice # 2.1. Slice is just a Struct A slice is just a struct. It consists of a pointer to the array, the length of the underlying array, its capacity (the maximum length of the underlying array).\n1 2 3 4 5 type slice struct { data uintptr len int cap int } So the overhead of assigning or passing a slice value, is just 3 words (12 bytes on 32bit, 24 bytes on 64bit), which is very cheap. This is different from assigning or passing an array value, which will copy the entire array.\n# 2.2. Slicing When you create a new slice from an existing array or slice (e.g., newSlice := oldSlice[start:end]), the new slice does not copy the elements. Instead, it refers to the same underlying array as the original slice. Slice is just a struct, as we have talked above.\n1 2 3 4 5 6 7 8 9 10 originalSlice := []int{1, 2, 3, 4, 5} newSlice := originalSlice[:3] originalSlice[0] = 99 // This also changes newSlice[0] newSlice[1] = 101 // This also changes originalSlice[1] fmt.Println(\u0026#34;Original slice:\u0026#34;, originalSlice) fmt.Println(\u0026#34;New slice:\u0026#34;, newSlice) // ouput Original slice: [99 101 3 4 5] New slice: [99 101 3] Note: if you append to the slice and the capacity of the underlying array is exceeded, Go will allocate a new array and copy the elements over, causing the slices to diverge.\nThere is a trick, we usually use d = d[:0] to generate a new slice d whose length is 0 but capacity not change, which can make program more efficient.\n# 2.3. var vs make() 1 2 3 var cats []string // or dogs := make([]string, 0) We have know that any varibles declared with var without an explicit initial value are given their zero value, nil is zero for map, slice and pointer.\nTherefore, the value of cats is nil for sure, then for make([]string, 0)it allocates a memory with 0 elements, which means dog != nil. But there probably no difference when you use, because you can append a nil slice directly:\n1 2 3 4 var expired []string // it\u0026#39;s totally fine to do this: expired = append(expired, \u0026#34;hello\u0026#34;) fmt.Println(expired) # 3. Commone usage of slice # 3.1. Remove elements by reslicing 1 2 3 4 5 6 7 8 9 func (s *MemoryStore) gc() { var expired []string for { // A new cycle begins, \u0026#34;remove\u0026#34; all elements from \u0026#39;expired\u0026#39; expired = expired[:0] // add elements to \u0026#39;expired\u0026#39;, and use them ... } } 1 2 3 4 5 6 7 8 9 10 // Stimulate stack stack := make([]rune, 0) for _, r := range s { if _, ok := pairs[r]; ok { stack = append(stack, r) } else { // reslice, \u0026#34;delete\u0026#34; the last one element stack = stack[:len(stack)-1] } } # 3.2. Passing a slice to channel 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 func main() { ready := make(chan []string) go func() { var expired []string expired = append(expired, \u0026#34;Coco\u0026#34;) expired = append(expired, \u0026#34;Bella\u0026#34;) ready\u0026lt;- expired }() go func() { // this will block until there is a data sent to the channel \u0026#34;ready\u0026#34; for s := range ready { for _, name := range s{ fmt.Println(name) } } }() time.Sleep(time.Second) } Bacsuse a slice likes a pointer, the two goroutines above share a same underlying array. You have to consider if there is a data race, if yes, consider make a deep copy of the slice: Everything Passed by Value - Go - David\u0026rsquo;s Blog\nNote that iteration variable is re-used in each iteration.\n","date":"2023-12-06T23:40:59Z","permalink":"https://blog.yorforger.cc/p/slice-array-go/","title":"slice \u0026 array - Go"},{"content":" # 1. os.Open() loads entire file into memory? No, the os.Open() function in Golang does not load the entire file into RAM by default. It returns a file descriptor that allows you to read or write data from or to the file.\nI found this answer talks about the open() sys call Linux on StackOverflow, which may give you hints on how os.Open() works:\nNo, a file is not automatically read into memory by opening it. That would be awfully inefficient. You have to read it yourself.\nNo it doesn\u0026rsquo;t. It just gives file a descriptor called file descriptor which then you can use to do read / write and some other operations. Think file descriptor as an abstraction or an handle over what lays on disk.\nThe open() function shall establish the connection between a file and a file descriptor.\nSource: https://stackoverflow.com/a/20512890/16317008\n1 func Open(name string) (*File, error) Open opens the named file for reading. If successful, methods on the returned file can be used for reading;\nThe return type of os.Open() is *File, which is a pointer to a struct:\n1 2 3 4 5 6 7 8 9 10 11 12 13 // File represents an open file descriptor. type File struct { *file // os specific } type file struct { pfd poll.FD name string dirinfo *dirInfo nonblock bool stdoutOrErr bool appendMode bool } As you can see, os.Open() just returns a file descriptor, which is a pointer to a struct. It does not load the entire file into memory. After you get the file descriptor, you can use it to read or write data from or to the file. This is why we say \u0026ldquo;The open() function shall establish the connection between a file and a file descriptor.\u0026rdquo;\nIf you want to read the entire file into memory, you can use the ioutil.ReadFile() function from the io/ioutil package. This function reads the entire contents of a file into a byte slice. However, keep in mind that this approach may not be suitable for very large files, as it loads the entire file into memory at once.\nLet me demonstrate how to open a file and read its contents chunk by chunk in Golang:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 func main() { // Open the file for reading file, _ := os.Open(\u0026#34;input.txt\u0026#34;) // Close the file later, otherwise it will cause memory leak defer file.Close() // Create a buffer to keep chunks that are read buffer := make([]byte, 1024) // Read from the file for { // Read a chunk // There is another way to read: file.ReadAt() n, _ := file.Read(buffer) if n == 0 { break } fmt.Print(string(buffer[:n])) } } Why if os.File() load the entire file into memory matters? Because if you are dealing with a very large file, and the RAM is quite limited, your program may get killed by the OS due to out of memory.\n# 2. io.Reader interface # 2.1. What is io.Reader The use io.Reader is quite common in Go. What is io.Reader?\n1 2 3 type Reader interface { Read(p []byte) (n int, err error) } As you can see, io.Reader is an interface that has a Read() method. Any type that implements the Read() method is a io.Reader. Read reads up to len(p) bytes into p. It returns the number of bytes read (0 \u0026lt;= n \u0026lt;= len(p)) and any error encountered. Learn more: https://golang.org/pkg/io/#Reader\n# 2.2. Common types implement io.Reader # 2.2.1. *os.File *os.File we mentioned above has the Read() method, which means it\u0026rsquo;s an io.Reader. Note that *os.File doesn\u0026rsquo;t equals to os.File, because they have different method set. Learn more: https://davidzhu.xyz/post/golang/basics/006-interfaces/\n1 func (f *File) Read(b []byte) (n int, err error) # 2.2.2. *bytes.Buffer 1 2 3 4 // A Buffer is a variable-sized buffer of bytes with Read and Write methods. The zero value for Buffer is an empty buffer ready to use. type Buffer struct { // contains filtered or unexported fields } 1 func (b *Buffer) Read(p []byte) (n int, err error) As you can see, *bytes.Buffer has the Read() method, not bytes.Buffer. So *bytes.Buffer is an io.Reader, but bytes.Buffer is not.\nIf you run code below, you will get an error Cannot use \u0026lsquo;bytes.Buffer{}\u0026rsquo; (type bytes.Buffer) as the type io.Reader Type does not implement \u0026lsquo;io.Reader\u0026rsquo; as the \u0026lsquo;Read\u0026rsquo; method has a pointer receiver:\n1 2 3 var r io.Reader r = bytes.Buffer{} // error r = \u0026amp;bytes.Buffer{} // this is ok You should learn how to read the documentation provided Go, it\u0026rsquo;s very important:\n# 2.2.3. net.Conn The net.Conn interface represents a network connection, such as a TCP or UDP connection. Many networking packages in Go, like net, net/http, and net/rpc, provide implementations of this interface. net.Conn interface has the Read() method, so it\u0026rsquo;s an io.Reader.\n1 2 3 4 5 type Conn interface { Read(b []byte) (n int, err error) Write(b []byte) (n int, err error) ... } # 2.2.4. Code example 1 2 3 4 5 6 file, _ := os.Open(\u0026#34;example.txt\u0026#34;) defer file.Close() buffer := make([]byte, 1024) n, _ := file.Read(buffer) fmt.Printf(\u0026#34;Read %d bytes from the file: %s\\n\u0026#34;, n, buffer[:n]) 1 2 3 4 5 6 data := []byte(\u0026#34;Hello, World!\u0026#34;) buffer := bytes.NewBuffer(data) readData := make([]byte, 5) n, _ := buffer.Read(readData) fmt.Printf(\u0026#34;Read %d bytes from the buffer: %s\\n\u0026#34;, n, readData) 1 2 3 4 5 6 conn, _ := net.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;example.com:80\u0026#34;) defer conn.Close() buffer := make([]byte, 1024) n, _ := conn.Read(buffer) fmt.Printf(\u0026#34;Read %d bytes from the network connection: %s\\n\u0026#34;, n, buffer[:n]) *os.File, *bytes.Buffer, and net.Conn all have the Read() method, so they are all io.Reader. And the use of them are quite similar which involves:\nget a io.Reader close the io.Reader later create a buffer for store chunk of data (not load entire data into memory) read data (chunk by chunk) to the buffer # 3. Reader wrapper # 3.1. Read user input from the console Sometimes we want to add some extra functionality to a io.Reader, for example, when read user input from the console, we want use a specific delimiter to indicate the end of input. We can use a bufio.Reader to wrap the os.Stdin:\n1 2 3 4 reader := bufio.NewReader(os.Stdin) fmt.Print(\u0026#34;Enter your input: \u0026#34;) input, _ := reader.ReadString(\u0026#39;\\n\u0026#39;) fmt.Println(\u0026#34;You entered:\u0026#34;, input) 1 2 3 4 5 // In bufio package, so the pointer receiver *Reader here is *bufio.Reader not io.Reader. func NewReader(rd io.Reader) *Reader // In bufio package, same as above. func (b *Reader) ReadString(delim byte) (string, error) *bufio.Reader and os.Stdin both have the Read() method, so they are both io.Reader. But bufio.Reader provides more functionality than os.Stdin, for example, ReadString(), ReadBytes(), ReadLine(), etc. So we can use bufio.Reader to wrap os.Stdin to add extra functionality.\nIf you use os.Stdin to read user input, would be a little inconvenient, for example, you need convert the byte slice to a string, and trim the unused part. And you cannot specify a delimiter to indicate the end of input:\n1 2 3 4 5 6 7 8 fmt.Print(\u0026#34;Enter your input: \u0026#34;) input := make([]byte, 1024) // Create a byte slice of a certain size n, _ := os.Stdin.Read(input) // Convert byte slice to a string, trimming the unused part inputStr := string(input[:n]) fmt.Println(\u0026#34;You entered:\u0026#34;, inputStr) # 3.2. Limit the size of HTTP request body When handle the user upload file, you may handle like this:\n1 2 3 4 5 6 7 8 func uploadHandler(w http.ResponseWriter, r *http.Request) { // Parse the form data from the request _ := r.ParseMultipartForm(10 \u0026lt;\u0026lt; 20) // Set a reasonable file size limit, e.g., 10MB // Get the file from the request file, _, _ := r.FormFile(\u0026#34;file\u0026#34;) ... } Accroding to the documentation of r.ParseMultipartForm():\nParseMultipartForm parses a request body as multipart/form-data. The whole request body is parsed and up to a total of maxMemory bytes of its file parts are stored in memory, with the remainder stored on disk in temporary files. http package - net/http - Go Packages\nThis means r.ParseMultipartForm() will parse the whole request body even if the uploaded file is larger than maxMemory. But think about another senario, if the client sends a vary large file, the server needs to handle all that data, which may consume the bandwith and CUP usage of the server.\nSo we need to limit the size of incoming request bodies. We can use http.MaxBytesReader() to wrap the http.Request.Body like this:\n1 2 3 4 5 6 7 8 9 10 11 func (s *server) handleUpload(w http.ResponseWriter, r *http.Request, currentDir string) (error, int) { r.Body = http.MaxBytesReader(w, r.Body, s.maxFileSize) if err := r.ParseMultipartForm(maxFileSize); err != nil { return fmt.Errorf(\u0026#34;file is too large:%v\u0026#34;, err), http.StatusBadRequest } // obtain file from parsed form. parsedFile, _, _ := r.FormFile(\u0026#34;file\u0026#34;) ... } Let\u0026rsquo;s see the documentation of http.MaxBytesReader():\n1 func MaxBytesReader(w ResponseWriter, r io.ReadCloser, n int64) io.ReadCloser http.MaxBytesReader() accepts a io.ReadCloser and returns a io.ReadCloser. To be specific, http.MaxBytesReader() wraps the http.Request.Body(io.ReadCloser) to a http.maxBytesReader which implements the io.ReadCloser interface.\n1 2 3 4 5 6 func MaxBytesReader(w ResponseWriter, r io.ReadCloser, n int64) io.ReadCloser { if n \u0026lt; 0 { // Treat negative limits as equivalent to 0. n = 0 } return \u0026amp;maxBytesReader{w: w, r: r, i: n, n: n} } As you can see, what http.MaxBytesReader() does is just to wrap the http.Request.Body to another io.ReadCloser.\nThen you call r.ParseMultipartForm(), this is where the actual parsing and loading of data into memory occur. According to the documentation of r.ParseMultipartForm(), it will parse the whole request body. But the wrapped http.Request.Body will limit the size of the request body, if the incoming data exceeds maxFileSize during the reading and parsing process, the http.MaxBytesReader will trigger an error, effectively preventing the server from reading any more data from the client. This helps to protect against clients sending excessively large requests.\nThen what do you think about how the r.ParseMultipartForm() parse file from request body? Don\u0026rsquo;t forget http.Request.Body is a io.Reader too, which means it has the Read() method. It actually calls the Read() method of http.Request.Body to read data from the request body.\nIn the Read() method of http.maxBytesReader, it will check if the number of bytes read exceeds the limit, if so, it will return an error. You can check the source code of the Read() method of http.maxBytesReader:\n1 2 3 4 5 6 7 8 func (l *maxBytesReader) Read(p []byte) (n int, err error) { ... if res, ok := l.w.(requestTooLarger); ok { res.requestTooLarge() } l.err = \u0026amp;MaxBytesError{l.i} return n, l.err } MaxBytesReader prevents clients from accidentally or maliciously sending a large request and wasting server resources. If possible, it tells the ResponseWriter to close the connection after the limit has been reached.\n# 4. The nature of io.Reader Readers in Go are used for reading data streams, and they have a crucial property: once you read data from a reader, that data is consumed. It\u0026rsquo;s not possible to \u0026lsquo;rewind\u0026rsquo; or read the same data from the reader again unless the reader specifically supports such an operation.\nAs what we did above, we read data from *os.File, *bytes.Buffer, and net.Conn which are all io.Reader. When we read the data into the buffer chunk by chunk, we didn\u0026rsquo;t record or mark where we stop, but in next time we read from the reader, it will start from the last stop point. This is because the data is consumed. Let me demonstrate this:\n1 2 3 4 5 6 7 8 9 func main() { reader := strings.NewReader(\u0026#34;HelloWorld\u0026#34;) buf := make([]byte, 5) _, _ = reader.Read(buf) fmt.Println(string(buf)) // Outputs: Hello _, _ = reader.Read(buf) fmt.Println(string(buf)) // Outputs: World } This applies to all readers, including *os.File, *bytes.Buffer, and net.Conn, etc.\n","date":"2023-12-04T14:25:04Z","permalink":"https://blog.yorforger.cc/p/io-in-golang/","title":"IO in Golang"},{"content":" # 1. Slicing makes shallow copy of a list I have talked this nature of slicing in previous post, currently I came across a weird behavior when improt a variable from another package.\nmessag.py:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 messages = [] def with_user(msg: str) -\u0026gt; None: messages.append(msg) def trim_last_two_messages() -\u0026gt; None: global messages print(\u0026#34;in trim func, before trim, len of messages:\u0026#34; + str(len(messages))) if len(messages) \u0026gt; 2: messages = messages[:-2] print(\u0026#34;in trim func, after trim, len of messages:\u0026#34; + str(len(messages))) if __name__ == \u0026#34;__main__\u0026#34;: pass main.py:\n1 2 3 4 5 6 7 8 9 10 11 from message import messages from message import with_user from message import trim_last_two_messages with_user(\u0026#39;hello\u0026#39;) with_user(\u0026#39;world\u0026#39;) with_user(\u0026#39;foo\u0026#39;) print(\u0026#34;main func, before trim:\u0026#34;, messages) trim_last_two_messages() print(\u0026#34;main func, after trim:\u0026#34;, messages) The output is:\n1 2 3 4 main func, before trim: [\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;, \u0026#39;foo\u0026#39;] in trim func, before trim, len of messages:3 in trim func, after trim, len of messages:1 main func, after trim: [\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;, \u0026#39;foo\u0026#39;] But what I expected is:\n1 2 3 4 main func, before trim: [\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;, \u0026#39;foo\u0026#39;] in trim func, before trim, len of messages:3 in trim func, after trim, len of messages:1 main func, after trim: [\u0026#39;hello\u0026#39;] Importing messages: When you import messages from message.py into main.py, you are importing a reference to the same list object that exists in message.py. Appending Messages: When you call with_user, it appends new messages to the messages list. Both main.py and message.py are still referring to the same list object. Trimming Messages: In trim_last_two_messages, you are slicing the messages list (messages = messages[:-2]). This is where the key behavior occurs. Slicing a list in Python creates a new list object. So after this slicing operation, message.py\u0026rsquo;s messages now points to a new list object, but main.py\u0026rsquo;s messages still points to the original list object. Because of this, changes made to the list in message.py (after the slicing operation) are not reflected in main.py, as they are now two different list objects.\nCorrect way (change the function in message.py):\n1 2 3 4 5 6 def trim_last_two_messages() -\u0026gt; None: global messages print(\u0026#34;in trim func, before trim, len of messages:\u0026#34; + str(len(messages))) if len(messages) \u0026gt; 2: del messages[-2:] print(\u0026#34;in trim func, after trim, len of messages:\u0026#34; + str(len(messages))) or\nChange the code in main.py:\n1 2 3 4 import message # use messages as this: print(message.messages) # 2. Performance of del vs relicing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import timeit # Test with a large list large_list = list(range(1000000)) # a list with one million elements def test_del_method(): temp_list = large_list.copy() del temp_list[-2:] def test_slice_method(): temp_list = large_list.copy() temp_list = temp_list[:-2] time_del = timeit.timeit(test_del_method, number=100) time_slice = timeit.timeit(test_slice_method, number=100) print(f\u0026#34;Time taken by del method: {time_del} seconds\u0026#34;) print(f\u0026#34;Time taken by slice method: {time_slice} seconds\u0026#34;) The output:\n1 2 Time taken by del method: 0.312709417 seconds Time taken by slice method: 0.683257708 seconds ","date":"2023-12-03T09:01:25Z","permalink":"https://blog.yorforger.cc/p/common-mistakes-and-tricks-python/","title":"Common Mistakes and Tricks Python"},{"content":" # 1. Problem description I\u0026rsquo;ve discussed how to use Cloudflare as a reverse proxy for my web traffic in previous post.\nI write a file server in Go, when attempting to upload a file of approximately 200 MB, it becomes very slow (always uploading) and never succeed. Upon monitoring the server using tools like htop, it seems that the server might be unaware of the incoming large file upload. I come across a error by chance: 413 Request Entity Too Large.\n# 2. Cloudflare Then I found this is because the limitation of Couldflare proxy:\nThereâ€™s a body size limit of 100 MB on Free and Pro, 200 MB on Business and 50074 MB on Enterprise. Only Enterprise customers can request to have the body size limit increased.\nEach user can only upload files with maximum size of 100MB at a time if your website is proxied by Cloudflare.\nDoes the 100 Mb limit apllies to all users on my website?\nSo this is the thing, then I try to access my website directly by IP address (bypass the Cloudflare proxy).\n# 3. VPS RAM Then I can see my file server handling the incoming request whose body larger than 100MB, I use htop to check the RAM usage status on my VPS, I can see the ram increase from 50MB to 100MB then 200MB, then my file server get killed by the OS.\nMy VPS RAM is 512MB, and there is 460MB left, I don\u0026rsquo;t know why the OS kill my file server program.\n# 4. Golang Besides, when I tried to upload some files whose size is around 60MB, the RAM usage of my VPS increase from 50MB (total) to around 100MB, this makes sense, because the file server needs load the whole file to the RAM and copy the content to the disk.\nBut after handling this request, the RAM usage is still around 100MB, if I upload another file (60MB), then the RAM usage increases to around 160MB. I thought there is memory leak on my program. But I was wrong. I found a post and share it here:\nGo does not release memory it allocated from the OS immediately. The reason is probably that allocating memory is costly (needs system calls) and the chance is high that it will be needed in the near future anyway again. But, if memory gets long enough unused it will be released eventually so that the RSS of the process decreases again.\nLearn more: https://stackoverflow.com/a/49843380/16317008\nRSS indicates the actual physical memory consumed by a process, while VSZ includes not only the physical memory but also the virtual memory.\nLearn more: https://stackoverflow.com/a/21049737/16317008\n","date":"2023-11-30T21:43:22Z","permalink":"https://blog.yorforger.cc/p/go-file-server-cannot-handle-large-files/","title":"Go File Server Cannot Handle Large Files"},{"content":" # 1. Objects in Python Everything in Python is an object. Classes, functions, and even simple data types, such as integers, floats, and strings, are objects in Python. When we define an integer in Python, CPython internally creates an object of type integer. These objects are stored in heap memory.\nEach Python object consists of three fields:\nValue Type Reference count Let\u0026rsquo;s consider a simple example:\n1 a = 100 When the above code is executed, CPython creates an object of type integer and allocates memory for this object on the heap memory.\nThe type indicates the type of the object in CPython, and the value field, as the name suggests, stores the value of the object (100 in this case). We will discuss the ref_count field later in the article.\nCPython is the default and most widely used implementation of the Python language. When we say Python, it essentially means we\u0026rsquo;re referring to CPython. When you download Python from python.org, you basically download the CPython code. Thus, CPython is a program written in C language that implements all the rules and specifications defined by the Python language. CPython can be defined as both an interpreter and a compiler as it compiles Python code into bytecode before interpreting it.\n# 2. Variables in Python Variables in Python are just references to the actual object in memory. They are like names or labels that point to the actual object in memory. They do not store any value.\nConsider the following example:\n1 a = 100 As discussed earlier, when the above code is executed, CPython internally creates an object of type integer. The variable a points to this integer object as shown below:\nWe can access the integer object in the Python program using the variable a.\nè¯»åˆ°è¿™å¯ä»¥çœ‹å‡ºJavaè¿˜ä¸æ˜¯çœŸæ­£çš„ä¸‡ç‰©çš†å¯¹è±¡ (å¦‚æœæƒ³åœ¨heapä¸Šåˆ›å»ºprimitiveå¯¹è±¡ éœ€è¦Integerå£°æ˜åˆ›å»º), ä½†Pythonå°±æ˜¯æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡, å³ä½¿æ˜¯ä¸€ä¸ªintç±»å‹, ç”šè‡³ä¸€ä¸ªå‡½æ•°ä¹Ÿæ˜¯ä¸ªå¯¹è±¡, å¦å¤–Javaä¸pythonçš„GC (Pythonä¸­ä¸å«GCå«Python memory manager)å¯¹å¯¹è±¡çš„ç®¡ç†æ–¹å¼åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„, å³åˆ†ä¸ºå¼•ç”¨å’Œå¯¹è±¡ä¸¤éƒ¨åˆ†, å¼•ç”¨åœ¨stack, å¯¹è±¡åœ¨heap, ä¸åƒc++é‚£ç§åœ¨å‡½æ•°é‡Œå£°æ˜çš„å°±æ˜¯å±€éƒ¨å¯¹è±¡(é™¤mallocå’Œnew), å¯¹äºJavaä¸pythonæ¥è¯´æ— è®ºä½ åœ¨å“ªåˆ›å»ºä¸€ä¸ªå¯¹è±¡, ä»–ä»¬éƒ½ä¼šè¢«åˆ›å»ºåˆ°heapä¸Š, ä¸”æ ¹æ®å¼•ç”¨è®¡æ•°æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦reachable, ç„¶ååˆ¤æ–­æ˜¯å¦å›æ”¶å¯¹è±¡, æ‰€ä»¥ä½ å®Œå…¨å¯ä»¥è¿”å›ä¸€ä¸ªâ€œå±€éƒ¨å¯¹è±¡â€çš„å¼•ç”¨, ä½†C++ä¸­, è‚¯å®šå°±ä¸è¡Œäº†, è¿™ä¼šé€ æˆé‡æŒ‡é’ˆé—®é¢˜,\nLet\u0026rsquo;s assign this integer object to another variable b:\n1 b = a When the above code is executed, the variables a and b both point to the same integer object, as shown below:\nLet\u0026rsquo;s now increment the value of the integer object by 1:\nLet\u0026rsquo;s now increment the value of the integer object by 1:\n1 2 # Increment a by 1 a = a + 1 When the above code is executed, CPython creates a new integer object with the value 101 and makes variable a point to this new integer object. Variable b will continue to point to the integer object with the value 100, as shown below:\nHere, we can see that instead of overwriting the value of 100 with 101, CPython creates a new object with the value 101 because integers in Python are immutable. Once created, they cannot be modified. Please note that floats and string data types are also immutable in Python.\nLet\u0026rsquo;s consider a simple Python program to further explain this concept:\n1 2 3 i = 0 while i \u0026lt; 100: i = i + 1 The above code defines a simple while loop that increments the value of the variable i until it is less than 100. When this code is executed, for every increment of the variable i, CPython will create a new integer object with the incremented value, and the old integer object will be deleted (to be more precise, this object would become eligible for deletion) from memory.\nCPython calls the malloc method for each new object to allocate memory for that object. It calls the free method to delete the old object from memory.\n1 2 3 4 5 i = 0 # malloc(i) while i \u0026lt; 100: # malloc(i + 1) # free(i) i = i + 1 We can see that CPython creates and deletes a large number of objects, even for this simple program. If we call the malloc and free methods for each object creation and deletion, it will degrade the programâ€™s execution performance and make the program slow.\nHence, CPython introduces various techniques to reduce the number of times we have to call malloc and free for each small object creation and deletion. Letâ€™s now understand how CPython manages memory!\nLearn more: Memory Management in Python - Honeybadger Developer Blog\n","date":"2023-11-29T14:51:31Z","permalink":"https://blog.yorforger.cc/p/objects-variables-python/","title":"Objects \u0026 Variables Python"},{"content":" # 1. Python 1 2 3 4 5 6 7 8 9 10 11 12 13 def test_function(x, y): x += 1 y.append(4) def main(): a = 1 b = [2, 3] test_function(a, b) print(\u0026#34;a =\u0026#34;, a) print(\u0026#34;b =\u0026#34;, b) main() Output:\n1 2 a = 1 b = [2, 3, 4] If you pass a mutable object into a method, the method gets a reference to that same object and you can mutate it to your heart\u0026rsquo;s delight, but if you rebind the reference in the method, the outer scope will know nothing about it, and after you\u0026rsquo;re done, the outer reference will still point at the original object.\ninteger, str are immutable objects in Python If you pass an immutable object to a method, you still can\u0026rsquo;t rebind the outer reference, and you can\u0026rsquo;t even mutate the object.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026gt;\u0026gt;\u0026gt; def main(): ... n = 9001 ... print(f\u0026#34;Initial address of n: {id(n)}\u0026#34;) ... increment(n) ... print(f\u0026#34; Final address of n: {id(n)}\u0026#34;) ... \u0026gt;\u0026gt;\u0026gt; def increment(x): ... print(f\u0026#34;Initial address of x: {id(x)}\u0026#34;) ... x += 1 ... print(f\u0026#34; Final address of x: {id(x)}\u0026#34;) ... \u0026gt;\u0026gt;\u0026gt; main() Initial address of n: 140562586057840 Initial address of x: 140562586057840 Final address of x: 140562586057968 Final address of n: 140562586057840 # 2. Javascript 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 function changeStuff(a, b, c) { a = a * 10; b.item = \u0026#34;changed\u0026#34;; c = {item: \u0026#34;changed\u0026#34;}; } var num = 10; var obj1 = {item: \u0026#34;unchanged\u0026#34;}; var obj2 = {item: \u0026#34;unchanged\u0026#34;}; changeStuff(num, obj1, obj2); console.log(num); console.log(obj1.item); console.log(obj2.item); This produces the output:\n1 2 3 10 changed unchanged # 3. Golang, Java, C++ \u0026amp; Javascript Python, Java, C++ and JS are all pass by value, but they do have references. When you assign or pass a reference-type, the copied value is still the value of the reference, namely the address, giving us the illusion of \u0026ldquo;pass by reference not value.\u0026rdquo;\nC++ has another application where passing const references is preferred to enhance efficiency. However, in Java, Python, and JS, references are passed every time, but they lack the concept of const references.\nActually Golang doesn\u0026rsquo;t have reference type (all are values), reference type often refers to the maps, slice, channels and strings in Golang which are pointers themselves or a struct holding a pointer to the underlying data structure.\n","date":"2023-11-28T23:02:06Z","permalink":"https://blog.yorforger.cc/p/pass-by-value-or-reference/","title":"Pass by Value or Reference"},{"content":" # Data Types in Programming Languages Programs are collections of instructions that manipulate data to produce a desired result.\n# 1. Javascript As you have know that javascript is a dynamic language from previous post, which means the values have types, not variables.\nJavascript value types can be categorized into two main categories: objects and primitives. Among these types, the objects are mutable, which means their values can be modified or changed after they are created. On the other hand, the primitive types are immutable, meaning their values cannot be changed once they are assigned.\n# 1.1. Primitive types Type typeof return value Object wrapper Null \u0026quot;object\u0026quot; N/A Undefined \u0026quot;undefined\u0026quot; N/A Boolean \u0026quot;boolean\u0026quot; Boolean Number \u0026quot;number\u0026quot; Number BigInt \u0026quot;bigint\u0026quot; BigInt String \u0026quot;string\u0026quot; String Symbol \u0026quot;symbol\u0026quot; Symbol All primitive types, except null and undefined, have their corresponding object wrapper types, which provide useful methods for working with the primitive values. For example, the Number object provides methods like toExponential().\nAll primitive types, except null, can be tested by the typeof operator. typeof null returns \u0026quot;object\u0026quot;, so one has to use === null to test for null.\n# 1.2. Object types Learn more:\nObjects \u0026amp; Collections in Javascript - David\u0026rsquo;s Blog\nJavaScript data types and data structures - JavaScript | MDN\n# 2. Python Python is a dynamic language which means the values have types, not variables.\nIn Python all values are objects, so doesn\u0026rsquo;t like Java, there is no primitives, all variable are references. (Variables are associated with values, values have types)\n# 2.1. Data types Python has the following data types built-in by default, in these categories:\nText Type: str Numeric Types: int, float, complex Sequence Types: list, tuple, range Mapping Type: dict Set Types: set, frozenset Boolean Type: bool Binary Types: bytes, bytearray, memoryview None Type: NoneType # 2.2. Mutable and immutable objects Everything in Python is an object. And all objects in Python can be either mutable or immutable. Mutable objects are those that allow you to change their value or data in place without affecting the objectâ€™s identity. In contrast, immutable objects donâ€™t allow this kind of operation, you have to create a new objects of the same type with different values.\nObjects of built-in types like (int, float, bool, str, tuple, unicode) are immutable. Objects of built-in types like (list, set, dict) are mutable. Custom classes are generally mutable.\nFind a good explanation:\nThe integer is immutable. When you write x=5, x points to a memory location that holds 5. When you go on and code y=x, the variable y points to the same location as x.\nThen you type x+1=6, and now x points to a new location that holds 6, and not the previous location. ( Here, the integer still holds immutable because the original integer 5 still exists, but the variable x is not bound to it now. x is now bound to a new location. But y is still bound to the integer 5)\nBut y still points to the same location that holds 5. So, integers are still immutable and this is how it works. To see it better, use id(x) or id(y) after every step.\nThe variable is not immutable; the int object referred to by the variable is.\n# 3. Java Java is a static language which means the variable have types, not values have types.\nTypes of variables in Java are divided into two categoriesâ€”primitive types and reference types.\n# 3.1. Primitive types The primitive types are boolean, byte, char, short, int, long, float and double. All other types are reference types.\nâ€¢ A primitive-type variable can store exactly one value of its declared type at a time.\nâ€¢ Primitive-type instance variables are initialized by default. Variables of types byte, char, short, int, long, float and double are initialized to 0. Variables of type boolean are initialized to false.\n# 3.2. Reference types Reference types in Java are non-primitive data types. It\u0026rsquo;s called reference ecause it holds the memory address (or reference) of the objects.\nIn Java, all objects are allocated on Heap. This is different from C++ where objects can be allocated memory either on Stack or on Heap.\nWhenever you use new, an object is created on the heap. Local variables are stored on the stack. That includes primitives (such as int) and the references to any objects created. The actual objects themselves aren\u0026rsquo;t created on the stack, as I mentioned when you use new they\u0026rsquo;ll be created on the heap. https://stackoverflow.com/a/8061692/16317008 1 2 3 4 5 // variable age: primitive, stored on stack int age = 77; // variable person: reference, stored on stack, // its value is the address of the object stored on heap Person person = new Person(); Just as men and women are fundamentally different (according to John Gray, author of Men Are from Mars, Women Are from Venus), primitive variables and object reference variables differ from each other in multiple ways. The basic difference is that primitive variables store the actual values, whereas reference variables store the addresses of the objects they refer to. Letâ€™s assume that a class Person is already defined. If you create an int variable a, and an object reference variable person, they will store their values in memory as shown in figure 2.13. https://stackoverflow.com/a/32049775/16317008\nNote that similar to Python, strings in Java are objects, and they are immutable.\n# 4. Golang Golang is static language, golang has no concept of object, all are values. So you can think the variable have types or values have types, all are fine.\nGolang has no refernce-type, all are values. But there is a concept of pointer, some types like slice, map, channel, function which are a pointer or a struct that has a pointer element, we usually catagorize them as reference-type.\n# 5. C++ C++ is a static language which means the variable have types, not values have types.\nC++ has variable, reference and object. A variable is a named object that can hold a value of a specific data type. A reference is an alias for a variable, which means that it refers to the same memory location as the variable it is referencing. An object is used to store a value in memory.\nA variable is an object that has a name (identifier). Naming our objects let us refer to them again later in the program. Although objects in C++ can be unnamed (anonymous), more often we name our objects using an identifier. An object with a name is called a variable.\n1 int x; // define a variable named x, of type int In C++, we use objects to access memory. A named object is called a variable. Variables have an identifier, a type, and a value (and some other attributes that arenâ€™t relevant here). A variableâ€™s type is used to determine how the value in memory should be interpreted.\nYou can think of RAM as a series of numbered boxes that can be used to store data while the program is running. In some older programming languages (like Applesoft BASIC), you could directly access these boxes (e.g. you could write a statement to â€œgo get the value stored in mailbox number 7532â€). In C++, direct memory access is discouraged. Instead, we access memory indirectly through an object. An object is a region of storage (usually memory) that can store a value, and has other associated properties.\n1.3 â€” Introduction to objects and variables â€“ Learn C++\n# 6. Conclusion Variables, values, types, the concepts of these terms may a little different. Don\u0026rsquo;t need to remember what exactly these terms mean in each language, our goal is to know the behavior of the language so that we can use the language correctly and efficiently. Such as pass by value or reference, and if can return a reference of a locla variable.\n","date":"2023-11-28T20:50:06Z","permalink":"https://blog.yorforger.cc/p/data-types-in-programming-languages/","title":"Data Types in Programming Languages"},{"content":" # 1. Compiled vs interpreted language Programming languages are for humans to read and understand. The program (source code) must be translated into machine language so that the computer can execute the program. The time when this translation occurs depends on whether the programming language is a compiled language or an interpreted language. Instead of translating the source code into machine language before the executable file is created, an interpreter converts the source code into machine language at the same time the program runs. So you can\u0026rsquo;t say a language doesnâ€™t have compilation step, because any language needs to be translated to machine code.\n# 2. Statically vs dynamically typing Also know as statically/dynamically typed, static/dynamic language.\nStatic Typing:\nIn statically typed languages, the type of a variable is known at compile time.\nThe programmer must explicitly declare the data type of each variable.\nExamples of statically typed languages include Java, C, C++, and Go.\nStatic typing allows for early detection of type-related errors during the compilation process.\nDynamic Typing:\nIn dynamically typed languages, the type of a variable is determined at runtime. The programmer does not need to explicitly declare the data type of each variable. Examples of dynamically typed languages include Python, JavaScript, Ruby, and PHP. Type checking occurs during runtime, which means that type-related errors may only be discovered when the code is executed. For example in Java:\n1 2 String str = \u0026#34;Hello\u0026#34;; //statically typed as string str = 5; //would throw an error since java is statically typed Whereas in a dynamically typed language the type is dynamic, meaning after you set a variable to a type, you CAN change it. That is because typing is associated with the value rather than the variable. For example in Python:\n1 2 str = \u0026#34;Hello\u0026#34; # it is a string str = 5 # now it is an integer; perfectly OK # 3. Strong vs weak typing The strong/weak typing in a language is related to implicit type conversions (partly taken from @Dario\u0026rsquo;s answer):\nFor example in Python:\n1 2 str = 5 + \u0026#34;hello\u0026#34; # would throw an error since it does not want to cast one type to the other implicitly. whereas in PHP:\n1 2 $str = 5 + \u0026#34;hello\u0026#34;; // equals 5 because \u0026#34;hello\u0026#34; is implicitly casted to 0 // PHP is weakly typed, thus is a very forgiving language. Static typing allows for checking type correctness at compile time. Statically typed languages are usually compiled, and dynamically typed languages are interpreted. Therefore, dynamicly typed languages can check typing at run time.\nSource: https://stackoverflow.com/a/34004765/16317008\n# 4. Conclusion Dynamically typing languages (where type checking happens at run time) can also be strongly typed (Python for example).\nNote that in dynamically checking languages, values have types, not variables (have types). Whereas, in statically checking languages, variables have types.\nStatic/Dynamic Typing is about when type information is acquired (Either at compile time or at runtime)\nStrong/Weak Typing is about how strictly types are distinguished (e.g. whether the language tries to do an implicit conversion from strings to numbers).\n","date":"2023-11-28T20:30:17Z","permalink":"https://blog.yorforger.cc/p/typing-in-programming-language/","title":"Typing in Programming Language"},{"content":"Previous post: Typing in Programming Language - David\u0026rsquo;s Blog\n# 1. Javascript JavaScript is a dynamic language with dynamic types. Variables in JavaScript are not directly associated with any particular value type, and any variable can be assigned (and re-assigned) values of all types:\n1 2 3 let foo = 42; // foo is now a number foo = \u0026#34;bar\u0026#34;; // foo is now a string foo = true; // foo is now a boolean This is in dynamic languages (dynamically typing), values have types, not variables.\nYou don\u0026rsquo;t need know what is dynamic languages, you just need know values have types, not variables.\nJavaScript is also a weakly typed language, which means it allows implicit type conversion when an operation involves mismatched types, instead of throwing type errors.\n1 2 3 const foo = 42; // foo is a number const result = foo + \u0026#34;1\u0026#34;; // JavaScript coerces foo to a string, so it can be concatenated with the other operand console.log(result); // 421 As you can see, weakly typed language means it allows implicit type conversion when an operation involves mismatched types, instead of throwing type errors.\n# 2. Python Python is dynamic language, and is strongly typed.\n1 2 bob = 1 bob = \u0026#34;bob\u0026#34; This works because the variable does not have a type; it can name any object. After bob=1, you\u0026rsquo;ll find that type(bob) returns int, but after bob=\u0026quot;bob\u0026quot;, it returns str. (Note that type is a regular function, so it evaluates its argument, then returns the type of the value.)\n1 2 3 4 5 6 # Attempting to add a string and an integer string_var = \u0026#34;Hello\u0026#34; integer_var = 42 # This line will result in a TypeError result = string_var + integer_var # 3. C/C++ Bbviously, they are static language, but strong or weak?\nIt\u0026rsquo;s hard to classify every language into \u0026lsquo;weakly\u0026rsquo; or \u0026lsquo;strongly\u0026rsquo; typed \u0026ndash; it\u0026rsquo;s more of a continuum. But, in comparison to other languages, C is fairly strongly typed. Every object has a compile-time type, and the compiler will let you know (loudly) if you\u0026rsquo;re doing something with an object that its type doesn\u0026rsquo;t let you do. For example, you can\u0026rsquo;t call functions with the wrong types of parameters, access struct/union members which don\u0026rsquo;t exist, etc.\nBut there are a few weaknesses. One major weakness is typecasts - they essentially say that you\u0026rsquo;re going to be mucking around with the types of objects, and the compiler should be quiet (when it can). void* is also another weakness \u0026ndash; it\u0026rsquo;s a generic pointer to an unknown type, and when you use them, you have to be extra careful that you\u0026rsquo;re doing the right thing. The compiler can\u0026rsquo;t statically check most uses of void*. void* can also be converted to a pointer to any type without a cast (only in C, not in C++), which is another weakness.\nhttps://stackoverflow.com/a/430204/16317008\n# 4. Java Java is static and strongly typed.\nIn Java or C/C++, every variable must have a declared type, and the type is checked at compile-time. Once a variable is declared with a specific type, it cannot be assigned a value of a different type. Here\u0026rsquo;s an example:\n1 2 int num = 10; // The variable \u0026#39;num\u0026#39; is declared as an integer num = \u0026#34;Hello\u0026#34;; // This will result in a compilation error because we are trying to assign a string to an integer variable Strongly Typed: Java is also a strongly typed language, which means that type conversions or implicit type coercion are limited. In Java, you cannot perform operations between incompatible types without explicitly converting them. Here\u0026rsquo;s an example:\n1 2 3 int num1 = 10; String str = \u0026#34;20\u0026#34;; int sum = num1 + str; // This will result in a compilation error because we are trying to add an integer and a string without explicit conversion # 4. Golang Golang is indeed a static and strongly typed language:\n1 2 3 a := 2 b := 3.2 fmt.Println(a + b) // invalid operation: a + b (mismatched types int and float64) ","date":"2023-11-28T19:20:17Z","permalink":"https://blog.yorforger.cc/p/typing-in-programming-language-example/","title":"Typing in Programming Language - Example"},{"content":" # 1. Concurrency models Processes Threads (system or green) Futures Asynchronous operations, non-blocking, single-threaded Coroutines CSP Actor Learn more: java - What\u0026rsquo;s the difference between a Future and a Promise? - Stack Overflow\n# 2. Promise object A wrapper for a resolved value or a reason that it\u0026rsquo;s not resolved yet. But with some powerful methods, allow you handle different situations. Like the then chain, the catch Non-blocking: enable you to write asynchronous code in a synchronous manner. Most important feature. There are more complicated methods, The Promise object has several fields and methods, including:\nstate: A private field that represents the current state of the promise (pending, fulfilled or rejected). result: A private field that holds the result value if the promise is fulfilled or the reason if it is rejected. then(), catch(), finally() methods, only get executed when the state of Promise object is fulfilled or rejected. # 3 Use await/async with Promise object 1 2 3 4 5 6 7 8 9 10 11 12 13 14 async function main() { let response try { // \u0026#39;response\u0026#39; is not a Promise object, // it\u0026#39;s the resolved value the in the Promise object response = await fetch(\u0026#39;https://www.google.com\u0026#39;); } catch (err) { console.error(\u0026#34;an err happened\u0026#34;); return } console.log(response.ok); } main().then() You may wonder why we need call then() after main(), the reason is that async functions always return a promise implicitly.\nIf the return value of an async function is not explicitly a promise, it will be implicitly wrapped in a promise. An async function is really just a fancy Promise wrapper.\nIf you call main like this:\n1 2 3 ... await main(); There will be an error:\n1 2 3 4 await main(); ^^^^^ SyntaxError: await is only valid in async functions and the top level bodies of modules This is another syntax to call async function:\n1 2 3 (async () =\u0026gt; { await main() })() # Use then() with Promise object 1 2 3 fetch(\u0026#39;https://www.google.com\u0026#39;) .then(response =\u0026gt; console.log(response.status)) .catch(err =\u0026gt; console.error(\u0026#34;An err occurred.\u0026#34;)) Because fetch() retuens a Promise object, we can call then() directly, this looks more concise than ealier example.\nBut we usually use await/async instead of then() for readability in real world projects, because we need handle errors and consider different situations.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 async function fetchMessage(messages) { setLoading(true) controller.current = new AbortController() try { const response = await fetch(fetchPath, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;Authorization\u0026#39;: localStorage.getItem(\u0026#39;token\u0026#39;), }, body: JSON.stringify({messages}), signal: controller?.current?.signal, }); const data = await response.json(); setLoading(false) if (!response.ok) { // remove the last message setMessages((messages) =\u0026gt; messages.slice(0, -1)); message.error({ content: \u0026#34;è·å–ä¿¡æ¯å¤±è´¥, è¯·è”ç³»æˆªå›¾ä¸»äººå–µ~: \u0026#34; + data.error, duration: 5, }); return; } return data; } catch (e) { setLoading(false) // remove the last message setMessages((messages) =\u0026gt; messages.slice(0, -1)); if (e.name === \u0026#39;AbortError\u0026#39;) { return } message.error(\u0026#34;è·å–ä¿¡æ¯å¤±è´¥, è¯·è”ç³»æˆªå›¾ä¸»äººå–µ~: \u0026#34; + e); } } ","date":"2023-11-28T12:34:29Z","permalink":"https://blog.yorforger.cc/p/promise-object-in-javascript/","title":"Promise Object in Javascript"},{"content":" # 1. An example to feel what it is enqueueLinks: is used to add the links exist in current page to a queue for crawler to process. maxRequestsPerCrawl: control the maximum of requests the crawler can make, you should always set it. headless: set it false, you will see all the actions on browser, browser will click link itself (controlled by your js program). 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import { PlaywrightCrawler, Dataset } from \u0026#39;crawlee\u0026#39;; // PlaywrightCrawler crawls the web using a headless // browser controlled by the Playwright library. const crawler = new PlaywrightCrawler({ // Use the requestHandler to process each of the crawled pages. async requestHandler({ request, page, enqueueLinks, log }) { const title = await page.title(); log.info(`Title of ${request.loadedUrl} is \u0026#39;${title}\u0026#39;`); // Extract links from the current page // and add them to the crawling queue. await enqueueLinks(); }, // Uncomment this option to see the browser window. // headless: false, // This value should always be set in order to prevent infinite loops in misconfigured crawlers. maxRequestsPerCrawl: 3, }); // Add first URL to the queue and start the crawl. await crawler.run([\u0026#39;https://github.com/apify/crawlee\u0026#39;]); Output:\n1 2 3 4 5 6 7 8 9 10 11 12 â¯ npm start \u0026gt; my-crawler@0.0.1 start \u0026gt; node src/main.js INFO PlaywrightCrawler: Starting the crawler. INFO PlaywrightCrawler: Title of https://github.com/apify/crawlee is \u0026#39;GitHub - apify/crawlee\u0026#39; INFO PlaywrightCrawler: Title of https://github.com/ is \u0026#39;GitHub: Letâ€™s build from here Â· GitHub\u0026#39; INFO PlaywrightCrawler: Title of https://github.com/signup?ref_cta=Sign+up\u0026amp;ref_loc=header+logged+out\u0026amp;ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E\u0026amp;source=header-repo is \u0026#39;Join GitHub Â· GitHub\u0026#39; INFO PlaywrightCrawler: Crawler reached the maxRequestsPerCrawl limit of 3 requests and will shut down soon. ... INFO PlaywrightCrawler: Finished! Total 4 requests: 4 succeeded, 0 failed. {\u0026#34;terminal\u0026#34;:true} As you can see, the output above: Crawler reached the maxRequestsPerCrawl limit of 3 requests\u0026hellip;\nYou probably notice that we just specified only one url, why the crawler makes 3 requests?\nIt makes three requests because we set maxRequestsPerCrawl: 3 above. Besides, because of we added parameter enqueueLinks, which pushes the all links (exist in the current page) into the request queue of the crawler, and this is a loop, so this is why we need set maxRequestsPerCrawl: 3.\n# 2. CheerioCrawler, PuppeteerCrawler and PlaywrightCrawler # 2.1. CheerioCrawler Unless you have a good reason to start with a different one, you should try building a CheerioCrawler first. It is an HTTP crawler with HTTP2 support, anti-blocking features and integrated HTML parser - Cheerio. It\u0026rsquo;s fast, simple, cheap to run and does not require complicated dependencies. The only downside is that it won\u0026rsquo;t work out of the box for websites which require JavaScript rendering. But you might not need JavaScript rendering at all, because many modern websites use server-side rendering.\nUses headless Chrome browser, doesn\u0026rsquo;t support headful browser.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // Add import of CheerioCrawler import { CheerioCrawler } from \u0026#39;crawlee\u0026#39;; const crawler = new CheerioCrawler({ // The `$` argument is the Cheerio object // which contains parsed HTML of the website. async requestHandler({ $, request }) { const title = $(\u0026#39;title\u0026#39;).text(); console.log(`The title of \u0026#34;${request.url}\u0026#34; is: ${title}.`); }, maxRequestsPerCrawl: 3, }) // Start the crawler with the provided URLs await crawler.run([\u0026#39;https://crawlee.dev\u0026#39;]); Learn more:\nQuick Start | Crawlee First crawler | Crawlee # 3. Real world example You can learn a lot from this:\nGetting some real-world data | Crawlee\nScraping the Store | Crawlee\n","date":"2023-11-26T21:29:35Z","permalink":"https://blog.yorforger.cc/p/clawlee-library-get-started/","title":"Clawlee Library - Get Started"},{"content":" # 1. Web crawler A Web crawler, sometimes called a spider or spiderbot and often shortened to crawler, is an Internet bot that systematically browses the World Wide Web and that is typically operated by search engines for the purpose of Web indexing (web spidering). Web crawler\n# 2. Headless browser A headless browser is a web browser that operates without a graphical user interface (GUI). It runs in the background and interacts with web pages programmatically, just like a regular browser, but without displaying the web page to the user. Headless browsers are commonly used in web crawling and scraping applications.\nLearn more: Web Scraping Without Getting Blocked | ScrapeOps\n# 3. Playwright library Playwright is an open-source automation library for browser testing and web scraping developed by Microsoft and launched on 31 January 2020, which has since become popular among programmers and web developers. Playwright provides the ability to automate browser tasks in Chromium, Firefox and WebKit with a single API.\nPlaywright is a framework for Web Testing and Automation. It allows testing Chromium, Firefox and WebKit with a single API. microsoft/playwright\n# 4. JavaScript rendering JavaScript rendering is the process of executing JavaScript on a page to make changes in the page\u0026rsquo;s structure or content. It\u0026rsquo;s also called client-side rendering, the opposite of server-side rendering. Some modern websites render on the client, some on the server and many cutting edge websites render some things on the server and other things on the client.\nJavascript uses the document object model (DOM) to manipulate the DOM elements. Rendering refers to showing the output in the browser.\nLearn more:\nWhat is JavaScript rendering?\nJavaScript rendering | Crawlee\n# 5. Anti-Scraping It refers to all techniques, tools, and approaches to protect online data against scraping. In other words, anti-scraping makes it more difficult to automatically extract data from a web page. Specifically, it\u0026rsquo;s about identifying and blocking requests from bots or malicious users.\nLearn more: 7 Anti-Scraping Techniques You Need to Know - ZenRows\n# 6. Is there an easy way to tell if a website will allow scrapers or not? To find out if the website allows scraping then check out:\nRobots.txt file: This will say which pages can you access with a scraper.\nTerms \u0026amp; Conditions: Their T\u0026amp;Cs will normally say if they permit scraping, programmatic access, etc.\nCheck the link below, at the end there is: You will not access the Site through automated or non-human means, such as with bots, scripts or otherwise;\u0026hellip;. When you login you usually see: I have read and understood the Privacy Policy and the Terms of Use. Presence of Anti-Bot Protection: If you are getting ban pages from Cloudflare, Distill Network, Imperva, DataDome, etc. then it is highly likely that the website doesn\u0026rsquo;t want you to scrape them.\nIf you are getting blocked but still want to scrape the website then you can do the following:\nUser-Agents \u0026amp; Headers: You need to use fake user-agents when scraping as most HTTP clients clearly identify themselves by default, giving you away as a scraper. Better yet you should use full fake browser headers that match what a real browser should send to a website. More about how to optimize and generate browser headers here. Rotating Proxies: You should send your requests via a rotating proxy pool that will make it harder for the website to detect you as a scraper. Residential \u0026amp; Mobile proxies are better than datacenter proxies but are a lot more expensive. You can compare proxy provider plans here. Fortified Headless Browser: Depending on the anti-bot protection the website is using you make need to use a fortified headless browser that can solve its JS challenges without giving its identity away. Your options include the Puppeteer stealth plugin and Selenium undetected-chromedriver. Learn more about it here Guide to Web Scraping Without Getting Blocked.\nLearn more: https://www.reddit.com/r/webscraping/comments/xvqd6r/comment/ir4m0xx/?utm_source=share\u0026utm_medium=web2x\u0026context=3\n","date":"2023-11-26T19:29:35Z","permalink":"https://blog.yorforger.cc/p/basic-concepts/","title":"Basic Concepts"},{"content":" # 1. Basics concepts Try to understand the exception information (Traceback (most recent call last)) :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 def foo(): print(10 * (1 / 0)) def main(): foo() if __name__ == \u0026#34;__main__\u0026#34;: main() Traceback (most recent call last): File \u0026#34;main.py\u0026#34;, line 10, in \u0026lt;module\u0026gt; main() File \u0026#34;main.py\u0026#34;, line 6, in main foo() File \u0026#34;main.py\u0026#34;, line 2, in foo print(10 * (1 / 0)) ZeroDivisionError: division by zero As you can see The last line of the error message indicates what happened: print(10 * (1 / 0)).\nErrors detected during execution are called exceptions. Errors and Exceptions â€” Python 3.12.0\n# 2. Types of Exceptions BaseException is the common base class of all exceptions. One of its subclasses, Exception, is the base class of all the non-fatal exceptions. Exceptions which are not subclasses of Exception are not typically handled, because they are used to indicate that the program should terminate. They include SystemExitwhich is raised by sys.exit() and KeyboardInterruptwhich is raised when a user wishes to interrupt the program.\nExceptioncan be used as a wildcard that catches (almost) everything. However, it is good practice to be as specific as possible with the types of exceptions that we intend to handle, and to allow any unexpected exceptions to propagate on.\n# 3. Handle Exceptions The most common pattern for handling Exception is to print or log the exception and then re-raise it (allowing a caller to handle the exception as well):\n1 2 3 4 5 6 7 8 9 10 11 12 import sys try: f = open(\u0026#39;myfile.txt\u0026#39;) s = f.readline() i = int(s.strip()) except OSError as err: print(\u0026#34;OS error:\u0026#34;, err) raise except Exception as err: print(f\u0026#34;Unexpected {err=}, {type(err)=}\u0026#34;) raise # Predefined clean-up actions Some objects define standard clean-up actions to be undertaken when the object is no longer needed, regardless of whether or not the operation using the object succeeded or failed. Look at the following example, which tries to open a file and print its contents to the screen.\n1 2 for line in open(\u0026#34;myfile.txt\u0026#34;): print(line, end=\u0026#34;\u0026#34;) The problem with this code is that it leaves the file open for an indeterminate amount of time after this part of the code has finished executing. This is not an issue in simple scripts, but can be a problem for larger applications. The with statement allows objects like files to be used in a way that ensures they are always cleaned up promptly and correctly.\n1 2 3 with open(\u0026#34;myfile.txt\u0026#34;) as f: for line in f: print(line, end=\u0026#34;\u0026#34;) After the statement is executed, the file f is always closed, even if a problem was encountered while processing the lines. Objects which, like files, provide predefined clean-up actions will indicate this in their documentation.\n# 4. Performance performance - How is exception handling implemented in Python? - Stack Overflow:\nI\u0026rsquo;ve learned from other SO answers that a try/catch block is cheaper than an if/else statement if the exception is expected to be raised rarely, and that it\u0026rsquo;s the call depth that\u0026rsquo;s important because filling the stacktrace is expensive. This is probably principally true for all programming languages.\nIf you throw an exception, all functions will be exited back to the point where it finds a try...catch block with a matching catch type. If your function isn\u0026rsquo;t called from within a try block, the program will exit with an unhandled exception.\nFind some discussions, from: c# - Do try/catch blocks hurt performance when exceptions are not thrown? - Stack Overflow\nDuring a code review with a Microsoft employee we came across a large section of code inside a try{} block. She and an IT representative suggested this can have effects on performance of the code. In fact, they suggested most of the code should be outside of try/catch blocks, and that only important sections should be checked. The Microsoft employee added and said an upcoming white paper warns against incorrect try/catch blocks.\ntry catch blocks have a negligible impact on performance but exception Throwing can be pretty sizable, this is probably where your coworker was confused.\nAnother disscussion: java - Is it expensive to use try-catch blocks even if an exception is never thrown? - Stack Overflow\ntry has almost no expense at all. Instead of doing the work of setting up the try at runtime, the code\u0026rsquo;s metadata is structured at compile time such that when an exception is thrown, it now does a relatively expensive operation of walking up the stack and seeing if any try blocks exist that would catch this exception. From a layman\u0026rsquo;s perspective, try may as well be free. It\u0026rsquo;s actually throwing the exception that costs you - but unless you\u0026rsquo;re throwing hundreds or thousands of exceptions, you still won\u0026rsquo;t notice the cost.\nAnother post: What are the effects of exceptions on performance in Java? - Stack Overflow\nIn Java much of the expense of throwing an exception is the time spent gathering the stack trace, which occurs when the exception object is created. The actual cost of throwing the exception, while large, is considerably less than the cost of creating the exception.\nhttps://stackoverflow.com/a/8024032/16317008\n# 5. When to catch # 5.1. At the lowest possible level This is the level at which you are integrating with third party code, such as an ORM tool or any library performing IO operations (accessing resources over HTTP, reading a file, saving to the database, you name it). That is, the level at which you leave your applicationâ€™s native code to interact with other components.\nThe guidelines in this scenario are:\nHandle only specific exceptions, such as SqlTimeoutException or IOException. Never handle a generic exception (of type Exception) Handle it only if you have something meaningful to do about it, such as retries, triggering compensatory actions, or adding more data to the exception (e.g. context variables), and then re-throw it Do not perform logging here Let all other exceptions bubble up as they will be handled by the second case # 5.2. At the highest possible level This would be the last place where you can handle the exception before it is thrown directly to the user.\nYour goal here is to log the error and forward the details to the programmers so they can identify and correct the error. Add as much information as possible, record it, and then show an apology message to the user, as thereâ€™s probably nothing they can do about it, especially if it is a bug in the software.\nThe guidelines in this second scenario are:\nHandle the generic Exception class Add more information from current execution context Log the error and notify the programmers Show an apology to the user Work it out as soon as you can Learn more, very good explanation: https://stackoverflow.com/a/59511485\n# 6. When to throw exceptions Easier to explain in the context of developing a library. You should throw when you reached an error and there\u0026rsquo;s nothing more you can do besides letting the consumer of your APIs know about it, and letting them decide.\nImagine you\u0026rsquo;re the developer of some data access library. When you reach a network error, there\u0026rsquo;s nothing you can do besides throwing an exception. That\u0026rsquo;s an irreversible error from a data access library standpoint.\nLearn more, very good explanation: https://stackoverflow.com/a/59511485\n","date":"2023-11-24T09:37:26Z","permalink":"https://blog.yorforger.cc/p/exception-handling-expensive-or-not-python/","title":"Exception Handling \u0026 Expensive or Not Python"},{"content":" # 1. Definition yield is a keyword that is used like return, but it will make the function return a generator.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 def create_generator(): print(\u0026#34;create_generator\u0026#34;) for i in range(10): yield i ite = create_generator() print(ite) # ite is a generator object for i in ite: print(i) # \u0026lt;generator object create_generator at 0x102d2bdd0\u0026gt; # create_generator # 0 # 1 # 2 When you call a function that contains a yield statement, you get a generator object, but no code runs. Then each time you extract from the generator, Python resumes the function from where it left off (from the yield), runs until the next yield, and then pauses again.\n# 2. Why yield Handling Large Data: If you\u0026rsquo;re working with a large amount of data that doesn\u0026rsquo;t fit into memory, a generator can be a great solution. It allows you to process one item at a time rather than loading everything into memory at once.\nYield is more efficient, memory-wise, and also sometimes execution-wise. If you iterate over a list of 1,000,000 elements, Python has to generate the entire list and store the contents in memory before beginning the first iteration. With a generator (using yield), the elements are created at the time of iteration, so 1,000,000 elements donâ€™t need to be pre-calculated first and stored in memory.\nThere are other benefits such as using generators with async or performing logic after certain iterations (that generators can potentially give better control over than iterating over a list), but in my opinion the main reason for using them is the memory and processing considerations.\nhttps://www.reddit.com/r/learnpython/comments/rzukrb/comment/hrxetbx/?utm_source=share\u0026utm_medium=web2x\u0026context=3\nYep its 99% about memory. First time I used it was when I was working with huge amounts of data from a SQL server. Rather than do analysis on all 100,000,000 lines at once, not joking about how many, I pulled back 10k at a time used yield to send the 10k to the analysis function. Then sent the updated data on to the system that needed it. Used like 20MB of RAM as apposed to like 200GB.\nhttps://www.reddit.com/r/learnpython/comments/rzukrb/comment/hrxhm46/?utm_source=share\u0026utm_medium=web2x\u0026context=3\n# 3. Example - read large file The files range between 1Gb and ~20Gb in length which is too big to read into RAM. So I would like to read the lines in chunks/bins of say 10000 lines at a time so that I can perform calculations on the final column in these bin sizes.\nInstead of playing with offsets in the file, try to build and yield lists of 10000 elements from a loop:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 def read_large_file(file_handler, block_size=10000): block = [] for line in file_handler: block.append(line) if len(block) == block_size: yield block block = [] # don\u0026#39;t forget to yield the last block if block: yield block with open(path) as file_handler: for block in read_large_file(file_handler): print(block) Learn more: using a python generator to process large text files - Stack Overflow\n# 4. Example - async 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 from typing import Iterator, Any, cast from openai import OpenAI client = OpenAI() def chat(messages: list, stream: bool) -\u0026gt; Iterator[str]: response_iter = cast( # The Any type is a special type that represents an unconstrained value # and is often used when the type of the value is not known or needs to be dynamically determined. Any, # client.chat.completions.create() won\u0026#39;t return immediately, it will make requests to the API. # time.sleep(1), you can umcomment this to stimulate the time of the request. client.chat.completions.create( messages=messages, stream=stream, model=\u0026#34;gpt-3.5-turbo-1106\u0026#34;, max_tokens=200, ), ) if stream: for response in response_iter: if response.choices[0].delta.content is not None: chunk = response.choices[0].delta.content yield chunk else: yield response_iter.choices[0].message.content msg = [{\u0026#34;role\u0026#34;: \u0026#34;user\u0026#34;, \u0026#34;content\u0026#34;: \u0026#34;Hello, help me write a essay about the history of the United States of America.\u0026#34;}] steam = True ite = chat(msg, steam) # async: you will get a generator object, but no code in function chat() runs for i in ite: print(i, end=\u0026#34;\u0026#34;, flush=True) ","date":"2023-11-23T16:04:26Z","permalink":"https://blog.yorforger.cc/p/yeild-generator-python/","title":"Yeild \u0026 Generator Python"},{"content":"é¦–å…ˆå¯ä»¥è”ç½‘, è°·æ­Œå’Œå¾®è½¯é‚®ç®±ç­‰å…¶ä»–çš„ä¸€äº›ç½‘ç«™éƒ½å¯è®¿é—®, ä½†æ˜¯è®¿é—®æ²¹ç®¡çš„æ—¶å€™æ€»æ˜¯ä¼šè¶…æ—¶,\né¦–å…ˆæƒ³åˆ°äº†æ˜¯ DNS æœåŠ¡å™¨çš„é—®é¢˜, å°è¯•æŠŠç”µè„‘çš„ DNS server æ”¹ä¸º 8.8.8.8, å¯æƒœéœ€è¦ç®¡ç†å‘˜æƒé™, å¤±è´¥\nåæ¥æ— èŠæƒ³ç€çœ‹çœ‹è§£æå‡ºæ¥youtube.comçš„å®é™…ipæ˜¯ä»€ä¹ˆ, ä½¿ç”¨ nklookup æŸ¥äº†ä¸€ä¸‹, (å¤§æ¦‚è¿™æ ·, æ²¡åœ¨å®éªŒå®¤)\n1 2 3 4 5 6 7 â¯ nslookup youtube.com Server:\t192.168.2.1 Address:\t192.168.100.1#53 Non-authoritative answer: Name:\tyoutube.com Address: 142.251.40.206 äºæ˜¯è®¿é—® 142.251.40.206\n1 2 3 4 5 6 7 â¯ wget -O- 142.251.40.206 --2023-11-22 22:23:53-- http://142.251.40.206/ Connecting to 142.251.40.206:80... connected. HTTP request sent, awaiting response... 301 Moved Permanently Location: http://www.google.com/ [following] --2023-11-22 22:23:53-- http://www.google.com/ Resolving www.google.com (www.google.com)... 142.250.80.36 å¯ä»¥çœ‹åˆ°è¢«é‡å®šå‘åˆ°äº†è°·æ­Œé¡µé¢, å½“æ—¶åœ¨å®éªŒå®¤ä¹Ÿæ˜¯è¿™ç§æƒ…å†µ, æŸ¥äº†ä¸€ä¸‹, è¿™ç¡®å®æ˜¯æ­£ç¡®çš„åœ°å€, åªæ˜¯è°·æ­Œç»™é‡å®šå‘äº†, æ‰€ä»¥ä¸æ˜¯DNSçš„é—®é¢˜, é‚£åº”è¯¥å°±æ˜¯é˜²ç«å¢™çš„é—®é¢˜, ä¸‹æ¬¡å»å®éªŒå®¤å†çœ‹çœ‹,\nå¦å¤–ä¸Šé¢ nskookup è¿”å›çš„æ˜¯ Non-authoritative answer, æ„æ€æ˜¯ ip åœ°å€ä¸æ˜¯ç”±è¯¥åŸŸåçš„ NS æœåŠ¡å™¨è¿”å›çš„, è€Œæ˜¯ä» DNS cacheè·å–çš„, æ‰€ä»¥ Non-authoritative answer å¹¶ä¸æ˜¯ä»£è¡¨ä¸å®‰å…¨æˆ–è€…ä¸å¯é , ä½†å¯èƒ½ä¸æ˜¯æœ€æ–°çš„, æ¯”å¦‚ä½ çš„åŸŸååˆšæ›´æ–°äº† NS server, åŠ äº†å±‚ Cloudflare çš„ https åŠ å¯†ä»£ç†, å³ your_domain-\u0026gt;proxy-ip-\u0026gt;your_ip, è€Œå­¦æ ¡çš„ DNS cache é‡Œç¼“å­˜çš„å´æ˜¯ä½ ä¹‹å‰çš„ ip, å³ your_domain -\u0026gt; your_ip, é‚£ä»£ç†å°±ä¸ä¼šç”Ÿæ•ˆ,\nå»å®éªŒå®¤æŸ¥äº†ä¸€ä¸‹æˆ‘åŸŸåçš„NS, ç«Ÿç„¶ time-out:\n1 2 3 4 5 6 7 c: \\Users\\student\u0026gt;nslookup shaowenzhu.top Server: Unknown Address:192.168.102.1 DNS request timed out. timeout was 2 seconds. ... æŸ¥äº†ä¸€ä¸‹, çœ‹åˆ°äº†ä¸€ä¸ªä¸æˆ‘ç›¸ä¼¼çš„é—®é¢˜:\nDNS request timed out means NSLookup submitted the query to the DNS server, but did not get a response.\nIt\u0026rsquo;s possible the DNS server you queried was having a problem and couldn\u0026rsquo;t reply. Network errors could be to blame as well.\nHowever, given that you did this from a \u0026ldquo;public computer,\u0026rdquo; the most likely explanation is that your DNS lookup was blocked by the network\u0026rsquo;s firewall. It\u0026rsquo;s common for network administrators to require that DNS lookups originating from nodes on the internal network be done using approved DNS servers. These can either be DNS servers under the administrator\u0026rsquo;s control, or specific public DNS servers selected by the admin.\nçªç„¶æƒ³åˆ° DNS ç¼“å­˜åœ¨ Chrome ä¸Šä¹Ÿæœ‰å¤‡ä»½, äºæ˜¯å»æŸ¥äº†ä¸€ä¸‹æ˜¯ä¸æ˜¯å¯ä»¥ä¿®æ”¹ DNS server åœ¨ Chrome ä¸Š, (åœ¨ç”µè„‘ä¸Šæ²¡æœ‰ç®¡ç†å‘˜æƒé™),\nçœŸçš„æœ‰, å…·ä½“å‚è€ƒ(privacy-security -\u0026gt; Advanced -\u0026gt; Use Secure DNS): How to Change DNS Server in Google Chrome on Computer and Mobile? - MiniTool\nç„¶åå¯ä»¥åœ¨Chromeä¸Šé€šè¿‡åŸŸåè®¿é—®æˆ‘çš„ç½‘ç«™äº†, ç»ˆäºä¸ç”¨è¾“å…¥ IP äº†æ¯æ¬¡, nnd\n","date":"2023-11-22T21:43:22Z","permalink":"https://blog.yorforger.cc/p/%E6%8E%92%E6%9F%A5%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%94%B5%E8%84%91%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E4%B8%80%E4%BA%9B%E7%BD%91%E7%AB%99/","title":"æ’æŸ¥å®éªŒå®¤ç”µè„‘æ— æ³•è®¿é—®ä¸€äº›ç½‘ç«™"},{"content":"URLs can only be sent over the Internet using the ASCII character-set. Since URLs often contain characters outside the ASCII set, the URL has to be converted into a valid ASCII format.\nPercent encoding replaces special characters with a \u0026ldquo;%\u0026rdquo; followed by two hexadecimal digits that represent the character\u0026rsquo;s ASCII code.\nURLs cannot contain white spaces. URL encoding normally replaces a white space with a plus (+) sign or with %20. The whitespace character in ASCII has hexadecimal value 0x20 In URLs, the forward slash (/) is used as a path separator to separate different elements of the URL. In the case of the forward slash, its ASCII code is 2f, so it is represented as %2f in a URL. If the special character (Chinese) doesn\u0026rsquo;t exist in ASCII table, it will use the UTF-8 hexadecimal digits of that special character.\nFor example, if you want to include the Chinese characters \u0026ldquo;ä¸­å›½\u0026rdquo; (China) in a URL, its UTF-8 encoding would be \u0026ldquo;%E4%B8%AD%E5%9B%BD\u0026rdquo;. Each Chinese character is encoded as its three-byte UTF-8 representation, prefixed with a percent sign.\n","date":"2023-11-20T22:29:19Z","permalink":"https://blog.yorforger.cc/p/url-encoding-percent-encoding/","title":"URL Encoding (Percent Encoding)"},{"content":" # 1. OSPF, BGP and MPLS OSPF: OSPF is an interior gateway protocol (IGP) used for routing within an autonomous system (AS). It determines the best paths for routing packets based on metrics such as bandwidth, delay, and cost. ï»¿ï»¿BGP: BGP is an exterior gateway protocol (EGP) used for routing between autonomous systems. It enables the exchange of routing information between different networks and determines the best paths between ASes. ï»¿ï»¿MPLS: MPLS is not a routing protocol but a forwarding mechanism that operates at the network layer. It uses labels to encapsulate packets, creating virtual paths called Label Switched Paths (LSPs). MPLS allows for efficient forwarding and traffic engineering by quickly switching packets based on labels instead of performing complex IP routing. Routers refer to internal routing tables to make decisions about how to route packets along network paths. A routing table records the paths that packets should take to reach every destination that the router is responsible for.\n# 2. MPLS # 2.1. Basic concepts In a network that uses MPLS, each packet is assigned to a class called a forwarding equivalence class (FEC). The network paths that packets can take are called label-switched paths (LSP). A packet\u0026rsquo;s class (FEC) determines which path (LSP) the packet will be assigned to. Packets with the same FEC follow the same LSP.\nEach packet has one or more labels attached, and all labels are contained in an MPLS header, which is added on top of all the other headers attached to a packet. FECs are listed within each packet\u0026rsquo;s labels. Routers do not examine the packet\u0026rsquo;s other headers; they can essentially ignore the IP header. Instead, they examine the packet\u0026rsquo;s label and direct the packet to the right LSP.\nBecause MPLS-supporting routers only need to see the MPLS labels attached to a given packet, MPLS can work with almost any protocol (hence the name \u0026ldquo;multiprotocol\u0026rdquo;). It does not matter how the rest of the packet is formatted, as long as the router can read the MPLS labels at the front of the packet.\nLabel value: the name says it all, this is where you will find the value of the label. EXP: these are the three experimental bits. These are used for QoS, normally the IP precedence value of the IP packet will be copied here. S: this is the â€œbottom of stackâ€ bit. With MPLS itâ€™s possible to add more than one label, youâ€™ll see why in some of the MPLS VPN lessons. When this bit is set to one, itâ€™s the last MPLS header. When itâ€™s set to zero then there is one or more MPLS headers left. TTL: just like in the IP header, this is the time to live field. You can use this for traces in the MPLS network. Each hop decrements the TTL by one. # 2.2. FECs FEC is a term used in MPLS networks to describe a set of incoming packets with similar characteristics, allowing those packets to be allocated the same label and forwarded down the same LSP (Label Switched Path). FEC - Forwarding Equivalence Class\nIn previous part we said: FECs are listed within each packet\u0026rsquo;s labels. But, wait, how?\nAn FEC is a set of packets that a single router:\n(1) Forwards to the same next hop;\n(2) Out the same interface; and\n(3) With the same treatment (such as queuing).\n# 2.3. Step-by-Step a packet in MPLS network Packet Enters the MPLS Network: Imagine a data packet entering an MPLS network at an \u0026lsquo;ingress router\u0026rsquo;. The ingress router examines the header of the packet (like destination IP address). Label Assignment: Based on this examination, the router assigns a \u0026rsquo;label\u0026rsquo; to the packet. This label is a short, fixed-length identifier. The process of assigning a label is known as \u0026rsquo;label imposition'. Each label corresponds to a pre-determined path through the network, known as a Label Switched Path (LSP). Packet Travels through the MPLS Network: Once the packet has been labeled, it is sent into the MPLS network. As it reaches each router (or label switch router, LSR) in the MPLS network, the router does not need to examine the IP header. Instead, it looks at the label. Based on the label, the LSR quickly determines where to send the packet next. This is a process called \u0026rsquo;label switching'. The LSR may also swap the packet\u0026rsquo;s existing label with a new label before forwarding it (label swapping). This is done to maintain the correct routing path as defined by the LSP. Approaching the Exit of the MPLS Network: As the packet approaches the end of its path through the MPLS network, it reaches an \u0026rsquo;egress router'. The egress router removes the MPLS label from the packet, a process known as \u0026rsquo;label popping'. Packet Leaves the MPLS Network: After the label is removed, the packet is forwarded based on its original IP header. It is now back in a standard IP-based network and can be routed to its final destination using traditional IP routing methods. # 3. OSPF, BGP and MPLS So each packet has a LSP theoretically? which means each packet belongs to a FEC, and each FEC has a LSP, the LSP built by using the routing table formed by OSPF and BGP\nYes, your understanding is on the right track. In MPLS (Multiprotocol Label Switching) networks, the concept of Forwarding Equivalence Classes (FECs) and Label Switched Paths (LSPs) is fundamental. Let\u0026rsquo;s break down these concepts:\n# 3.1. Forwarding Equivalence Class (FEC) A FEC is essentially a group of IP packets that are forwarded in the same manner (same path, same treatment). Each packet that enters an MPLS network is assigned to a FEC. The assignment is based on criteria like destination IP address, IP protocol type, source IP address, and even Layer 4 ports. The idea is that all packets within a FEC will follow the same LSP and receive similar forwarding treatment. Label Switched Path (LSP)\nAn LSP is a pre-established path that packets in a particular FEC will follow through the MPLS network. LSPs are set up by the MPLS control plane, which can use signaling protocols like RSVP-TE or LDP. Once an LSP is established, labels are assigned and used to forward the packets along this path. # 3.2. Interaction with OSPF and BGP OSPF and BGP are used to form the routing table, which provides the necessary information about network topology and available paths. OSPF is typically used within an autonomous system (internal routing), while BGP is used between autonomous systems (external routing). The information from OSPF and BGP helps in determining the best paths for the LSPs. Once the best paths are identified, MPLS signaling protocols set up LSPs along these paths, and labels are distributed to the routers (LSRs) on these paths. # 3.3. Practical Example Imagine a packet entering an MPLS network destined for a specific IP address. This packet is assigned to a FEC based on its destination IP. An LSP for this FEC has already been established using OSPF or BGP routing information. The ingress router assigns an MPLS label to the packet based on its FEC. The packet is then forwarded through the MPLS network, with each router making forwarding decisions based solely on the MPLS label. When the packet reaches the egress router of the MPLS network, the MPLS label is removed, and the packet is forwarded based on its original IP header. In this way, each packet is associated with a FEC, and each FEC has its LSP. The LSPs are constructed using the routing tables formed by OSPF and BGP, ensuring that packets are forwarded efficiently and along optimal paths within the MPLS network.\nReferences:\nWhat is MPLS (multiprotocol label switching)? | Cloudflare MPLS Labels and Devices Understanding the Role of FECs in MPLS | Network World ","date":"2023-11-17T08:27:59Z","permalink":"https://blog.yorforger.cc/p/mpls/","title":"MPLS"},{"content":" # 1. Hosting your domain on Cloudflare (Enable CDN) 1 client \u0026lt;----tls-1----\u0026gt; cloudflare \u0026lt;----tls-2----\u0026gt; your server Note: You cannot login your server with ssh user@your_domain any more after enabling Cloudflare. You need to login with ssh user@your_ip. Cause the Cloudflare acts as a reverse proxy, it only forwards the http/https traffic to your server, and only on some specific ports.\nThere are two steps to add your domain to Cloudflare:\nAdd your domain to Cloudflare Create and install TLS certificate to your server Cloudflare does this by serving as a reverse proxy for your web traffic. Actually, Clooudflare achieves this by using its CDN service, which caches your website\u0026rsquo;s static content and serves it to your visitors from the nearest Cloudflare data center. Refer to our Load Balancing reference architecture to learn more about advanced ways to forward traffic to your origins, as well as our CDN reference architecture to learn more about how Cloudflare processes and optimizes your web traffic.\n# 1.1. Add your domain to Cloudflare Go to this website: https://dash.cloudflare.com/\nAnd you will get instructions for updating your nameserver of your domain. After change your nameserver, waite about one hour, your site will be active on Cloudflare. Then you can choose the TLS encryption mode:\nNote: choose full mode, don\u0026rsquo;t use flexbile mode, otherwise you probably would get ERR_TOO_MANY_REDIRECTS when access your website.\n# 1.2. Install TLS certificate The generated two files cert.pem and cert.key is used for encryption between your server and Cloudflare.\nYou can use these two file like this:\n1 2 3 4 5 6 7 8 ... func main() { http.HandleFunc(\u0026#34;/hello\u0026#34;, HelloServer) err := http.ListenAndServeTLS(\u0026#34;:443\u0026#34;, \u0026#34;./conf/cert.pem\u0026#34;, \u0026#34;./conf/cert.key\u0026#34;, nil) if err != nil { log.Fatal(\u0026#34;ListenAndServe: \u0026#34;, err) } } Note: don\u0026rsquo;t add the keep-alive header when handle request on your server, otherwise you may get a 520 error when you access your website on browser: Error 520: Web server is returning an unknown error\n1 2 w.Header().Set(\u0026#34;Connection\u0026#34;, \u0026#34;Keep-Alive\u0026#34;) w.Header().Set(\u0026#34;Keep-Alive\u0026#34;, \u0026#34;timeout=2, max=1000\u0026#34;) Learn more: https://luyuhuang.tech/2020/06/03/cloudflare-free-https.html\nAfter config this, the DNS needs time to take effect (you change the nameservers of your domain to Cloudfalre from the defatult nameservers, this needs time to take effect)\nIf there still no HTTPS connection but the cloudflare displays your website is active on their service, you may try to check if your server is listening on 443 port and try to flush the DNS cache of your client computer (chrome + system DNS cache). Learn more: DNS Concepts (NameServer(NS), DNS Records and Caching) - David\u0026rsquo;s Blog\nBTW, you can check if your domain is proxied by the Cloudflare with nslookup command, which will get the A Record by default (IPv4) address of your domain, but in this case, with Cloudfalre proxy, you should get the ip of Cloudfalre Name Server.\n1 2 3 4 5 6 â¯ nslookup shaowenzhu.top Non-authoritative answer: Name:\tshaowenzhu.top Address: 172.67.171.207 # not my domain\u0026#39;s real ip, it\u0026#39;s Cloudfalre Name:\tshaowenzhu.top Address: 104.21.47.185 # not my domain\u0026#39;s real ip, it\u0026#39;s Cloudfalre Learn more: Add a site Â· Cloudflare Fundamentals docs\n# 2. Change A record If you changed a vps, all you need to do is to change the A record of your domain on Cloudflare, you don\u0026rsquo;t need to change the A record on your domain register website.\nCloudflare serves as a reverse proxy, directing all traffic for the specified proxied domain to the target IP address.\n# 3. Allow custom port The default port of https is 443. If you want to use other ports, you need to allow them with firewall first on your server.\nCloudflare only allows the following HTTPS ports:\n443 2053 2083 2087 2096 8443\nVery easy, you don\u0026rsquo;t need to do anything on Cloudflare, just allow the port on your server. Then you can access your website with https://your_domain:port. And your traffic will be encrypted by Cloudflare.\nLearn more:\nHow to allow custom port - Website, Application, Performance / Security - Cloudflare Community\nNetwork ports Â· Cloudflare Fundamentals docs\nLearn more about CDN:\nWhat is a content delivery network (CDN)? | How do CDNs work? | Cloudflare\nReference Architecture: Cloudflare Content Delivery Network (CDN) Â· Cloudflare Reference Architecture docs\n","date":"2023-11-15T20:09:22Z","permalink":"https://blog.yorforger.cc/p/get-free-tls-certificate-with-cloudflare/","title":"Get Free TLS certificate with Cloudflare"},{"content":" # 1. Official Docs Make request for the RESTful API of OpenAI: API Reference - OpenAI API Error status code for HTTP response: Error codes - OpenAI API Stream cookbook.openai.com/examples/how_to_stream_completions How to Print ChatGPT API Response as a Stream â€“ PuppyCoding Cookbook: https://cookbook.openai.com/ # 2. Stream message If you write code like this:\n1 2 3 4 respense = openai.create(...) for chunk in response: if chunk.choices[0].delta.content is not None: print(chunk.choices[0].delta.content, end=\u0026#34;\u0026#34;, flush=True) You probably won\u0026rsquo;t get the result you want, your program will print line by line, not word by word.\nThe actual reason is that Python buffers the chunks before printing them, whereas we want them printed as soon as theyâ€™re ready. To do this, we add a flush = True parameter to tell Python to flush the buffer with each chunk.\n1 2 3 4 5 def handle_stream(response): for chunk in response: if chunk.choices[0].delta.content is not None: print(chunk.choices[0].delta.content, end=\u0026#34;\u0026#34;, flush=True) print() Normally output to a file or the console is buffered, with text output at least until you print a newline. The flush makes sure that any output that is buffered goes to the destination. https://stackoverflow.com/a/15608262/16317008\n# 3. Task types Completions: Given a prompt, the model will return one or more predicted completions. 1 POST https://api.openai.com/v1/completions Chat: Given a list of messages describing a conversation, the model will return a response. 1 POST https://api.openai.com/v1/chat/completions Images: Given a prompt and/or an input image, the model will generate a new image. 1 POST https://api.openai.com/v1/images/generations # 4. Openai package error: urllib3 only supports OpenSSL After import openai package, an error occurred:\n1 ImportError: urllib3 v2.0 only supports OpenSSL 1.1.1+, currently the \u0026#39;ssl\u0026#39; module is compiled with LibreSSL 2.8.3. See: https://github.com/urllib3/urllib3/issues/2168 urllib3 is a Python package for making HTTP requests, which is an HTTP client (like a browser):\n1 2 3 4 5 6 \u0026gt;\u0026gt;\u0026gt; import urllib3 \u0026gt;\u0026gt;\u0026gt; resp = urllib3.request(\u0026#34;GET\u0026#34;, \u0026#34;https://httpbin.org/robots.txt\u0026#34;) \u0026gt;\u0026gt;\u0026gt; resp.status 200 \u0026gt;\u0026gt;\u0026gt; resp.data b\u0026#34;User-agent: *\\nDisallow: /deny\\n\u0026#34; Solution: https://davidzhu.xyz/post/python/practice/003-openssl-issue/\nReferences:\nA Complete Guide to the ChatGPT API Fixing ImportError: urllib3 v2.0 only supports OpenSSL 1.1.1+ | Level Up Coding python - ImportError: urllib3 v2.0 only supports OpenSSL 1.1.1+, currently the \u0026lsquo;ssl\u0026rsquo; module is compiled with LibreSSL 2.8.3 - Stack Overflow OpenAI ChatGPT (GPT-3.5) API error: \u0026ldquo;\u0026lsquo;messages\u0026rsquo; is a required property\u0026rdquo; when testing the API with Postman - Stack Overflow GPT - OpenAI API GPT-3.5-turbo how to remember previous messages like Chat-GPT website - API - OpenAI Developer Forum ","date":"2023-11-14T00:07:25Z","permalink":"https://blog.yorforger.cc/p/chatgpt-bot/","title":"ChatGPT Bot"},{"content":" # 1. Check Python environment 1 2 3 â¯ ls /usr/bin/python* \u0026amp; ls /usr/local/bin/python* /usr/local/bin/python3 /usr/local/bin/python3.10 /usr/bin/python3 /usr/bin belongs to the system. Mess with it at your peril. /usr/local/bin is yours to fool with; if you mess something up in there, you can trash /usr/local and the system will chug along just fine. If you trash /usr/bin, you\u0026rsquo;ll probably end up reinstalling the OS.\n# 1.1. Multiple versions of Python interpreter As you can see, there are two python3 located at /usr/bin/ and /usr/local/bin/ respectively, and both of these dirs added into the $PATH, so when I input python3 on my terminal, which \u0026quot;python3\u0026quot; will be chosen?\nIt depends on the PATH environment variable, the PATH variable determines the order in which directories are searched to find executable files. If /usr/local/bin appears before /usr/bin in the PATH, then /usr/local/bin/python3 will be chosen when you enter \u0026ldquo;python3\u0026rdquo; in the terminal.\n# 2. Environment variable $PATH The PATH environment variable is an essential component of any Linux system. If you ever use the command line at all, the system is relying on the PATH variable to find the location of the commands you are entering.\n1 2 echo $path /opt/homebrew/bin /opt/homebrew/sbin /usr/local/bin /usr/bin /bin /usr/sbin /sbin Learn more: https://linuxconfig.org/linux-path-environment-variable\n# 3. Virtual environment venv (for Python 3) and virtualenv (for Python 2) allow you to manage separate package installations for different projects. They essentially allow you to create a â€œvirtualâ€ isolated Python installation and install packages into that virtual installation. When you switch projects, you can simply create a new virtual environment and not have to worry about breaking the packages installed in the other environments. It is always recommended to use a virtual environment while developing Python applications.\nIf you are using Python 2, replace venv with virtualenv in the below commands:\n1 2 python3 -m venv env_310 source env/bin/activate This command will create a virtual environment in your current directory. The version of Python in the virtual environment using this command will be the same is the version of the python interpreter you used.\nHere the python3 is 3.10, so the created env will use python 3.10 as interpreter, you can find the interpreter at ./env_310/bin/ folder.\nYou can also create different virtual env in a same project so that you can switch different version of Python interpreter.\n1 2 3 4 5 # python3 is python 3.10 on my machine $ python3 -m venv env_310 # /usr/bin/python3 is python 3.9 $ /usr/bin/python3 -m venv env_309 Then there will be two virtual environments, you can switch to any version of the Python virtual environment by deactivating one and activating another.\n1 2 3 4 5 6 7 8 9 $ source env_310/bin/activate $ which python /Users/David/Codes/PyCharm/tgpt/env_310/bin/python $ env_310 â¯ python --version Python 3.10.0 # switch to python 3.9 $ deactivate $ source env_309/bin/activate ... # 4. Command python -m \u0026lt;module-name\u0026gt; 1 2 3 4 5 6 7 8 9 python3 -m notebook python3 -m pip ... # if no -m, there will be an error python3 notebook // /Library/Developer/CommandLineTools/usr/bin/python3: can\u0026#39;t open file \u0026#39;/Users/shaowen/notebook\u0026#39;: [Errno 2] No such file or directory python pip // python: can\u0026#39;t open file \u0026#39;/Users/PyCharm/pythonProject/pip\u0026#39;: [Errno 2] No such file or directory What does -m in python -m pip install \u0026lt;package\u0026gt; mean? or while upgrading pip using python -m pip install --upgrade pip. What is difference when just running pip install.\n-m: run library module as a script (terminates option list)\n1 2 3 4 python3 main.py python3 -m main python3 main // error python3 -m main.py // warning remove \u0026#39;.py\u0026#39; # 5. if __name__ == \u0026quot;__main__\u0026quot; This is useful because you do not want this code block to run when importing into other files, but you do want it to run when invoked from the command line.\n1 2 3 4 5 6 7 //cat.py: if __name__ == \u0026#34;__main__\u0026#34;: print(\u0026#39;mow~\u0026#39;) //main.py: import cat print(\u0026#39;hello\u0026#39;) Execute on shell:\n1 2 3 4 5 6 python main.py hello # After the first line in cat.py is removed python main.py mow~ hello # 6. pip uninstall xxx use pip-autoremove to remove a package plus unused dependencies.\n1 2 3 4 5 pip list # install pip-autoremove pip install pip-autoremove # remove \u0026#34;somepackage\u0026#34; plus its dependencies: pip-autoremove xxx -y https://stackoverflow.com/a/10284948/16317008\n","date":"2023-11-09T19:12:40Z","permalink":"https://blog.yorforger.cc/p/virtual-environment-python/","title":"Virtual Environment Python"},{"content":" # 1. iTerm2 # 1.1. iTerm2 theme settings iTerm2 Preferences: Appearance \u0026gt; General \u0026gt; Theme: Minimal\niTerm2 Preferences: Advanced\niTerm2 â€” Snazzy theme\n1 $ curl -Ls https://raw.githubusercontent.com/sindresorhus/iterm2-snazzy/main/Snazzy.itermcolors \u0026gt; /tmp/Snazzy.itermcolors \u0026amp;\u0026amp; open /tmp/Snazzy.itermcolors Configure iTerm2 color theme: iTerm2 Preferences: Profiles \u0026gt; Colors \u0026gt; Color Presets: Snazzy\n# 1.2. Install Oh My Zsh and zplug 1 2 3 4 # Oh My Zsh sh -c \u0026#34;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34; # zplug brew install zplug .zshrc file:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ~.zshrc export ZSH=~/.oh-my-zsh # disable oh-my-zsh themes for pure prompt ZSH_THEME=\u0026#34;\u0026#34; source $ZSH/oh-my-zsh.sh export ZPLUG_HOME=/opt/homebrew/opt/zplug source $ZPLUG_HOME/init.zsh zplug \u0026#34;mafredri/zsh-async\u0026#34;, from:github zplug \u0026#34;sindresorhus/pure\u0026#34;, use:pure.zsh, from:github, as:theme zplug load # Install plugins if there are plugins that have not been installed if ! zplug check --verbose; then printf \u0026#34;Install? [y/N]: \u0026#34; if read -q; then echo; zplug install fi fi # 1.3. syntax highlighting \u0026amp; auto suggestions 1 2 3 zplug \u0026#34;zdharma/fast-syntax-highlighting\u0026#34;, as:plugin, defer:2 zplug \u0026#34;zsh-users/zsh-autosuggestions\u0026#34;, as:plugin, defer:2 Then reload your iTerm2, you will see the change after download.\nReference: Beautify your iTerm2 and prompt ğŸ’‹ | by Steven Chim | airfrance-klm | Medium\n# 2. Clean PrettyClean\nmac-cleanup-sh\n# 3. Nvim # install 1 2 3 4 5 brew install neovim echo \u0026#34;alias vim=\u0026#39;nvim\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.zshrc git clone -b v2.0 https://github.com/NvChad/NvChad ~/.config/nvim --depth 1 \u0026amp;\u0026amp; nvim # for live grep search brew install ripgrep # font Change font of iTerm2 otherwise you will see some weird characters in nvim.\n1 2 â¯ brew tap homebrew/cask-fonts â¯ brew install --cask font-jetbrains-mono-nerd-font Then set the font in iTerm2 Preferences: Profiles \u0026gt; Text \u0026gt; Font: jetbrains-mono-nerd\nLearn more: How to Install Nerd Fonts on mac\n# theme Chnage the theme of nvim, enter nvim and type space + t + h, choose onenord theme.\n# Highlight 1 2 3 :TSInstall markdown :TSInstall markdown_inline :setlocal spell spelllang=en_us, cjk spellcapcheck=\u0026#34;\u0026#34; # Plugins Edit ~/.config/nvim/lua/custom/chadrc.lua:\n1 2 3 4 5 6 7 local M = {} M.ui = { theme = \u0026#39;onenord\u0026#39; } M.plugins = \u0026#39;custom.plugins\u0026#39; return M Add new file ~/.config/nvim/lua/custom/plugins.lua:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 local plugins = { { \u0026#34;Pocco81/auto-save.nvim\u0026#34;, lazy = false, config = function() require(\u0026#34;auto-save\u0026#34;).setup { -- your config goes here -- or just leave it empty :) } end, } } return plugins # Shortcuts https://docs.rockylinux.org/books/nvchad/nvchad_ui/nvchad_ui/\n# Final custom/chadrc.lua:\n1 2 3 4 5 6 7 8 ---@type ChadrcConfig local M = {} M.ui = { theme = \u0026#39;onenord\u0026#39; } M.plugins = \u0026#39;custom.plugins\u0026#39; return M custom/plugins.lua:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 local plugins = { { \u0026#34;Pocco81/auto-save.nvim\u0026#34;, lazy = false, config = function() require(\u0026#34;auto-save\u0026#34;).setup { -- your config goes here -- or just leave it empty :) } end, }, { \u0026#34;github/copilot.vim\u0026#34;, lazy = false, }, { \u0026#39;MeanderingProgrammer/markdown.nvim\u0026#39;, dependencies = { \u0026#39;nvim-treesitter/nvim-treesitter\u0026#39; }, ft = \u0026#39;markdown\u0026#39;, config = function() require(\u0026#39;render-markdown\u0026#39;).setup({}) end, }, } return plugins ","date":"2023-11-08T22:50:37Z","permalink":"https://blog.yorforger.cc/p/my-mac-configuration/","title":"My Mac Configuration"},{"content":" # 1. Background When I first started writing backend code, if the server return a file (any type), and I would add a Content-Type header and set its value to application/octet-stream:\n1 2 3 4 w.Header().Set(\u0026#34;Content-Disposition\u0026#34;, \u0026#34;attachment; filename=\u0026#34;+strconv.Quote(info.Name())) w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/octet-stream\u0026#34;) http.ServeFile(w, r, filePath) return I don\u0026rsquo;t know what does this mean, but it works. Haha, it\u0026rsquo;s not a good habit, so I decide to take some time to learn it.\n# 2. MIME types A media type (also known as a Multipurpose Internet Mail Extensions or MIME type) indicates the nature and format of a document, file, or assortment of bytes.\n# 2.1. Structure of a MIME type 1 type/subtype The type represents the general category into which the data type falls, such as video or text.\nThe subtype identifies the exact kind of data of the specified type the MIME type represents. For example, for the MIME type text, the subtype might be plain (plain text), html (HTML source code), or calendar (for iCalendar/.ics) files.\nAn optional parameter can be added to provide additional details:\n1 type/subtype;parameter=value For any MIME type whose main type is text, you can add the optional charset parameter to specify the character set used for the characters in the data. If no charset is specified, the default is ASCII (US-ASCII) unless overridden by the user agent\u0026rsquo;s settings. To specify a UTF-8 text file, the MIME type text/plain;charset=UTF-8 is used.\nThere are two classes of type: discrete and multipart: https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_Types#types\n# 3. Common MIME types # 3.1. application/octet-stream This is the default for binary files. As it means unknown binary file, browsers usually don\u0026rsquo;t execute it, or even ask if it should be executed. They treat it as if the Content-Disposition header was set to attachment, and propose a \u0026ldquo;Save As\u0026rdquo; dialog.\n# 3.2. text/plain This is the default for textual files. Even if it really means \u0026ldquo;unknown textual file,\u0026rdquo; browsers assume they can display it.\n# 3.3. text/css CSS files used to style a Web page must be sent with text/css. If a server doesn\u0026rsquo;t recognize the .css suffix for CSS files, it may send them with text/plain or application/octet-stream MIME types. If so, they won\u0026rsquo;t be recognized as CSS by most browsers and will be ignored.\nLearn more: Common MIME types - HTTP | MDN\nReferences: MIME types (IANA media types) - HTTP | MDN\n","date":"2023-11-06T22:06:07Z","permalink":"https://blog.yorforger.cc/p/mime-types/","title":"MIME Types"},{"content":" # 1. Differences between gRPC and REST APIs gRPC utilizes HTTP/2 whereas REST utilizes HTTP 1.1 gRPC utilizes the protocol buffer data format as opposed to the standard JSON data format that is typically used within REST APIs With gRPC you can utilize HTTP/2 capabilities such as server-side streaming, client-side streaming or even bidirectional-streaming should you wish. Source: Go gRPC Beginners Tutorial | TutorialEdge.net\n# 2. Helloworld # 2.1. Intsall protoc and plugins Ptotocol Buffers - David\u0026rsquo;s Blog\n# 2.2. Install gRPC in your project 1 â¯ go get -u google.golang.org/grpc # 2.3. HelloWorld example Go gRPC Beginners Tutorial | TutorialEdge.net\n","date":"2023-11-05T16:01:06Z","permalink":"https://blog.yorforger.cc/p/intro-to-grpc/","title":"Intro to gRPC"},{"content":"Source: Introduction to HTTP/2 | Google Developers\n# 1. Binary Framing # 1.1. Streams, messages, and frames At the core of all performance enhancements of HTTP/2 is the new binary framing layer, which dictates how the HTTP messages are encapsulated and transferred between the client and server.\nThe introduction of the new binary framing mechanism changes how the data is exchanged between the client and server. To describe this process, letâ€™s familiarize ourselves with the HTTP/2 terminology:\nStream: A bidirectional flow of bytes within an established connection, which may carry one or more messages. Message: A complete sequence of frames that map to a logical request or response message. Frame: The smallest unit of communication in HTTP/2, each containing a frame header, which at a minimum identifies the stream to which the frame belongs. The relation of these terms can be summarized as follows:\nAll communication is performed over a single TCP connection that can carry any number of bidirectional streams. Each stream has a unique identifier and optional priority information that is used to carry bidirectional messages. Each message is a logical HTTP message, such as a request, or response, which consists of one or more frames. The frame is the smallest unit of communication that carries a specific type of dataâ€”e.g., HTTP headers, message payload, and so on. Frames from different streams may be interleaved and then reassembled via the embedded stream identifier in the header of each frame. In short, HTTP/2 breaks down the HTTP protocol communication into an exchange of binary-encoded frames, which are then mapped to messages that belong to a particular stream, all of which are multiplexed within a single TCP connection. This is the foundation that enables all other features and performance optimizations provided by the HTTP/2 protocol.\n# 1.2. Request and response multiplexing With HTTP/1.x, if the client wants to make multiple parallel requests to improve performance, then multiple TCP connections must be used (see Using Multiple TCP Connections ). This behavior is a direct consequence of the HTTP/1.x delivery model, which ensures that only one response can be delivered at a time (response queuing) per connection. Worse, this also results in head-of-line blocking and inefficient use of the underlying TCP connection. I have talked this in previous post.\nThe new binary framing layer in HTTP/2 removes these limitations, and enables full request and response multiplexing, by allowing the client and server to break down an HTTP message into independent frames, interleave them, and then reassemble them on the other end.\n\u0026hellip;.\nLearn more: Introduction to HTTP/2 | Web Fundamentals | Google Developers\n# 2. Server push Another powerful new feature of HTTP/2 is the ability of the server to send multiple responses for a single client request. That is, in addition to the response to the original request, the server can push additional resources to the client, without the client having to request each one explicitly.\nNote: HTTP/2 breaks away from the strict request-response semantics and enables one-to-many and server-initiated push workflows that open up a world of new interaction possibilities both within and outside the browser. This is an enabling feature that will have important long-term consequences both for how we think about the protocol, and where and how it is used.\n# 3. Header compression \u0026hellip;\n","date":"2023-11-04T00:45:30Z","permalink":"https://blog.yorforger.cc/p/http-2.0-binary-frame-server-push-header-compression/","title":"HTTP 2.0 (Binary Frame, Server Push, Header Compression)"},{"content":" # 1. Form data vs query string # 1.1. Client side Query string resides in the url:\n1 http://www.blabla.com?a=1\u0026amp;b=2 Form data is sent with the request body. Therefore, when there is sensitive data, we usually put data in the form not the query string. Because the requested URL might show up in Web server logs and browser history/bookmarks which is not a good thing. source\n# 1.2. Server side # 1.2.1. Go web For all requests, ParseForm() parses the raw query from the URL and updates r.Form. For POST, PUT, and PATCH requests, it also reads the request body, parses it as a form and puts the results into both r.PostForm and r.Form. When the Content-Type is not application/x-www-form-urlencoded, the request Body is not read.\nLearn more: Some HTTP Issues with Go - David\u0026rsquo;s Blog\n# 1.2.2. Spring web If your server is wiritten in Java Spring, and you need to POST form data to the server, you need to set your Content-Type header of your request to application/json.\nWhen we write test we usually use curl command, looks like this:\n1 $ curl localhost:8080/hello -d \u0026#39;{\u0026#34;username\u0026#34;:\u0026#34;davidzhu\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;778899a\u0026#34;}\u0026#39; However, this command with -d option will set Content-Type header to application/x-www-form-urlencoded by default, which is not accepted on Spring\u0026rsquo;s side.\nTherefore you have to set Content-Type explicitly:\n1 2 3 $ curl localhost:8080/postbody -d \u0026#39;{\u0026#34;username\u0026#34;:\u0026#34;davidzhu\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;778899a\u0026#34;}\u0026#39; -H \u0026#34;Content-Type: application/json\u0026#34; Note the format of the -d is josn format not url query string format: \u0026quot;username=davidzhu\u0026amp;password=778899a\u0026quot;, this format is application/x-www-form-urlencoded, not application/json.\nSource: https://stackoverflow.com/a/7173011/16317008\nLearn more about curl post: https://reqbin.com/req/c-dwjszac0/curl-post-json-example\n# 2. POST data to server The HTTP POST method sends data to the server. The type of the body of the request is indicated by the Content-Type header.\nA POST request is typically sent via an HTML form and results in a change on the server. In this case, the content type is selected by putting the adequate string in the enctype attribute of the form element or the formenctype attribute of the input or button elements:\nReferences: https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST\n# 3. POST data to server - example Let\u0026rsquo;s say there is a html file looks like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;form action=\u0026#34;http://localhost:8080/postform\u0026#34; method=\u0026#34;post\u0026#34; class=\u0026#34;form-example\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;form-example\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;username\u0026#34;\u0026gt;username\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;usernam\u0026#34; id=\u0026#34;username\u0026#34; required /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-example\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;password\u0026#34;\u0026gt;password\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;passwor\u0026#34; id=\u0026#34;password\u0026#34; required /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-example\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;register\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; When I push the regiser buttion to submit the form, the http request looks like this:\nAs you can see the form data resides in the request body, not in the URL.\nSometimes you send data to server with query string or with form. Although, data in this two cases reside in different places, former located in the URL, latter at the payload (request body), these two cases may result same thing (the server will get same data), which may give you a wrong impression that form data wil be put into URL too.\n1 2 $ curl -X POST localhost:8080/postform -d \u0026#34;username=davidzhu\u0026amp;password=778899a\u0026#34; $ curl -X POST \u0026#34;localhost:8080/postform?username=david\u0026amp;password=778899a\u0026#34; The server may get same data for these two command, this is because the server may try to parse the query string and form data at the same time, I have talked this in previous post.\n# 4. Form data restriction As we talk above, form data can only be these three type by by default:application/x-www-form-urlencoded, multipart/form-data, text/plain, and you have to set the Content-Type to the corresponding type with correct format.\nIf you want application/json type, you need encode the form data into josn at client and decode the request body at server side. Besides, don\u0026rsquo;t forget to set the Content-Type header to application/json which will tell the server the data format resides in the request body.\nAn answer from stackoverflow, hope it will help:\nHTML provides no way to generate JSON from form data. If you really want to handle it from the client, then you would have to resort to using JavaScript to:\ngather your data from the form via DOM organise it in an object or array generate JSON with JSON.stringify POST it with XMLHttpRequest You\u0026rsquo;d probably be better off sticking to application/x-www-form-urlencoded data and processing that on the server instead of JSON. Your form doesn\u0026rsquo;t have any complicated hierarchy that would benefit from a JSON data structure.\nThis is same in Go, if you want send json data in the request body, you should encode it into bytes and decode request body at server:\nclient:\n1 2 3 4 5 6 7 // string in back quote is raw string which means // the double quote here will lose its special meaning // decode the json string into reader_json := strings.NewReader(`{\u0026#34;username\u0026#34;: \u0026#34;david\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;my_password\u0026#34;}`) r, _ := http.NewRequest(http.MethodPost, \u0026#34;/postbody\u0026#34;, reader_json) r.Header.Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) ... server:\n1 2 3 4 5 6 7 8 9 10 11 12 13 // Parse username and password in form. type info struct { Username string `json:\u0026#34;username\u0026#34;` Password string `json:\u0026#34;password\u0026#34;` } user := info{} // note that r.Body is an io.Reader // which means decoder.Decode() method will consume data stroed in r.Body // you cannot read same data twice decoder := json.NewDecoder(r.Body) err := decoder.Decode(\u0026amp;user) print(user.password) print(user.username) ","date":"2023-11-04T00:02:19Z","permalink":"https://blog.yorforger.cc/p/form-data-query-string/","title":"Form Data \u0026 Query String"},{"content":" # 1. HTTP/1.1 The first standardized version of HTTP, HTTP/1.1, was published in early 1997, only a few months after HTTP/1.0.\nHTTP/1.1 clarified ambiguities and introduced numerous improvements:\nA underlying TCP connection could be reused. It no longer needed to be opened multiple times to request the resources embedded in the single original document.\nHTTP keep-alive, a.k.a., HTTP persistent connection, is an instruction that allows a single TCP connection to remain open for multiple HTTP requests/responses. Learn more: HTTP Headers (2) - David\u0026rsquo;s Blog Pipelining was added. This allowed a second request to be sent before the answer to the first one was fully transmitted. This lowered the latency of the communication.\nPipelining will cause another issue: Head-of-line (HOL) blocking, we will talk this later. \u0026hellip;\nThe persistent-connection model keeps connections opened between successive requests, reducing the time needed to open new connections. The HTTP pipelining model goes one step further, by sending several successive requests without even waiting for an answer, reducing much of the latency in the network. Connection management in HTTP/1.x | MDN\n# 2. HTTP/2.0 The primary goals for HTTP/2 are to reduce latency by enabling full request and response multiplexing, minimize protocol overhead via efficient compression of HTTP header fields, and add support for request prioritization and server push.\nFrom a technical point of view, one of the most significant features that distinguishes HTTP/1.1 and HTTP/2 is the binary framing layer, which can be thought of as a part of the application layer in the internet protocol stack. As opposed to HTTP/1.1, which keeps all requests and responses in plain text format, HTTP/2 uses the binary framing layer to encapsulate all messages in binary format, while still maintaining HTTP semantics, such as verbs, methods, and headers. An application level API would still create messages in the conventional HTTP formats, but the underlying layer would then convert these messages into binary. This ensures that web applications created before HTTP/2 can continue functioning as normal when interacting with the new protocol.\nThe conversion of messages into binary allows HTTP/2 to try new approaches to data delivery not available in HTTP/1.1, a contrast that is at the root of the practical differences between the two protocols.\n# 3. HTTP/1.1 â€” Pipelining and Head-of-Line Blocking The first response that a client receives on an HTTP GET request is often not the fully rendered page. Instead, it contains links to additional resources needed by the requested page. Because of this, the client will have to make additional requests to retrieve these resources. In HTTP/1.0, the client had to break and remake the TCP connection with every new request, a costly affair in terms of both time and resources.\nHTTP/1.1 takes care of this problem by introducing persistent connections and pipelining. With persistent connections, HTTP/1.1 assumes that a TCP connection should be kept open unless directly told to close. This allows the client to send multiple requests along the same connection without waiting for a response to each, greatly improving the performance of HTTP/1.1 over HTTP/1.0.\nUnfortunately, there is a natural bottleneck to this optimization strategy. We said client to send multiple requests along the same connection (means a same thread on server), assume there are 3 request needed to be sent to server, one is for html, one is for an image and another one for a video. Now with persistent connections and pipelining, the client can send these three requests at a time within one TCP connection, and these requests will be procceeded by the server one by one (they are in a same tcp connection), if the second request is very time consuming at server, then the third request has to wait for the second finished. Adding separate, parallel TCP connections at client could alleviate this issue, but there are limits to the number of concurrent TCP connections possible between a client and server, and each new connection requires significant resources.\nHead of Line blocking in HTTP terms is often referring to the fact that each browser/client has a limited number of connections to a server and doing a new request over one of those connections has to wait for the ones to complete before it can fire it off. The head of line requests block the subsequent ones. HTTP/2 solves this by introducing multiplexing so that you can issue new requests over the same connection without having to wait for the previous ones to complete.\nHTTP/2 does however still suffer from another kind of HOL, namely on the TCP level. One lost packet in the TCP stream makes all streams wait until that packet is re-transmitted and received. This HOL is being addressed with the QUIC protocol\u0026hellip;\nLearn more: https://stackoverflow.com/a/45583977/16317008\nThe multiplex here is not the multiplex on linux (epoll, select), learn more: HTTP 2.0 Binary Framing - David\u0026rsquo;s Blog\n# 4. What are the other differences between HTTP/2 and HTTP/1.1 that impact performance? Multiplexing: HTTP/1.1 loads resources one after the other, so if one resource cannot be loaded, it blocks all the other resources behind it. In contrast, HTTP/2 is able to use a single TCP connection to send multiple streams of data at once so that no one resource blocks any other resource. HTTP/2 does this by splitting data into binary-code messages and numbering these messages so that the client knows which stream each binary message belongs to.\nServer push: Typically, a server only serves content to a client device if the client asks for it. However, this approach is not always practical for modern webpages, which often involve several dozen separate resources that the client must request. HTTP/2 solves this problem by allowing a server to \u0026ldquo;push\u0026rdquo; content to a client before the client asks for it. The server also sends a message letting the client know what pushed content to expect â€“ like if Bob had sent Alice a Table of Contents of his novel before sending the whole thing.\nHeader compression: Small files load more quickly than large ones. To speed up web performance, both HTTP/1.1 and HTTP/2 compress HTTP messages to make them smaller. However, HTTP/2 uses a more advanced compression method called HPACK that eliminates redundant information in HTTP header packets. This eliminates a few bytes from every HTTP packet. Given the volume of HTTP packets involved in loading even a single webpage, those bytes add up quickly, resulting in faster loading.\nReferences:\nHTTP/1.1 vs HTTP/2: What\u0026rsquo;s the Difference? | DigitalOcean Introduction to HTTP/2 | Web Fundamentals | Google Developers HTTP/2 vs. HTTP/1.1 | Cloudflare Connection management in HTTP/1.x - HTTP | MDN https://stackoverflow.com/a/45583977/16317008 Evolution of HTTP - HTTP | MDN ","date":"2023-11-03T22:45:30Z","permalink":"https://blog.yorforger.cc/p/http-1.1-vs-http-2.0/","title":"HTTP 1.1 vs HTTP 2.0"},{"content":" # 1. Compilation process in C C/C++ programs are built in two main phases (ignore the preprocess, assemble):\nCompilation - produces object code (.obj, .o)\n1 2 # Compile source code into an object file without linking: gcc -c path/to/source.c The extension of the object file in DOS is .obj, and in UNIX, the extension is .o. Linking - produces executable code (.exe or .dll)\nexecutable file with an extension of exe in DOS and .out in UNIX OSL # 2. Static linking and dynamic linking # 2.1. Static linking - portable, fast Mainly, all the programs written in C use library functions. These library functions are pre-compiled, and the object code of these library files is stored with .lib (or .a) extension. The main working of the linker is to combine the object code of library files with the object code of our program. The output of the linker is the executable file. So the static Linking creates larger binary files. Note that this is the process of static linking, and .lib and .a is static library in windows and linux respectively.\nIn static linking, everything is bundled into your application, you donâ€™t have to worry that the client will have the right library (and version) available on their system. Since all library code have connected at compile time, the final executable has no dependencies on the library at run time. You have everything under your control and there is no dependency.\nOne major advantage of static libraries being preferred even now â€œis speedâ€. There will be no dynamic querying of symbols in static libraries.\nOne drawback of static libraries is, for any change(up-gradation) in the static libraries, you have to recompile the main program every time.\n# 2.2. Dynamic linking - smaller binary Dynamic Linking doesnâ€™t require the code to be copied, it is done by just placing name of the library in the binary file. The actual linking happens when the program is run, when both the binary file and the library are in memory.\nSource: Static and Dynamic Libraries | Set 1 - GeeksforGeeks\n# 3. Static library vs dynamic library Static library: windows .lib, linux .a\nDynamic library (shared library): windows .dll, linux .so\nStatic library .lib is just a bundle of .obj files and therefore isn\u0026rsquo;t a complete program. It hasn\u0026rsquo;t undergone the second (linking) phase of building a program. Dlls, on the other hand, are like exe\u0026rsquo;s and therefore are complete programs.\nIf you build a static library, it isn\u0026rsquo;t linked yet and therefore consumers of your static library will have to use the same compiler that you used (if you used g++, they will have to use g++). If the static library uses C++ library, such as #include \u0026lt;iostream\u0026gt;.\nIf instead you built a dll (and built it correctly), you have built a complete program that all consumers can use, no matter which compiler they are using. There are several restrictions though, on exporting from a dll, if cross compiler compatibility is desired.\nSource: https://stackoverflow.com/a/25209275/16317008\n# 4. Example in practice Dynamic linking means the use of shared libraries. Shared libraries usually end with .so (short for \u0026ldquo;shared object\u0026rdquo;) or .dylib on MacOS.\nAnother thing to note is that when a bug is fixed in a shared library, every application that references this library will profit from it. This also means that if the bug remains undetected, each referencing application will suffer from it (if the application uses the affected parts).\nIt can be very hard for beginners when an application requires a specific version of the library, but the linker only knows the location of an incompatible version. In this case, you must help the linker find the path to the correct version.\nAlthough this is not an everyday issue, understanding dynamic linking will surely help you in fixing such problems.\nFortunately, the mechanics for this are quite straightforward. To detect which libraries are required for an application to start, you can use ldd, which will print out the shared libraries used by a given file.\n1 2 3 4 5 $ ldd my_app linux-vdso.so.1 (0x00007ffd1299c000) libmy_shared.so =\u0026gt; not found libc.so.6 =\u0026gt; /lib64/libc.so.6 (0x00007f56b869b000) /lib64/ld-linux-x86-64.so.2 (0x00007f56b8881000) Note that the library libmy_shared.so is part of the repository but is not found. This is because the dynamic linker, which is responsible for loading all dependencies into memory before executing the application, cannot find this library in the standard locations it searches.\nErrors associated with linkers finding incompatible versions of common libraries (like bzip2, for example) can be quite confusing for a new user. One way around this is to add the repository folder to the environment variable LD_LIBRARY_PATH to tell the linker where to look for the correct version. In this case, the right version is in this folder, so you can export it:\n1 2 $ LD_LIBRARY_PATH=$(pwd):$LD_LIBRARY_PATH $ export LD_LIBRARY_PATH Now the dynamic linker knows where to find the library, and the application can be executed. You can rerun ldd to invoke the dynamic linker, which inspects the application\u0026rsquo;s dependencies and loads them into memory. The memory address is shown after the object path:\n1 2 3 4 5 $ ldd my_app linux-vdso.so.1 (0x00007ffd385f7000) libmy_shared.so =\u0026gt; /home/stephan/library_sample/libmy_shared.so (0x00007f3fad401000) libc.so.6 =\u0026gt; /lib64/libc.so.6 (0x00007f3fad21d000) /lib64/ld-linux-x86-64.so.2 (0x00007f3fad408000) To find out which linker is invoked, you can use file:\n1 2 $ file my_app my_app: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=26c677b771122b4c99f0fd9ee001e6c743550fa6, for GNU/Linux 3.2.0, not stripped The linker /lib64/ld-linux-x86â€“64.so.2 is a symbolic link to ld-2.30.so, which is the default linker for my Linux distribution:\n1 2 $ file /lib64/ld-linux-x86-64.so.2 /lib64/ld-linux-x86-64.so.2: symbolic link to ld-2.31.so Looking back to the output of ldd, you can also see (next to libmy_shared.so) that each dependency ends with a number (e.g., /lib64/libc.so.6). The usual naming scheme of shared objects is:\n1 **lib** XYZ.so **.\u0026lt;MAJOR\u0026gt;** . **\u0026lt;MINOR\u0026gt;** On my system, libc.so.6 is also a symbolic link to the shared object libc-2.30.so in the same folder:\n1 2 $ file /lib64/libc.so.6 /lib64/libc.so.6: symbolic link to libc-2.31.so If you are facing the issue that an application will not start because the loaded library has the wrong version, it is very likely that you can fix this issue by inspecting and rearranging the symbolic links or specifying the correct search path (see \u0026ldquo;The dynamic loader: ld.so\u0026rdquo; below).\nFor more information, look on the ldd man page.\nSource: How to handle dynamic and static libraries in Linux | Opensource.com\nNote that the dynamic linker on MacOS is called dyld, try man dyld to check the details. Learn more: https://stackoverflow.com/a/34905091/16317008\n1 2 3 4 func main() { fmt.Println(\u0026#34;hello\u0026#34;) } // go build -o server main.go Then check the shared libraries this executable file server required:\n1 2 3 4 5 # otool -L: print shared libraries used $ otool -L server server: /usr/lib/libSystem.B.dylib (compatibility version 0.0.0, current version 0.0.0) /usr/lib/libresolv.9.dylib (compatibility version 0.0.0, current version 0.0.0) ldd is on linux, on MaxOS you should use otool\n","date":"2023-11-03T10:49:20Z","permalink":"https://blog.yorforger.cc/p/statically-linking-in-c/","title":"Statically Linking in C"},{"content":"å£°æ˜: æœ¬æ–‡åªç”¨äºå­¦ä¹ ç›®çš„, è¯·å‹¿ç”¨äºéæ³•ç”¨é€”.\n# 1. DNS spoofing DNS cache poisoning is the act of entering false information into a DNS cache, so that DNS queries return an incorrect response and users are directed to the wrong websites. DNS cache poisoning is also known as \u0026lsquo;DNS spoofing\u0026rsquo;.\n# 1.1. DNS Caching Learn more about DNS caching: DNS Concepts (NameServer(NS), DNS Records and Caching) - David\u0026rsquo;s Blog\n# 1.2. How do attackers poison DNS caches? Attackers can poison DNS caches by impersonating DNS nameservers, making a request to a DNS resolver, and then forging the reply when the DNS resolver queries a nameserver. This is possible because DNS servers use UDP instead of TCP, and because currently there is no verification for DNS information.\nDNS Cache Poisoning Process:\nPoisoned DNS Cache:\nIf a DNS resolver receives a forged response, it accepts and caches the data uncritically because there is no way to verify if the information is accurate and comes from a legitimate source.\nDespite these major points of vulnerability in the DNS caching process, DNS poisoning attacks are not easy. Because the DNS resolver does actually query the authoritative nameserver, attackers have only a few milliseconds to send the fake reply before the real reply from the authoritative nameserver arrives.\nThe way to prevent this is to set the /etc/host file directly, because checking host file happens before DNS resolution.\nLearn more: DNS Stub and Recursive Resolver - Config Files - David\u0026rsquo;s Blog\nLearn more: What is DNS cache poisoning? | DNS spoofing | Cloudflare\n# 2. GFW # 2.1. HTTP åŠ«æŒ åŸæ–‡: æµ…è°ˆHTTPåŠ«æŒã€DNSæ±¡æŸ“çš„å½±å“åŠè§£å†³åŠæ³•ï¼ˆä»…ä¸ªäººç†è§£ï¼‰ | é€—æ¯”æ ¹æ®åœ°\nHTTPåŠ«æŒå¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºHTTPä¼ è¾“åè®®æ˜¯æ˜æ–‡çš„ï¼Œå¹¶ä¸”æˆ‘çš„ç½‘ç«™æœåŠ¡å™¨æ˜¯åœ¨æµ·å¤–ï¼Œè¦è®¿é—®æˆ‘çš„ç½‘ç«™å°±è¦é€šè¿‡ä¸­å›½çš„å›½é™…å®½å¸¦å‡ºå£ï¼Œå‡ºå»ä¸æˆ‘çš„ç½‘ç«™å»ºç«‹è¿æ¥ã€‚æˆ‘çš„ç½‘ç«™ä¹Ÿæ˜¯å› ä¸ºå…³é”®è¯çš„åŸå› åœ¨ç»è¿‡å‡ºå£çš„æ—¶å€™ï¼Œè¢«â€œæ£€æŸ¥ç«™ï¼šå¢™â€æ‰«æåˆ°äº†è¿è§„å…³é”®è¯ï¼Œäºæ˜¯ææ–­äº†TCPé“¾æ¥ã€‚æ‰€ä»¥å½“æ—¶ç”¨æˆ·è®¿é—®ç½‘ç«™ä¼šé‡åˆ°ï¼šé“¾æ¥å·²é‡ç½®ã€è¯¥ç½‘ç«™å·²æ°¸ä¹…ç§»åŠ¨åˆ°å…¶ä»–åœ°å€ç­‰ç­‰ã€‚\nHTTPåŠ«æŒå¾ˆå®¹æ˜“è§£å†³ï¼Œé‚£å°±æ˜¯åŠ ä¸ŠSSLè¯ä¹¦ï¼Œç½‘ç«™é“¾æ¥å…¨éƒ¨å†…å®¹åŠ å¯†ï¼Œè¿™æ ·â€œæ£€æŸ¥ç«™ï¼šå¢™â€å°±æ— æ³•è§£å¯†æ•°æ®åˆ†æå…³é”®è¯äº†ã€‚ä½†æ˜¯è¿™ä¸æ˜¯ç»å¯¹èƒ½è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œå¦‚æœä½ çš„ç½‘ç«™åªæ˜¯è¯¯æ€æˆ–è€…è¿è§„æ“¦è¾¹çƒï¼Œé‚£è¿˜å¥½ï¼Œå¦‚æœæ˜¯å¤§å‹ç½‘ç«™ï¼Œå°±ä¼šç‰¹æ®Šå¯¹å¾…äº†ã€‚\nHTTPSåœ¨å»ºç«‹åŠ å¯†è¿æ¥çš„æ—¶å€™ï¼Œéœ€è¦ä¸€æ¬¡æ¡æ‰‹ï¼Œä¹Ÿå°±æ˜¯è¾¾æˆé“¾æ¥åè®®å»ºç«‹åŠ å¯†è¿æ¥ï¼Œä½†æ˜¯è¿™æ¬¡æ¡æ‰‹æ˜¯æ˜æ–‡çš„ï¼ˆå»ºç«‹åŠ å¯†é“¾æ¥é¦–å…ˆå°±æ˜¯é“¾æ¥åŒæ–¹ä¿¡ä»»ï¼Œæ¯”å¦‚ç½‘ç«™çš„SSLè¯ä¹¦æ˜¯è‡ªå·±ç­¾çš„ï¼Œæˆ–è€…SSLè¯ä¹¦åˆ°æœŸæˆ–ä¼ªé€ çš„ï¼Œåœ¨è®¿é—®è¿™ä¸ªç½‘ç«™çš„æ—¶å€™æµè§ˆå™¨å°±ä¼šè¿›è¡Œæç¤ºï¼Œè¡¨ç¤ºæ­¤ç½‘ç«™ä¸å®‰å…¨å•¥çš„ã€‚ï¼‰æ¡æ‰‹æ˜¯æ˜æ–‡çš„å°±æ„å‘³ç€ï¼Œå¦‚æœä½ çš„åŸŸåè¢«é‡ç‚¹å…³æ³¨ï¼Œå³ä½¿ä½ åŠ ä¸Šäº†SSLè¯ä¹¦ï¼Œä¹Ÿä¼šåœ¨é¦–æ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼Œè¢«å…³é”®è¯åŒ¹é…ç„¶åææ–­é“¾æ¥ã€‚ learn more: HTTPS SSL TLS - David\u0026rsquo;s Blog\n# 2.2. DNSæ±¡æŸ“æŠ•æ¯’ æˆ‘ä»¬å‡è®¾Aä¸ºç”¨æˆ·ç«¯ä¹Ÿå°±æ˜¯ä½ çš„ç”µè„‘è®¾å¤‡ï¼ŒBä¸ºDNSæœåŠ¡å™¨ï¼ŒCä¸ºAåˆ°Bé“¾è·¯ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„ç½‘ç»œè®¾å¤‡ï¼ˆè·¯ç”±å™¨ã€äº¤æ¢æœºã€ç½‘å…³ç­‰ï¼‰ã€‚\nç„¶åæˆ‘ä»¬æ¨¡æ‹Ÿä¸€æ¬¡è¢«æ±¡æŸ“çš„DNSè¯·æ±‚è¿‡ç¨‹ã€‚\nAè®¿é—®ä¸€ä¸ªç½‘ç«™ï¼Œæ¯”å¦‚ google.com ï¼Œç„¶åï¼ŒAå‘Bé€šè¿‡UDPæ–¹å¼å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œæ¯”å¦‚æŸ¥è¯¢å†…å®¹ A google.com ï¼Œè¿™ä¸ªæ•°æ®åº“åœ¨å‰å¾€Bçš„æ—¶å€™è¦ç»è¿‡æ•°ä¸ªèŠ‚ç‚¹ç½‘ç»œè®¾å¤‡æ¯”å¦‚Cï¼Œç„¶åç»§ç»­å‰å¾€DNSæœåŠ¡å™¨Bã€‚\nç„¶è€Œåœ¨è¿™ä¸ªä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒCé’ˆå¯¹è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œç‰¹å¾åˆ†æï¼Œï¼ˆDNSç«¯å£ä¸º53ï¼Œè¿›è¡Œç‰¹å®šç«¯å£ç›‘è§†æ‰«æï¼Œå¯¹UDPæ˜æ–‡ä¼ è¾“çš„DNSæŸ¥è¯¢è¯·æ±‚è¿›è¡Œç‰¹å¾å’Œå…³é”®è¯åŒ¹é…åˆ†æï¼Œæ¯”å¦‚â€œgoogle.comâ€æ˜¯å…³é”®è¯ï¼Œä¹Ÿæˆ–è€…æ˜¯â€œAè®°å½•â€ï¼‰ï¼Œä»è€Œç«‹åˆ»è¿”å›ä¸€ä¸ªé”™è¯¯çš„è§£æç»“æœï¼ˆæ¯”å¦‚è¿”å›äº† A 233.233.233.233 ï¼‰ã€‚\nä¼—æ‰€å‘¨çŸ¥ï¼Œä½œä¸ºé“¾è·¯ä¸Šçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç½‘ç»œè®¾å¤‡ C å¿…å®šæ¯”çœŸæ­£çš„ DNS æœåŠ¡å™¨ B æ›´å¿«çš„è¿”å›ç»“æœåˆ° ç”¨æˆ·ç”µè„‘Aï¼Œè€Œç›®å‰çš„DNSè§£ææœºåˆ¶ç­–ç•¥æœ‰ä¸€ä¸ªé‡è¦çš„åŸåˆ™ï¼Œå°±æ˜¯åªè®¤ç¬¬ä¸€ã€‚å› æ­¤ èŠ‚ç‚¹ç½‘ç»œè®¾å¤‡Cæ‰€è¿”å›çš„æŸ¥è¯¢ç»“æœå°±è¢« ç”¨æˆ·ç”µè„‘Aå½“ä½œäº†æœ€ç»ˆç»“æœï¼Œäºæ˜¯ç”¨æˆ·ç”µè„‘Aå› ä¸ºè·å¾—äº†é”™è¯¯çš„IPï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸è®¿é—® google.com ã€‚\néªŒè¯æ±¡æŸ“ æˆ‘çš„ doub.ssrshare.usm ä¸»åŸŸåè™½ç„¶åœ¨å¤§éƒ¨åˆ†åœ°åŒºè§£é™¤äº†DNSæ±¡æŸ“ï¼Œä½†æ˜¯æˆ‘çš„ä¸¤ä¸ªSSç«™åŸŸåå¹¶æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘å°è¯•å¯¹æˆ‘çš„SS å­åŸŸåè¿›è¡Œnslookupæµ‹è¯•ã€‚\n1 2 3 4 5 6 7 8 C:\\Users\\Administrator\u0026gt;nslookup ss.dou-bi.com 8.8.8.8 æœåŠ¡å™¨: google-public-dns-a.google.com Address: 8.8.8.8 éæƒå¨åº”ç­”: åç§°: ss.dou-bi.com Addresses: 200:2:9f6a:794b:: 8.7.198.45 æˆ‘ä½¿ç”¨çš„æ˜¯è°·æ­Œçš„ 8.8.8.8 DNSï¼Œä½†æ˜¯æˆ‘å¾—åˆ°çš„Aè®°å½• IPå´æ˜¯8.7.198.45ï¼Œè¿™ä¸ªæ˜æ˜¾ä¸æ˜¯æˆ‘çš„IPï¼Œçœ‹ä¸€ä¸‹å…¶ä»–è¢«DNSæ±¡æŸ“çš„åŸŸåå°±ä¼šå‘ç°éƒ½ä¼šæœ‰è¿™ä¸ªIPã€‚å¾ˆæ˜æ˜¾ï¼Œæˆ‘çš„ ss.dou-bi.com åŸŸåå—åˆ°äº†DNSæ±¡æŸ“ã€‚\nè§£å†³åŠæ³•\nä½¿ç”¨åŠ å¯†ä»£ç†ï¼Œæ¯”å¦‚Shadowsocksï¼Œåœ¨åŠ å¯†ä»£ç†é‡Œè¿›è¡Œè¿œç¨‹DNSè§£æï¼Œæˆ–è€…ä½¿ç”¨VPNä¸Šç½‘ã€‚\nä¿®æ”¹hostsæ–‡ä»¶ï¼Œæ“ä½œç³»ç»Ÿä¸­Hostsæ–‡ä»¶çš„æƒé™ä¼˜å…ˆçº§é«˜äºDNSæœåŠ¡å™¨ï¼Œæ“ä½œç³»ç»Ÿåœ¨è®¿é—®æŸä¸ªåŸŸåæ—¶ï¼Œä¼šå…ˆæ£€æµ‹HOSTSæ–‡ä»¶ï¼Œç„¶åå†æŸ¥è¯¢DNSæœåŠ¡å™¨ã€‚å¯ä»¥åœ¨hostsæ·»åŠ å—åˆ°æ±¡æŸ“çš„DNSåœ°å€æ¥è§£å†³DNSæ±¡æŸ“å’ŒDNSåŠ«æŒã€‚\né€šè¿‡ä¸€äº›è½¯ä»¶ç¼–ç¨‹å¤„ç†ï¼Œå¯ä»¥ç›´æ¥å¿½ç•¥è¿”å›ç»“æœæ˜¯è™šå‡IPåœ°å€çš„æ•°æ®åŒ…ï¼Œç›´æ¥è§£å†³DNSæ±¡æŸ“çš„é—®é¢˜ã€‚å¦‚æœä½ æ˜¯Firefoxç”¨æˆ·ï¼Œå¹¶ä¸”åªç”¨Firefoxï¼Œåˆæ‡’å¾—æŠ˜è…¾ï¼Œç›´æ¥æ‰“å¼€Firefoxçš„è¿œç¨‹DNSè§£æå°±è¡Œäº†ã€‚åœ¨åœ°å€æ ä¸­è¾“å…¥ï¼šabout:configæ‰¾åˆ° network.proxy.socks_remote_dns ä¸€é¡¹æ”¹æˆtrueã€‚\nä½¿ç”¨DNSCryptè½¯ä»¶ï¼Œæ­¤è½¯ä»¶ä¸ä½¿ç”¨çš„OpenDNSç›´æ¥å»ºç«‹ç›¸å¯¹å®‰å…¨çš„TCPè¿æ¥å¹¶åŠ å¯†è¯·æ±‚æ•°æ®ï¼Œä»è€Œä¸ä¼šè¢«æ±¡æŸ“ã€‚ å¯¹äºè¢«DNSæ±¡æŸ“çš„ç½‘ç«™ç«™é•¿æ¥è¯´ï¼Œæœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯ æ¢åŸŸåæˆ–è€…IP äº†ã€‚\n# 2.3. ipé»‘åå• å³ä½¿æ²¡æœ‰DNSæ±¡æŸ“ æˆ–è€… ä½ è·å¾—äº†æ­£ç¡®çš„IPï¼Œä½ å°±èƒ½æ­£å¸¸è®¿é—®è¿™äº›è¢«å±è”½çš„ç½‘ç«™äº†å—ï¼Ÿ\nä¸ï¼Œå¢™ç›®å‰å·²ç»æœ‰äº†IPé»‘åå•ï¼Œé’ˆå¯¹è°·æ­Œè¿™ç§ç½‘ç«™å·²ç»ä¸å†æ˜¯æ™®é€šçš„DNSæ±¡æŸ“äº†ï¼Œå› ä¸ºæ€»ä¼šæœ‰åŠæ³•è®¿é—®è¢«DNSæ±¡æŸ“çš„ç½‘ç«™ï¼ˆæ¯”å¦‚æŒ‡å®šHostsï¼‰ã€‚\né‚£ä¹ˆå°±ç›´æ¥æŠŠæ‰€æœ‰çš„è°·æ­ŒIPæ‹‰é»‘ä¸å°±å¥½äº†ï¼Ÿå°±ç®—ä½ è·å¾—äº†æ­£ç¡®çš„è°·æ­ŒIPï¼Œä½†æ˜¯å½“ä½ å»è®¿é—®è¿™ä¸ªIPçš„æ—¶å€™ï¼Œå¢™ä¼šå‘ç°è¿™ä¸ªIPå­˜åœ¨äºé»‘åå•ä¸­ï¼Œäºæ˜¯ç›´æ¥é˜»æ–­ï¼Œäºæ˜¯æµè§ˆå™¨å°±ä¼šæç¤ºï¼šwww.google.com çš„å“åº”æ—¶é—´è¿‡é•¿ç­‰ç­‰\n# 3. å¸¸è§ä»£ç†æ–¹å¼ VPN å¸¸è§åè®®: IPSec, OpenVPN, L2TP, WireGuard Shadowsocks (ä»£ç†æœåŠ¡å™¨) å¸¸è§åè®®: SOCKS5 V2Ray (ä»£ç†æœåŠ¡å™¨) å¸¸è§åè®®: VMess HTTP ä»£ç† (ä»£ç†æœåŠ¡å™¨) å·²è¢«å°é”, åŸå› æ˜¯HTTPä»£ç†å¹¶ä¸å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†, å³ä½¿æµé‡èƒ½å¤Ÿç»•è¿‡åˆæ­¥çš„å®¡æŸ¥ï¼Œä¼ è¾“çš„å†…å®¹ä»ç„¶æ˜¯é€æ˜çš„ï¼Œå®¹æ˜“è¢«ç›‘æ§ã€‚ å³ä½¿ä½¿ç”¨ HTTPS ä¹Ÿä¸ä¼šå®ç°å…¨å±€åŠ å¯†, åœ¨å»ºç«‹ TLS æ¡æ‰‹éªŒè¯æ—¶è¿˜æ˜¯éœ€è¦ä¸€ä¸ªHTTPæ˜æ–‡è¿æ¥ äº†è§£æ›´å¤š: ä¸Šç½‘é™åˆ¶å’Œç¿»å¢™åŸºæœ¬åŸç† | superxlcr\u0026rsquo;s notebook\n","date":"2023-10-31T15:29:25Z","permalink":"https://blog.yorforger.cc/p/dns-spoofing-gfw/","title":"DNS Spoofing - GFW"},{"content":" # 1. nslookup # 1.1. Query A Record 1 2 3 4 5 6 7 8 # basic DNS lookup $ nslookup google.com Server:\t192.168.2.1 Address:\t192.168.2.1#53 Non-authoritative answer: Name:\tgoogle.com Address: 142.250.81.238 # 1.2. Reverse DNS look-up 1 2 3 4 5 6 7 8 9 $ nslookup 18.219.46.189 Server:\t192.168.2.1 Address:\t192.168.2.1#53 Non-authoritative answer: 189.46.219.18.in-addr.arpa\tname = ec2-18-219-46-189.us-east-2.compute.amazonaws.com. Authoritative answers can be found from: 46.219.18.in-addr.arpa\tnameserver = ns1-24-us-east-2.ec2-rdns.amazonaws.com. # 1.3. Query name server 1 2 3 4 5 6 7 8 $ nslookup -type=ns google.com Server:\t192.168.2.1 Address:\t192.168.2.1#53 Non-authoritative answer: google.com\tnameserver = ns1.google.com. google.com\tnameserver = ns3.google.com. .... When using the nslookup utility to query Domain Name System (DNS) servers, you could see the message â€œNon-authoritative answer.â€ This tells you that the DNS server youâ€™re asking canâ€™t ensure that it has the official, up-to-date information for the domain name or IP address youâ€™re seeking up and is instead giving you a cached response that it got from another DNS server.\nPlease note that getting non-authoritative answers doesn\u0026rsquo;t mean incorrect or unreliable. However, if you need the most accurate and up-to-date information, it is recommended to use authoritative DNS servers for queries.\nReference:\nNslookup Command in Linux with Examples - GeeksforGeeks\nWhy is â€œNon-authoritative answerâ€ given by nslookup? DNS Explained\n# 1.4. Get authoritative answer Step 1: Use the nslookup command to query the SOA (Start of Authority) record of the domain name. The SOA record contains information about the authoritative name servers for the domain.\n1 2 3 4 5 6 7 8 â¯ nslookup -type=soa davidzhu.xyz Non-authoritative answer: ... Authoritative answers can be found from: davidzhu.xyz\tnameserver = ns1.dnsowl.com. davidzhu.xyz\tnameserver = ns2.dnsowl.com. davidzhu.xyz\tnameserver = ns3.dnsowl.com. Step 2: Identify the primary name server from previous response:\n1 2 3 4 5 6 â¯ nslookup davidzhu.xyz ns1.dnsowl.com Server:\tns1.dnsowl.com Address:\t162.159.27.173#53 Name:\tdavidzhu.xyz Address: 185.199.108.153 # 2. dig dig command stands for Domain Information Groper. It is used for retrieving information about DNS name servers. Dig command replaces older tools such as nslookup and the host.\n# 2.1. Query A Record To query domain â€œAâ€ record with +short:\n1 2 $ dig geeksforgeeks.org +short 34.218.62.116 Specify DNS server:\n1 $ dig geeksforgeeks.org +short @8.8.8.8 By default, dig command will query the name servers listed in â€œ/etc/resolv.confâ€ to perform a DNS lookup. We can change it by using @ symbol followed by a hostname or IP address of the name server.\nLearn more about /etc/resolv.conf and /etc/hosts: DNS Stub and Recursive Resolver - Config Files - David\u0026rsquo;s Blog\n# 2.2. Reverse DNS lookup 1 2 â¯ dig -x 18.219.46.189 +short ec2-18-219-46-189.us-east-2.compute.amazonaws.com. # 2.3. Query name server 1 2 3 4 â¯ dig davidzhu.xyz NS +short ns1.dnsowl.com. ns2.dnsowl.com. ns3.dnsowl.com. # 3. dig vs nslookup dig Process: dig follows the standard DNS resolution process, starting with a query to the root name servers to obtain the list of TLD name servers. It then queries a TLD name server to obtain the authoritative name servers for the domain. After obtaining the authoritative name servers, dig sends a direct query to one of these name servers to retrieve the A record for the domain. The response obtained from dig is typically authoritative, as it comes directly from the authoritative name server responsible for the domain. nslookup Process: nslookup queries the DNS server configured on the local system by default. This DNS server may be provided by the ISP or manually configured. The response from nslookup may be non-authoritative, indicating that the DNS server providing the response is not the authoritative server for the queried domain. It may have obtained the response from its cache or forwarded the query to another DNS server. In summary, dig directly queries authoritative name servers to obtain DNS information, resulting in authoritative responses. On the other hand, nslookup queries the local DNS server, which may or may not provide authoritative responses, depending on its configuration and the nature of the query.\n","date":"2023-10-31T15:23:08Z","permalink":"https://blog.yorforger.cc/p/tools-commonly-used-in-networking/","title":"Tools Commonly Used in Networking"},{"content":" # 1. DNS DNS stands for Domain Name System, and it is a distributed hierarchical system that translates human-readable domain names into IP addresses. The process of DNS resolution involves converting a hostname (such as www.example.com) into a computer-friendly IP address (such as 192.168.1.1).\nThe main components of the DNS are DNS servers. All DNS servers fall into one of four categories: Recursive resolvers, root nameservers, TLD nameservers, and authoritative nameservers.\n# 1.1. DNS stub resolver Before introduce the DNS servers, there is a software runs on the client whcih called DNS stub resolver should be noted.\nDNS stub resolver runs on the client machine, which is used to initiate DNS queries, and it sends the DNS query to the recursive resolver, which then performs the actual DNS resolution process (usually provided by your internet service provider (ISP) or a public DNS resolver like Google\u0026rsquo;s 8.8.8.8 or Cloudflare\u0026rsquo;s 1.1.1.1).\nLearn more: DNS Stub and Recursive Resolver - Config Files - David\u0026rsquo;s Blog\n# 1.2. Recursive resolver As we mentioned above, recursive resolver performs the actual DNS resolution process, and it\u0026rsquo;s a DNS server actually, usually provided by your internet service provider (ISP) or a public DNS resolver like Google\u0026rsquo;s 8.8.8.8 or Cloudflare\u0026rsquo;s 1.1.1.1.\nA recursive resolver (also known as a DNS recursor) is the first stop in a DNS query. The recursive resolver acts as a middleman between a client and a DNS nameserver. When a recursive resolver receives a query from a stub resolver, a recursive resolver will either respond with cached data, or send a request to a root nameserver, followed by another request to a TLD nameserver, and then one last request to an authoritative nameserver. After receiving a response from the authoritative nameserver containing the requested IP address, the recursive resolver then sends a response to the client.\nDuring this process, the recursive resolver will cache information received from authoritative nameservers. When a client requests the IP address of a domain name that was recently requested by another client, the resolver can circumvent the process of communicating with the nameservers, and just deliver the client the requested record from its cache.\n# 1.3. Root nameserver \u0026amp; TLD nameserver The 13 DNS root nameservers are known to every recursive resolver, and they are the first stop in a recursive resolverâ€™s quest for DNS records. A root server accepts a recursive resolverâ€™s query which includes a domain name, and the root nameserver responds by directing the recursive resolver to a TLD nameserver, based on the extension of that domain (.com, .net, .org, etc.).\nA TLD nameserver maintains information for all the domain names that share a common domain extension, such as .com, .net, or whatever comes after the last dot in a URL. For example, a .com TLD nameserver contains information for every website that ends in â€˜.comâ€™. If a user was searching for google.com, after receiving a response from a root nameserver, the recursive resolver would then send a query to a .com TLD nameserver, which would respond by pointing to the authoritative nameserver (see below) for that domain.\n# 1.4. Authoritative nameserver When a recursive resolver receives a response from a TLD nameserver, that response will direct the resolver to an authoritative nameserver.\nThe authoritative nameserver contains information specific to the domain name it serves (e.g. google.com) and it can provide a recursive resolver with the IP address of that server found in the DNS A record, or if the domain has a CNAME record (alias) it will provide the recursive resolver with an alias domain, at which point the recursive resolver will have to perform a whole new DNS lookup to procure a record from an authoritative nameserver (often an A record containing an IP address).\nDNS A record is actually a map between the domain name and its ipv4 address.\nDNS CNAME record is an alias for that domain.\nAfter buy a domain on a website, the most common operations we use are that change its nameservers and update its DNS records:\nHere, Change the NameServers option if to change the authoritative nameserver of your domain, and update the DNS records is to set ip address (A record) or alias (CNAME record) for your domain.\n# 2. DNS queries Recursive query - In a recursive query, a DNS client requires that a DNS server (typically a DNS recursive resolver) will respond to the client with either the requested resource record or an error message if the resolver can\u0026rsquo;t find the record. Iterative query - in this situation the DNS client will allow a DNS server to return the best answer it can. Non-recursive query: learn more: What is DNS? | How DNS works | Cloudflare # 3. DNS caching # 3.1. Browser DNS caching Modern web browsers are designed by default to cache DNS records for a set amount of time. The purpose here is obvious; the closer the DNS caching occurs to the web browser, the fewer processing steps must be taken in order to check the cache and make the correct requests to an IP address. When a request is made for a DNS record, the browser cache is the first location checked for the requested record.\nIn Chrome, you can see the status of your DNS cache by going to chrome://net-internals/#dns.\n# 3.2. Operating system (OS) level DNS caching The operating system level DNS resolver is the second and last local stop before a DNS query leaves your machine. The process inside your operating system that is designed to handle this query is commonly called a â€œstub resolverâ€ or DNS client. When a stub resolver gets a request from an application, it first checks its own cache to see if it has the record. If it does not, it then sends a DNS query (with a recursive flag set), outside the local network to a DNS recursive resolver inside the Internet service provider (ISP).\nWhen the recursive resolver inside the ISP receives a DNS query, like all previous steps, it will also check to see if the requested host-to-IP-address translation is already stored inside its local persistence layer.\nSource: What is DNS? | How DNS works | Cloudflare\nNote that checking /etc/hosts happens before DNS.\n# 3.3. Recursive resolver caching We have mentioned above, during DNS resolution process, the recursive resolver will cache information received from authoritative nameservers.\nA DNS resolver will save responses to IP address queries for a certain amount of time. In this way, the resolver can respond to future queries much more quickly, without needing to communicate with the many servers involved in the typical DNS resolution process.\n","date":"2023-10-31T09:50:20Z","permalink":"https://blog.yorforger.cc/p/dns-concepts-nameserverns-dns-records-and-caching/","title":"DNS Concepts (NameServer(NS), DNS Records and Caching)"},{"content":" # 1. Concepts Every device on a TCP/IP-based network must have a unique unicast IP address to access the network and its resources. Without DHCP, IP addresses for new computers or computers that are moved from one subnet to another must be configured manually; IP addresses for computers that are removed from the network must be manually reclaimed.\nWith DHCP, this entire process is automated and managed centrally. The DHCP server maintains a pool of IP addresses and leases an address to any DHCP-enabled client when it starts up on the network. Because the IP addresses are dynamic (leased) rather than static (permanently assigned), addresses no longer in use are automatically returned to the pool for reallocation.\nThe Dynamic Host Configuration Protocol (DHCP) is a network management protocol used on Internet Protocol (IP) networks for automatically assigning IP addresses and other communication parameters to devices connected to the network using a clientâ€“server architecture. Dynamic Host Configuration Protocol\n# 2. Process of DHCP DHCP Discover: When a computer (client) joins a network, it sends out a DHCP Discover message as a broadcast to discover DHCP servers available on the network. DHCP Offer: DHCP servers that receive the Discover message respond with a DHCP Offer message. This message contains configuration parameters, including IP address, subnet mask, default gateway, and DNS server addresses. DHCP Request: The computer selects one of the DHCP Offers and sends a DHCP Request message to the chosen DHCP server, indicating its acceptance of the offered configuration. DHCP Acknowledge: Upon receiving the DHCP Request, the DHCP server sends a DHCP Acknowledge message to the computer, confirming the lease of the offered configuration parameters. The computer now configures its network interface with the provided settings. # 3. DHCP discover message \u0026amp; DHCP offer message Learn more about these two messages\u0026rsquo; format: Dynamic Host Configuration Protocol\nReferences: Dynamic Host Configuration Protocol (DHCP) | Microsoft Learn\n","date":"2023-10-30T23:43:06Z","permalink":"https://blog.yorforger.cc/p/dhcp-basics/","title":"DHCP Basics"},{"content":" # 1. Man-in-the-middle attack Learn more:\nhttps://davidzhu.xyz/post/cs-basics/002-ssh/\nHTTPS SSL TLS - David\u0026rsquo;s Blog\n# 2. DDoS attack Learn more: DDoS Attack - David\u0026rsquo;s Blog\n# 3. CSRF attack Learn more: CSRF Attack and CORS - David\u0026rsquo;s Blog\n# 4. SSL stripping SSL stripping attacks, also known as SSL strip, SSL downgrade, or HTTP downgrade attacks, strip the encryption offered by HTTPS, reducing the connection to the less-secure HTTP.\nIn order to â€œstripâ€ the SSL, an attacker intervenes in the redirection of the HTTP to the secure HTTPS protocol and intercepts a request from the user to the server. The attacker will then continue to establish an HTTPS connection between himself and the server, and an unsecured HTTP connection with the user, acting as a â€œbridgeâ€ between them.\nHow can the SSL strip trick both the browser and the websiteâ€™s server? The SSL strip takes advantage of the way most users come to SSL websites. The majority of visitors connect to a websiteâ€™s page that redirects through a 302 redirect, or they arrive on an SSL page via a link from a non-SSL site. If the victim wants, for instance, to buy a product and types the URL www.buyme.com in the address bar, the browser connects to the attacker\u0026rsquo;s machine and waits for a response from the server. In an SSL strip, the attacker, in turn, forwards the victimâ€™s request to the online shopâ€™s server and receives the secure HTTPS payment page. For example https://www.buyme.com. At this point, the attacker has complete control over the secure payment page. He downgrades it from HTTPS to HTTP and sends it back to the victimâ€™s browser. The browser is now redirected to http://www.buyme.com. From now onward, all the victimâ€™s data will be transferred in plain text format, and the attacker will be able to intercept it. Meanwhile, the websiteâ€™s server will think that it has successfully established the secure connection, which indeed it hasâ€”but with the attackerâ€™s machine, not the victimâ€™s.\n# 4.1. Enable SSL sitewide at all websites To mitigate this threat, financial institutions and technology firms have already enabled HTTPS on a site-wide basis. Enabling HTTPS encrypts the connection between a browser and the website, thereby securing sensitive data transmissions. Therefore it makes perfect sense for banks and high-profile technology firms to enable HTTPS on their dynamic websites because of the transaction of important and sensitive information.\n# 4.2. Why enable HSTS? In addition to enabling HTTPS on a site-wide basis, corporations should weigh the benefits of enabling HSTS (HTTP Strict Transport Security), which is a web security policy mechanism that helps to protect websites against SSL stripping attacks and cookie hijacking. It allows web servers to declare that web browsers should interact with them using only secure HTTPS connections, and never via the insecure HTTP protocol.\nWhen a web application issues HSTS Policy to user browsers, conformant user browsers will automatically redirect any insecure HTTP requests to HTTPS for the target website. In addition, when a man-in-the-middle attacker attempts to intercept traffic from a victim using an invalid certificate, HSTS does not allow the user to override the invalid certificate warning message. By having a HSTS policy installed, it will be nearly impossible for the attackers to intercept any information at all!\nSource: What Are SSL Stripping Attacks? | Venafi\n# 5. DNS # 5.1. DNS hijacking To prevent DNS hijacking, first, you have to know the different kinds of attacks. DNS hijacking can take four different forms:\nLocal DNS hijacking: An attacker installs Trojan software on a user\u0026rsquo;s computer, then modifies the local DNS settings (cahnge its DNS server to a Rogue DNS server). DNS hijacking using a router: Many routers have weak firmware or use the default passwords they were shipped with. Attackers can take advantage of this to hack a router and change its DNS settings, which will affect everyone that uses that router. Man-in-the-middle (MITM) attacks: Attackers use man-in-the-middle attack techniques to intercept communications between users and a DNS server. They then direct the target to malicious websites. Learn more What Is DNS Hijacking? How to Detect \u0026amp; Prevent It | Fortinet\n# 5.2. DNS spoofing vs DNS (cache) poisoning DNS Poisoning:\nDefinition: The attacker inserts false address records into the DNS server\u0026rsquo;s cache, causing the server to return incorrect IP addresses for domain names. Target: The attack is on the DNS server. Example: If www.example.com is supposed to resolve to IP 1.2.3.4, in a DNS poisoning attack, the DNS server might be tricked into resolving it to 5.6.7.8. DNS Spoofing:\nDefinition: The attacker intercepts and responds to DNS requests with false information, usually before the legitimate response is received. Example: When a user tries to access www.example.com, an attacker might intercept this request and send a fake response directing the user to IP 5.6.7.8 instead of the real IP 1.2.3.4. Learn more: GFW and DNS Poisoning - David\u0026rsquo;s Blog\n# 5.3. Others DNS Poisoning vs DNS Spoofing:\nDNS Poisoning: Inject false DNS info to the real server\u0026rsquo;s cache. DNS Spoofing: Send false response back with a malicious DNS server. Purpose of MAC Address Spoofing:\nTo make a switch forward packets to an attacker\u0026rsquo;s device by mimicking a legitimate MAC address. Use of ICMP Redirects in Man-in-the-Middle Attacks:\nAn attacker sends forged \u0026ldquo;ICMP redirect messages\u0026rdquo; to mislead a host into changing its routing table, diverting traffic through the attacker\u0026rsquo;s machine. ","date":"2023-10-30T22:44:57Z","permalink":"https://blog.yorforger.cc/p/common-network-attacks/","title":"Common Network Attacks"},{"content":" # 1. Strict-Transport-Security Q: Disable HTTP access to the domain, donâ€™t even redirect or link it to SSL. Just inform the users this website is not accessible over HTTP and they have to access it over SSL.\nA: I can\u0026rsquo;t see any technical reason why HTTP needs to be completely blocked either, and many sites do forward HTTP to HTTPS. When doing this it is highly advisable to implement HTTP Strict Transport Security (HSTS) which is a web security mechanism which declares that browsers are to only use HTTPS connections.\nHSTS is implemented by specifying a response header such as Strict-Transport-Security: max-age=31536000. Complying user agents will automatically turn insecure links into secure links, thereby reducing the risk of man-in-the-middle attacks.\nSource: security - Is redirecting http to https a bad idea? - Stack Overflow\nLearn more: Common Network Attacks - David\u0026rsquo;s Blog\n# 2. keep-alive HTTP keep-alive, a.k.a., HTTP persistent connection, is an instruction that allows a single TCP connection to remain open for multiple HTTP requests/responses.\nBy default, HTTP connections close after each request. When someone visits your site, their browser needs to create new connections to request each of the files that make up your web pages (e.g. images, Javascript, and CSS stylesheets), a process that can lead to high page load times.\nEnabling the keep-alive header allows you to serve all web page resources over a single TCP connection. Keep-alive also reduces both CPU and memory usage on your server.\nLearn more: What is HTTP Keep Alive | Benefits of Connection Keep Alive | Imperva\n# 3. user-agent The User-Agent request header is a characteristic string that lets servers and network peers identify the application, operating system, vendor, and/or version of the requesting user agent.\n","date":"2023-10-30T22:06:07Z","permalink":"https://blog.yorforger.cc/p/http-headers-2/","title":"HTTP Headers (2)"},{"content":" # 1. Parse raw query string 1 2 3 4 5 6 7 8 9 10 func (s *server) ServeHTTP(w http.ResponseWriter, r *http.Request) { // handle asset. const assetPrefix = \u0026#34;asset=\u0026#34; if strings.HasPrefix(r.URL.RawQuery, assetPrefix) { r.URL.RawQuery[len(assetPrefix):] s.asset(w, r, assetName) return } ... } If there are whitespaces in query string, the whitespace will be encoded to %20 or + automatically, js code:\n1 2 3 4 5 6 async function getUrl(filepath) { const filename = \u0026#34;back ground.png\u0026#34; const url = \u0026#34;?asset=\u0026#34; + filename let response = await fetch(url) ... } The request URL will be: http://localhost:8080?filepath=back%20ground.png. Therefore, if you use r.URL.RawQuery in Go:\n1 2 log.Println(r.URL.RawQuery) log.Println(r.URL.Query()) This will print:\n1 2 2023/10/29 12:19:36 filepath=back%20ground.png 2023/10/29 12:19:36 map[filepath:[back ground.png]] As you can see, r.URL.RawQuery isn\u0026rsquo;t friendly to string with whitespace, you should try to use r.URL.Query() to emliminate the %20 characters.\nSo the recommended way is as below:\n1 2 3 4 5 6 7 8 9 10 11 func (s *server) ServeHTTP(w http.ResponseWriter, r *http.Request) { // handle asset. const assetPrefix = \u0026#34;asset=\u0026#34; if strings.HasPrefix(r.URL.RawQuery, assetPrefix) { // r.URL.Query() returns a map[string][]string assetName := r.URL.Query()[strings.TrimSuffix(assetPrefix, \u0026#34;=\u0026#34;)][0] s.asset(w, r, assetName) return } ... } # 2. r.URL.Path vs r.URL.RawPath 1 2 3 4 5 6 7 8 9 func main() { u, err := url.Parse(\u0026#34;http://example.com/x/xx%20a\u0026#34;) if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;Path:\u0026#34;, u.Path) fmt.Println(\u0026#34;RawPath:\u0026#34;, u.RawPath) fmt.Println(\u0026#34;EscapedPath:\u0026#34;, u.EscapedPath()) } 1 2 3 Path: /x/xx a RawPath: EscapedPath: /x/xx%20a If url changes to \u0026ldquo;http://example.com/x/xx%2Fa\", then will print:\n1 2 3 Path: /x/xx/a RawPath: /x/xx%2Fa EscapedPath: /x/xx%2Fa In general, code should call EscapedPath() instead of reading u.RawPath directly.\nLearn more:\nhttps://pkg.go.dev/net/url#URL.EscapedPath\nURL Encoding (Percent Encoding) - David\u0026rsquo;s Blog\n# 3. Relative path You can write relative path directly for the endpoint, because the browser know the Origin, when you make HTTP request, it knows where should go.\n1 2 3 \u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;/login\u0026#34;\u0026gt; ... \u0026lt;/form\u0026gt; And it\u0026rsquo;s ok to write relative path when redirect in Go code:\n1 2 // Redirect to login page. http.Redirect(w, r, \u0026#34;/login\u0026#34;, http.StatusFound) # 4. Redirection # 4.1. Redirect at front end For redirection, you can use js code to redirect based on the status code passed from server:\n1 2 3 4 5 6 7 8 9 10 11 const response = await fetch(\u0026#34;/login\u0026#34;, { method: \u0026#34;POST\u0026#34;, body: data, }) if (!response.ok) { ... return } // If login successfully, redirect to /home window.location = \u0026#34;/home\u0026#34; # 4.2. Redirect at server with Location header Learn more: HTTP Headers - David\u0026rsquo;s Blog\n# 4.3. Redirect at server with http.Redirect() method See above Relative path section.\n# 5. Parse form and query string 1 func (r *Request) ParseForm() error For all requests, ParseForm() parses the raw query from the URL and updates r.Form. For POST, PUT, and PATCH requests, it also reads the request body, parses it as a form and puts the results into both r.PostForm and r.Form. Request body parameters take precedence over URL query string values in r.Form. For other HTTP methods, or when the Content-Type is not application/x-www-form-urlencoded, the request Body is not read.\nTherefore, you can pass data in query string or in the request body. When you pass data with request body and the Content-Type header is application/x-www-form-urlencoded, it will be same to sending data with query stirng.\nThe Content-Type header can be application/json, application/x-www-form-urlencoded, multipart/form-data, learn more: Curl Basics - David\u0026rsquo;s Blog\nHow to send form data in application/x-www-form-urlencoded format: Tricks in Javascript - David\u0026rsquo;s Blog\nLearn more: http package - net/http - Go Packages\n# 6. Check the type of the request When You are starting a HTTP/s server You use either ListenAndServe or ListenAndServeTLS or both together on different ports. If You are using just one of them, then from Listen.. it\u0026rsquo;s obvious which scheme request is using and You don\u0026rsquo;t need a way to check and set it. But if You are serving on both HTTP and HTTP/s then You can use request.TLS state. if its nil it means it\u0026rsquo;s HTTP.\n1 2 3 4 5 6 7 8 // TLS allows HTTP servers and other software to record // information about the TLS connection on which the request // was received. This field is not filled in by ReadRequest. // The HTTP server in this package sets the field for // TLS-enabled connections before invoking a handler; // otherwise it leaves the field nil. // This field is ignored by the HTTP client. TLS *tls.ConnectionState an example:\n1 2 3 4 5 6 7 func index(w http.ResponseWriter, r *http.Request) { scheme := \u0026#34;http\u0026#34; if r.TLS != nil { scheme = \u0026#34;https\u0026#34; } w.Write([]byte(fmt.Sprintf(\u0026#34;%v://%v%v\u0026#34;, scheme, r.Host, r.RequestURI))) } Source: https://stackoverflow.com/a/76143800/16317008\n# 7. Receive file from http request # 7.1. Issue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 func (s *server) handleUpload(w http.ResponseWriter, r *http.Request, currentDir string) (error, int) { maxFileSize := int64(s.maxFileSize * 1024 * 1024) // limit the size of incoming request bodies. r.Body = http.MaxBytesReader(w, r.Body, maxFileSize) // parse form from request body. // !!!This will load the file into RAM if err := r.ParseMultipartForm(maxFileSize); err != nil { return fmt.Errorf(\u0026#34;file is too large:%v\u0026#34;, err), http.StatusBadRequest } // obtain file from parsed form. parsedFile, parsedFileHeader, err := r.FormFile(\u0026#34;file\u0026#34;) if errors.Is(err, http.ErrMissingFile) { w.Header().Set(\u0026#34;Location\u0026#34;, r.URL.String()) } if err != nil { return err, http.StatusSeeOther } defer parsedFile.Close() dstPath := filepath.Join(currentDir, filepath.Base(parsedFileHeader.Filename)) var dst *os.File _, err = os.Stat(dstPath) // the name of parsed file already exists, create a dst file with a new name. if err == nil { filename := strings.Split(parsedFileHeader.Filename, \u0026#34;.\u0026#34;)[0] + \u0026#34;_\u0026#34; + strconv.FormatInt(time.Now().UnixNano(), 10) + filepath.Ext(parsedFileHeader.Filename) dst, err = os.Create(filepath.Join(currentDir, filename)) } else if os.IsNotExist(err) { // the name of parsed file already exists, create a dst file with original name. dst, err = os.Create(dstPath) } if err != nil { return fmt.Errorf(\u0026#34;failed to create file: %v\u0026#34;, err), http.StatusInternalServerError } defer dst.Close() _, err = io.Copy(dst, parsedFile) if err != nil { return fmt.Errorf(\u0026#34;failed to copy file: %v\u0026#34;, err), http.StatusInternalServerError } // considering the buffering mechanism, getting error when close a writable file is needed. if err = dst.Close(); err != nil { return fmt.Errorf(\u0026#34;failed to close dst fileHtml: %v\u0026#34;, err), http.StatusInternalServerError } // clean url and redirect r.URL.RawQuery = \u0026#34;\u0026#34; w.Header().Set(\u0026#34;Location\u0026#34;, r.URL.String()) w.WriteHeader(http.StatusSeeOther) return nil, http.StatusSeeOther } http.MaxBytesReader(): Doesn\u0026rsquo;t load any data, it just wraps the request body with a http.maxBytesReader, learn more: IO in Golang - David\u0026rsquo;s Blog\nUsage of r.ParseMultipartForm(maxFileSize): This is where the actual parsing of data (request body) occurs. The whole request body is parsed and up to a total of maxMemory bytes of its file parts are stored in memory, with the remainder stored on disk in temporary files. This will cause a spike in the usage of RAM, because it doesn\u0026rsquo;t stream the data, it loads maxMemory bytes of data into memory, and the rest of data into disk one time. Learn more: IO in Golang - David\u0026rsquo;s Blog\nReading and Writing the File: The file is read from the form data and written to the destination path. The io.Copy function used here is efficient as it streams the data to dst file.\n# 7.2. Solution 1 func (r *Request) MultipartReader() (*multipart.Reader, error) MultipartReader returns a MIME multipart reader if this is a multipart/form-data or a multipart/mixed POST request, else returns nil and an error. Use this function instead of ParseMultipartForm to process the request body as a stream.\nNote: When use MultipartReader(), you cannot use http.MaxBytesReader() to limit the size of incoming request bodies as what we did with ParseMultipartForm(). Because r.ParseMultipartForm() will return an error if the request body is larger than maxMemory, which MultipartReader() doesn\u0026rsquo;t. If you try use http.MaxBytesReader() with MultipartReader(), when the request body exceeds the specified max size, part, err := reader.NextPart() will return an error:\n1 err.Error(): multipart: NextPart: http: request body too large You can do something like this:\n1 2 3 4 5 6 7 8 9 10 11 reader, err := r.MultipartReader() ... for { part, err := reader.NextPart() if err != nil { if err.Error() == \u0026#34;multipart: NextPart: http: request body too large\u0026#34; { ... } ... } } ","date":"2023-10-29T11:30:50Z","permalink":"https://blog.yorforger.cc/p/some-http-issues-with-go/","title":"Some HTTP Issues with Go"},{"content":" # 1. Delay function 1 2 3 4 5 function delay(minutes) { return new Promise(resolve =\u0026gt; setTimeout(resolve, minutes * 1000 * 60)); } // await delay(2) # 2. Click copy 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;p id=\u0026#34;url-text\u0026#34; style=\u0026#34;display: none\u0026#34;\u0026gt;{{.SharedUrl}}\u0026lt;/p\u0026gt; \u0026lt;button onclick=\u0026#34;copyText()\u0026#34;\u0026gt;share\u0026lt;/button\u0026gt; \u0026lt;script\u0026gt; function copyText() { const copyText = document.getElementById(\u0026#34;url-text\u0026#34;); navigator.clipboard.writeText(copyText.textContent) .then(() =\u0026gt; { alert(\u0026#34;successfully copied\u0026#34;); }) .catch(() =\u0026gt; { alert(\u0026#34;something went wrong\u0026#34;); }); } \u0026lt;/script\u0026gt; # 3. Relative path You can write relative path directly for the endpoint, because the browser know the Origin, when you make HTTP request, it knows where should go.\n1 2 3 \u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;/login\u0026#34;\u0026gt; ... \u0026lt;/form\u0026gt; And it\u0026rsquo;s ok to write relative path when redirect in Go code:\n1 2 // Redirect to login page. http.Redirect(w, r, \u0026#34;/login\u0026#34;, http.StatusFound) # 4. Send username and password form If you have a login page with user name and password, do not tell users that they entered a wrong password. Tell them that they entered wrong credentials. You donâ€™t want to give hackers a way to know if a user name is right or wrong. source\nTraditional way to submit a form:\n1 2 3 4 5 \u0026lt;form action=\u0026#34;/login\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;name\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;psaaword\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Submit\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; The form data will be sent to /login endpoint of the server automatically. After check the input, you may make ajax with fetch() to send form data:\n1 2 3 4 5 6 7 let data = new FormData(document.getElementById(\u0026#34;login-form\u0026#34;)) ... let response = await fetch(\u0026#34;/login\u0026#34;, { method: \u0026#34;POST\u0026#34;, headers:{\u0026#34;Content-Type\u0026#34;:\u0026#34;application/x-www-form-urlencoded\u0026#34;}, body: data, }) Then the actual request body sent by browser will be:\n1 2 3 4 5 6 7 8 \u0026#34;username\u0026#34; david ------WebKitFormBoundaryGx7UioRfdfhdT5U5 Content-Disposition: form-data; name=\u0026#34;password\u0026#34; 778899sS ------WebKitFormBoundaryGx7UioRfdfhdT5U5-- This is not correct and you will get error at the server, the suggestion to get a correct request body is to not set header explictly:\n1 2 3 4 5 let response = await fetch(\u0026#34;/login\u0026#34;, { method: \u0026#34;POST\u0026#34;, //headers:{\u0026#34;Content-Type\u0026#34;:\u0026#34;application/x-www-form-urlencoded\u0026#34;}, body: data, }) Then the correct form data will be sent:\n1 2 username: david password: 778899s Note: if you don\u0026rsquo;t set Content-Type header explicitly, the browser will set Content-Type header to multipart/form-data automatically.\n# 4.1. Special situation in Go If your server written in Go, you may parse the form like this:\n1 2 3 4 5 6 if e := r.ParseForm(); err != nil { err = fmt.Errorf(\u0026#34;failed to parse username and password: %v\u0026#34;, e) return } username = r.Form.Get(\u0026#34;username\u0026#34;) password = r.Form.Get(\u0026#34;password\u0026#34;) According to Golang docs for ParseForm() :\nFor other HTTP methods, or when the Content-Type is not application/x-www-form-urlencoded, the request Body is not read.\nTherefore, ParseForm() method will ignore the request body, which means you cannot get the username and password. The URLSearchParams() in JS can help:\n1 2 3 4 5 6 7 8 9 const data = new URLSearchParams() for (const pair of new FormData(document.getElementById(\u0026#34;login-form\u0026#34;))) { data.append(pair[0], String(pair[1])) } let response = await fetch(\u0026#34;/login\u0026#34;, { method: \u0026#34;POST\u0026#34;, //headers:{\u0026#34;Content-Type\u0026#34;:\u0026#34;application/x-www-form-urlencoded\u0026#34;}, body: data, }) I find this solution on an answer at Stackoverflow, the problem caused by new FormData():\nThe FormData interface provides a way to easily construct a set of key/value pairs representing form fields and their values, which can then be easily sent using the XMLHttpRequest.send() method. It uses the same format a form would use if the encoding type were set to \u0026quot;multipart/form-data\u0026quot;.\nSo when using FormData you are locking yourself into multipart/form-data. There is no way to send a FormData object as the body and not sending data in the multipart/form-data format.\nIf you want to send the data as application/x-www-form-urlencoded you will either have to specify the body as an URL-encoded string, or pass a URLSearchParams object.\n","date":"2023-10-28T22:54:02Z","permalink":"https://blog.yorforger.cc/p/tricks-in-javascript/","title":"Tricks in Javascript"},{"content":" # 2xx 200 OK: Request is okay, entity body contains requested resource. 201 Created: For requests that create server objects (e.g., PUT). The entity body of the response should contain the various URLs for referencing the created resource, with the Location header containing the most specific reference. The server must have created the object prior to sending this status code. # Redirect # 301: permanent redirect: å¯èƒ½ä¼šä¿®æ”¹è¯·æ±‚æ–¹æ³• The HyperText Transfer Protocol (HTTP) 301 Moved Permanently redirect status response code indicates that the requested resource has been definitively moved to the URL given by the Location headers. A browser redirects to the new URL and search engines update their links to the resource. æ ¹æ®æè¿°å¯ä»¥çœ‹å‡º, 301 æ˜¯ç”¨æ¥å›å¤ GET è¯·æ±‚çš„, ä¸ä¸‹é¢ 303 åˆšå¥½ç›¸å\nAlthough the specification requires the method and the body to remain unchanged when the redirection is performed, not all user-agents meet this requirement. Use the 301 code only as a response for GET or HEAD methods and use the 308 Permanent Redirect for POST methods instead, as the method change is explicitly prohibited with this status. 301 Moved Permanently - HTTP | MDN\nè¿™æ®µè¯æŒ‡çš„æ˜¯åœ¨å¤„ç† HTTP é‡å®šå‘æ—¶ï¼Œä¸åŒçš„çŠ¶æ€ç ä¼šå¯¹æµè§ˆå™¨æˆ–ç”¨æˆ·ä»£ç†ï¼ˆå¦‚ Web æµè§ˆå™¨ï¼‰çš„è¡Œä¸ºæœ‰ä¸åŒçš„æŒ‡ç¤ºï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç† HTTP æ–¹æ³•ï¼ˆå¦‚ GET, POST, HEAD ç­‰ï¼‰å’Œè¯·æ±‚ä½“çš„ä¿ç•™æ–¹é¢ã€‚\nåœºæ™¯: å‡è®¾ä½ æœ‰ä¸€ä¸ªè¡¨å•æäº¤åˆ° URL http://example.com/formï¼Œä½¿ç”¨ POST æ–¹æ³•ã€‚ç”±äºæŸäº›åŸå› ï¼Œè¿™ä¸ªè¡¨å•å¤„ç†çš„ URL æ°¸ä¹…å˜æ›´åˆ°äº† http://example.com/new-formã€‚\nå¸¸è§„åšæ³•: ä½¿ç”¨ 301 çŠ¶æ€ç æ¥é‡å®šå‘åˆ°æ–°çš„ URLã€‚ä½†æ˜¯ï¼Œæ ¹æ® HTTP/1.0 æ ‡å‡†ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç”¨æˆ·ä»£ç†ï¼ˆç‰¹åˆ«æ˜¯æ—§çš„æµè§ˆå™¨æˆ–ä¸å®Œå…¨éµå¾ªæ ‡å‡†çš„å®¢æˆ·ç«¯ï¼‰åœ¨é‡å®šå‘æ—¶å°† POST è¯·æ±‚æ”¹å˜ä¸º GET è¯·æ±‚ï¼Œè¿™å¯èƒ½ä¸æ˜¯é¢„æœŸçš„è¡Œä¸ºã€‚\nåœºæ™¯: åŒæ ·çš„æƒ…å†µï¼Œè¡¨å•ä» http://example.com/form ç§»åŠ¨åˆ° http://example.com/new-formã€‚\næ›´å®‰å…¨çš„åšæ³•: ä½¿ç”¨ 308 Permanent Redirectã€‚è¿™ä¸ªçŠ¶æ€ç æ˜ç¡®ç¦æ­¢åœ¨é‡å®šå‘è¿‡ç¨‹ä¸­æ”¹å˜è¯·æ±‚æ–¹æ³•ã€‚å› æ­¤ï¼Œå¦‚æœåŸå§‹è¯·æ±‚æ˜¯ POSTï¼Œé‡å®šå‘åçš„è¯·æ±‚ä¹Ÿå¿…é¡»æ˜¯ POSTã€‚è¿™æ ·å¯ä»¥ç¡®ä¿é‡å®šå‘è¡Œä¸ºçš„ä¸€è‡´æ€§å’Œé¢„æœŸæ€§ï¼Œä¸ç®¡ç”¨æˆ·ä»£ç†æ˜¯ä»€ä¹ˆã€‚\n# 303: temporary redirect: ä¿®æ”¹è¯·æ±‚æ–¹æ³•ä¸º GET 303: Seee Other, çœ‹åå­—å°±å¯ä»¥çŸ¥é“æ˜¯ 303 æ˜¯å‘Šè¯‰æµè§ˆå™¨å»å¦ä¸€ä¸ªé¡µé¢, æ³¨æ„æ˜¯ä¸€ä¸ªé¡µé¢, æ‰€ä»¥æµè§ˆå™¨æ”¶åˆ° 303 è¯·æ±‚å, ä¼šç”¨ GET è¯·æ±‚æ¥è®¿é—®é‡å®šå‘çš„ URL, å³ä½¿ä¹‹å‰çš„è¯·æ±‚æ˜¯ POST è¯·æ±‚. è¿™ä¸ªçŠ¶æ€ç ç»å¸¸æ˜¯ç”¨æ¥åšè¡¨å•æäº¤åçš„é‡å®šå‘, å³ç”¨æ¥å›å¤ POST å’Œ PUT è¯·æ±‚. The HyperText Transfer Protocol (HTTP) 303 See Other redirect status response code indicates that the redirects don\u0026rsquo;t link to the requested resource itself, but to another page (such as a confirmation page, a representation of a real-world object). This response code is often sent back as a result of PUT or POST. The method used to display this redirected page is always GET. 303 See Other - HTTP | MDN # 307: temporary redirect: ä¸ä¼šä¿®æ”¹è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚ä½“ The method and the body of the original request are reused to perform the redirected request.\nIn the cases where you want the method used to be changed to GET, use 303 See Other instead. This is useful when you want to give an answer to a PUT method that is not the uploaded resources, but a confirmation message (like \u0026ldquo;You successfully uploaded XYZ\u0026rdquo;).\nThe only difference between 307 and 302 is that 307 guarantees that the method and the body will not be changed when the redirected request is made. With 302, some old clients were incorrectly changing the method to GET: the behavior with non-GET methods and 302 is then unpredictable on the Web, whereas the behavior with 307 is predictable. For GET requests, their behavior is identical.\nLearn more: 307 Temporary Redirect - HTTP | MDN\n# 308: permanent redirect, ä¸ä¿®æ”¹è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚ä½“ The request method and the body will not be altered, whereas 301 may incorrectly sometimes be changed to a GET method.\nLearn more: 308 Permanent Redirect - HTTP | MDN\n# Redirect Code mistakes Different redirect status code can cause browser behave differently.\nAn unauthorized user make a request to /home which needs authorized state to access, he will be redirect to /login, if server respond 308, then the unauthorized user will be redirect to /login, this woks fine. But 308 tell the brower all following http requests for /home need be redirected to /login even the user login successfully, you can clear the browser cache to reset, make sure don\u0026rsquo;t repond a wrong status code.\n","date":"2023-10-26T15:30:05Z","permalink":"https://blog.yorforger.cc/p/http-status-codes/","title":"HTTP Status Codes"},{"content":" # 0. Header types Headers can be grouped according to their contexts:\nRequest headers contain more information about the resource to be fetched, or about the client requesting the resource. Response headers hold additional information about the response, like its location or about the server providing it. Representation headers contain information about the body of the resource, like its MIME type, or encoding/compression applied. Payload headers contain representation-independent information about payload data, including content length and the encoding used for transport. Learn more: HTTP headers - HTTP | MDN\n# 1. Content-Type Common values of Content-Type header can be application/json, application/x-www-form-urlencoded, multipart/form-data, the first two is usually used with posting form data to server, the third is used to upload file to the server.\napplication/x-www-form-urlencoded: the keys and values are encoded in key-value tuples separated by '\u0026amp;', with a '=' between the key and the value. The format of application/x-www-form-urlencoded is \u0026quot;username=davidzhu\u0026amp;password=778899a\u0026quot; . The format of application/json is '{\u0026quot;username\u0026quot;:\u0026quot;davidzhu\u0026quot;, \u0026quot;password\u0026quot;:\u0026quot;778899a\u0026quot;}'. multipart/form-data: each value is sent as a block of data (\u0026ldquo;body part\u0026rdquo;), with a user agent-defined delimiter (\u0026ldquo;boundary\u0026rdquo;) separating each part. The keys are given in the Content-Disposition header of each part. text/plain HTML provides no way to generate JSON from form data, learn more: Form Data \u0026amp; Query String - David\u0026rsquo;s Blog\n# 2. Access-Control-Allow-Origin Access-Control-Allow-Origin header allows servers to specify which origins are allowed to access their resources, even if they are from different origins.\nLearn more: Cross-origin Request HTTP - David\u0026rsquo;s Blog\n# 3. Location The Location response header indicates the URL to redirect a page to. It only provides a meaning when served with a 3xx (redirection) or 201 (created) status response.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func (s *server) handleMkdir(w http.ResponseWriter, r *http.Request, currentPath string) error { // Parse form. if err := r.ParseForm(); err != nil { err = fmt.Errorf(\u0026#34;failed to parse folder name: %v\u0026#34;, err) return err } ... // clean url and redirect r.URL.RawQuery = \u0026#34;\u0026#34; w.Header().Set(\u0026#34;Location\u0026#34;, r.URL.String()) w.WriteHeader(http.StatusSeeOther) return nil } Note that Location is a response header.\nAjax call in js doesn\u0026rsquo;t need redirection to go back to the current page.\nStatus code 303: HTTP Status Codes - David\u0026rsquo;s Blog\n# 4. Cache-Control cache-control: no-cache: This directive means that cached versions of the requested resource cannot be used without first checking to see if there is an updated version. max-age=0 is a workaround for no-cache , because many old (HTTP/1.0) cache implementations don\u0026rsquo;t support no-cache.\ncache-control: private: A response with a private directive can only be cached by the client and never by an intermediary agent, such as a CDN or a proxy. These are often resources containing private data, such as a website displaying a userâ€™s personal information.\ncache-control: public: Conversely, the public directive means the requested resource can be stored by any cache.\nWhen we access a web page, there may have multiple http requests being made, such as favicon.ico, xxx.js, xxx.json, xxx.png, for each of these resources there is a http request needed to be sent, and indeed there is a corresponding http response. These resourses are called the requested resources above we mentioned. So each of the repsonse have their own http headers:\nBrowser caching is a great way to both preserve resources and improve user experience on the Internet, but without cache-control, it would be very brittle. Every resource on every site would be bound by the same caching rules, meaning that sensitive information would be cached the same way as public information, and frequently-updated resources would be cached for the same amount of time as ones that rarely change.\nThe code below is written in Go which responsible for handle assets request from client, favicon.ico for example.\n1 2 3 4 5 func RenderAsset(w http.ResponseWriter, r *http.Request, assetPath string) { header := w.Header() header.Set(\u0026#34;Cache-Control\u0026#34;, \u0026#34;public, max-age=0\u0026#34;) http.ServeFile(w, r, filename) } Browser caching is when a web browser saves website resources so it doesnâ€™t have to fetch them again from a server. For example, a background image on a website might be saved locally in cache so that when a user visits that page for the second time, the image will load from the userâ€™s local files and the page will load much faster.\nCookies are HTTP Headers. The header is called Cookie:, and it contains your cookie.\nLearn more: What is cache-control? | Cache explained | Cloudflare\n# 5. Authorization \u0026amp; WWW-Authenticate HTTP supports the use of several authentication mechanisms to control access to pages and other resources. These mechanisms are all based around the use of the 401 status code and the WWW-Authenticate response header.\nThe most widely used HTTP authentication mechanisms are:\nBasic: the client sends the user name and password as unencrypted base64 encoded text. It should only be used with HTTPS, as the password can be easily captured and reused over HTTP.\nDigest: the client sends a hashed form of the password to the server. Although, the password cannot be captured over HTTP, it may be possible to replay requests using the hashed password.\nNTLM: this uses a secure challenge/response mechanism that prevents password capture or replay attacks over HTTP. However, the authentication is per connection and will only work with HTTP/1.1 persistent connections. For this reason, it may not work through all HTTP proxies and can introduce large numbers of network roundtrips if connections are regularly closed by the web server.\nIn this section, we will just discuss the Basic authentication mechanism:\nIf an HTTP receives an anonymous request for a protected resource it can force the use of Basic authentication by rejecting the request with a 401 (Access Denied) status code and setting the WWW-Authenticate response header as shown below:\n1 2 3 HTTP/1.1 401 Access Denied WWW-Authenticate: Basic realm=\u0026#34;My Server\u0026#34; Content-Length: 0 The word Basic in the WWW-Authenticate selects the authentication mechanism that the HTTP client must use to access the resource. The realm string can be set to any value to identify the secure area and may used by HTTP clients to manage passwords. Most web browsers will display a login dialog when this response is received, allowing the user to enter a username and password. This information is then used to retry the request with an Authorization request header:\n1 2 3 GET /securefiles/ HTTP/1.1 Host: www.httpwatch.com Authorization: Basic aHR0cHdhdGNoOmY= The Authorization specifies the authentication mechanism (in this case Basic) followed by the username and password. Although, the string aHR0cHdhdGNoOmY= may look encrypted it is simply a base64 encoded version of :. In this example, the un-encoded string \u0026ldquo;httpwatch:foo\u0026rdquo; was used and would be readily available to anyone who could intercept the HTTP request.\nThe HTTP Authorization request header can be used to provide credentials that authenticate a user agent with a server, allowing access to a protected resource.\nThe HTTP WWW-Authenticate response header defines the HTTP authentication methods (\u0026ldquo;challenges\u0026rdquo;) that might be used to gain access to a specific resource.\nLearn more: http://www.httpwatch.com/httpgallery/authentication/\nThe Authorization header is usually, but not always, sent after the user agent first attempts to request a protected resource without credentials. The server responds with a 401 Unauthorized message that includes at least one WWW-Authenticate header. This header indicates what authentication schemes can be used to access the resource (and any additional information needed by the client to use them).\nWarning: The \u0026ldquo;Basic\u0026rdquo; authentication scheme used in the diagram above sends the credentials encoded but not encrypted. This would be completely insecure unless the exchange was over a secure connection (HTTPS/TLS).\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func(w http.ResponseWriter, r *http.Request) { username, password, ok := r.BasicAuth() if ok { usernameMatch := subtle.ConstantTimeCompare(usernameHash[:], expectedUsernameHash[:]) == 1 passwordMatch := subtle.ConstantTimeCompare(passwordHash[:], expectedPasswordHash[:]) == 1 if usernameMatch \u0026amp;\u0026amp; passwordMatch { ... return } } w.Header().Set(\u0026#34;WWW-Authenticate\u0026#34;, `Basic realm=\u0026#34;restricted\u0026#34;, charset=\u0026#34;UTF-8\u0026#34;`) http.Error(w, \u0026#34;Unauthorized\u0026#34;, http.StatusUnauthorized) } Basic realm=\u0026quot;restricted\u0026quot;, what does this mean?\nIn short, endpoints in the same realm should share credentials. If your credentials work for a endpoint with the realm \u0026quot;restricted\u0026quot;, it should be assumed that the same username and password combination should work for another endpoint with the same realm.\nHow to group pages (endpoints) with realm?\nrealm value doesn\u0026rsquo;t have magic, you still need apply the auth middleware for each endpoint at server side. But different value of realm will instruct browser use different credentials (username, password) for the different request url automatically. The concept of realms in the context of authentication is primarily used to instruct the client (typically a web browser) to send different credentials for different request URLs automatically. The server-side implementation still requires applying the authentication middleware to each endpoint.\nCode credit to: Go BasicAuth\nHTTP authentication framework: HTTP authentication - HTTP | MDN\nLearn more: Authorization - HTTP | MDN\n# 6. cookie There are two headers related to cookie, one is Set-Cookie header another is Cookie header.\nAfter receiving an HTTP request, a server can send one or more Set-Cookie headers with the response. The browser usually stores the cookie and sends it with requests made to the same server inside a Cookie HTTP header.\nFor example, a response from server contains cookie headers may looks like this:\n1 2 3 4 5 6 HTTP/2.0 200 OK Content-Type: text/html Set-Cookie: yummy_cookie=choco Set-Cookie: tasty_cookie=strawberry [page content] A HTTP request may looks like this below:\n1 2 3 GET /sample_page.html HTTP/2.0 Host: www.example.org Cookie: yummy_cookie=choco; tasty_cookie=strawberry Therefore, when I want set cookie manually for my http request, I\u0026rsquo;ll probably do something like this (I do this in Go):\n1 2 3 4 5 6 req, _ := http.NewRequest(http.MethodPost, \u0026#34;/chat\u0026#34;, your_encoded_message) // set content-type header req.Header.Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/x-www-form-urlencoded\u0026#34;) // set cookie header (cookie is a key value data) req.Header.Set(\u0026#34;Cookie\u0026#34;, \u0026#34;session_id=xxxxxxxxxxx\u0026#34;) ... If I want get cookie from repsonse, I\u0026rsquo;ll probably retrieve the cookie like this:\n1 2 response := makeRequest(...) my_cooke := response.Header().Get(\u0026#34;Set-Cookie\u0026#34;) Cookie is just a header which having no doubt resides in the header of HTTP mesages, don\u0026rsquo;t overthinking.\nReference: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#creating_cookies\n","date":"2023-10-26T09:58:10Z","permalink":"https://blog.yorforger.cc/p/http-headers-1/","title":"HTTP Headers (1)"},{"content":"I choose a sqilte3 library which uses cgo, the Dockerfile:\n1 2 3 4 5 6 7 8 FROM golang:alpine WORKDIR /app COPY ./ ./ RUN go mod download RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o /server . CMD [\u0026#34;./server\u0026#34;] The CGO_ENABLED=0 is to disable cgo. GOOS=linux and GOARCH=amd64 is used for cross compilation in Go. Because I build this on my macOS arm64 machine, and I want build for Ubuntu amd64 machine, so I choose GOOS=linux GOARCH=amd64.\nLearn more:\nStatic Linking Go Programs - David\u0026rsquo;s Blog\nCross Compilation - Go - David\u0026rsquo;s Blog\nAfter build successfully and run image:\n1 2 3 $ docker run -p 80:80 shwezhu/file-station:v1 2023/10/10 02:15:15 /app/main.go:12 [error] failed to initialize database, got error Binary was compiled with \u0026#39;CGO_ENABLED=0\u0026#39;, go-sqlite3 requires cgo to work. This is a stub As you can see, apparently I will get an error, because my Go code use the go-sqlite3 package which implemented by pure cgo, if I disable cgo with CGO_ENABLED=0, this will wrong. Then I change the dockerfile to:\n1 2 3 4 5 6 ... # Install gcc to compile cgo RUN apk add --no-cache --update go gcc g++ RUN go build -o /server . CMD [\u0026#34;./server\u0026#34;] And build image with command:\n1 $ docker build -t shwezhu/file-station:v2 . There is an error when run the image on EC2 server:\n1 2 $ docker run -p 80:80 shwezhu/file-station:v1 WARNING: The requested image\u0026#39;s platform (linux/arm64) does not match the detected host platform (linux/amd64) and no specific platform was requested Because my local machine is arm64, which means the image will be built to arm64 by default, but my EC2 server is linux/amd64, so there is an error occurred. With --platform, you can specify the platform this image built for:\n1 $ docker build --platform linux/amd64 -t shwezhu/file-station:v2 . Go is a statically compiled language. To execute a Go binary on a machine, it must be compiled for the matching operating system and processor architecture. So there is cross-compilation in Go. --platform is used to build multi-platform docker images, not build Go for another platform. You should know the difference between these concepts.\n","date":"2023-10-21T10:24:22Z","permalink":"https://blog.yorforger.cc/p/cgo-compile-error-building-docker-image/","title":"CGO Compile Error Building Docker Image"},{"content":" # 1. ISO the International Organization for Standardization To clarify the relationship between ISO, standards and the standard library, ISO publishes standards, which essentially become the standard library. ISO discusses and develops language standards every year, resulting in standards for languages like C99 and C11. These standards primarily cover two main aspects: the functionality of the language itself and the standard library associated with that language. However, it\u0026rsquo;s important to note that these standards are essentially specifications. The actual implementations of these standards are carried out by other entities; for instance, glibc and MSVCRT are implementations of the C standard library.\nFor example, the outcome of their discussions in 1999 is the C99 standard, formally known as ISO/IEC 9899:1999(E) \u0026ndash; Programming Languages \u0026ndash; C, The C99 standard comprises two main parts:\nthe C/C++ features and functionalities;\nthe C/C++ API â€” a collection of classes, functions and macros that developers use in their C/C++ programs. It is called the Standard Library.\nNo implementation, just a specifications.\n# 2. Implementation of standard library There are functions for memory allocation, creating threads, and input/output operations (such as those in stdio.h) in C language. All of these functions rely on system calls. Therefore, when third-party manufacturers implement the standard library of C language, they must create different versions for the different OS because each OS has its own set of system calls.\n# 2.1. glibc - the linux implementation The GNU C Library and glibc are synonyms, which are the runtime library/standard library for the C programming language.\nIt\u0026rsquo;s important to clarify that the runtime library includes both static and dynamic libraries. The term \u0026ldquo;runtime library\u0026rdquo; is used for a general term.\nThe term library (runtime library) and header are not same. Library are the implementations of the header, which exist as binary files (the static library .a/.lib or the dynamic library .so/.dll ), whereas headers are .h files.\nTherefore, we usually cannot find the source code of the implementation of C standard library, such as function printf(), the implementation of these functions are provided as compiled binary files. But you can find the glibc\u0026rsquo;s implementation of printf() on the internet, because glibc is open source.\nThe printf() function is part of the C Standard Library and is typically provided by the GNU C Library (glibc) on Linux systems. The implementation of printf() in glibc is open source and can be found in the glibc source code.\nprintf() is part of C standard library, which is called \u0026ldquo;standard\u0026rdquo; because it is linked by default by C compiler. Standard library is typically provided by operating system or compiler. On most linux systems, it is located in libc.so, whereas on MS Windows C Library is provided by Visual C runtime file msvcrt.dll.\nhttps://stackoverflow.com/a/37154724/16317008\nLearn more: The GNU C Library\n# 2.2. Mac and iOS Implementation On Mac and iOS the C Standard Library implementation is part of libSystem, a core library located in /usr/lib/libSystem.dylib. LibSystem includes other components such as the math library, the thread library and other low-level utilities.\nC header file on MacOS: /Library/Developer/CommandLineTools/SDKs/MacOSX12.3.sdk/usr/include\nLearn more: https://www.internalpointers.com/post/c-c-standard-library\n# 2.3. Windows Implementation On Windows the implementation of the Standard Libraries has always been strictly bound to Visual Studio, the official Microsoft compiler. They use to call it C/C++ Run-time Library (CRT) and it covers both implementations.\nLearn more: https://www.internalpointers.com/post/c-c-standard-library\n# 3. glibc vs libc As of today glibc is the most widely used C library on Linux. However, during the â€˜90s there was for a while a glibc competitor called Linux libc (or just libc), born from a fork of glibc 1.x. For a while, Linux libc was the standard C library in many Linux distributions.\nAfter years of development, glibc turned out to be way superior to Linux libc and all Linux distributions that had been using it switched back to glibc. So don\u0026rsquo;t worry if you find a file in your disk named libc.so.6: it\u0026rsquo;s the modern glibc. The version number got incremented to 6 in order to avoid any confusion with the previous Linux libc versions (they couldn\u0026rsquo;t name it glibc.so.6: all Linux libraries must start with the lib prefix).\n1 2 3 4 $ ls /usr/lib/x86_64-linux-gnu | grep libc libc.a libc.so libc.so.6 Learn more: https://www.internalpointers.com/post/c-c-standard-library\n# 4. glibc vs gcc A few things:\ngcc and glibc are two different things. gcc is the compiler, glibc are the runtime libraries. Pretty much everything needs glibc to run. .a files are static libraries, .so means shared object and is the Linux equivalent of a DLL Most things DON\u0026rsquo;T link against libc.a, they link against libc.so Hope that clears it up for you. As for the location, it\u0026rsquo;s almost certainly going to be in /usr/lib/libc.a and / or /usr/lib/libc.so.\nSource: https://stackoverflow.com/a/5925691/16317008\n# 5. Location of the implementation of library If you are looking for libc.a:\n1 2 3 4 5 $ gcc --print-file-name=libc.a /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/libc.a $ gcc --print-file-name=libc.so /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/libc.so Source: https://stackoverflow.com/a/36103882/16317008\n# 6. libc.a va libc.so The size of libc.a is 5.8 MB which is huge for codes, libc.a is a static library, also known as a \u0026ldquo;archive\u0026rdquo; library, It contains compiled object code that gets linked into the final executable at compile time.\n1 2 $ ls -lh /usr/lib/x86_64-linux-gnu/libc.a -rw-r--r-- 1 root root 5.8M Sep 25 14:45 /usr/lib/x86_64-linux-gnu/libc.a 1 2 3 4 5 6 # Don\u0026#39;t archive libc.a directly, archive it on a different folder $ ar -x libc.a $ ls | grep printf printf.o sprintf.o ... ä¸ºä»€ä¹ˆé™æ€è¿è¡Œåº“é‡Œé¢ä¸€ä¸ªç›®æ ‡æ–‡ä»¶åªåŒ…å«ä¸€ä¸ªå‡½æ•°ï¼Ÿæ¯”å¦‚libc.aé‡Œé¢printf.oåªæœ‰printf()å‡½æ•°ã€strlen.oåªæœ‰strlen()å‡½æ•°ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·ç»„ç»‡ï¼Ÿ\né“¾æ¥å™¨åœ¨é“¾æ¥é™æ€åº“çš„æ—¶å€™æ˜¯ä»¥ç›®æ ‡æ–‡ä»¶ä¸ºå•ä½çš„, æ¯”å¦‚æˆ‘ä»¬å¼•ç”¨äº†printf()`å‡½æ•°, å¦‚æœè¿›è¡Œé™æ€é“¾æ¥çš„è¯, é‚£ä¹ˆé“¾æ¥å™¨å°±åªä¼šæŠŠåº“ä¸­åŒ…å«printf()å‡½æ•°çš„é‚£ä¸ªç›®æ ‡æ–‡ä»¶é“¾æ¥è¿›æ¥, ç”±äºè¿è¡Œåº“æœ‰æˆç™¾ä¸Šåƒä¸ªå‡½æ•°, å¦‚æœæŠŠè¿™äº›å‡½æ•°éƒ½æ”¾åœ¨ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ä¸­å°±ä¼šå¾ˆå¤§\u0026hellip;\nå¦‚æœæŠŠæ•´ä¸ªé“¾æ¥è¿‡ç¨‹æ¯”ä½œä¸€å°è®¡ç®—æœº, é‚£ä¹ˆldé“¾æ¥å™¨å°±æ˜¯è®¡ç®—æœºçš„CPU, æ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶ã€åº“æ–‡ä»¶å°±æ˜¯è¾“å…¥, é“¾æ¥ç»“æœè¾“å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶å°±æ˜¯è¾“å‡º, è€Œé“¾æ¥æ§åˆ¶è„šæœ¬æ­£æ˜¯è¿™å°è®¡ç®—æœºçš„â€œç¨‹åºâ€, å®ƒæ§åˆ¶CPUçš„è¿è¡Œ, ä»¥â€œç¨‹åºâ€è¦æ±‚çš„æ–¹å¼å°†è¾“å…¥åŠ å·¥æˆæ‰€é¡»è¦çš„è¾“å‡ºç»“æœ.\nlibc.so is a shared library, often referred to as a \u0026ldquo;dynamic link library.\u0026rdquo; It contains compiled code that is loaded into memory at runtime, allowing multiple programs to share the same code in memory.\nBoth libc.a and libc.so are implementations of the C library, but they differ in their form and how they are linked to programs.\nWhen we staticlly compile a source file, then libc.a will be used at compiled time, if we dynamically compile a source file (compile with dynamically linked) then libc.so will be used at runtime.\n1 2 3 4 5 6 7 $ gcc -static -o main main.c $ file main main: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, BuildID[sha1]=7fd47f129d345aa2ef6c44b06ffa01be4174d098, for GNU/Linux 3.2.0, not stripped $ ls -lh main -rwxrwxr-x 1 ubuntu ubuntu 880K Oct 18 00:51 main 1 2 3 4 5 6 7 $ gcc -o main main.c $ file main main: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=f14bf2e15cabc179d82a09a2de5bf15da6e5b75c, for GNU/Linux 3.2.0, not stripped $ ls -lh main -rwxrwxr-x 1 ubuntu ubuntu 16K Oct 18 00:54 main As you can see, the dynamically linked binary is very small just 16k compared with the statically linked binary 880K.\n# 7. Conclusion ç¨‹åºå¦‚ä½•ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„API(system call)? åœ¨ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œä¸€ç§è¯­è¨€çš„å¼€å‘ç¯å¢ƒå¾€å¾€ä¼šé™„å¸¦æœ‰è¯­è¨€åº“ï¼ˆLanguage Libraryä¹Ÿå¯ä»¥è¯´æ˜¯æ ‡å‡†åº“,è¿è¡Œæ—¶åº“ï¼‰ã€‚è¿™äº›åº“å°±æ˜¯å¯¹æ“ä½œç³»ç»Ÿçš„APIçš„åŒ…è£…ï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å…¸çš„Cè¯­è¨€ç‰ˆâ€œHello Worldâ€ç¨‹åºï¼Œå®ƒä½¿ç”¨Cè¯­è¨€æ ‡å‡†åº“çš„â€œprintfâ€å‡½æ•°æ¥è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œâ€œprintfâ€å‡½æ•°å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¸€äº›å¿…è¦çš„å¤„ç†ä»¥åï¼Œæœ€åä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„APIã€‚å„ä¸ªæ“ä½œç³»ç»Ÿä¸‹ï¼Œå¾€ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²çš„APIéƒ½ä¸ä¸€æ ·ï¼Œåœ¨Linuxä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œwriteâ€çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œåœ¨Windowsä¸‹å®ƒæ˜¯â€œWriteConsoleâ€ç³»ç»ŸAPIã€‚æ ‡å‡†åº“å‡½æ•°(è¿è¡Œåº“)ä¾èµ–çš„æ˜¯system callã€‚åº“é‡Œé¢è¿˜å¸¦æœ‰é‚£äº›å¾ˆå¸¸ç”¨çš„å‡½æ•°ï¼Œæ¯”å¦‚Cè¯­è¨€æ ‡å‡†åº“é‡Œé¢æœ‰å¾ˆå¸¸ç”¨ä¸€ä¸ªå‡½æ•°å–å¾—ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦å«strlen()ï¼Œè¯¥å‡½æ•°å³éå†æ•´ä¸ªå­—ç¬¦ä¸²åè¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼Œè¿™ä¸ªå‡½æ•°å¹¶æ²¡æœ‰è°ƒç”¨ä»»ä½•æ“ä½œç³»ç»Ÿçš„APIï¼Œä¹Ÿæ²¡æœ‰åšä»»ä½•è¾“å…¥è¾“å‡ºã€‚ä½†æ˜¯å¾ˆå¤§ä¸€éƒ¨åˆ†åº“å‡½æ•°(è¿è¡Œåº“)éƒ½æ˜¯è¦è°ƒç”¨æ“ä½œç³»ç»Ÿçš„APIçš„.\nâ€œAny problem in computer science can be solved by another layer of indirection.â€\næ¯ä¸ªå±‚æ¬¡ä¹‹é—´éƒ½é¡»è¦ç›¸äº’é€šä¿¡ï¼Œæ—¢ç„¶é¡»è¦é€šä¿¡å°±å¿…é¡»æœ‰ä¸€ä¸ªé€šä¿¡çš„åè®®ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†å…¶ç§°ä¸ºæ¥å£ï¼ˆInterfaceï¼‰ï¼Œæ¥å£çš„ä¸‹é¢é‚£å±‚æ˜¯æ¥å£çš„æä¾›è€…ï¼Œç”±å®ƒå®šä¹‰æ¥å£ï¼›æ¥å£çš„ä¸Šé¢é‚£å±‚æ˜¯æ¥å£çš„ä½¿ç”¨è€…ï¼Œå®ƒä½¿ç”¨è¯¥æ¥å£æ¥å®ç°æ‰€éœ€è¦çš„åŠŸèƒ½.\nè¿è¡Œæ—¶åº“(æ ‡å‡†åº“, static library, dynamic library) ä¾èµ– system call, å®ƒæä¾›å¤´æ–‡ä»¶(stdio.h, math.h)ä¾›æˆ‘ä»¬ä½¿ç”¨. æ‰€ä»¥å®ƒå¾ˆé‡è¦, å®ƒåœ¨åº”ç”¨å±‚å’Œæ“ä½œç³»ç»Ÿä¸­é—´. æˆ‘ä»¬ä½¿ç”¨å®ƒæä¾›çš„æ¥å£(printf())å’Œæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤æµ(é€šè¿‡system call).\næˆ‘ä»¬çš„è½¯ä»¶ä½“ç³»ä¸­ï¼Œä½äºæœ€ä¸Šå±‚çš„æ˜¯åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚æˆ‘ä»¬å¹³æ—¶ç”¨åˆ°çš„ç½‘ç»œæµè§ˆå™¨ã€Emailå®¢æˆ·ç«¯ã€å¤šåª’ä½“æ’­æ”¾å™¨ã€å›¾ç‰‡æµè§ˆå™¨ç­‰ã€‚ä»æ•´ä¸ªå±‚æ¬¡ç»“æ„ä¸Šæ¥çœ‹ï¼Œå¼€å‘å·¥å…·ä¸åº”ç”¨ç¨‹åºæ˜¯å±äºåŒä¸€ä¸ªå±‚æ¬¡çš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½ä½¿ç”¨ä¸€ä¸ªæ¥å£ï¼Œé‚£å°±æ˜¯æ“ä½œç³»ç»Ÿåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆApplication Programming Interface, å°±æ˜¯æ ‡å‡†åº“çš„å¤´æ–‡ä»¶ï¼‰ã€‚åº”ç”¨ç¨‹åºæ¥å£(å¤´æ–‡ä»¶)çš„æä¾›è€…æ˜¯è¿è¡Œåº“ï¼Œä»€ä¹ˆæ ·çš„è¿è¡Œåº“æä¾›ä»€ä¹ˆæ ·çš„APIï¼Œæ¯”å¦‚Linuxä¸‹çš„Glibcåº“æä¾›POSIXçš„APIï¼›Windowsçš„è¿è¡Œåº“æä¾›Windows APIï¼Œæœ€å¸¸è§çš„32ä½Windowsæä¾›çš„APIåˆè¢«ç§°ä¸ºWin32ã€‚\nè¿è¡Œåº“ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼ˆSystem call Interfaceï¼‰ï¼Œç³»ç»Ÿè°ƒç”¨æ¥å£åœ¨å®ç°ä¸­å¾€å¾€ä»¥è½¯ä»¶ä¸­æ–­ï¼ˆSoftware Interruptï¼‰çš„æ–¹å¼æä¾›ï¼Œæ¯”å¦‚Linuxä½¿ç”¨0x80å·ä¸­æ–­ä½œä¸ºç³»ç»Ÿè°ƒç”¨æ¥å£ï¼ŒWindowsä½¿ç”¨0x2Eå·ä¸­æ–­ä½œä¸ºç³»ç»Ÿè°ƒç”¨æ¥å£ï¼ˆä»Windows XP Sp2å¼€å§‹ï¼ŒWindowså¼€å§‹é‡‡ç”¨ä¸€ç§æ–°çš„ç³»ç»Ÿè°ƒç”¨æ–¹å¼ï¼‰ã€‚\næ“ä½œç³»ç»Ÿå†…æ ¸å±‚å¯¹äºç¡¬ä»¶å±‚æ¥è¯´æ˜¯ç¡¬ä»¶æ¥å£çš„ä½¿ç”¨è€…ï¼Œè€Œç¡¬ä»¶æ˜¯æ¥å£çš„å®šä¹‰è€…ï¼Œç¡¬ä»¶çš„æ¥å£å®šä¹‰å†³å®šäº†æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå…·ä½“æ¥è®²å°±æ˜¯é©±åŠ¨ç¨‹åºå¦‚ä½•æ“ä½œç¡¬ä»¶ï¼Œå¦‚ä½•ä¸ç¡¬ä»¶è¿›è¡Œé€šä¿¡ã€‚è¿™ç§æ¥å£å¾€å¾€è¢«å«åšç¡¬ä»¶è§„æ ¼ï¼ˆHardware Specificationï¼‰ï¼Œç¡¬ä»¶çš„ç”Ÿäº§å‚å•†è´Ÿè´£æä¾›ç¡¬ä»¶è§„æ ¼ï¼Œæ“ä½œç³»ç»Ÿå’Œé©±åŠ¨ç¨‹åºçš„å¼€å‘è€…é€šè¿‡é˜…è¯»ç¡¬ä»¶è§„æ ¼æ–‡æ¡£æ‰€è§„å®šçš„å„ç§ç¡¬ä»¶ç¼–ç¨‹æ¥å£æ ‡å‡†æ¥ç¼–å†™æ“ä½œç³»ç»Ÿå’Œé©±åŠ¨ç¨‹åºã€‚\n\u0026mdash;ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ï¼šé“¾æ¥ã€è£…è½½ä¸åº“\n","date":"2023-10-17T17:58:57Z","permalink":"https://blog.yorforger.cc/p/intros-of-c-standard-library/","title":"Intros of C Standard Library"},{"content":" # 1. /etc/hosts and /etc/resolv.conf On Linux or a Mac, if you add this to /etc/hosts, facebook no longer exists:\n1 127.0.0.1 facebook.com /etc/hosts is used to resolve hostnames to IP addresses on a local machine. They\u0026rsquo;re looked at first.\nNow\u0026hellip; If you don\u0026rsquo;t have an entry for a host in your host file, you need to ask someone what the IP is. That comes from a resolver.\n# 2. Local resolver \u0026amp; recursive resolver Recursive resolver usually located at remote acts as a DNS server, whereas, a DNS stub resolver running on client devices.\nMost Internet users use a recursive resolver provided by their ISP, but there are other options available; for example Cloudflare\u0026rsquo;s 1.1.1.1 or 8.8.8.8 provided by Google.\n1 2 3 4 $ cat /etc/resolv.conf # This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8). # Do not edit. nameserver 127.0.0.53 127.0.0.53 is the DNS server address, you can also manually change it to the IP of any DNS server (for example, change it to the famous Google DNS 8.8.8.8).\n127.x.x.x are loopback addresses that point to the local machine and are bound to the \u0026ldquo;lo\u0026rdquo; (loopback) network device. So who is this DNS server 127.0.0.53?\n1 2 3 $ sudo netstat -anp | grep 127.0.0.53 tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN 96729/systemd-resol udp 0 0 127.0.0.53:53 0.0.0.0:* 96729/systemd-resol From the output, we can see that the process uses 127.0.0.53:53 called systemd-resolve. In /etc/resolv.conf it says that it\u0026rsquo;s maintained by the systemd-resolved service. So we can try to check its status with systemctl:\n1 2 3 4 5 $ systemctl status systemd-resolved â— systemd-resolved.service - Network Name Resolution Loaded: loaded (/lib/systemd/system/systemd-resolved.service; enabled; vendor preset: enabled) Active: active (running) since Tue 2023-10-10 01:56:13 UTC; 3 days ago .... We have know that the current DNS server on this machine is systemd-resolve which a DNS stub (client). So, what is the IP address of the actual DNS server? We can use the following command to check:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # $ systemd-resolve --status | grep \u0026#34;DNS Servers\u0026#34; # In systemd 239 \u0026#39;systemd-resolve\u0026#39; has been renamed to \u0026#39;resolvectl\u0026#39; $ resolvectl status | grep \u0026#39;DNS Servers\u0026#39; DNS Servers: 172.31.0.2 $ resolvectl status Global Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported resolv.conf mode: stub Link 2 (eth0) Current Scopes: DNS Protocols: +DefaultRoute +LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported Current DNS Server: 172.31.0.2 DNS Servers: 172.31.0.2 DNS Domain: us-east-2.compute.internal DNS stub resolver used to initiate DNS queries, and it sends the DNS query to the recursive resolver, which then performs the actual DNS resolution process (usually provided by an internet service provider or a public DNS resolver like Google\u0026rsquo;s 8.8.8.8).\nReferences: https://zhuanlan.zhihu.com/p/101275725\n","date":"2023-10-13T14:03:57Z","permalink":"https://blog.yorforger.cc/p/dns-stub-and-recursive-resolver-config-files/","title":"DNS Stub and Recursive Resolver - Config Files"},{"content":" # 1. WORKDIR 1 WORKDIR /path/to/workdir The WORKDIR instruction sets the working directory for any RUN, CMD, ENTRYPOINT, COPY and ADD instructions that follow it in the Dockerfile. If the WORKDIR doesn\u0026rsquo;t exist, it will be created even if it\u0026rsquo;s not used in any subsequent Dockerfile instruction.\nThe WORKDIR instruction can be used multiple times in a Dockerfile. If a relative path is provided, it will be relative to the path of the previous WORKDIR instruction. For example:\n1 2 3 WORKDIR /a WORKDIR b RUN pwd The output of the final pwd command in this Dockerfile would be /a/b.\nIf not specified, the default working directory is /. In practice, if you aren\u0026rsquo;t building a Dockerfile from scratch (FROM scratch), the WORKDIR may likely be set by the base image you\u0026rsquo;re using.\nTherefore, to avoid unintended operations in unknown directories, it is best practice to set your WORKDIR explicitly.\n# 2. COPY We usually the following code in Dockerfile:\n1 2 3 ... WORKDIR /app COPY ./test ./ The COPY ./test ./ will be executed when building the image, what COPY ./test ./ does is copy all the files under ./test on your computer into the /app folder of the container. Because ./ means current folder, and we set our current folder to /app by using WORKDIR /app in Dockerfile.\nNote that .dockerignore file is not considered here, if you add .dockerignore file, then before execute COPY ./test ./, docker will check the .dockerignore file first, if the file in the ./test folder machs the file list in .dockerignore file, then COPY ./test ./ will skip that file.\nAnd note that the build command docker build -t docker-learning:v1 ., the last . sign is used to specify the context, in COPY ./test ./, the ./test is the test folder under the context.\n# 3. RUN vs CMD vs ENTRYPOINT # 3.1. Example ENTRYPOINT sets the process to run, while CMD supplies default arguments to that process.\n1 2 3 4 5 6 7 WORKDIR /app COPY ./ ./ RUN go mod download RUN go build -o server ENTRYPOINT [\u0026#34;./server\u0026#34;] CMD [\u0026#34;-p\u0026#34;, \u0026#34;80\u0026#34;] When run image:\n1 docker run -p 80:80 --rm file-server:v1.0 The command ./server -p 80 will run in the container. By the way, thr CMD could be overwritten by docker run:\n1 2 3 4 ... ENTRYPOINT [\u0026#34;./server\u0026#34;] CMD [\u0026#34;-p\u0026#34;, \u0026#34;9000\u0026#34;] When run image:\n1 sudo docker run -p 8080:8080 --rm file-server:v1.0 -port 8080 The command ./server -port 8080 will run, not ./server -p 9000\n# 3.2. Concepts ENTRYPOINT is the process thatâ€™s executed inside the container. Images can only have one ENTRYPOINT. If you repeat the Dockerfile instruction more than once, the last one will apply. When an image is created without an ENTRYPOINT, Docker defaults to using /bin/sh -c. CMD is the default set of arguments that are supplied to the ENTRYPOINT process. There can only be one CMD instruction in a Dockerfile. If you list more than one CMD then only the last CMD will take effect. CMD - command triggers while we launch the created docker image. RUN - command triggers while we build the docker image. 1 2 3 ENTRYPOINT [\u0026#34;./server\u0026#34;] CMD [\u0026#34;-p\u0026#34;, \u0026#34;80\u0026#34;] # same as: CMD [\u0026#34;./server\u0026#34;, \u0026#34;-p\u0026#34;, \u0026#34;80\u0026#34;] # 4. docker run vs ENTRYPOINT The docker run command starts a new container using a specified image. When no further arguments are given, the process that runs in the container will exactly match the ENTRYPOINT and CMD defined in the image.\n1 2 # Executes /usr/bin/my-app help $ docker run my-image:latest Technically, it is possible to override the ENTRYPOINT using docker run by setting its --entrypoint flag. Although this is rarely required, the technique can be useful if you want to launch a shell inside a container, such as to inspect the contents of an imageâ€™s filesystem:\n1 2 # Executes bash -c \u0026#34;ls /\u0026#34; $ docker run --entrypoint bash my-image:latest -c \u0026#34;ls /\u0026#34; Note that there is no bash under the /bin folder of alpine:latest linux system which our container based on, there just two shells: ash and sh. So the command above will get an error.\n1 docker: Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: \u0026#34;bash\u0026#34;: executable file not found in $PATH: unknown. You can try:\n1 2 3 4 $ docker run --entrypoint /bin/sh docker-learning:v1 -c \u0026#34;cat /etc/shells\u0026#34; # valid login shells /bin/sh /bin/ash Or\n1 2 3 4 $ docker run docker-learning:v1 cat /etc/shells # valid login shells /bin/sh /bin/ash Both of these are same, because the default entrypoint is /bin/sh -c.\nReference:\nDockerfile reference | Docker Docs Docker ENTRYPOINT and CMD : Differences \u0026amp; Examples ","date":"2023-10-11T12:27:35Z","permalink":"https://blog.yorforger.cc/p/dockerfile-synatax/","title":"Dockerfile Synatax"},{"content":" # 1. Docker architecture Docker uses a client-server architecture. The Docker client talks to the Docker daemon, which does the heavy lifting of building, running, and distributing your Docker containers. The Docker client and daemon can run on the same system, or you can connect a Docker client to a remote Docker daemon. The Docker client and daemon communicate using a REST API, over UNIX sockets or a network interface.\nLearn more about the Cocker client(docker), Docker daemon(dockerd) and Docker objects (images, containers): https://docs.docker.com/get-started/overview/\n# 2. Docker build architecture Docker Build implements a client-server architecture, where:\nBuildx is the client and the user interface for running and managing builds BuildKit is the server, or builder, that handles the build execution. As of Docker Engine 23.0 and Docker Desktop 4.19, Buildx is the default build client.\nIn newer versions of Docker Desktop and Docker Engine, you\u0026rsquo;re using Buildx by default when you invoke the docker build command. In earlier versions, to build using Buildx you would use the docker buildx build command.\nSourcce: Docker Build architecture | Docker Docs\nLearn more: Builders | Docker Docs\n","date":"2023-10-11T10:38:35Z","permalink":"https://blog.yorforger.cc/p/docker-architecture/","title":"Docker Architecture"},{"content":"Previous post: Statically Linking in C - David\u0026rsquo;s Blog\n# 1. Static linking on linux Go creates static binaries by default unless you use cgo to call C code, in which case it will create a dynamically linked binary. The easiest way to check if your program is statically compiled is to run file on it.\nstandard packages os/user and net use cgo, so importing either (directly or indirectly) will result in a dynamic binary.\nNote that net use cgo does\u0026rsquo;t mean that all its implementation is cgo, cgo is just used for Name Resolution and some teivial features. https://pkg.go.dev/net#section-documentation\nI do this test on my Ubuntu server firstly without cgo:\n1 2 3 4 5 6 7 package main import \u0026#34;fmt\u0026#34; func main() { fmt.Println(\u0026#34;hello\u0026#34;) } 1 2 3 4 5 6 7 8 9 10 # ubuntu @ ip-172-31-12-228 in ~/codes [19:40:23] $ go build -o server main.go # ubuntu @ ip-172-31-12-228 in ~/codes [19:40:31] $ file server server: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, Go BuildID=hjbIteBvAg_rZ86av_gy/k1xYD8duMhRTtrThDrrX/5yBtTaOBDsf4F2IOwADX/U1b5vnivY9rWcRUWpC_A, with debug_info, not stripped # ubuntu @ ip-172-31-12-228 in ~/codes [19:40:36] $ ldd server not a dynamic executable As you can see, I just use fmt package, and the executable file is statically linked.\nAnd then I change the go code to:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; ) func main() { srv := http.NewServeMux() srv.HandleFunc(\u0026#34;/\u0026#34;, func(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprintln(w, \u0026#34;hello world\u0026#34;) }) fmt.Println(\u0026#34;running...\u0026#34;) _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, srv) } Then build it on Ubtutu machine:\n1 2 3 4 5 6 7 8 9 10 11 12 # ubuntu @ ip-172-31-12-228 in ~/codes [19:47:06] $ go build -o server main.go # ubuntu @ ip-172-31-12-228 in ~/codes [19:47:31] $ file server server: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, Go BuildID=KCFaacb5_zSot7hqkTv8/oYQa-0nbl_Gq2_YxF6JO/BnF2hmfFNgVx-UHRKxMt/Oj91sMcK9_or35yi4Xd0, with debug_info, not stripped # ubuntu @ ip-172-31-12-228 in ~/codes [19:47:39] $ ldd server linux-vdso.so.1 (0x00007fff10cfb000) libc.so.6 =\u0026gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f4cd6200000) /lib64/ld-linux-x86-64.so.2 (0x00007f4cd6612000) The binary file is dynamically linked as we expected.\n# 1.1. Disable dynamically linking with CGO_ENABLED=0 1 2 3 4 5 6 # ubuntu @ ip-172-31-12-228 in ~/codes [19:48:57] $ CGO_ENABLED=0 go build -o server main.go # ubuntu @ ip-172-31-12-228 in ~/codes [20:11:01] $ file server server: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, Go BuildID=wGRY1RH-HeASVOwzThcj/lQNxgqzqGUe1P8n_WjN7/cEcN362GspK8XKl2L0AG/F7hVHMJfVIyYcLM6Jhz1, with debug_info, not stripped Note that the CGO_ENABLED=0 is to disable cgo. It is disabled by default when cross-compiling. You can control this by setting the CGO_ENABLED environment variable when running the go tool: set it to 1 to enable the use of cgo, and to 0 to disable it.\nIf CGO_ENABLED=0 is set, the Go net package will not use cgo, and instead, it will use a pure Go implementation for its networking functionality.\nLearn more: https://go-review.googlesource.com/c/go/+/12603/2/src/cmd/cgo/doc.go\n# 2. Static linking on osx On Mac, the behavior is totoally different, even don\u0026rsquo;t use cgo the final executable will be dynamically linked.\n1 2 3 4 5 6 7 package main import \u0026#34;fmt\u0026#34; func main() { fmt.Println(\u0026#34;hello\u0026#34;) } Build on MacOS machine:\n1 2 3 4 5 6 7 8 9 10 11 $ go build -o server main.go $ file server server: Mach-O 64-bit executable arm64 # otool is similar to \u0026#39;ldd\u0026#39; on linux # -L print shared libraries used $ otool -L server server: /usr/lib/libSystem.B.dylib (compatibility version 0.0.0, current version 0.0.0) /usr/lib/libresolv.9.dylib (compatibility version 0.0.0, current version 0.0.0) CGO_ENABLED=0 won\u0026rsquo;t help on MaxOS. And I found something could be explain this:\nI think this won\u0026rsquo;t work on macOS, where fully static builds are not allowed/supported by Apple. Binaries should always go through libSystem, which is also why we changed the way Go calls the kernel in Go 1.12. So, pure Go binaries are already as static as they can be, as far as I can tell.\nI propose that on macOS go build -static simply tries to statically link cgo libraries, so that the final binary doesn\u0026rsquo;t depend on third-party. So but just on system libraries. To do this, unfortunately, it looks like it\u0026rsquo;s not sufficient to add the output of pkg-config --static --libs to LDFLAGS because that output still refers to each library as -L/path/to -lfoo (as this is the correct syntax when --static is passed to the linker, which we are not going to do in macOS). So, the output of pkg-config should be rewritten as /path/to/libfoo.a (using a similar library path search algorithm that the linker does).\nSource: https://github.com/golang/go/issues/26492#issuecomment-525527016\nYes, I agree with Volker\u0026rsquo;s comment that some systems don\u0026rsquo;t really allow static binaries.\nSource: https://stackoverflow.com/a/61324538/16317008\nNote that fully static builds are not allowed/supported by Apple doesn\u0026rsquo;t mean we cannot create statically linked binaries on Mac, we can build the binary executable on other platforms, linux, for example.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; ) func main() { srv := http.NewServeMux() srv.HandleFunc(\u0026#34;/\u0026#34;, func(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprintln(w, \u0026#34;hello world\u0026#34;) }) fmt.Println(\u0026#34;running...\u0026#34;) _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, srv) } Build on MacOS machine with some flags:\n1 2 3 4 $ GOOS=linux go build -o server main.go $ file server server: ELF 64-bit LSB executable, ARM aarch64, version 1 (SYSV), statically linked, Go BuildID=qAraNfnU-cYn-2KsoFx7/rrJYFJTR911CeHr08Y4E/uoFKsYV1LH9as_7QdMc7/fJ71_ARZOiNg7b4tLPIt, with debug_info, not stripped As you can see, even we use the net package which uses cgo, it still can be statically with GOOS=linux flag, this is called cross compilation, learn more: Cross Compilation - Go - David\u0026rsquo;s Blog\nBut the arch is arm64, not amd64, if you want build binary gonna runs on amd64, you should add GOARCH=amd64 :\n1 $ GOOS=linux GOARCH=amd64 go build -o server main.go # 3. \u0026quot;-extldflags=-static\u0026quot; In previous part, we know that CGO_ENABLED=0 will disable cgo, if we use net and we want statically linking, it\u0026rsquo;s fine we just pass CGO_ENABLED=0 to go build, then we will use pure go implementation of net. But what if we use a third party package that only implemented by cgo, mattn/go-sqlite3 for example, and we want make it linked statically, apparently we can\u0026rsquo;t use CGO_ENABLED=0 to disable cgo.\nA simle cgo:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main // typedef int (*intFunc) (); // // int // bridge_int_func(intFunc f) // { //\treturn f(); // } // // int fortytwo() // { //\treturn 42; // } import \u0026#34;C\u0026#34; import \u0026#34;fmt\u0026#34; func main() { f := C.intFunc(C.fortytwo) fmt.Println(int(C.bridge_int_func(f))) // Output: 42 } Then compile it with CGO_ENABLED=0 on Ubuntu machine:\n1 2 3 4 5 6 7 8 9 $ CGO_ENABLED=0 go build -o server main.go go: no Go source files # ubuntu @ ip-172-31-12-228 in ~/codes [20:58:50] C:1 $ go build -o server main.go # ubuntu @ ip-172-31-12-228 in ~/codes [21:00:15] $ file server server: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=da0674602632e4f540cfe58f0be1ffa261f2eefe, for GNU/Linux 3.2.0, with debug_info, not stripped Then we can use -ldflags to tell the C linker to statically link with -extldflags:\n1 -ldflags=\u0026#34;-extldflags=-static\u0026#34; 1 2 3 4 5 6 # ubuntu @ ip-172-31-12-228 in ~/codes [21:00:18] $ go build -ldflags=\u0026#34;-extldflags=-static\u0026#34; -o server main.go # ubuntu @ ip-172-31-12-228 in ~/codes [21:01:41] $ file server server: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, BuildID[sha1]=4031763b8f09ffcd1455840afe89c4644eca0088, for GNU/Linux 3.2.0, with debug_info, not stripped Now it\u0026rsquo;s statically linked.\nI hope you can understand the difference between CGO_ENABLED=0 and -ldflags=\u0026quot;-extldflags=-static\u0026quot; flag, and when you should use which one. Besides, you should know the different behavior on MacOS and Linux for statically linking in Go. And the two common command ldd, otool, file will help you.\nLearn more:\nStatically compiling Go programs #!bash blog/2014/04/linking-golang-statically/ cgo | Dave Cheney Matt Turner - Statically Linking Go in 2022 ","date":"2023-10-10T12:09:35Z","permalink":"https://blog.yorforger.cc/p/static-linking-go-programs/","title":"Static Linking Go Programs"},{"content":" # 1. What is cross compilation? Cross-compilation is the process of compiling code for runing on a different OS.\n# 2. An example There is a question on Stackoverflow:\nIt\u0026rsquo;s said that Golang is the compiled language, but what does it mean by compiled? If golang application is compiled to machine code, why can\u0026rsquo;t I just distribute the binary (of course on corresponding arch and platform) instead of go install stuff?\nOnce you compile a binary you can distribute it onto machines with the same architecture. You don\u0026rsquo;t need go real time envorionment such as go install, go run, etc, which are just necessary for compilation.\nThe go code:\n1 2 3 4 5 6 7 8 func main() { srv := http.NewServeMux() srv.HandleFunc(\u0026#34;/\u0026#34;, func(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprintln(w, \u0026#34;hello world\u0026#34;) }) fmt.Println(\u0026#34;running...\u0026#34;) _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, srv) } Compile go program on my local machine MacOS:\n1 2 3 4 5 $ go build -o server main.go $ file server server: Mach-O 64-bit executable arm64 $ uname -m arm64 Then copy this file to my Ubuntu server and try to run it:\n1 2 3 4 5 6 7 8 9 10 11 # ubuntu @ ip-172-31-12-228 in ~ [13:38:04] $ uname -m x86_64 # ubuntu @ ip-172-31-12-228 in ~ [13:38:09] $ file server server: Mach-O 64-bit arm64 executable, flags:\u0026lt;|DYLDLINK|PIE\u0026gt; # ubuntu @ ip-172-31-12-228 in ~ [13:38:17] $ ./server zsh: exec format error: ./serve Then I tried add GOOS=linux when compile it on my Mac, and it works:\n1 $ GOOS=linux GOARCH=amd64 go build -o server main.go Run on my Ubuntu server:\n1 2 3 4 5 6 # Note the output \u0026#39;statically linked\u0026#39; $ file server server: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, Go BuildID=UPJ7jqIdP4OxbRX0df1Y/Xoh0f7edlCBhoN_dKDuV/xIAf8LzXqSyYE4r7v3Rq/Jq_3l1_5WQhsiIkApqgj, with debug_info, not stripped $ ./server running... So once you compile a binary you can distribute it onto machines with the same architecture. You don\u0026rsquo;t need go real time envorionment to run it. This is the power of compiled language.\n# 3. Cross-compilation I found a post, share it here:\nThe Bash shell and the Python interpreter are available on most Linux servers of any architecture. Hence, everything had worked well before.\nHowever, now I was dealing with a compiled language, Go, which produces an executable binary. The compiled binary consists of opcodes or assembly instructions that are tied to a specific architecture. That\u0026rsquo;s why I got the format error. Since the Arm64 CPU (where I ran the binary) could not interpret the binary\u0026rsquo;s x86-64 instructions, it errored out. Previously, the shell and Python interpreter took care of the underlying opcodes or architecture-specific instructions for me.\nI checked the Golang docs and discovered that to produce an Arm64 binary, all I had to do was set two environment variables when compiling the Go program before running the go build command.\nGOOS refers to the operating system (Linux, Windows, BSD, etc.), while GOARCH refers to the architecture to build for.\n1 $ env GOOS=linux GOARCH=arm64 go build -o prepnode_arm64 # 3.1. What about other architectures? x86 and Arm are two of the five architectures I test software on. I was worried that Go might not support the other ones, but that was not the case. You can find out which architectures Go supports with:\n1 2 3 4 5 6 7 8 9 10 11 $ go tool dist list aix/ppc64 android/386 android/amd64 android/arm android/arm64 darwin/amd64 darwin/arm64 windows/386 windows/amd64 ..... Generatiing binaries for all of the architectures under my test is as simple as writing a tiny shell script from my x86 laptop:\n1 2 3 4 5 6 7 #!/usr/bin/bash archs=(amd64 arm64 ppc64le ppc64 s390x) for arch in ${archs} do env GOOS=linux GOARCH=${arch} go build -o prepnode_${arch} done ","date":"2023-10-10T11:09:35Z","permalink":"https://blog.yorforger.cc/p/cross-compilation-go/","title":"Cross Compilation - Go"},{"content":" # 1. Dockerfile example 1 2 3 4 5 6 7 8 9 10 11 12 13 14 FROM golang:alpine WORKDIR /app COPY ./ ./ RUN go mod download RUN go build -o server ENTRYPOINT [\u0026#34;./server\u0026#34;] CMD [\u0026#34;-p\u0026#34;, \u0026#34;80\u0026#34;] # docker build [--platform linux/amd64] -t shwezhu/file-server:v1.0 . # [docker push shwezhu/file-server:v1.0] # [docker pull davidzhu/file-server:v1.0] # sudo docker run -d -p 80:80 --rm shwezhu/file-server:v1.0 # 2. Docker commands 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # check the output of the program running in the container $ docker logs container_name # volumes, mount the folder on the machine \u0026#39;~/root\u0026#39; to the \u0026#39;/app/root\u0026#39; dir of the container $ docker run --name file-server --rm -d -p 80:80 -v ~/root:/app/root shwezhu/file-server:v1.0 ./server -p 80 # file-server is the container name, not image $ docker exec -it file-server bash $ docker exec -it file-server /bin/sh #------------- show -------------- $ docker container ls -a $ docker image ls -a #-------------- build and delete -------------- $ docker build -t davidzhu/go-learning:v1.0 . $ docker rmi shwezhu/file-station:v1\t# if docker is in-use, delete with -f $ docker rm container_id #------------------ run image ---------------------- # --rm automatically removes the container when it exits, # -d: Run container in background $ docker run -d -p 80:80 --rm davidzhu/go-learning:v1.0 # specify the container name $ docker run --name mysql-volume ... # publish and pull image from repo $ docker push shwezhu/file-station:v1 $ docker pull davidzhu/file-station:v1 # 3. Build image The docker build command is used to build a Docker image from a Dockerfile and a \u0026ldquo;context\u0026rdquo;.\nDuring the build, those files (build context) are sent to the Docker daemon so that the image can use them as files. The build context is usually at the current folder.\n1 2 3 # -t image_name:tag_name # . specifies the build context as the current directory $ docker build -t go-learning:1 . Learn more: Multi-stage builds | Docker Docs\n# 4. .dockerignore File During the build, those files (build context) are sent to the Docker daemon so that the image can use them as files.\nWhen you build a Docker image, Docker takes all the files and directories in the build context and sends them to the Docker daemon, which then processes and includes them in the image. By using a .dockerignore file, you can specify patterns of files and directories that should be ignored during the build process.\nBy excluding unnecessary files and directories, you can significantly reduce the size of the Docker image. This is particularly important when building images for production environments or when transferring images across networks.\n# 5. Image vs container A container is an isolated place where an application runs without affecting the rest of the system and without the system impacting the application. Because they are isolated, containers are well-suited for securely running software like databases or web applications that need access to sensitive resources without giving access to every user on the system. However, containers can be much more efficient than virtual machines because they donâ€™t need the overhead of an entire operating system. They share a single kernel with other containers and boot in seconds instead of minutes.\nImages are read-only templates containing instructions for creating a container. A Docker image creates containers to run on the Docker platform. Docker images are immutable, so you cannot change them once they are created. If you need to change something, create another container with your changes, then save those as another image. Or, just run your new container using an existing image as a base and change that one.\nAn image is composed of multiple stacked layers, like layers in a photo editor, each changing something in the environment. Images contain the code or binary, runtimes, dependencies, and other filesystem objects to run an application. The image relies on the host operating system (OS) kernel. For example, to build a web server image, start with an image that includes Ubuntu Linux (a base OS). Then, add packages like Apache and PHP on top.\nThink of a Docker container as a running image instance. You can create many containers from the same image, each with its own unique data and state. Although images are not the only way to create containers, they are a common method.\nSource: Docker image vs container: What are the differences? | CircleCI\n# 6. Image with cross platform Docker images are typically built for a specific CPU architecture, such as x86-64 (64-bit Intel/AMD processors). By default, Docker images are built for the architecture of the system where the image is built. However, it is possible to build and run Docker images for different architectures using a technique called multi-architecture or cross-platform support.\nDocker images can support multiple platforms, which means that a single image may contain variants for different architectures, and sometimes for different operating systems, such as Windows. When you run an image with multi-platform support, Docker automatically selects the image that matches your OS and architecture.\nMost of the Docker Official Images on Docker Hub provide a variety of architecturesopen_in_new. For example, the busybox image supports amd64, arm32v5, arm32v6, arm32v7, arm64v8, i386, ppc64le, and s390x. When running this image on an x86_64 / amd64 machine, the amd64 variant is pulled and run.\nLearn more: Multi-platform images | Docker Docs\n","date":"2023-10-09T21:09:35Z","permalink":"https://blog.yorforger.cc/p/docker-basics/","title":"Docker Basics"},{"content":" # 1. ufw command # 1.1. Commonly used ufw commands 1 2 3 4 5 6 7 # ubuntu @ ip-172-31-12-228 $ sudo ufw status Status: inactive # ubuntu @ ip-172-31-12-228 $ sudo ufw enable Command may disrupt existing ssh connections. Proceed with operation (y|n)? n Aborted Note: use sudo ufw enable carefully, because it may disrupt your ssh connection.\n1 2 3 4 5 6 7 8 9 10 ufw enable: Enables the firewall, which starts enforcing the configured rules. ufw disable: Disables the firewall, allowing all network traffic. ufw status: Displays the current status of the firewall and the rules that are in effect. ufw default allow: Sets the default policy to allow all incoming and outgoing traffic. ufw default deny: Sets the default policy to deny all incoming and outgoing traffic. ufw allow \u0026lt;port\u0026gt;: Opens a specific port for incoming traffic. ufw deny \u0026lt;port\u0026gt;: Blocks incoming traffic on a specific port. ufw delete \u0026lt;rule\u0026gt;: Deletes a specific rule from the firewall. # e.g., sudo ufw delete allow 80 # 1.2. ufw app list 1 2 3 4 5 6 7 # ubuntu @ ip-172-31-12-228 $ sudo ufw app list Available applications: Nginx Full Nginx HTTP Nginx HTTPS OpenSSH The output of sudo ufw app list only shows the available application profiles, not their actual status or whether they have been allowed or denied by ufw. It simply provides a list of predefined profiles so that you can use conveniently when configuring firewall rules. You don\u0026rsquo;t need to remember which port for each application, you can simply use like this:\n1 2 3 4 5 6 # sudo ufw allow \u0026#39;Profile Name\u0026#39; $ sudo ufw allow \u0026#39;OpenSSH\u0026#39; Rules updated Rules updated (v6) $ sudo ufw allow \u0026#39;OpenS\u0026#39; ERROR: Could not find a profile matching \u0026#39;OpenS\u0026#39; rather than\n1 sudo ufw allow 22 So the command below will allow both port 80 and 443:\n1 sudo ufw allow \u0026#39;Nginx Full\u0026#39; To check the status of your firewall rules and verify whether Nginx HTTP, Nginx HTTPS, or OpenSSH have been allowed or denied by ufw, you can use the sudo ufw status command. This command will display the current status of the firewall and the active rules.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 $ sudo ufw allow \u0026#39;OpenSSH\u0026#39; Rules updated Rules updated (v6) $ sudo ufw enable Command may disrupt existing ssh connections. Proceed with operation (y|n)? y Firewall is active and enabled on system startup $ sudo ufw status Status: active To Action From -- ------ ---- 5060/udp ALLOW Anywhere OpenSSH ALLOW Anywhere 5060/udp (v6) ALLOW Anywhere (v6) OpenSSH (v6) ALLOW Anywhere (v6) $ sudo ufw disable Firewall stopped and disabled on system startup # 2. Ubuntu Firewall (ufw) vs AWS Security Groups A firewall like UFW is running at the OS level, while Amazon Security Groups are running at the instance level. Traffic coming into the EC2 would first pass through the SG, and then be evaluated by UFW.\nI strongly recommend you to use only \u0026ldquo;SG(Security Group)\u0026rdquo; on EC2 even though we can use both \u0026ldquo;SG\u0026rdquo; and \u0026ldquo;UFW. \u0026ldquo;SG\u0026rdquo; is a firewall same as \u0026ldquo;UFW\u0026rdquo;.\nWhen only \u0026ldquo;SG\u0026rdquo; allowed \u0026ldquo;SSH 22\u0026rdquo; and \u0026ldquo;UFW\u0026rdquo; didn\u0026rsquo;t allow \u0026ldquo;SSH 22\u0026rdquo; then I logged out ubuntu, I couldn\u0026rsquo;t log in to ubuntu forever, then I terminated ubuntu.\nEven though \u0026ldquo;SG\u0026rdquo; allowed \u0026ldquo;SSH 22\u0026rdquo;, I couldn\u0026rsquo;t log in to ubuntu because \u0026ldquo;UFW\u0026rdquo; didn\u0026rsquo;t allow \u0026ldquo;SSH 22\u0026rdquo;. So if either of them doesn\u0026rsquo;t allow \u0026ldquo;SSH 22\u0026rdquo;, \u0026ldquo;SSH 22\u0026rdquo; doesn\u0026rsquo;t work. If both \u0026ldquo;SG\u0026rdquo; and \u0026ldquo;UFW\u0026rdquo; allow \u0026ldquo;SSH 22\u0026rdquo;, \u0026ldquo;SSH 22\u0026rdquo; works, then we can log in to ubuntu.\nI also experimented with \u0026ldquo;HTTP 80\u0026rdquo;. When only \u0026ldquo;SG\u0026rdquo; allowed \u0026ldquo;HTTP 80\u0026rdquo; and \u0026ldquo;UFW\u0026rdquo; didn\u0026rsquo;t allow \u0026ldquo;HTTP 80\u0026rdquo;, \u0026ldquo;HTTP 80\u0026rdquo; didn\u0026rsquo;t work. When \u0026ldquo;SG\u0026rdquo; and \u0026ldquo;UFW\u0026rdquo; allowed \u0026ldquo;HTTP 80\u0026rdquo;, \u0026ldquo;HTTP 80\u0026rdquo; worked.\nJust remember like \u0026ldquo;If both allow, it works\u0026rdquo; and \u0026ldquo;If only either of them allow, it doesn\u0026rsquo;t work\u0026rdquo;. Actually, using both of them makes complication and some trobles. So again, I really recommend you to use only \u0026ldquo;SG\u0026rdquo; on EC2 which is simpler than using both of them.\nSource: https://stackoverflow.com/questions/57436758/does-ubuntu-ufw-overrides-amazon-ec2s-security-groups-and-rules\n","date":"2023-10-09T13:53:57Z","permalink":"https://blog.yorforger.cc/p/ufw-vs-aws-security-group/","title":"ufw vs  AWS Security Group"},{"content":" OpenSSL is an all-around cryptography library that offers an open-source application of the TLS protocol. It allows users to perform various SSL-related tasks, including CSR (Certificate Signing Request) and private keys generation, and SSL certificate installation. You can use OpenSSL\u0026rsquo;s commands to generate, install and manage SSL certificates on various servers. What Is OpenSSL and How Does It Work?\nOpenSSL is a library, so there should be API interfaces. However, the more common use of OpenSSL is as a command-line tool, which can be entered on a computer\n1 2 $ openssl version LibreSSL 3.3.6 Why the output is LibreSSL? LibreSSL is another version of SSL implementation, which exists alongside OpenSSL. Learn more: Why You Should Use LibreSSL Instead of OpenSSL\nOpenSSL is indeed a library, and HTTPS is based on SSL. When establishing a secure connection using SSL, operations such as SSL handshake and identity verification are required. For example, we write a program to make an HTTPS request to a server, do TLS handshake and verifying digital signatures on our own would be challenging. This is where OpenSSL comes inâ€”it handles these complex operations.\nIt\u0026rsquo;s possible that some people may have noticed that when sending HTTP requests using Python, OpenSSL was not explicitly used. There are two reasons for this:\nIt could be because you were sending an HTTP request instead of an HTTPS request. You can check if the destination port is set to 80, which is the default port for HTTP.\nThe HTTP library you used in Python may have called the OpenSSL library at its lower levels to handle the complex operations on your behalf. However, you might not have noticed this because it happens behind the scenes. For example, the OpenAI package you mentioned that you recently used internally utilizes OpenSSL, but you wouldn\u0026rsquo;t be able to detect it without examining the source code:\n1 2 3 4 5 6 7 8 9 10 11 import openai openai.api_key = \u0026#34;Your Key\u0026#34; # make https request here response = openai.ChatCompletion.create( model=\u0026#34;gpt-3.5-turbo\u0026#34;, messages=[ {\u0026#34;role\u0026#34;: \u0026#34;user\u0026#34;, \u0026#34;content\u0026#34;: \u0026#34;Who won the 2018 FIFA world cup?\u0026#34;} ] ) print(response[\u0026#39;choices\u0026#39;][0][\u0026#39;message\u0026#39;][\u0026#39;content\u0026#39;]) When I run the code above, there is an error:\n1 ImportError: urllib3 v2.0 only supports OpenSSL 1.1.1+, currently the \u0026#39;ssl\u0026#39; module is compiled with LibreSSL 2.8.3. See: https://github.com/urllib3/urllib3/issues/2168 openai package utilizes a Python package called urllib3, which is used for sending HTTP requests. urllib3 relies on a built-in Python library called ssl, which internally calls OpenSSL\u0026rsquo;s related interfaces for tasks such as session creation and certificate verification.\nHowever, from your Python code\u0026rsquo;s perspective, you\u0026rsquo;re just using the ssl module\u0026rsquo;s high-level API. You don\u0026rsquo;t have to interact directly with OpenSSL - it\u0026rsquo;s an implementation detail hidden by the SSLContext and socket wrapping methods. So in short, the Python SSL library uses the OpenSSL library under the hood to actually perform SSL handshakes, key generation, encryption, etc. But from a Python programmer\u0026rsquo;s point of view, you just import ssl and call its APIs to establish encrypted SSL connections.\nSo, the error message above is stating that urllib3 version 2.0 only supports OpenSSL 1.1.1+ but the SSL library used on my computer is LibreSSL 2.8.3. (Remember, openssl version earlier, the output is LibreSSL) Since urllib3 version 2.0 does not support the LibreSSL on your computer, the solution would be to switch to a different version of urllib3.\n1 2 pip3 uninstall urllib3 pip3 install \u0026#39;urllib3\u0026lt;2.0\u0026#39; Alternatively, I could consider upgrading or changing the version of LibreSSL on my computer to a version that is compatible with urllib3 2.0:\n1 brew install openssl@1.1 ","date":"2023-10-07T12:01:25Z","permalink":"https://blog.yorforger.cc/p/urllib3-not-compatible-with-openssl-issue-python/","title":"urllib3 not compatible with openssl issue - python"},{"content":" # 1. HTTP vs HTTPS Strictly speaking, HTTPS is not a separate protocol, but refers to use of ordinary HTTP over an encrypted SSL/TLS connection.\nPort 80 is typically used for unencrypted HTTP traffic while port 443 is the common port used for encrypted HTTP traffic which is called HTTPS.\nNote that TLS is the successor of SSL, you can simply think they are same thing.\nSource: https://en.wikipedia.org/wiki/HTTPS#Network_layers\n# 2. What is TLS/SSL SSL (Secure Sockets Layer) and its successor, TLS (Transport Layer Security), are protocols for establishing authenticated and encrypted links between networked computers.\nHTTPS, HTTP, and TLS are all protocols. HTTPS utilizes the encryption and digital authentication provided by SSL/TLS, while SSL/TLS utilizes some cryptographic algorithms within the protocol in different phases, such as RSA is used at session key exchange stage, AES is used during data transfer. Encryption can be further divided into two types:\nSymmetric Encryption Algorithms: AES, etc.\nAsymmetric Encryption Algorithms (public key cryptography): RSA, ECC, etc.\n# 3. The process of establishing a HTTPS connection When we click a link on our browser will send a or multiple http requets to the target server, then the server will responds us with html file or some images or other resources. But transfer data there are other things needed to do under the hood:\nA tcp connection needed to be established (envolves three way handshake). Make a TLS handshake After TLS handshake, the secure communication begins (client makes http request, server makes response). During the TLS handshake, the client generates a session key and encrypts it with the public key of the server and then send the encrypted session key string to the server, then the server decrypt this string to get the actual session key. Then they make communication with this session key. Now you should understand why I say TLS/SSL use both RSA and AES encryption algorithms at different phrases in previous part.\nNote that SSL/TLS is a stateful protocol, whereas HTTP/HTTPS is a stateless protocol.\nTLS/SSL is stateful. The web server and the client (browser) cache the session including the cryptographic keys to improve performance and do not perform key exchange for every request. Source\n# 4. Details in TLS handshake - avoid man-in-middle attack I have talked man-in-middle attack in other post, when a ssh connection is being established at the first time, it will notify us the fingerprint of the server which enables us can make sure to we are connecting the right server. But it\u0026rsquo;s a little diffenent in SSL/TLS (HTTPS). The authenciation happens in the TLS handshake, the authenciation here means to prevent man-in-the-middle attack by verifying the identity of the remote server.\nOnce the client and server have agreed to use TLS, they negotiate a stateful connection by using a handshaking procedure (see TLS handshake). The protocols use a handshake with an asymmetric cipher to establish not only cipher settings but also a session-specific shared key with which further communication is encrypted using a symmetric cipher. During this handshake, the client and server agree on various parameters used to establish the connection\u0026rsquo;s security:\nThe handshake begins when a client connects to a TLS-enabled server requesting a secure connection and the client presents a list of supported cipher suites (ciphers and hash functions). From this list, the server picks a cipher and hash function that it also supports and notifies the client of the decision. The server usually then provides identification in the form of a digital certificate. The certificate contains the server name, the trusted certificate authority (CA) that vouches for the authenticity of the certificate, and the server\u0026rsquo;s public encryption key. (The digital certificate here is know as SSL/TLS certificate) The client confirms the validity of the certificate before proceeding. (The client verifies the identity of the remote server by check the digital certificate which is called SSL/TLS certificate here) To generate the session keys used for the secure connection, the client either: encrypts a random number (PreMasterSecret) with the server\u0026rsquo;s public key and sends the result to the server (which only the server should be able to decrypt with its private key); both parties then use the random number to generate a unique session key for subsequent encryption and decryption of data during the session, or uses Diffieâ€“Hellman key exchange (or its variant elliptic-curve DH) to securely generate a random and unique session key for encryption and decryption that has the additional property of forward secrecy: if the server\u0026rsquo;s private key is disclosed in future, it cannot be used to decrypt the current session, even if the session is intercepted and recorded by a third party. This concludes(ends) the handshake and begins the secured connection, which is encrypted and decrypted with the session key until the connection closes. If any one of the above steps fails, then the TLS handshake fails and the connection is not created.\nSource: https://en.wikipedia.org/wiki/Transport_Layer_Security\nLearn more: https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/\n# 5. Two ways to get SSL/TLS certificate There are several ways to obtain an SSL/TLS certificate:\nPurchase from a Certificate Authority (CA): Trusted CAs offer various types of certificates, such as domain validation (DV), organization validation (OV), and extended validation (EV). A CA is an outside organization, a trusted third party, that generates and gives out SSL certificates. The CA will also digitally sign the certificate with their own private key, allowing client devices to verify it. Once the certificate is issued, it needs to be installed and activated on the website\u0026rsquo;s origin server.\nTechnically, anyone can create their own SSL certificate by generating a public-private key pairing and including all the information mentioned above . Such certificates are called self-signed certificates because the digital signature used, instead of being from a CA, would be the website\u0026rsquo;s own private key. While self-signed certificates provide encryption for your website or application, they are not trusted by default by web browsers or other client applications. Therefore, visitors accessing your site will typically see a warning message stating that the certificate is not trusted. Learn more: How to generate a self-signed SSL certificate using OpenSSL?\n# 6. Is HTTPS secure enough? Does an established HTTPS connection mean the line is really secure?\nIt\u0026rsquo;s important to understand what SSL does and does not do, especially since this is a very common source of misunderstanding.\nIt encrypts the channel It applies integrity checking It provides authentication So, the quick answer should be: \u0026ldquo;yes, it is secure enough to transmit sensitive data\u0026rdquo;. However, things are not that simple. There are a few issues here, the major one being authentication. Both ends need to be sure they are talking to the right person or institution and no man-in-the-middle attack or CSRF attacks.\nHTTPS is secure in encryption. HTTPS is secure itself but if we can totally trust HTTPS connection when exhcange privacy data is another thing. Although no one can decrept the data without the session key, there probably have man-in-the-middle attck or CSRF attck needs to be considered which make the hackers get your money without getting your sensitive data . If you can make sure the client is really that people you want talk as a server or you can make sure the server is the correct server you want to get, then https is safe. Can you make sure the server itself is a bad company? Which will sell your personal data to other perople. But this is another topic, haha, In the last I\u0026rsquo;ll share a answer here which is very comprehensive:\nQuestion: Consider a scenario, where user authentication (username and password) is entered by the user in the page\u0026rsquo;s form element, which is then submitted. The POST data is sent via HTTPS to a new page (where the php code will check for the credentials). If a hacker sits in the network, and say has access to all the traffic, is the Application layer security (HTTPS) enough in this case ?\nAnswer 1: Yes. In an HTTPS only the handshake is done unencrypted, but even the HTTP GET/POST query\u0026rsquo;s are done encrypted.\nIt is however impossible to hide to what server you are connecting, since he can see your packets he can see the IP address to where your packets go. If you want to hide this too you can use a proxy (though the hacker would know that you are sending to a proxy, but not where your packets go afterwards).\nAnswer 2: HTTPS is sufficient \u0026ldquo;if\u0026rdquo; the client is secure. Otherwise someone can install a custom certificate and play man-in-the-middle.\nReferences:\nDoes an established HTTPS connection mean a line is really secure? - Information Security Stack Exchange php - POST data encryption - Is HTTPS enough? - Stack Overflow ","date":"2023-10-07T08:30:26Z","permalink":"https://blog.yorforger.cc/p/https-ssl-tls/","title":"HTTPS SSL TLS"},{"content":" # 1. CORS issue My frontend application is deployed on http://localhost:5173, and backend application is deployed on http://localhost:8080. The frontend application sends HTTP requests to the backend application through fetch, but it fails with the following error:\n1 2 3 4 # æ˜¾ç„¶æ²¡æœ‰æœåŠ¡å™¨å¤„ç† OPTIONS è¯·æ±‚ Access to fetch at \u0026#39;http://localhost:8080/\u0026#39; from origin \u0026#39;http://localhost:5173\u0026#39; has been blocked by CORS policy: Response to preflight request doesn\u0026#39;t pass access control check: It does not have HTTP ok status. Access to fetch at \u0026#39;http://localhost:8080/api/chat\u0026#39; from origin \u0026#39;http://localhost:5173\u0026#39; has been blocked by CORS policy: Request header field content-type is not allowed by Access-Control-Allow-Headers in preflight response. This is the famous CORS issue, and it is caused by the same-origin policy (SOP) enforced by web browsers.\nCORS is a feature built into browsers for added security. It prevents any random website from using your authenticated cookies to send an API request to your bank\u0026rsquo;s website and do stuff like secretly withdraw money.\næƒ³è±¡ä¸€ä¸‹, å¦‚æœä½ ç‚¹è¿›äº†ä¸€ä¸ªæ¶æ„ç½‘ç«™, è¿™ä¸ªç½‘ç«™æœ‰ä¸ªJSè„šæœ¬ä½¿ç”¨æ¯”å¦‚ fetch å‘ä½ é“¶è¡Œ /api/transfers å‘é€äº†ä¸€ä¸ªè¯·æ±‚, å¦‚æœæµè§ˆå™¨æ²¡æœ‰ same-origin policy é™åˆ¶, é‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±ä¼šè¢«å‘é€å‡ºå», è€Œä¸”ä¼šè‡ªåŠ¨å¸¦ä¸Šä½ çš„é“¶è¡Œç½‘ç«™çš„ cookie (ä¸€äº›è¯·æ±‚å¤´), è¿™æ ·æ¶æ„ç½‘ç«™å°±å¯ä»¥åšä¸€äº›ä½ ä¸çŸ¥é“çš„äº‹æƒ…, æ¯”å¦‚è½¬è´¦, æç°ç­‰ç­‰.\nä½†æ˜¯, æœ‰äº† same-origin policy é™åˆ¶, é‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±ä¸ä¼šè¢«æµè§ˆå™¨å‘é€å‡ºå», å› ä¸ºè¿™ä¸ªè¯·æ±‚çš„ origin å’Œä½ é“¶è¡Œç½‘ç«™çš„ origin ä¸ä¸€æ ·, æ‰€ä»¥æµè§ˆå™¨ä¼šé˜»æ­¢è¿™ä¸ªè¯·æ±‚. Origin æ˜¯æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ çš„è¯·æ±‚å¤´, ä½ ä¸èƒ½ä¿®æ”¹å®ƒ. Origin åŒ…æ‹¬ä¸‰éƒ¨åˆ†: åè®®, åŸŸå, ç«¯å£. ä¸Šé¢çš„ä¾‹å­ origin å°±æ˜¯ http://localhost:5173 å’Œ http://localhost:8080, å‰ç«¯é¡µé¢çš„ js ä»£ç æ˜¯åœ¨ http://localhost:5173 è¿è¡Œçš„, æ‰€ä»¥å®ƒçš„ origin æ˜¯ http://localhost:5173, è€Œåç«¯çš„ API æ˜¯åœ¨ http://localhost:8080 è¿è¡Œçš„, æ‰€ä»¥å®ƒçš„ origin æ˜¯ http://localhost:8080.\næ‰€ä»¥ç†è®ºä¸Šæ¥è¯´, å¦‚æœä½ çš„åç«¯æœåŠ¡å™¨ä¸å…è®¸CORS, é‚£ä¹ˆé™¤äº†è·Ÿä½ åç«¯æœåŠ¡å™¨åŒæº(Origin)çš„å‰ç«¯é¡µé¢, å…¶ä»–çš„å‰ç«¯é¡µé¢éƒ½ä¸èƒ½åœ¨æµè§ˆå™¨è®¿é—®ä½ çš„åç«¯ API. å½“ç„¶ä½ å¯ä»¥åœ¨ç»ˆç«¯ä½¿ç”¨ curl å‘½ä»¤è®¿é—®ä½ çš„åç«¯ API, å› ä¸º curl å‘½ä»¤ä¸æ˜¯æµè§ˆå™¨, å®ƒä¸ä¼šè‡ªåŠ¨æ·»åŠ  origin è¯·æ±‚å¤´. å¦å¤– React çš„ create-react-app ä¹Ÿæœ‰ä¸€ä¸ª proxy åŠŸèƒ½, å¯ä»¥è®©ä½ åœ¨å¼€å‘ç¯å¢ƒä¸‹ç»•è¿‡ CORS é™åˆ¶, ä½†æ˜¯è¿™ä¸ªä»£ç†åŠŸèƒ½åªåœ¨å¼€å‘ç¯å¢ƒä¸‹æœ‰æ•ˆ, ç”Ÿäº§ç¯å¢ƒä¸‹è¿˜æ˜¯è¦ä½ è‡ªå·±é…ç½®åç«¯æœåŠ¡å™¨çš„ CORS.\n# 2. How to fix CORS issue # 2.1. ç®€å•åœºæ™¯ è§£å†³çš„åŠæ³•å¾ˆç®€å•, åœ¨åç«¯ API çš„å“åº”å¤´é‡Œæ·»åŠ  Access-Control-Allow-Origin: * å°±å¯ä»¥äº†. ä½†è¿™ä»…é™äºä¸€äº›ç®€å•çš„åœºæ™¯, å¦‚ GET è¯·æ±‚. å¯å‚è€ƒ: Golang CORS Guide: What It Is and How to Enable It\n# 2.2. å¤æ‚åœºæ™¯ å¦‚æœä½ çš„ API æ˜¯ POST è¯·æ±‚, å¹¶ä¸”éœ€è¦å¸¦ä¸Šä¸€äº›è¯·æ±‚å¤´, é‚£ä¹ˆä½ å¯èƒ½è¿˜éœ€è¦åœ¨å“åº”å¤´é‡Œæ·»åŠ  Access-Control-Allow-Headers: *, è¿™æ ·æ‰èƒ½è®©æµè§ˆå™¨å‘é€ POST è¯·æ±‚, å¹¶ä¸”å¸¦ä¸Šä½ éœ€è¦çš„è¯·æ±‚å¤´. (å…·ä½“è§„å®šå¯å‚è€ƒ: https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨æœ‰çš„å‰ç«¯JS fetchä»£ç é‡Œ, ä½ åç«¯ç®€å•è®¾ç½® Access-Control-Allow-Origin: * å°±å¯ä»¥äº†, ä½†æ˜¯æœ‰çš„å¹¶ä¸ä¼šæˆåŠŸ.\né™¤äº†è®¾ç½®ä¸Šé¢ä¸¤ä¸ªå“åº”å¤´, ä½ è¿˜éœ€è¦å¤„ç† OPTIONS è¯·æ±‚, è¿™æ˜¯å› ä¸ºæµè§ˆå™¨åœ¨å‘é€è·¨åŸŸè¯·æ±‚æ—¶, ä¼šå…ˆå‘é€ä¸€ä¸ª OPTIONS è¯·æ±‚, ç”¨æ¥è¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚, å¦‚æœæœåŠ¡å™¨ä¸å…è®¸, é‚£ä¹ˆæµè§ˆå™¨å°±ä¸ä¼šå‘é€çœŸæ­£çš„è¯·æ±‚.\næ¯”å¦‚æˆ‘çš„åç«¯ API éœ€è¦å®¢æˆ·ç«¯å¸¦ä¸Šä¸€ä¸ªè¯·æ±‚å¤´ Content-Type: application/json å’Œ Content-Type: xxxx, é‚£ä¹ˆæˆ‘å°±éœ€è¦åœ¨å“åº”å¤´é‡Œæ·»åŠ  Access-Control-Allow-Headers: Content-Type, Content-Type, æˆ–è€… Access-Control-Allow-Headers: *, è¿™æ ·æµè§ˆå™¨å‘é€HTTPè¯·æ±‚æ—¶æ‰ä¼šå¸¦ä¸Šè¿™ä¸¤ä¸ªè¯·æ±‚å¤´.\nä½¿ç”¨ Golang å¤„ç†çš„è¯, å¤§è‡´é€»è¾‘å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 func (s *Server) ServeHTTP(w http.ResponseWriter, r *http.Request) { enableCors(\u0026amp;w) // Handle CORS preflighted request sent by browser. if (*r).Method == \u0026#34;OPTIONS\u0026#34; { return } // çœŸæ­£çš„å¤„ç†é€»è¾‘ s.mux.ServeHTTP(w, r) } func enableCors(w *http.ResponseWriter) { (*w).Header().Set(\u0026#34;Access-Control-Allow-Origin\u0026#34;, \u0026#34;*\u0026#34;) (*w).Header().Set(\u0026#34;Access-Control-Allow-Methods\u0026#34;, \u0026#34;POST, GET, OPTIONS\u0026#34;) // We need to allow the Authorization header to be sent to the backend. (*w).Header().Set(\u0026#34;Access-Control-Allow-Headers\u0026#34;, \u0026#34;*\u0026#34;) (*w).Header().Set(\u0026#34;Access-Control-Max-Age\u0026#34;, \u0026#34;86400\u0026#34;) } # 3. CORS vs SOP The Same-Origin Policy (SOP) is a security feature enforced by web browsers that restricts web pages (javascript) from interacting with resources (such as making requests or accessing data) from different origins.\nCORS allows servers to specify which origins are allowed to access their resources, even if they are from different origins. It provides a set of HTTP headers that the server includes in its responses to explicitly permit cross-origin requests from specific origins.\nReferences:\nCross-Origin Resource Sharing (CORS) - HTTP | MDN\nSame-origin policy - Web security | MDN\n","date":"2023-10-06T20:28:50Z","permalink":"https://blog.yorforger.cc/p/cross-origin-request-http/","title":"Cross-origin Request HTTP"},{"content":"Why would you get an error from Close() but not an earlier Write() call? To answer that we need to take a brief, high-level detour into the area of computer architecture.\nGenerally speaking, as you move outside and away from your CPU, actions get orders of magnitude slower. Writing to a CPU register is very fast. Accessing system RAM is quite slow in comparison. Doing I/O on disks or networks is an eternity.\nIf every Write() call committed the data to the disk synchronously, the performance of our systems would be unusably slow. While synchronous writes are very important for certain types of software (like databases), most of the time itâ€™s overkill.\nThe pathological case is writing to a file one byte at a time. Hard drives â€“ brutish, mechanical devices â€“ need to physically move a magnetic head to the position on the platter and possibly wait for a full platter revolution before the data could be persisted. SSDs, which store data in blocks and have a finite number of write cycles for each block, would quickly burn out as blocks are repeatedly written and overwritten.\nFortunately this doesnâ€™t happen because multiple layers within hardware and software implement caching and write buffering. When you call Write(), your data is not immediately being written to media. The operating system, storage controllers and the media itself are all buffering the data in order to batch smaller writes together, organizing the data optimally for storage on the medium, and deciding when best to commit it. This turns our writes from slow, blocking synchronous operations to quick, asynchronous operations that donâ€™t directly touch the much slower I/O device. Writing a byte at a time is never the most efficient thing to do, but at least we are not wearing out our hardware if we do it.\nOf course, the bytes do have to be committed to disk at some point. The operating system knows that when we close a file, we are finished with it and no subsequent write operations are going to happen. It also knows that closing the file is its last chance to tell us something went wrong.\nOn POSIX systems like Linux and macOS, closing a file is handled by the close system call. The BSD man page for close(2) talks about the errors it can return:\n1 2 3 4 5 6 7 8 9 ERRORS The close() system call will fail if: [EBADF] fildes is not a valid, active file descriptor. [EINTR] Its execution was interrupted by a signal. [EIO] A previously-uncommitted write(2) encountered an input/output error. EIO is exactly the error we are worried about. It means that weâ€™ve lost data trying to save it to disk, and our Go programs should absolutely not return a nil error in that case.\nOn Twitter, Ben Johnson suggested that Close() may be safe to run multiple times on files, like so:\n1 2 3 4 5 6 7 8 9 10 11 12 func doSomething() error { f, err := os.Create(\u0026#34;foo\u0026#34;) if err != nil { return err } defer f.Close() if _, err := f.Write([]byte(\u0026#34;bar\u0026#34;); err != nil { return err } return f.Close() } The docs for *os.File on its behavior saying: Close will return an error if it has already been called. But since we are ignoring the error from the defer, this doesnâ€™t matter.\nSource: Don\u0026rsquo;t defer Close() on writable files â€“ joe shaw\n","date":"2023-10-05T18:52:56Z","permalink":"https://blog.yorforger.cc/p/dont-defer-close-on-writable-files-go-notes/","title":"Don't Defer Close() on Writable Files - Go Notes"},{"content":" # 1. Index concepts Learn more: https://www.oreilly.com/library/view/high-performance-mysql/0596003064/ch04.html\n# 2. When will index be created Primary Key: By default, when you define a primary key constraint on a column or set of columns using the PRIMARY KEY keyword, MySQL automatically creates an index on that column(s).\n1 2 3 4 5 6 7 # index will created on user_id column create table `user` ( `user_id` smallint not null auto_increment, `username` varchar(20) not null, `password` varchar(20) not null, primary key (`user_id`) ); Unique Constraints: When you define a unique constraint on a column or set of columns using the UNIQUE keyword, MySQL automatically creates an index to enforce uniqueness.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # index will be created on username column create table `user` ( `user_id` smallint not null, `username` varchar(20) not null, `password` varchar(20) not null, unique (`username`) ); # there will be two indexes # index will be created on both user_id and username column create table `user` ( `user_id` smallint not null auto_increment, `username` varchar(20) not null, `password` varchar(20) not null, primary key (`user_id`), unique (`username`) ); # 3. Why use index Indexes are used to find rows with specific column values quickly. Without an index, MySQL must begin with the first row and then read through the entire table to find the relevant rows. The larger the table, the more this costs. If the table has an index for the columns in question, MySQL can quickly determine the position to seek to in the middle of the data file without having to look at all the data. This is much faster than reading every row sequentially.\nMost MySQL indexes (PRIMARY KEY, UNIQUE, INDEX, and FULLTEXT) are stored in B-trees. Exceptions: Indexes on spatial data types use R-trees; MEMORY tables also support hash indexes; InnoDB uses inverted lists for FULLTEXT indexes.\nThe best way to improve the performance of SELECT operations is to create indexes on one or more of the columns that are tested in the query. The index entries act like pointers to the table rows, allowing the query to quickly determine which rows match a condition in the WHERE clause, and retrieve the other column values for those rows. All MySQL data types can be indexed.\nAlthough it can be tempting to create an indexes for every possible column used in a query, unnecessary indexes waste space and waste time for MySQL to determine which indexes to use. Indexes also add to the cost of inserts, updates, and deletes because each index must be updated. You must find the right balance to achieve fast queries using the optimal set of indexes.\nSource: MySQL :: MySQL 8.0 Reference Manual :: 8.3 Optimization and Indexes\nLearn when index will be used in MySQL operations: https://dev.mysql.com/doc/refman/8.0/en/mysql-indexes.html\n# 4. Table types MyISAM and InnoDB are two different storage engines in MySQL, each with its own characteristics and features.\n# 4.1. InnoDB tables InnoDB tables provide B-tree indexes. The indexes provide no packing or prefix compression. In addition, InnoDB also requires a primary key for each table. As with BDB, though, if you donâ€™t provide a primary key, MySQL will supply a 64-bit value for you.\nThe indexes are stored in the InnoDB tablespace, just like the data and data dictionary (table definitions, etc.). Furthermore, InnoDB uses clustered indexes. That is, the primary keyâ€™s value directly affects the physical location of the row as well as its corresponding index node. Because of this, lookups based on primary key in InnoDB are very fast. Once the index node is found, the relevant records are likely to already be cached in InnoDBâ€™s buffer pool.\nWith clustered indexes, the primary key and the record itself are â€œclusteredâ€ together, and the records are all stored in primary-key order. InnoDB table uses clustered indexes.\n# 4.2. MyISAM tables MySQLâ€™s default table type provides B-tree indexes, and as of Version 4.1.0, it provides R-tree indexes for spatial data.\nWith MyISAM tables, the indexes are kept in a completely separate file that contains a list of primary (and possibly secondary) keys and a value that represents the byte offset for the record. These ensure MySQL can find and then quickly skip to that point within the database to locate the record. MySQL has to store the indexes this way because the records are stored in essentially random order.\nNote that the difference between MyISAM table and InnoDB table is that the records are stored in random order, another tables\u0026rsquo;s record stored according to clustered indexe (primary key).\nWith a standard MyISAM table index, there are two lookups, one to the index, and a second to the table itself via the location specified in the index. With clustered indexes in InnoDB table, thereâ€™s a single lookup that points directly to the record in question. Therefore, when your data is almost always searched on via its primary key, clustered indexes can make lookups incredibly fast.\n# 5. Clustered vs secondary indexes Each InnoDB table has a special index called the clustered index that stores row data. Typically, the clustered index is synonymous with the primary key. To get the best performance from queries, inserts, and other database operations, it is important to understand how InnoDB uses the clustered index to optimize the common lookup and DML operations.\nWhen you define a PRIMARY KEY on a table, InnoDB uses it as the clustered index. A primary key should be defined for each table. If there is no logical unique and non-null column or set of columns to use a the primary key, add an auto-increment column. Auto-increment column values are unique and are added automatically as new rows are inserted. If you do not define a PRIMARY KEY for a table, InnoDB uses the first UNIQUE index with all key columns defined as NOT NULL as the clustered index. If a table has no PRIMARY KEY or suitable UNIQUE index, InnoDB generates a hidden clustered index named GEN_CLUST_INDEX on a synthetic column that contains row ID values. The rows are ordered by the row ID that InnoDB assigns. The row ID is a 6-byte field that increases monotonically as new rows are inserted. Thus, the rows ordered by the row ID are physically in order of insertion. Source: https://dev.mysql.com/doc/refman/8.0/en/innodb-index-types.html\nSecondary indexes point to the primary key rather than the row. Therefore, if you index on a very large value and have several secondary indexes, you will end up with many duplicate copies of that primary index, first as the clustered index stored alongside the records themselves, but then again for as many times as you have secondary indexes pointing to those clustered indexes. With a small value as the primary key, this may not be so bad, but if you are using something potentially long, such as a URL, this repeated storage of the primary key on disk may cause storage issues.\nSome operations render clustered indexes less effective. For instance, consider when a secondary index is in use. Going back to our phone book example, suppose you have last_name set as the primary index and phone_number set as a secondary index, and you perform the following query:\n1 SELECT * FROM phone_book WHERE phone_number = \u0026#39;555-7271\u0026#39; MySQL scans the phone_number index to find the entry for 555-7271, which contains the primary key entry Zawodny because phone_bookâ€™s primary index is the last name. MySQL then skips to the relevant entry in the database itself.\nIn other words, lookups based on your primary key happen exceedingly fast, and lookups based on secondary indexes happen at essentially the same speed as MyISAM index lookups would.\nAnother less common but equally problematic condition happens when the data is altered such that the primary key is changed on a record. This is the most costly function of clustered indexes. A number of things can happen to make this operation a more severe performance hit:\nAlter the record in question according to the query that was issued. Determine the new primary key for that record, based on the altered data record. Relocate the stored records so that the record in question is moved to the proper location in the tablespace. Update any secondary indexes that point to that primary key. As you might imagine, if youâ€™re altering the primary key for a number of records, that UPDATE command might take quite some time to do its job, especially on larger tables. Choose your primary keys wisely. Use values that are unlikely to change, such as a Social Security account number instead of a last name, serial number instead of a product name, and so on.\nSource: https://www.oreilly.com/library/view/high-performance-mysql/0596003064/ch04.html\n# 6. Should each table have a primary key Short answer: yes, each table should have a PRIMARY KEY so that you could distinguish two records.\nIn MySQL, the InnoDB storage engine always creates a primary key if you didn\u0026rsquo;t specify it explicitly, thus making an extra column you don\u0026rsquo;t have access to.\nLearn more: https://stackoverflow.com/a/840182/16317008\n# 7. Unique indexes versus primary keys If youâ€™re coming from other relational databases, you might wonder what the difference between a primary key and a unique index is in MySQL. As usual, it depends. In MyISAM tables, thereâ€™s almost no difference. The only thing special about a primary key is that it canâ€™t contain NULL values. The primary key is simply a NOT NULL UNIQUE INDEX named PRIMARY. MyISAM tables donâ€™t require that you declare a primary key.\nInnoDB and BDB tables require primary keys for every table. Thereâ€™s no requirement that you specify one, however. If you donâ€™t, the storage engine automatically adds a hidden primary key for you. In both cases, the primary keys are simply incrementing numeric values, similar to an AUTO-INCREMENT column. If you decide to add your own primary key at a later time, simply use ALTER TABLE to add one. Both storage engines will discard their internally generated keys in favor of yours. Heap tables donâ€™t require a primary key but will create one for you. In fact, you can create Heap tables with no indexes at all.\n# 8. Index adds places and time overhead Time overhead is easy to understand, indexes add to the cost of inserts, updates, and deletes because each index must be updated.\nFor taking up place, there is an example: try to think our book or dictionary which have index (table of contents) which helps us to find the content quickly, the table of contents usually has multiple pages, just like this, index in a table also will take up some place which makes a table bigger.\nGiven that creating an index requires additional disk space (277,778 blocks extra from the above example, a ~28% increase), and that too many indices can cause issues arising from the file systems size limits, careful thought must be used to select the correct fields to index. Learn more: https://stackoverflow.com/a/1130/16317008\nSince indices are only used to speed up the searching for a matching field within the records, it stands to reason that indexing fields used only for output would be simply a waste of disk space and processing time when doing an insert or delete operation, and thus should be avoided.\nWhat does \u0026ldquo;indexing fields used only for output\u0026rdquo; mean?\nFor example, imagine a table of products. Some fields like \u0026ldquo;name\u0026rdquo; or \u0026ldquo;price\u0026rdquo; are used for searching and filtering, while other fields like \u0026ldquo;description\u0026rdquo; or \u0026ldquo;image_url\u0026rdquo; are used only to provide additional information in the output. Creating an index on fields used only for output is not helpful and can waste resources.\nIndexes trade space for performance. Because MySQL needs to maintain a separate list of indexesâ€™ values and keep them updated as your data changes, you really donâ€™t want to index every column in a table. Indexes are a trade-off between space and time. Youâ€™re sacrificing some extra disk space and a bit of CPU overhead on each INSERT, UPDATE, and DELETE query to make most (if not all) your queries much faster. Source: https://www.oreilly.com/library/view/high-performance-mysql/0596003064/ch04.html\n","date":"2023-10-03T12:06:36Z","permalink":"https://blog.yorforger.cc/p/index-and-primary-key/","title":"Index and Primary Key"},{"content":" # 1. Session Session is a server-side state management technique that allows the storage and retrieval of user-specific data across multiple requests. It provides a way to maintain state for individual users during their interaction with a web application. Here are some key points about session:\nSession data is stored on the server, usually in memory or in a session store. Each user is assigned a unique session ID, typically stored as a cookie or in the URL. Session data is private to each user and cannot be accessed by other users. Session data can be accessed and modified throughout the user\u0026rsquo;s session on any page of the application. Session data is available only as long as the session is active. It expires after a certain period of inactivity or can be explicitly cleared. Sessions are commonly used to store user-specific information such as user\u0026rsquo;s authorization state, user\u0026rsquo;s privilege, user preferences, and temporary data needed during the user\u0026rsquo;s session. And recently, I\u0026rsquo;m writing a chatgpt bot which needs remember user\u0026rsquo;s chat history, this is just a temporary data which need isolated with each user and not that important, session is perfect to store it.\nLearn more: Session Management - AWS\n# 2. Caching Caching is a mechanism used to temporarily store frequently accessed or expensive-to-compute data in order to improve application performance and reduce database or server load. It involves storing data in memory or another fast-access storage location. Here are some key points about caching:\nCached data is stored on the server or in a distributed cache, such as Redis or Memcached. Cached data is typically shared among all users of an application and can be accessed across multiple requests. Cached data is often used to store static or infrequently changing data that is expensive to compute or retrieve from a database. Cached data can be set to expire after a certain period or manually invalidated to ensure fresh data is retrieved when necessary. Caching can help optimize application performance by reducing the need to fetch data from slower data sources, such as databases or external APIs. It is commonly used to cache database query results, rendered views, frequently accessed configuration settings, or other expensive computations.\nDonâ€™t use cache to store anything you canâ€™t regenerate. Cache can be deleted in the middle of the session, or even in the middle of a non-atomic operation. Learn more: https://www.v2ex.com/t/109856\n# 3. Additional: session management There are various ways to manage user sessions including storing those sessions locally to the node responding to the HTTP request or designating a layer in your architecture which can store those sessions in a scalable and robust manner. Common approaches used include utilizing Sticky sessions or using a Distributed Cache for your session management.\n# 3.1. Sticky Sessions with Local Session Caching Sticky sessions, also known as session affinity, allow you to route a site user to the particular web server that is managing that individual userâ€™s session. The sessionâ€™s validity can be determined by a number of methods, including a client-side cookies or via configurable duration parameters that can be set at the load balancer which routes requests to the web servers.\nSome advantages with utilizing sticky sessions are that itâ€™s cost effective due to the fact you are storing sessions on the same web servers running your applications and that retrieval of those sessions is generally fast because it eliminates network latency. A drawback for using storing sessions on an individual node is that in the event of a failure, you are likely to lose the sessions that were resident on the failed node. In addition, in the event the number of your web servers change, for example a scale-up scenario, itâ€™s possible that the traffic may be unequally spread across the web servers as active sessions may exist on particular servers. If not mitigated properly, this can hinder the scalability of your applications.\n# 3.2. Distributed Session Management In order to address scalability and to provide a shared data storage for sessions that can be accessible from any individual web server, you can abstract the HTTP sessions from the web servers themselves. A common solution to for this is to leverage an In-Memory Key/Value store such as Redis and Memcached.\nWhile Key/Value data stores are known to be extremely fast and provide sub-millisecond latency, the added network latency and added cost are the drawbacks. An added benefit of leveraging Key/Value stores is that they can also be utilized to cache any data, not just HTTP sessions, which can help boost the overall performance of your applications.\nA consideration when choosing a distributed cache for session management is determining how many nodes may be needed in order to manage the user sessions. Generally speaking, this decision can be determined by how much traffic is expected and/or how much risk is acceptable. In a distributed session cache, the sessions are divided by the number of nodes in the cache cluster. In the event of a failure, only the sessions that are stored on the failed node are affected. If reducing risk is more important than cost, adding additional nodes to further reduce the percent of stored sessions on each node may be ideal even when fewer nodes are sufficient.\nAnother consideration may be whether or not the sessions need to be replicated or not. Some key/value stores offer replication via read replicas. In the event of a node failure, the sessions would not be entirely lost. Whether replica nodes are important in your individual architecture may inform as to which key/value store should be used. ElastiCache offerings for In-Memory key/value stores include ElastiCache for Redis, which can support replication, and ElastiCache for Memcached which does not support replication.\nThere are a number of ways to store sessions in Key/Value stores. Many application frameworks provide libraries which can abstract some of the integration plumbing required to GET/SET those sessions in memory. In other cases, you can write your own session handler to persist the sessions directly.\nSource: https://aws.amazon.com/caching/session-management/\n# 4. Conclusion Sessions are used to store user-specific data across requests, while caching is used to store frequently accessed or expensive-to-compute data to improve application performance, theyâ€™re just unrelated things. Both mechanisms have their own specific use cases and can be used together to enhance the functionality and performance of application.\nSession data could be stored in many places, using a MySQL database for example might be acceptable if that is your existing backend. Or you can store session in a central cache server, such as Redis. As you can see, cache is just a way to store data, session can be cached with Redis server or cached just in loacl memory, cache and session is like the car and high way, they are not same thing. But you should note that adding a cache layer will make your application complexed:\nâ€œThe real problem is that programmers have spent far too much time worrying about efficiency in the wrong places and at the wrong times; premature optimization is the root of all evil (or at least most of it) in programming.â€ - Donald Knuth\nTherefore, premature optimization is always a disaster. It\u0026rsquo;s not too late to add caching when actual bottlenecks are discovered after deployment or users\u0026rsquo; feedback.\nReference: What is the Difference between session and caching?\n","date":"2023-10-02T09:37:58Z","permalink":"https://blog.yorforger.cc/p/caching-session-management/","title":"Caching \u0026 Session Management"},{"content":"Previous post: https://davidzhu.xyz/post/database/redis/004-session-vs-cache/\nA paragraph I like, and share it here with you:\nâ€œThe real problem is that programmers have spent far too much time worrying about efficiency in the wrong places and at the wrong times; premature optimization is the root of all evil (or at least most of it) in programming.â€ - Donald Knuth\nPremature optimization is always a disaster. It\u0026rsquo;s not too late to add caching when actual bottlenecks are discovered after deployment or users\u0026rsquo; feedback.\n# 1. What should be cached Generally you want to cache:\nMetadata/configuration data that does not change frequently. E.g. country/state lists, external resource addresses, logic/branching settings, product/price/tax definitions, etc. Data that is costly to retrieve or generate and that does not need to frequently change. E.g. historical data sets for reports. Data that is unique to the current user\u0026rsquo;s session. The last item above is where you need to be careful as you can drastically increase your app\u0026rsquo;s memory usage, by adding a few megabytes to the data for every active session. It implies different levels of caching \u0026ndash; application wide, user session, etc.\nGenerally you should NOT cache data that is under active change.\nThis is a really broad question, and the answer depends heavily on the specific application/system you are building. Caching is only a performance optimization technique, and as with any optimization, measure first before making substantial changes, to avoid wasting time optimizing the wrong thing. Maybe you don\u0026rsquo;t need much caching, and it would only complicate your app. Maybe the data you are thinking of caching can be retrieved in a faster way, or less of it can be retrieved at once.\nSource: https://stackoverflow.com/a/13519206/16317008\ne.g.,\nEach user on my server has a credit balance which needs to be changed frequently, obviously we shouldn\u0026rsquo;t cache it, instead we should fecth it from database directly, a comment from Reddit:\nIf the credit balance (which sounds financial) query is simple and quick then pulling it directly from the backend storage should be fine and would eliminate the complexities of using a caching layer and trying to keep it in sync with the persistent storage layer.\n# 2. Where cache should sit In larger systems you also need to think about where the cache(s) will sit. Is it possible to have one central cache server (Redis), or is it good enough for each server/process to handle its own caching (local memory)?\nGenerally, Redis is used for distributed caching. But sometimes local caching like Guava Cache and Caffeine can also be considered. There are some disadvantages to using local caching: it cannot perform large-scale data storage, and the cache will become invalid when the application process restarts.\nHowever, using caching brings up issues that need to be considered: how to ensure consistency between redis and database, cache penetration, cache breakdown and cache avalanche, clustering.\ne.g.,\nA app is small enough that we haven\u0026rsquo;t had to scale a single instance yet. The three caching avenues I\u0026rsquo;m looking into are:\nin-memory - use HttpContext.Session for user data caching, with sticky sessions on the server. This is the one I tried out because it\u0026rsquo;s simplest. (This belongs to the server handle its own caching above, local memory caching) Redis - Add on MemoryDB or ElastiCache in our AWS stack. (Use Redis as a central cache server) Database caching- Use a DB table to keep that user data. I\u0026rsquo;d rather avoid this, the whole point is to avoid that round trip to the DB every pageload Source: https://www.reddit.com/r/dotnet/comments/vp873j/whats_your_preferred_session_data_caching/\n# 3. Basic Caching Strategies To maximize the advantages of the Go-Redis connection, itâ€™s imperative to employ the right caching strategy. Each strategy has its own set of merits and potential pitfalls, making the choice critical based on specific application needs. Letâ€™s deep-dive into some basic caching strategies and their respective implementation in Go.\n# 3.1. Cache-aside (Lazy Loading) Cache-aside, often termed lazy loading, is a caching pattern where the application code is responsible for loading data into the cache, updating, and invalidating cache entries.\n# 3.1.1. Implementation: Check the Cache: Initially, the application checks the cache to determine if the desired data is present. Database Call: If not present in the cache, the application fetches the data from the primary data store (e.g., a database) and then places it in the cache. Go Code: 1 2 3 4 5 6 7 8 9 10 value, err := client.Get(ctx, \u0026#34;key\u0026#34;).Result() if err == redis.Nil { // Cache miss // Fetch data from database data := fetchDataFromDB(\u0026#34;key\u0026#34;) client.Set(ctx, \u0026#34;key\u0026#34;, data, time.Hour) // Store in cache } else if err != nil { panic(err) } else { fmt.Println(\u0026#34;Data from cache:\u0026#34;, value) } # 3.1.2. Advantages \u0026amp; Disadvantages: Advantages: Minimal Initial Load: Since data is loaded on-demand, the initial loading time is reduced. Always Updated: Data in the cache is guaranteed to be current since itâ€™s fetched only when needed. Disadvantages: Latency: The first-time data is fetched (cache miss) has an additional latency since it requires a database call. Stale Data: If not managed correctly, there can be periods where stale data remains in the cache. # 3.2. Write-through Cache In a write-through caching strategy, every write to the application data also writes to the cache. The cache is always updated with fresh data.\n# 3.2.1. Implementation: Write Operation:\nEvery time thereâ€™s a write operation to the primary data store, the same data is written to the cache. Go Code:\n1 2 3 4 5 // Data update function func updateData(key string, value string) { updateDatabase(key, value) // Update primary data store client.Set(ctx, key, value, time.Hour) // Update cache } # 3.2.2 Advantages \u0026amp; Disadvantages: Advantages: Data Consistency: The cache always contains the latest data. Read Speed: Read operations are fast as data is always available in the cache. Disadvantages: Write Penalty: Every write operation comes with an overhead of updating the cache. Resource Intensive: It can be resource-intensive for write-heavy applications. # 3.3. Write-behind (or Write-back) Cache Here, the application writes directly to the cache, which then periodically updates the primary data store. This reduces the latency associated with every write operation.\n# 3.3.1. Implementation: Buffered Writes:\nWrites are buffered in the cache and are periodically flushed to the primary data store. Go Code:\n1 2 3 4 5 // Buffered data update function func bufferedUpdate(key string, value string) { client.Set(ctx, key, value, time.Hour) // Update cache // A separate routine or process will flush the cache to the primary data store } # 3.3.2. Advantages \u0026amp; Disadvantages: Advantages: Fast Writes: Write operations are speedy since they only update the cache initially. Batch Processing: Periodic flushing can leverage batch processing for efficiency. Disadvantages: Data Loss: If the cache fails before a flush, data can be lost. Complexity: Implementing a reliable flushing mechanism adds complexity. # 4. Eviction Policies: Keeping Your Cache Optimized Redis provides several eviction policies, ensuring optimal use of memory:\nNo Eviction: Redis returns errors when the memory limit is reached. AllKeys LRU: Evicts least recently used keys first. AllKeys Random: Evicts random keys. Volatile LRU: Evicts least recently used keys, but only among those set to expire. Volatile Random: Random eviction, but only among keys with an expiration set. Volatile TTL: Evicts the keys with the nearest expiration time first. In Go, you can set the desired eviction policy using:\n1 client.ConfigSet(ctx, \u0026#34;maxmemory-policy\u0026#34;, \u0026#34;allkeys-lru\u0026#34;) # 5. Best Practices for Go-Redis Caching # 5.1. Cache key naming conventions Choosing an appropriate naming convention for your cache keys can significantly improve cache manageability, readability, and prevent key collisions.\nDescriptive Names: A key should provide hints about the data it holds.\nBad: k1234 Good: user:profile:1234 Namespacing: Use colons : for separating different parts of your keys to simulate namespaces.\nExample: post:comments:4567 Versioning: When your data structure changes, you can use versioning in your keys to avoid conflicts.\nExample: v2:user:profile:1234 Keep It Concise: While descriptiveness is essential, long keys take more memory.\nExample in Go:\n1 key := fmt.Sprintf(\u0026#34;post:%d:comments\u0026#34;, postID) # 5.2. Handling Cache Misses Efficiently Cache misses can be expensive. Hereâ€™s how to manage them wisely:\nImplementing a Loading Strategy: On a cache miss, fetch the data from the primary data source and load it into the cache for future requests. This can be implemented with the Cache-aside (Lazy Loading) pattern we discussed earlier. Avoid Cache Stampede: This occurs when multiple clients try to read a key thatâ€™s missing from the cache, causing them all to hit the database simultaneously. One way to avoid this is by using a mutex or a semaphore to ensure only one client fetches from the database. Set Reasonable TTLs (Time-To-Live): For infrequently changed data, longer TTLs are apt, while frequently changed data benefits from shorter TTLs. # 6. Common Pitfalls in Go-Redis Caching and How to Avoid Them # 6.1. Not Considering Serialization Costs The Pitfall: Overlooking the time and CPU overhead of serializing and deserializing data when caching complex data structures. The Solution: Choose efficient serialization libraries and formats. In Go, libraries like encoding/gob or third-party solutions like msgpack can be considered. Test serialization strategies to see which works best for your specific data types and access patterns. e.g.,\nSerialization of cache items (encoding/gob?)\nI switched our in-memory caching to Redis and used encoding/gob to serialize the cache items. It seemed nice considering it carries type info and gave my \u0026ldquo;generic\u0026rdquo; caches a nice api (as I could just keep the redis store as an interchangeable Store interface, easily switched out for an in-memory cache without serialization or whatever), and benchmarked quite well as compared to json. But now I\u0026rsquo;m seeing a pretty massive CPU usage on our servers, and having read a bit more it might not have been a great use case for gob, which apparently is better suited for streams of data where one encoder instance is \u0026ldquo;paired\u0026rdquo; to one decoder instance. I end up having to initialize GobEncoder and GobDecoder on every ser/deser, and I suspect it\u0026rsquo;s taking a pretty heavy toll on CPU.\nIs there any way around this while still using gob? I tried keeping an encoder/decoder alive with a buffer along with a mutex, and clearing the buffer with buffer.Reset() on every ser/deser, but that fails. There seems to be more internal state to gob than that.\nWhat other serialization formats do people normally use for storing stuff in redis or equivalent?\nComments:\nOP: The thing I\u0026rsquo;m unsure about is whether gob is a viable solution for these \u0026ldquo;one off\u0026rdquo; ser/deserializations? Since it\u0026rsquo;s primarily meant for streams of data, and I end up using something like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 func Serialize(item Item) ([]byte, error) { b := new(bytes.Buffer) if err := gob.NewEncoder(b).Encode(item); err != nil { return nil, err } return b.Bytes(), nil } func Deserialize(data []byte) (*Item, error) { b := bytes.NewBuffer(data) var item Item return \u0026amp;item, gob.NewDecoder(b).Decode(\u0026amp;item) } Someone: Yeah, gob isn\u0026rsquo;t the best fit for storing singular values.\nhttps://golang.org/pkg/encoding/gob/#Encoder.Encode\n\u0026hellip; guaranteeing that all necessary type information has been transmitted first.\nThis could be the gotcha you\u0026rsquo;re facing, https://golang.org/src/encoding/gob/decoder.go#L153 will likely end up running for every single value (as each stored value is in effect a complete stream with a single element).\nedit: https://github.com/alecthomas/go_serialization_benchmarks may be helpful\nSomeone: You\u0026rsquo;ll also find that gob uses more space than many other encodings when storing singular values - it\u0026rsquo;s just not suited to this task.\nOP: Ended up using msgpack as it performed way, way better for this single value scenario. Gob is just meant for streaming I suppose.\n# 6.2. Cache Invalidation Woes The Pitfall: Not invalidating or updating the cache when the underlying data changes, leading to stale data being served. The Solution: Implement a robust cache invalidation strategy. This might include setting appropriate TTLs, using write-through caching, or manually invalidating keys when data changes. # 6.3. Not Preparing for Redis Failures The Pitfall: Failing to consider scenarios where the Redis server might become unavailable. The Solution: Implement redundancy using Redis Sentinel or Redis Cluster. On the application side, ensure that your Go application can handle Redis downtimes gracefully, potentially serving stale data or reverting to the primary data source. Learn more:\nComplete Guide to Redis in Go - From Installation to Advanced Features | Master Redis with Golang Go-Redis Caching: Strategies, Best Practices \u0026amp; Common Pitfalls ","date":"2023-10-01T17:56:58Z","permalink":"https://blog.yorforger.cc/p/caching-strategies-and-what-should-be-cached/","title":"Caching Strategies and What should be Cached"},{"content":"To prevent data race, store.Get() always creates a new session (or make a copy) and returns the session to user.\n1 2 3 4 5 6 7 // Get a session. // A copied one or new session. session, _ = store.Get(req, \u0026#34;session-key\u0026#34;) // Add a value. session.Values[\u0026#34;foo\u0026#34;] = \u0026#34;bar\u0026#34; // Save. _ = sessions.Save(req, rsp) Let\u0026rsquo;s check the source code, the Get() method of Redistore:\n1 2 3 func (s *RediStore) Get(r *http.Request, name string) (*sessions.Session, error) { return sessions.GetRegistry(r).Get(s, name) } It gets a registry associated with the request, then get the session by the registry. The code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // GetRegistry returns a registry instance for the current request. func GetRegistry(r *http.Request) *Registry { var ctx = r.Context() registry := ctx.Value(registryKey) if registry != nil { return registry.(*Registry) } newRegistry := \u0026amp;Registry{ request: r, sessions: make(map[string]sessionInfo), } *r = *r.WithContext(context.WithValue(ctx, registryKey, newRegistry)) return newRegistry } For each request they are different, even that two request from a same client. So for each new request when the server call store.Get() there will be a registry created. Only when you call store.Get() more than once in a handler, the registry := ctx.Value(registryKey) will return a non-nil registry:\n1 2 3 4 5 6 7 8 9 10 // Get a session. session, _ = store.Get(req, \u0026#34;session-key\u0026#34;) // Add a value. session.Values[\u0026#34;foo\u0026#34;] = \u0026#34;bar\u0026#34; // Save. _ = sessions.Save(req, rsp) // Get session again // because the req is same, the Registry // will be the old one created druing the first store.Get() call. session, _ = store.Get(req, \u0026#34;session-key\u0026#34;) After gets the registry, then its Registry.Get() will be called:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // Get registers and returns a session for the given name and session store. // // It returns a new session if there are no sessions registered for the name. func (s *Registry) Get(store Store, name string) (session *Session, err error) { if !isCookieNameValid(name) { return nil, fmt.Errorf(\u0026#34;sessions: invalid character in cookie name: %s\u0026#34;, name) } // because Registry is always created as a new one for each request // ok always equals to false // if you call store.Get() at a same handler twice or more, // the Registry value will be the old one which created during the first store.Get() call if info, ok := s.sessions[name]; ok { session, err = info.s, info.e } else { // for each request, there will be a new session // a brand new or a copied one session, err = store.New(s.request, name) session.name = name s.sessions[name] = sessionInfo{s: session, e: err} } session.store = store return } Let\u0026rsquo;s check how store.New work:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 func (s *RediStore) New(r *http.Request, name string) (*sessions.Session, error) { var err error session := sessions.NewSession(s, name) // make a copy options := *s.Options session.Options = \u0026amp;options session.IsNew = true if c, errCookie := r.Cookie(name); errCookie == nil { // verify the cookie err = securecookie.DecodeMulti(name, c.Value, \u0026amp;session.ID, s.Codecs...) // if the cookie is correct which means there is a corresponding session in the store // therefore, load from redistore // load() will makes a deep copy, which prevent data race // user can use the returned session safely if err == nil { ok, err := s.load(session) session.IsNew = !(err == nil \u0026amp;\u0026amp; ok) // not new if no error and data available } } return session, err } Let\u0026rsquo;s check store.load()\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // load reads the session from redis. // returns true if there is a sessoin data in DB func (s *RediStore) load(session *sessions.Session) (bool, error) { conn := s.Pool.Get() defer conn.Close() if err := conn.Err(); err != nil { return false, err } data, err := conn.Do(\u0026#34;GET\u0026#34;, s.keyPrefix+session.ID) if err != nil { return false, err } if data == nil { return false, nil // no data was associated with this key } b, err := redis.Bytes(data, err) if err != nil { return false, err } return true, s.serializer.Deserialize(b, session) } Source code: https://github.com/boj/redistore\n","date":"2023-10-01T12:12:50Z","permalink":"https://blog.yorforger.cc/p/gorilla-sessions-redisstore-source-code-analysis/","title":"Gorilla Sessions RedisStore Source Code Analysis"},{"content":" # 1. Redis data types Redis, an acronym for Remote Dictionary Server, is an open-source, in-memory data structure store. It can be employed as a database, cache, and even a message broker. Unlike traditional databases that read and write data to disk, Redis operates primarily in memory, which is one of the key reasons behind its lightning-fast data retrieval capabilities.\n# 1.1. String Redis Strings is one of the most versatile of Redisâ€™ building blocks, a binary-safe data structure, binary-safe means the strings in Redis can be any binary data. In Redis, strings are multipurpose. They can store data as simple as an integer or as complex as a JPEG image file.\nStrings is an array data structure of bytes (or words) that stores a sequence of elements, typically characters, using some character encoding. It can store any data-a string, integer, floating point value, JPEG image, serialized Ruby object, or anything else you want it to carry.\n1 2 3 4 redis\u0026gt; set mykey \u0026#34;This is a string\u0026#34; OK redis\u0026gt; get mykey \u0026#34;This is a string\u0026#34; # 1.2. Hash A Redis hash is a data type that represents a mapping between a string field and a string value. There is no integer or float value in hash, just string.\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026gt; hset bike:1 model Deimos type \u0026#39;Enduro bikes\u0026#39; price 4972 (integer) 3 \u0026gt; hget bike:1 model \u0026#34;Deimos\u0026#34; \u0026gt; hget bike:1 price \u0026#34;4972\u0026#34; \u0026gt; hgetall bike:1 1) \u0026#34;model\u0026#34; 2) \u0026#34;Deimos\u0026#34; 3) \u0026#34;type\u0026#34; 4) \u0026#34;Enduro bikes\u0026#34; 5) \u0026#34;price\u0026#34; 6) \u0026#34;4972\u0026#34; Note that the output of \u0026gt; hget bike:1 price is \u0026quot;4972\u0026quot; not 4972, which is a string.\nOn the surface, think of a hash data type as an enclosed set of key/value pairs inside the value of another key. The embedded keys are called fields. So a string is stored inside a key and inside a particular field within that key.\nFigure 3 shows the basics of how a hash is stored. The key is associated with a hash object. That hash object can have multiple fields (i.e., subkeys) associated with individual strings. This allows you to store more complex data types.\nSource:\nRedis Data Types: The Basics - The New Stack\nhttps://youtu.be/-KdITaRkQ-U?si=aAQDQfZvUhqGn800\nLearn more:\nRedis Data Types: The Basics - The New Stack\nData Structures | Redis\nRedis data types | Redis\n# 2. Key-value database All data in Redis are stored as key-value pairs, Redis keys are always strings, Redis values can be strings, hashes, lists, sets or sorted sets.\nA good practice for naming keys is to create and stick to a particular schema. For example, a common scheme for identifying objects is to use an object-type:id schema. So an object representing user id#1000 would be attached to the key name user:1000. An object representing a purchase order with an order number of 1234 might be attached to a key named order:1234.\nAdditionally, keys related to the base object can use suffixes on the key. For example, while the user id#1000 can use the key user:1000, a queue associated with that user could use the key user:1000:queue.\nSource: https://thenewstack.io/redis-data-types-the-basics/\n# 2.1. Key is always string When you store a hash object in Redis, the key is still a string, and the value is a hash data structure:\n1 2 3 4 5 6 7 127.0.0.1:6379\u0026gt; hset user:1 name Alice age 6 (integer) 2 127.0.0.1:6379\u0026gt; set os Ubuntu OK 127.0.0.1:6379\u0026gt; keys * 1) \u0026#34;user:1\u0026#34; 2) \u0026#34;os\u0026#34; As you can see there we created two key-value data above, the first one\u0026rsquo;s value is a hash and second one\u0026rsquo;s value is a string, that\u0026rsquo;s the only difference. You may think the first key \u0026quot;user:1\u0026quot; a littler strange, but it\u0026rsquo;s just a string, you can name it as user-1, user1 or other form, \u0026quot;user:1\u0026quot; is just a hash\u0026rsquo;s key naming convention in Redis.\nAnd we use key to retrieve data:\n1 2 3 4 5 6 7 8 9 127.0.0.1:6379\u0026gt; get os \u0026#34;Ubuntu\u0026#34; 127.0.0.1:6379\u0026gt; hget user:1 age \u0026#34;6\u0026#34; 127.0.0.1:6379\u0026gt; hgetall user:1 1) \u0026#34;name\u0026#34; 2) \u0026#34;Alice\u0026#34; 3) \u0026#34;age\u0026#34; 4) \u0026#34;6\u0026#34; Retrieving hash value in Redis is a little complited, as you can see, we use string \u0026quot;user:1\u0026quot; to retrieve the hash value {\u0026quot;name\u0026quot;:\u0026quot;Alice\u0026quot;, \u0026quot;age\u0026quot;, \u0026quot;6\u0026quot;}, then we use the string \u0026quot;age\u0026quot; to get the string value \u0026quot;6\u0026quot;.\n# 2.2. Don\u0026rsquo;t forget all is string Note that we are in the Redis command line, therefore we don\u0026rsquo;t need make the key or value string explicitly, what I mean is that the both codes belwo is fine:\n1 2 3 4 5 6 127.0.0.1:6379\u0026gt; set \u0026#34;greeting\u0026#34; \u0026#34;helloworld\u0026#34; OK 127.0.0.1:6379\u0026gt; set greeting helloworld OK 127.0.0.1:6379\u0026gt; hset user:1 name Alice age 12 127.0.0.1:6379\u0026gt; hset \u0026#34;user:1\u0026#34; \u0026#34;name\u0026#34; \u0026#34;Alice\u0026#34; \u0026#34;age\u0026#34; \u0026#34;12\u0026#34; Bu you should know that they are string!\nIn Redis, a key-value pair is a fundamental data structure used for storing and retrieving data. The \u0026ldquo;key\u0026rdquo; is a unique identifier that is used to access the associated \u0026ldquo;value\u0026rdquo;.\nA Redis hash is a data type that represents a mapping between a string field and a string value.\n# 3. Redis features Atomic Operations: Redis operations are atomic, ensuring data integrity and consistency, even in concurrent environments, a feature particularly complementary to Goâ€™s concurrent capabilities.\nPersistence: Even though Redis is an in-memory store, it offers optional durability. This means you can periodically save the data in memory to disk without compromising performance.\nRedis provides different methods to persist data on disk without sacrificing much performance. Configuring the right persistence option can make a significant impact. RDB Snapshots: RDB persistence offers point-in-time snapshots of your dataset at specified intervals. Append-Only File (AOF): Logs every write operation received by the server, allowing complete data recovery. Versatility: Redis isnâ€™t just a simple key-value store. It supports various data structures like strings, hashes, lists, sets, and more, making it adaptable to diverse caching needs.\nScalability: With features like replication, partitioning, and clustering, Redis is designed for high availability and horizontal scaling, catering to applications of all sizes.\nHorizontal Scaling: Using Redis Cluster, you can distribute data across multiple machines. Vertical Scaling: Increasing the hardware resources (CPU, Memory) of your existing Redis server. Replication: Setting up master-slave replication to distribute read queries among multiple nodes. Time-to-Live (TTL): Redis supports the assignment of expiration times to keys, making it conducive to caching scenarios.\nSource:\nGo-Redis Caching: Strategies, Best Practices \u0026amp; Common Pitfalls\nComplete Guide to Redis in Go - From Installation to Advanced Features | Master Redis with Golang\n# 4. Use cases # 4.1. Session Store There are many ways to save sessions, in-memory, file, database and Redis, if you don\u0026rsquo;t know session, please refer to: Cookie \u0026amp; Session\n# 4.2. Caching Learn more:\nReferences:\nInstall Redis on macOS | Redis Redis CLI | Redis Redis: In-memory database. How it works and Why you should use it | The Home of Redis Developers ","date":"2023-10-01T10:40:58Z","permalink":"https://blog.yorforger.cc/p/introduce-redis-in-memory-database/","title":"Introduce Redis - In-memory Database"},{"content":" # 1. Install \u0026amp; run redis server Install:\n1 $ brew install redis Run Redis in the foreground:\n1 $ redis-server As an alternative to running Redis in the foreground, you can also start the process in the background:\n1 2 3 $ brew services start redis $ brew services stop redis # 2. Connect to redis server Once Redis is running, you can connect it by running Redis Command Line Interface - redis-cli:\n1 2 # run a client at terminal to connect Redis server $ redis-cli By default, redis-cli connects to the server at the address 127.0.0.1 with port 6379. To specify a different host name or an IP address:\n1 $ redis-cli -h redis15.localnet.org -p 6390 By default, redis-cli uses a plain TCP connection to connect to Redis. You may enable SSL/TLS using the --tls option, along with --cacert or --cacertdir to configure a trusted root certificate bundle or directory.\nIf the target server requires authentication using a client side certificate, you can specify a certificate and a corresponding private key using --cert and --key.\n# 3. redis-cli MONITOR All commands received by the active Redis instance will be printed to the standard output:\n1 2 3 4 5 $ redis-cli MONITOR OK 1692367745.525689 [0 127.0.0.1:49963] \u0026#34;set\u0026#34; \u0026#34;name\u0026#34; \u0026#34;jack\u0026#34; 1692368601.032173 [0 127.0.0.1:49963] \u0026#34;set\u0026#34; \u0026#34;name\u0026#34; \u0026#34;john\u0026#34; 1692368645.284030 [0 127.0.0.1:49963] \u0026#34;get\u0026#34; \u0026#34;name\u0026#34; This means you will get all the commands that your redis server received from clients, recall that redis-cli will connects to the server at the address 127.0.0.1 with port 6379.\nAnd if your application C1 use a Redis server S to save data, your another application C2 that connects to server S can get that data too. When you run redis-cli, it start a client, and you can input keys * to query all key saved on your Redis server.\nOf course using Redis just from the command line interface(redis-cli) is not enough as the goal is to use it from your application. In order to do so you need to download and install a Redis client library for your programming language. You\u0026rsquo;ll find a full list of clients for different languages in this page.\n","date":"2023-09-30T16:40:58Z","permalink":"https://blog.yorforger.cc/p/useful-redis-commands/","title":"Useful Redis Commands"},{"content":" # 1. Benchmark # 1.1. b.N loop Functions of the form\n1 func BenchmarkXxx(*testing.B) are considered benchmarks, and are executed by the go test command when its -bench flag is provided. Benchmarks are run sequentially.\nA sample benchmark function looks like this:\n1 2 3 4 5 func BenchmarkRandInt(b *testing.B) { for i := 0; i \u0026lt; b.N; i++ { rand.Int() } } The benchmark function must run the target code b.N times. During benchmark execution, b.N is adjusted until the benchmark function lasts long enough to be timed reliably. The output\n1 BenchmarkRandInt-8 68453040\t17.8 ns/op means that the loop ran 68453040 times at a speed of 17.8 ns per loop.\n# 1.2. Ignore expensive setup with timer If a benchmark needs some expensive setup before running, the timer may be reset:\n1 2 3 4 5 6 7 8 func BenchmarkBigLen(b *testing.B) { big := prepare() // note this will reset the timer b.ResetTimer() for i := 0; i \u0026lt; b.N; i++ { big.Len() } } Or something like this:\n1 2 3 4 5 6 7 8 func BenchmarkFib(b *testing.B) { for n := 0; n \u0026lt; b.N; n++ { b.StopTimer() // pause timer prepare() // prepare, initial setup b.StartTimer() // continue counting funcUnderTest() // the function was tested } } # 1.3. RunParallel() If a benchmark needs to test performance in a parallel setting, it may use the RunParallel helper function; such benchmarks are intended to be used with the go test -cpu flag:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func main() { testing.Benchmark(func(b *testing.B) { templ := template.Must(template.New(\u0026#34;test\u0026#34;).Parse(\u0026#34;Hello, {{.}}!\u0026#34;)) b.RunParallel(func(pb *testing.PB) { // Each goroutine has its own bytes.Buffer. var buf bytes.Buffer for pb.Next() { // The loop body is executed b.N times total across all goroutines. buf.Reset() templ.Execute(\u0026amp;buf, \u0026#34;World\u0026#34;) } }) }) } The body function will be run in each goroutine. It should set up any goroutine-local state and then iterate until pb.Next returns false. It should not use the StartTimer, StopTimer, or ResetTimer functions, because they have global effect. It should also not call Run.\n# 1.4. Skip test TestSomething(t *testing.T) this is called test function func BenchmarkXxx(*testing.B) this is called benchmark function go test run your benchmark function and does not disable run the test functions in the package. If you want to skip the test function, you can do so by passing a regex to the -run flag that will not match anything. I usually use\n1 go test -run=XXX -bench=. Learn more: Unit Test Basic Commands - Go - David\u0026rsquo;s Blog\n# 1.5. A note on compiler optimisations Before concluding I wanted to highlight that to be completely accurate, any benchmark should be careful to avoid compiler optimisations eliminating the function under test and artificially lowering the run time of the benchmark.\n1 2 3 4 5 6 7 8 9 10 11 12 13 var result int func BenchmarkFibComplete(b *testing.B) { var r int for n := 0; n \u0026lt; b.N; n++ { // always record the result of Fib to prevent // the compiler eliminating the function call. r = Fib(10) } // always store the result to a package level variable // so the compiler cannot eliminate the Benchmark itself. result = r } References:\nhttps://pkg.go.dev/testing#hdr-Benchmarks https://pkg.go.dev/testing#B.RunParallel How to write benchmarks in Go | Dave Cheney ","date":"2023-09-30T09:58:56Z","permalink":"https://blog.yorforger.cc/p/test-benchmark-go/","title":"Test \u0026 Benchmark - Go"},{"content":"In previous post we know that don\u0026rsquo;t mediate the access to shared memory with locks and mutexes instead share that memory by communicating. However, is this always true? Sometimes you may want mutex and lock not channels, it depends on the situation. Channel is a way help mutiple groutines communicate with each other. I find some posts and share it here:\nUse a sync.Mutex or a channel?\nOne of Go\u0026rsquo;s mottos is \u0026ldquo;Share memory by communicating, don\u0026rsquo;t communicate by sharing memory.\u0026rdquo;\nThat said, Go does provide traditional locking mechanisms in the sync package. Most locking issues can be solved using either channels or traditional locks. So which should you use?\nUse whichever is most expressive and/or most simple.\nA common Go newbie mistake is to over-use channels and goroutines just because it\u0026rsquo;s possible, and/or because it\u0026rsquo;s fun. Don\u0026rsquo;t be afraid to use a sync.Mutex if that fits your problem best. Go is pragmatic in letting you use the tools that solve your problem best and not forcing you into one style of code.\nAs a general guide, though:\nChannel Mutex passing ownership of data, distributing units of work, communicating async results caches, state If you ever find your sync.Mutex locking rules are getting too complex, ask yourself whether using channel(s) might be simpler.\nWait Group\nAnother important synchronisation primitive is sync.WaitGroup. These allow co-operating goroutines to collectively wait for a threshold event before proceeding independently again.\nChannel communication, mutexes and wait-groups are complementary and can be combined.\nSource: MutexOrChannel Â· golang/go Wiki\nMutexes are faster than channels. My rule of thumb is, if you can do what you need to do with one mutex, there\u0026rsquo;s no problem with that. For instance, concurrent map access, or some integer you need atomically incremented, or other such simple things.\nHowever, you want to never try to take two locks. This includes bearing in mind that if you take a lock in your function, and call something else that takes a lock, that\u0026rsquo;s two locks. Threading hell is not caused by a single lock, it is caused by trying to use more than one at a time. At that point, you generally want channels and select. They don\u0026rsquo;t magically solve the problem. Technically you can still deadlock with channels and select.\nAlso, performance isn\u0026rsquo;t everything, but I do find it helpful to bear in mind that when using any of these primitives, they aren\u0026rsquo;t free, even if they are cheap, and they need to pay their way. In general the way you do that sort of thing is try to ensure that when you do take a lock or send a message over a channel, you do what you can to send as big a task or chunk of information as possible. Even in a local OS process, you need to be a bit careful not to design internal APIs in a way that two processes are constantly interacting over mutexes or channels. For instance, rather than a loop where you ask the user server for a user\u0026rsquo;s real name one at a time, create an API where the user server will accept the full list and return the full set in one shot. Even 13.2ns is a couple hundred cycles, and that number is also the best case, it can get worse if there is contention.\nSource: https://www.reddit.com/r/golang/comments/d85d0l/comment/f17m5e8/?utm_source=share\u0026utm_medium=web2x\u0026context=3\nThis is just an example for demonstrating passing behavior with function, don\u0026rsquo;t over-use channel:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 func newChannelStore() *Store { s := \u0026amp;Store{ops: make(chan func(map[string]*Session))} go s.loop() return s } type Store struct { ops chan func(map[string]*Session) } func (s *Store) addSession(session *Session) { s.ops \u0026lt;- func(m map[string]*Session) { // if the key has existed in map, change the value of the key. // if key doesn\u0026#39;t exist, create a new one m[session.id] = session } } func (s *Store) getSession(id string) *Session { result := make(chan *Session, 1) s.ops \u0026lt;- func(m map[string]*Session) { // everything copied by value, session is a copy of m[id] // you should consider if session has pointer field session, ok := m[id] if !ok { result \u0026lt;- nil return } result \u0026lt;- session } // wait ops finish return \u0026lt;-result } func (s *Store) loop() { sessions := make(map[string]*Session) for op := range s.ops { op(sessions) } } The code below has a better performance compared with code above which achieves in channel style:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 func newMuxStore() *store { return \u0026amp;store{ mu: sync.RWMutex{}, sessions: make(map[string]*Session), } } type store struct { mu sync.RWMutex sessions map[string]*Session } func (m *store) addSession(session *Session) { m.mu.Lock() defer m.mu.Unlock() m.sessions[session.id] = session } func (m *store) getSession(id string) *Session { m.mu.RLock() defer m.mu.RUnlock() session, ok := m.sessions[id] if !ok { return nil } return session } session.go:\n1 2 3 4 5 6 7 8 9 10 11 12 13 func newSession(id string, value int) *Session { return \u0026amp;Session{ id: id, value: value, expiry: time.Now().Add(time.Duration(10) * time.Second).Unix(), } } type Session struct { id string value int expiry int64 } ","date":"2023-09-29T20:44:55Z","permalink":"https://blog.yorforger.cc/p/dont-overuse-channel-go/","title":"Don't Overuse Channel - Go"},{"content":" # 1. bytes \u0026amp; strings packages Package strings implements simple functions to manipulate UTF-8 encoded strings.\nPackage bytes implements functions for the manipulation of byte slices. It is analogous to the facilities of the strings package.\n# 1.1. Make http request When send POST request with json body, you can write code like this:\n1 2 3 4 5 jsonBytes := []byte(`{\u0026#34;username\u0026#34;:\u0026#34;coco\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;778899a\u0026#34;}`) r, _ := http.NewRequest(\u0026#34;POST\u0026#34;, \u0026#34;/login\u0026#34;, bytes.NewReader(jsonBytes)) r.Header.Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) w := httptest.NewRecorder() ... And at the server side, decode the request body:\n1 2 3 4 5 6 7 8 9 func handleLogin(w http.ResponseWriter, r *http.Request) { user := struct { Username string `json:\u0026#34;username\u0026#34;` Password string `json:\u0026#34;password\u0026#34;` }{} decoder := json.NewDecoder(r.Body) _ = decoder.Decode(\u0026amp;user) fmt.Println(user) } Because the third parameter ofhttp.NewRequest() required to be an io.Reader, we use bytes.NewReader() to wrap jsonBytes at client side.\n1 func NewRequest(method, url string, body io.Reader) (*Request, error) You can use other type which implements the io.Reader at client to call http.NewRequest():\n1 2 3 4 jsonString := `{\u0026#34;username\u0026#34;:\u0026#34;coco\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;778899a\u0026#34;}` r, _ := http.NewRequest(\u0026#34;POST\u0026#34;, \u0026#34;/login\u0026#34;, strings.NewReader(jsonString)) r.Header.Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) ... As you can see the package bytes and strings are just different for processing byte slices and strings, strings.NewReader() wraps a string value into an io.Reader whereas bytes.NewReader converts a byte slice into an io.Reader.\nstrings.NewRecoder():\n1 func NewReader(s string) *Reader bytes.NewReader:\n1 func NewReader(b []byte) *Reader # 2. bytes.Buffer type A Buffer is a variable-sized buffer of bytes with Read and Write methods. This means it has implemented io.Reader and io.Writer interface.\n1 2 3 4 5 6 7 // A Buffer is a variable-sized buffer of bytes with Read and Write methods. // The zero value for Buffer is an empty buffer ready to use. type Buffer struct { buf []byte // contents are the bytes buf[off : len(buf)] off int // read at \u0026amp;buf[off], write at \u0026amp;buf[len(buf)] lastRead readOp // last read operation, so that Unread* can work correctly. } # 3. bufio package Buffered I/O is a technique that allows a program to read or write data in chunks rather than one byte at a time. This is useful because it allows the program to read or write data more efficiently. It also allows the program to read or write data more predictably.\n# 3.1. bufio.Reader \u0026amp; io.Reader To create a buffered reader (bufio.Reader), you can use the bufio.NewReader function. This function takes an io.Reader as an argument. This means that you can pass in any type that implements the io.Reader interface. This includes os.File, strings.Reader, and bytes.Buffer.\nNote that until we introdeced two Readesr: io.Reader and bufio.Reader. bufio.Reader just wraps an io.Reader and provides additional buffering functionality, such as ReadLine(), ReadString(), and ReadBytes().\n1 func (b *Reader) ReadLine() (line []byte, isPrefix bool, err error) ReadLine() is a low-level line-reading primitive. Most callers should use ReadBytes('\\n') or ReadString('\\n') instead or use a bufio.Scanner.\n1 func (b *Reader) ReadString(delim byte) (string, error) ReadString() reads until the first occurrence of delim in the input, returning a string containing the data up to and including the delimiter.\nThe following program reads the content of a file line-by-line delimited with value '\\n' :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 func main() { file, err := os.Open(\u0026#34;./planets.txt\u0026#34;) if err != nil { fmt.Println(err) os.Exit(1) } defer file.Close() reader := bufio.NewReader(file) for { line, err := reader.ReadString(\u0026#39;\\n\u0026#39;) if err != nil { if err == io.EOF { break } else { fmt.Println(err) os.Exit(1) } } fmt.Print(line) } } // credit: https://medium.com/learning-the-go-programming-language/streaming-io-in-go-d93507931185 # 3.2. bufio vs. io package The main difference between buffered I/O and normal I/O is that buffered I/O reads or writes data in chunks rather than one byte at a time. While on the other side normal I/O reads or writes data one byte at a time. This might not seem like a big difference but it can make a big difference in performance.\nIn a case where you are reading or writing a lot of data, buffered I/O can be much faster than normal I/O. To see this, we can compare the performance of buffered I/O and normal I/O using benchmarks.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 func funcToWithIO() { file, err := os.Open(\u0026#34;file.txt\u0026#34;) if err != nil { fmt.Println(err) return } defer file.Close() data := make([]byte, 100) for { _, err := file.Read(data) if err == io.EOF { break } if err != nil { fmt.Println(err) return } } } func funcToWithBufio() { file, err := os.Open(\u0026#34;file.txt\u0026#34;) if err != nil { fmt.Println(err) return } defer file.Close() reader := bufio.NewReader(file) data := make([]byte, 100) for { _, err := reader.Read(data) if err == io.EOF { break } if err != nil { fmt.Println(err) return } } } func createFile() { file, err := os.Create(\u0026#34;file.txt\u0026#34;) if err != nil { fmt.Println(err) return } defer file.Close() for i := 0; i \u0026lt; 1000000; i++ { file.Write([]byte(\u0026#34;Hello World!\u0026#34;)) } } func main() { createFile() funcToWithIO() funcToWithBufio() } Test file:\n1 2 3 4 5 6 7 8 9 10 11 func BenchmarkFuncToWithIO(b *testing.B) { for i := 0; i \u0026lt; b.N; i++ { funcToWithIO() } } func BenchmarkFuncToWithBufio(b *testing.B) { for i := 0; i \u0026lt; b.N; i++ { funcToWithBufio() } } 1 2 3 4 5 6 7 $ go test -bench \u0026#39;BenchmarkFuncToWithIO|BenchmarkFuncToWithBufio\u0026#39; goos: darwin goarch: arm64 pkg: leetcode BenchmarkFuncToWithIO-8 18 62718294 ns/op BenchmarkFuncToWithBufio-8 469 2531219 ns/op PASS Source: https://www.kelche.co/blog/go/golang-bufio/\n","date":"2023-09-26T17:03:55Z","permalink":"https://blog.yorforger.cc/p/useful-types-and-packages-for-io-go/","title":"Useful Types and Packages for IO - Go"},{"content":"Connecting to my aws server with ssh client is very slow, and after connected, the session is very slow too.\nLike input a command in the ssh session and you have to wait seconds to get the output, lots of latency.\nThen I think maybe there is a \u0026ldquo;bad\u0026rdquo; process which takes a lot of cpu usages makes my server in high load, or there is a high network traffic. Then I use top command to check, then I got this:\n1 2 $ top 60841 asterisk -11 0 1025372 325376 9300 R 99.9 32.9 980:16.51 asterisk The asterisk which takes up 99.9% of my cup!!!\nThenk I kill it with\n1 sudo kill 60841 Then my server works fine.\n","date":"2023-09-25T14:30:22Z","permalink":"https://blog.yorforger.cc/p/ssh-session-vary-slow/","title":"ssh session vary slow"},{"content":" # 1. Content-Type header The Content-Type header can be application/json, application/x-www-form-urlencoded, multipart/form-data, the first two is usually used with posting form data to server, the third is used to upload file to the server.\nThe format of application/json is '{\u0026quot;username\u0026quot;:\u0026quot;davidzhu\u0026quot;, \u0026quot;password\u0026quot;:\u0026quot;778899a\u0026quot;}'.\nThe format of application/x-www-form-urlencoded is \u0026quot;username=davidzhu\u0026amp;password=778899a\u0026quot; .\n# 2. Parse query string and x-www-form-urlencoded data In previous post I have talked that r.ParseForm() will try to parse both query string and request body in Go, but there is a condition: the Content-Type header of the reuqest must be application/x-www-form-urlencoded and you have the correct format data in the request body. Otherwise, the request body will be ignored by r.ParseForm(), it just tries to parse query string resides in the URL. Talk is cheap let\u0026rsquo;s show the codes,\nFirst, there is a simple handler which parses form data or query string:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 func handlePostForm(w http.ResponseWriter, r *http.Request) { // r.ParseForm() parses username and password in form or query string. // And puts the parsed data into r.Form which is a map value. if err := r.ParseForm(); err != nil { http.Error(w, fmt.Sprintf(\u0026#34;failed to parse username and password: %v\u0026#34;, err), http.StatusMethodNotAllowed) return } username := r.Form.Get(\u0026#34;username\u0026#34;) password := r.Form.Get(\u0026#34;password\u0026#34;) if username == \u0026#34;\u0026#34; || password == \u0026#34;\u0026#34; { http.Error(w, \u0026#34;failed to parse username and password: no username or password\u0026#34;, http.StatusMethodNotAllowed) return } _, _ = fmt.Fprint(w, fmt.Sprintf(\u0026#34;username:%v password:%v\\n\u0026#34;, username, password)) } func main() { mux := http.NewServeMux() // Add pattern and its handdler into mux mux.HandleFunc(\u0026#34;/postform\u0026#34;, handlePostForm) // http.ListenAndServe will call mux.ServerHTTP(w, r) _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, mux) } And the request below will get same result:\n1 2 $ curl -X POST \u0026#34;localhost:8080/postform?username=david\u0026amp;password=778899a\u0026#34; $ curl -X POST localhost:8080/postform -d \u0026#34;username=davidzhu\u0026amp;password=778899a\u0026#34; But the code below won\u0026rsquo;t work, because the Content-Type header is not application/x-www-form-urlencoded:\n1 2 3 4 5 $ curl -X POST localhost:8080/postform -d \u0026#34;username=davidzhu\u0026amp;password=778899a\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; failed to parse username and password: no username or password # 3. Parse json data from request body The handler should be like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 func handlePostBody(w http.ResponseWriter, r *http.Request) { // Parse username and password in form. type info struct { Username string `json:\u0026#34;username\u0026#34;` Password string `json:\u0026#34;password\u0026#34;` } user := info{} // note that r.Body is an io.Reader // which means decoder.Decode() method will consume data stroed in r.Body // you cannot read same data twice decoder := json.NewDecoder(r.Body) err := decoder.Decode(\u0026amp;user) if err != nil { http.Error(w, fmt.Sprintf(\u0026#34;failed to decode post body:%v\u0026#34;, err), http.StatusMethodNotAllowed) } _, _ = fmt.Fprint(w, fmt.Sprintf(\u0026#34;username:%v password:%v\\n\u0026#34;, user.Username, user.Password)) } The command below won\u0026rsquo;t work:\n1 2 3 4 5 $ curl -X POST localhost:8080/postbody -d \u0026#34;username=davidzhu\u0026amp;password=778899a\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; failed to decode post body:invalid character \u0026#39;u\u0026#39; looking for beginning of value username: password: Because the data format isn\u0026rsquo;t correct, this will work:\n1 $ curl localhost:8080/postbody -d \u0026#39;{\u0026#34;username\u0026#34;:\u0026#34;davidzhu\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;778899a\u0026#34;}\u0026#39; ","date":"2023-09-23T18:08:55Z","permalink":"https://blog.yorforger.cc/p/parse-form-data-in-go-server/","title":"Parse Form Data in Go Server"},{"content":" # 1. Intro of HTTP messages There are two types of messages: requests sent by the client to trigger an action on the server, and responses, the answer from the server.\nHTTP requests, and responses, share similar structure and are composed of:\nA start-line describing the requests to be implemented, or its status of whether successful or a failure. This start-line is always a single line. An optional set of HTTP headers specifying the request, or describing the body included in the message. A blank line indicating all meta-information for the request has been sent. An optional body containing data associated with the request (like content of an HTML form), or the document associated with a response. The presence of the body and its size is specified by the start-line and HTTP headers. The start-line and HTTP headers of the HTTP message are collectively known as the head of the requests, whereas its payload is known as the body.\n# 2. HTTP Requests # 2.1. Start line A start line contains three parts:\nTheir start-line contain three elements: An HTTP method, a verb (like GET, PUT or POST) or a noun (like HEAD or OPTIONS), that describes the action to be performed. GET è¯·æ±‚çš„ç»“æœå¯è¢«æµè§ˆå™¨å’Œå…¶ä»–ä¸­é—´ä»¶(ä»£ç†æœåŠ¡å™¨)ç¼“å­˜ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè¢«é‡å¤æ‰§è¡Œï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶ï¼‰ã€‚ å¦‚æœä½ æ˜¯åœ¨ç”¨æˆ·ç‚¹å‡»æŸä¸ªæŒ‰é’®åé€šè¿‡ GET è¯·æ±‚æ¥å¤„ç†ç‚¹èµåŠŸèƒ½ï¼Œé‚£ä¹ˆç†è®ºä¸Šï¼Œä»…å½“ç”¨æˆ·å†æ¬¡ç‚¹å‡»è¿™ä¸ªæŒ‰é’®æ—¶ï¼Œè¯¥ GET è¯·æ±‚æ‰ä¼šè¢«é‡æ–°å‘é€ã€‚å¦‚æœä½ çš„å‰ç«¯é€»è¾‘ç¡®ä¿äº†æ¯æ¬¡ç‚¹å‡»éƒ½å¯¹åº”ä¸€ä¸ªç‚¹èµæ“ä½œï¼Œé‚£ä¹ˆä¸ä¼šå› ä¸ºæµè§ˆå™¨é¡µé¢åˆ·æ–°è€Œå¯¼è‡´é‡å¤æäº¤ã€‚ç„¶è€Œï¼Œå³ä½¿æ˜¯è¿™ç§æƒ…å†µï¼Œä½¿ç”¨ GET è¯·æ±‚æ¥å¤„ç†ç‚¹èµåŠ¨ä½œä»ç„¶ä¸æ˜¯æœ€ä½³å®è·µï¼ŒåŸå› åŒ…æ‹¬ï¼š éå¹‚ç­‰æ€§ï¼šç‚¹èµæ“ä½œæ˜¯éå¹‚ç­‰çš„ï¼Œå› ä¸ºæ¯æ¬¡æ“ä½œéƒ½æ”¹å˜äº†æœåŠ¡å™¨ä¸Šçš„çŠ¶æ€ï¼ˆå³å¢åŠ äº†ç‚¹èµè®¡æ•°ï¼‰ã€‚è€Œ GET è¯·æ±‚åº”å½“æ˜¯å¹‚ç­‰çš„ï¼Œå³å¤šæ¬¡æ‰§è¡Œç›¸åŒçš„è¯·æ±‚åº”è¯¥å…·æœ‰ç›¸åŒçš„å‰¯ä½œç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤šæ¬¡ç‚¹å‡»æŒ‰é’®ä¼šå¯¼è‡´å¤šæ¬¡ç‚¹èµï¼Œè¿åäº† GET è¯·æ±‚çš„å¹‚ç­‰æ€§åŸåˆ™ã€‚\nThe request target\nUsually a URL Sometimes url followed by a '?' and query string: http://example.com/?bar1=a\u0026amp;bar2=b The HTTP version\n1 POST www.example.com/test.html?username=alibaba HTTP/1.1 # 2.2. Headers An HTTP header consists of its case-insensitive name followed by a colon (:), then by its value. Whitespace before the value is ignored. This is an HTTP header:\n1 Content-Type: text/html; charset=utf-8 Usually, a request or response consist of many headers:\n1 2 3 4 5 6 7 8 GET /home.html HTTP/1.1 Host: developer.mozilla.org User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:50.0) Gecko/20100101 Firefox/50.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate, br Referer: https://developer.mozilla.org/testpage.html Connection: keep-alive As you can see above, there are 7 headers in this request, a header like a key-value string, different header usually has different syntax and its own type. For example:\nThe type of Accept header is a Request header, and its syntax is below:\n1 2 3 4 5 6 Accept: \u0026lt;MIME_type\u0026gt;/\u0026lt;MIME_subtype\u0026gt; Accept: \u0026lt;MIME_type\u0026gt;/* Accept: */* // Multiple types, weighted with the quality value syntax: Accept: text/html, application/xhtml+xml, application/xml;q=0.9, image/webp, */*;q=0.8 The type of Content-Type header is Representation header, and its syntax:\n1 2 Content-Type: text/html; charset=utf-8 Content-Type: multipart/form-data; boundary=something The offcial way to indicate aobve is:\nMany different headers can appear in an HTTP request. They can be divided in several groups:\nGeneral headers, like Via, apply to the message as a whole. Request headers, like User-Agent or Accept, modify the request by specifying it further (like Accept-Language), by giving context (like Referer), or by conditionally restricting it (like If-None). Representation headers like Content-Type that describe the original format of the message data and any encoding applied (only present if the message has a body). # 2.3. Body The final part of the request is its body. Not all requests have one: requests fetching resources, like GET, HEAD, DELETE, or OPTIONS, usually don\u0026rsquo;t need one. Some requests send data to the server in order to update it: as often the case with POST requests (containing HTML form data).\nBodies can be broadly divided into two categories:\nSingle-resource bodies, consisting of one single file, defined by the two headers: Content-Type and Content-Length. Multiple-resource bodies, consisting of a multipart body, each containing a different bit of information. This is typically associated with HTML Forms. # 3. HTTP Responses HTTP Reponse also contains three parts:\nStatus line\nThree part: protocol version, a status code, a status text (A brief, purely informational, textual description of the status code to help a human understand the HTTP message.) HTTP/1.1 404 Not Found Headers\nSame as http request. Body\nSame as http request. Reference: HTTP Messages - HTTP | MDN\n","date":"2023-09-23T09:51:30Z","permalink":"https://blog.yorforger.cc/p/http-messages/","title":"HTTP Messages"},{"content":" # 1. POST data with Curl The Content-Type header can be application/json, application/x-www-form-urlencoded, multipart/form-data, the first two is usually used with posting form data to server, the third is used to upload file to the server.\nThe format of application/json is '{\u0026quot;username\u0026quot;:\u0026quot;davidzhu\u0026quot;, \u0026quot;password\u0026quot;:\u0026quot;778899a\u0026quot;}'.\nThe format of application/x-www-form-urlencoded is \u0026quot;username=davidzhu\u0026amp;password=778899a\u0026quot; .\ne.g.,\nPOST x-www-form-urlencoded format form data to server:\n1 2 # curl will set the request header to \u0026#39;application/x-www-form-urlencoded\u0026#39; by default curl localhost:8080/hello -d \u0026#34;username=davidzhu\u0026amp;password=778899a\u0026#34; POST json format data with curl:\n1 2 3 4 # you need specify the Content-Type header to application/json explictly curl -X POST [URL] -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{\u0026#34;username\u0026#34;:\u0026#34;davidzhu\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;778899a\u0026#34;}\u0026#39; Note that we use single quote to wrap the double quote which makes double quote lose its special meaning, it\u0026rsquo;s just all about shell scripting, learn more: Shell Script Basic Syntax - David\u0026rsquo;s Blog\nBad example:\n1 2 # Bad example curl localhost:8080/hello -d \u0026#39;{\u0026#34;username\u0026#34;:\u0026#34;davidzhu\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;778899a\u0026#34;}\u0026#39; The server will parse it wrong, because the data format is json obviously, but curl will set the Content-Type header to application/x-www-form-urlencoded by default. Therefore, don\u0026rsquo;t write it wrong, otherwise, your server won\u0026rsquo;t parse data from the request correctly.\nThe content below form the docs of curl, hope it will help:\nTo make a POST request with Curl, you can run the Curl command-line tool with the -d or --data command-line option and pass the data as the second argument. Curl will automatically select the HTTP POST method and application/x-www-form-urlencoded content type if the method and content type are not explicitly specified. Source\nIf you submit data using Curl and do not explicitly specify the Content type, Curl uses the application/x-www-form-urlencoded content type for your data. Therefore, when sending JSON (or any other data type), you must specify the data type using the -H \u0026ldquo;Content-Type: application/json\u0026rdquo; command line parameter.\n1 2 3 $ curl localhost:8080/hello -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{\u0026#34;Id\u0026#34;: 79, \u0026#34;status\u0026#34;: 3}\u0026#39; Learn more: application/x-www-form-urlencoded and multipart/form-data\nLearn more about http request header: https://davidzhu.xyz/post/cs-basics/018-http-messages/\n# 2. Query string with curl 1 2 3 $ curl -X POST \u0026#34;localhost:8080/postform?username=david\u0026amp;password=778899a\u0026#34; # The code below won\u0026#39; work (you have to make it with double quote): $ curl -X POST localhost:8080/postform?username=david\u0026amp;password=778899a # wrong ","date":"2023-09-22T22:58:30Z","permalink":"https://blog.yorforger.cc/p/curl-basics/","title":"Curl Basics"},{"content":"This article enlightened by:\nUnderstanding Mux and Handler concept GopherCon 2019: Mat Ryer - How I Write HTTP Web Services after Eight Years # 1. Hello world - 2 ways # 1.1. Implementing a Handler Interface - way 1 To run a server, we need to implement http.Handler interface:\n1 2 3 type Handler interface{ ServeHTTP(ResponseWriter, *Request) } To achieve that we need to create an empty struct and provide a method for it:\n1 2 3 4 5 6 7 8 9 10 11 type handler struct{} func (h *handler) ServeHTTP(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprint(w, \u0026#34;hello world\\n\u0026#34;) } func main() { h := \u0026amp;handler{} // 1 http.Handle(\u0026#34;/\u0026#34;, h) // 3 _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) //4 } Note that the signature of http.Handle():\n1 2 // Handle() registers the handler for the given pattern in the DefaultServeMux. func Handle(pattern string, handler Handler) the http.ListenAndServe()\n1 2 // The handler is typically nil, in which case the DefaultServeMux is used. func ListenAndServe(addr string, handler Handler) error Test:\n1 2 $ curl localhost:8080 hello world We creating an empty struct that implements http.Handler interface http.Handle() will register our handler for the given pattern, in our case, it is â€œ/â€. Why pattern and not URI? Because under the hood when your server is running and getting any request - it will find the closest pattern to the request path and dispatch the request to the corresponding handler. That means that if you will try to call \u0026lsquo;http://localhost:8000/some/other/path?value=foo\u0026rsquo; it will still be dispatched to our registered handler, even if it is registered under the â€œ/â€ pattern. On the last line with http.ListenAndServe we starting server on the port 8000. Keep in mind the second argument, which is nil for now, but we will consider it in detail in a few moments. # 1.2. Using handler function - way 2 1 2 3 4 5 6 7 8 func handler(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprint(w, \u0026#34;hello world\\n\u0026#34;) } func main() { http.HandleFunc(\u0026#34;/\u0026#34;, handler) _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) } Note that the http.HandleFunc() above:\n1 2 // HandleFunc() registers the handler function for the given pattern in the DefaultServeMux. func HandleFunc(pattern string, handler func(ResponseWriter, *Request)) Test:\n1 2 $ curl localhost:8080 hello world This example looks very similar to the previous one, but it is a little bit shorter and easier to develop. We donâ€™t need to implement any interface.\nNotice that under the hood http.HandleFunc() is just syntax sugar for avoiding the creation of http.Handler instances on each pattern. http.HandleFunc() is an adapter that converts a function to a struct with serveHTTP() method. So instead of this:\n1 2 3 4 5 6 7 8 9 10 11 12 type root struct{} func (t *root) ServeHTTP(w http.ResponseWriter, r *http.Request) {...} type home struct{} func (t *home) ServeHTTP(w http.ResponseWriter, r *http.Request) {...} type login struct{} func (t *login) ServeHTTP(w http.ResponseWriter, r *http.Request) {...} //... http.Handle(\u0026#34;/\u0026#34;, root) http.Handle(\u0026#34;/home\u0026#34;, home) http.Handle(\u0026#34;/login\u0026#34;, login) We can just use this approach:\n1 2 3 4 5 6 7 func root(w http.ResponseWriter, r *http.Request) {...} func home(w http.ResponseWriter, r *http.Request) {...} func login(w http.ResponseWriter, r *http.Request) {...} ... http.HandleFunc(\u0026#34;/\u0026#34;, root) http.HandleFunc(\u0026#34;/home\u0026#34;, home) http.HandleFunc(\u0026#34;/login\u0026#34;, login) # 2. ServeMux - the Router # 2.1. Register patterns for ServeMux You\u0026rsquo;ve probably noticed that above:\n1 2 3 4 5 6 7 8 9 // HandleFunc() registers the handler function for the given pattern in the DefaultServeMux. func HandleFunc(pattern string, handler func(ResponseWriter, *Request)) // Handle() registers the handler for the given pattern in the DefaultServeMux. func Handle(pattern string, handler Handler) // ListenAndServe() listens on the TCP network address addr and then calls Serve with handler to handle requests on incoming connections. // The handler is typically nil, in which case the DefaultServeMux is used. func ListenAndServe(addr string, handler Handler) error The comment of Handle() is quite confusing, what does \u0026ldquo;register\u0026rdquo; mean? We can check what this function does:\n1 2 3 // Handle registers the handler for the given pattern // in the DefaultServeMux. func Handle(pattern string, handler Handler) { DefaultServeMux.Handle(pattern, handler) } This is the definition of DefaultServeMux.Handle(pattern, handler) (I\u0026rsquo;ve deleted some codes):\n1 2 3 4 5 6 7 8 9 func (mux *ServeMux) Handle(pattern string, handler Handler) { // check if the pattern has existed if _, exist := mux.m[pattern]; exist { panic(\u0026#34;http: multiple registrations for \u0026#34; + pattern) } // add (register) the pattern and its corresponding hander into ServeMux e := muxEntry{h: handler, pattern: pattern} mux.m[pattern] = e } 1 2 3 4 5 6 7 8 9 10 11 type ServeMux struct { mu sync.RWMutex m map[string]muxEntry es []muxEntry // slice of entries sorted from longest to shortest. hosts bool } type muxEntry struct { h Handler pattern string } You can think ServeMux uses a map m to store the patterns and its corresponding hander. Functions http.Handle() and http.HandleFunc() will call ServeMux\u0026rsquo;s two method DefaultServeMux.HandleFunc(pattern, handler) and DefaultServeMux.Handle(pattern, handler) which will add (register) pattern into the default ServeMux.\nWe don\u0026rsquo;t need to call functions http.Handle() and http.HandleFunc() to register patterns for ServeMux, we can create our own ServeMux and we call its method HandleFunc() and Handle() directly.\nNote that there are four functions, first two is http.HandleFunc() and http.Handle() which were used above in the main code. Another two are the methods of ServeMux. They do different things, the first two just call the last two.\nA method contains a receiver, and a function does not contain a receiver.\n# 2.2 ServeMux - a request dispatcher (Router) ServeMux implements the function ServeHTTP() which means it implements http.Handler interface, ServeMux is a http.Handler itself:\n1 2 3 4 5 6 7 // ServeHTTP dispatches the request to the handler whose // pattern most closely matches the request URL. func (mux *ServeMux) ServeHTTP(w ResponseWriter, r *Request) { // mux.Handler() returns the handler to use for the given request h, _ := mux.Handler(r) h.ServeHTTP(w, r) } Do you remember we said:\nNotice that under the hood http.HandleFunc() is just syntax sugar for avoiding the creation of http.Handler instances on each pattern. HandleFunc() is an adapter that converts a function to a struct with serveHTTP() method.\nActually it converts a function into another function type HandlerFunc which has implemented http.Handler, I\u0026rsquo;ll show you:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 func handler(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprint(w, \u0026#34;hello world\\n\u0026#34;) } func main() { http.HandleFunc(\u0026#34;/\u0026#34;, handler) _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) } //------------http.HandleFunc()-----------\u0026gt; // HandleFunc registers the handler function for the given pattern // in the DefaultServeMux. // The documentation for ServeMux explains how patterns are matched. func HandleFunc(pattern string, handler func(ResponseWriter, *Request)) { DefaultServeMux.HandleFunc(pattern, handler) } //-------DefaultServeMux.HandleFunc(pattern, handler)-----------\u0026gt; // HandleFunc registers the handler function for the given pattern. func (mux *ServeMux) HandleFunc(pattern string, handler func(ResponseWriter, *Request)) { if handler == nil { panic(\u0026#34;http: nil handler\u0026#34;) } mux.Handle(pattern, HandlerFunc(handler)) } //------------HandlerFunc--------------\u0026gt; // The HandlerFunc type is an adapter to allow the use of // ordinary functions as HTTP handlers. If f is a function // with the appropriate signature, HandlerFunc(f) is a // Handler that calls f. type HandlerFunc func(ResponseWriter, *Request) // ServeHTTP calls f(w, r). func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) { f(w, r) } Now you know that when develop a web app we have to deal with http requests, and we do this by regisering some patterns (urls) with its handler which is an instance of http.Handler into a ServeMux. We can take advantage offunc HandleFunc(pattern string, handler func(ResponseWriter, *Request)) which helps us create an instance of http.Handler for the pattern.\nServeMux is an HTTP request multiplexer. It matches the URL of each incoming request against a list of registered patterns and calls the handler for the pattern that most closely matches the URL. ServeMux - Go\nKeep in mind that servemux, provided by Go will process each request in a separate goroutine.\n# 3. Creating own ServeMux At part one we create two hello wrold example and we pass nil to ListenAndServe():\n1 2 3 4 func main() { http.HandleFunc(\u0026#34;/\u0026#34;, handler) _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) } We can check the source code:\n1 2 3 4 5 // The handler is typically nil, in which case the DefaultServeMux is used. func ListenAndServe(addr string, handler Handler) error { server := \u0026amp;Server{Addr: addr, Handler: handler} return server.ListenAndServe() } Therefore, we can create our own ServeMux and pass it to ListenAndServe(), and we can register patterns to ServeMux directly which means we don\u0026rsquo;t need to use http.HandleFunc() and ``http.Handle()` to help us register anymore.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 func newServer() *server { s := \u0026amp;server{ router: http.NewServeMux(), } s.routes() return s } // you can put dependencies here, like a db type server struct { router *http.ServeMux } // make our server as a http.Handler // so that we can pass it to ListenAndServe() // don\u0026#39;t hide any logic here, which means don\u0026#39;t write any other code // if you want do something before a request, valide request for example // use a middleware instead, // middleware: https://davidzhu.xyz/post/golang/practice/008-closures-go/#22-creating-middleware // learn more: https://youtu.be/rWBSMsLG8po?si=qwtUTKF3J4EtWRQC // I\u0026#39;ll explain why we call s.router.ServeHTTP(w, r) later func (s *server) ServeHTTP(w http.ResponseWriter, r *http.Request) { s.router.ServeHTTP(w, r) } // register patterns for ServeMux directly func (s *server) routes() { s.router.HandleFunc(\u0026#34;/\u0026#34;, s.handleIndex) s.router.HandleFunc(\u0026#34;/favicon.ico\u0026#34;, s.handleFavicon) } func (s *server) handleFavicon(_ http.ResponseWriter, _ *http.Request) {} func (s *server) handleIndex(w http.ResponseWriter, _ *http.Request) { _, _ = fmt.Fprint(w, \u0026#34;hello there\u0026#34;) } func main() { // As we have talked befor, don\u0026#39;t need to register patterns here // because we have registered patterns to ServeMux directly in routes() method s := newServer() // s is a http.Handler, so we can pass it here log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, s)) } The code above has this:\n1 2 3 func (s *server) ServeHTTP(w http.ResponseWriter, r *http.Request) { s.router.ServeHTTP(w, r) } Recall that ServeHTTP() method of ServeMux is used to dispatches the http requests to the handler function, we pass our server to http.ListenAndServe() which means http package will treat our server as the \u0026ldquo;DefaultServeMux\u0026rdquo;, which means that the ServeHTTP() method of our server will be called to \u0026ldquo;dispatche\u0026rdquo; the http request by the http packet. But as you can see, there is nothing but a call for s.router.ServeHTTP(w, r), yes, http packet calls the ServeHTTP() method of our server to dispatche http request, but actually the ServeHTTP() method of our server call the ServeHTTP() of our ServeMux to dispatche http request.\n1 2 3 4 5 6 7 // ServeHTTP dispatches the request to the handler whose // pattern most closely matches the request URL. func (mux *ServeMux) ServeHTTP(w ResponseWriter, r *Request) { // mux.Handler() returns the handler to use for the given request h, _ := mux.Handler(r) h.ServeHTTP(w, r) } Actually we can delete the method ServeHTTP of our server and just pass our ServeMux to ListenAndServe():\n1 2 ... log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, s.router)) But this probably looks not as elegant as:\n1 log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, s)) Now you should understand the nature of ServeMux: a router of our web application.\n","date":"2023-09-19T23:49:55Z","permalink":"https://blog.yorforger.cc/p/the-router-of-go-web-app-servemux/","title":"The Router of Go Web App - ServeMux"},{"content":"Previous post: First-Class Functions - Go - David\u0026rsquo;s Blog\n# 1. What is closure Go functions may be closures. A closure is a function value that references variables from outside its body. The function may access and assign to the referenced variables; in this sense the function is \u0026ldquo;bound\u0026rdquo; to the variables.\nClosures - A Tour of Go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 func adder() func(int) (int, *int) { sum := 0 return func(x int) (int, *int) { sum += x return sum, \u0026amp;sum } } func main() { pos, neg := adder(), adder() for i := 1; i \u0026lt;= 3; i++ { sum, addr := pos(i) fmt.Println(\u0026#34;pos: \u0026#34;, sum, \u0026#34; \u0026#34;, addr) sum, addr = neg(-i) fmt.Println(\u0026#34;neg: \u0026#34;, sum, \u0026#34; \u0026#34;, addr) } } //-------------------------- pos: 1 0x140000b0018 neg: -1 0x140000b0020 pos: 3 0x140000b0018 neg: -3 0x140000b0020 pos: 6 0x140000b0018 neg: -6 0x140000b0020 As we see above, when the anonymous function defined in the adder() access sum, it looks like accessing a global variable, even the function adder() has returned we still can access variable sum. However, there are \u0026ldquo;two\u0026rdquo; sum actually, they are isolated and each has its own address.\nYou should note that we return an anonymous function here, function is first-class citizen in golang just like javascript, it\u0026rsquo;s a gift don\u0026rsquo;t fear it.\n# 2. Use cases # 2.1. Pass behaviour 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 type Mux struct { mu sync.Mutex conns map[net.Addr]net.Conn } func (m *Mux) Add(conn net.Conn) { m.mu.Lock() defer m.mu.Unlock() m.conns[conn.RemoteAddr()] = conn } func (m *Mux) Remove(addr net.Addr) { m.mu.Lock() defer m.mu.Unlock() delete(m.conns, addr) } func (m *Mux) SendMsg(msg string) error { m.mu.Lock() defer m.mu.Unlock() for _, conn := range m.conns { _, err := io.WriteString(conn, msg) if err != nil { return err } } return nil } Is this what we call idiomatic in Go? Maybe. This is our first proverb don\u0026rsquo;t mediate the access to shared memory with locks and mutexes instead share that memory by communicating.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 type Mux struct { add chan net.Conn remove chan net.Addr sendMsg chan string } func (m *Mux) Add(conn net.Conn) { m.add \u0026lt;- conn } func (m *Mux) Remove(addr net.Addr) { m.remove \u0026lt;- addr } func (m *Mux) SendMsg(msg string) error { m.sendMsg \u0026lt;- msg return nil } func (m *Mux) loop() { // only one goroutine can access this map, // don\u0026#39;t need lock conns := make(map[net.Addr]net.Conn) for { select { case conn := \u0026lt;-m.add: conns[conn.RemoteAddr()] = conn case addr := \u0026lt;-m.remove: delete(conns, addr) case msg := \u0026lt;-m.sendMsg: for _, conn := range conns { _, _ = io.WriteString(conn, msg) } } } } We don\u0026rsquo;t need the mutex anymore because the shared sate this conns map is now local to the loop() function, it can\u0026rsquo;t be mutated by anybody else. There cannot be a (data) race because it only exists within the scope of that function.\nBut there\u0026rsquo;s still a lot of hard-coded logic in here, loop() only knows how to do three things, it only knows how to add, remove and sendMsg. If we wanted to extend our Mux, it would involve three things\nadding a channel adding a helper (function) to send data over that channel and then opening up the select logic inside loop and adding the knowledge of how to process that data But we can rewrite our Mux to use first-class functions to pass the behavior we want to be executed not the data to interpret.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 type Mux struct { ops chan func(map[net.Addr]net.Conn) } func (m *Mux) Add(conn net.Conn) { m.ops \u0026lt;- func(m map[net.Addr]net.Conn) { m[conn.RemoteAddr()] = conn } } func (m *Mux) Remove(addr net.Addr) { m.ops \u0026lt;- func(m map[net.Addr]net.Conn) { delete(m, addr) } } func (m *Mux) SendMsg(msg string) error { m.ops \u0026lt;- func(m map[net.Addr]net.Conn) { for _, conn := range m { _, _ = io.WriteString(conn, msg) } } return nil } func (m *Mux) loop() { conns := make(map[net.Addr]net.Conn) for op := range m.ops { op(conns) } } But there are a few little problems to fix, the lack of error handling inside sendMsg, if there\u0026rsquo;s an error of writing to one of the connections that\u0026rsquo;s just going to be discarded. To handle the error generated inside the anonymous function that we pass into loop we need to create a channel to communicate with the result of the operation.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 func (m *Mux) SendMsg(msg string) error { result := make(chan error, 1) m.ops \u0026lt;- func(m map[net.Addr]net.Conn) { for _, conn := range m { _, err := io.WriteString(conn, msg) if err != nil { result \u0026lt;- err return } } result \u0026lt;- nil } return \u0026lt;-result } func (m *Mux) PrivateMsg(addr net.Addr, msg string) (int, error) { result := make(chan net.Conn, 1) m.ops \u0026lt;- func(m map[net.Addr]net.Conn) { result \u0026lt;- m[addr] } conn := \u0026lt;-result if conn == nil { return 0, fmt.Errorf(\u0026#34;client %v not registered\u0026#34;, addr) } return io.WriteString(conn, msg) } I was wondering can I just replace the channel with just a error value in sendMsg() method, like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func (m *Mux) SendMsg(msg string) error { var result error m.ops \u0026lt;- func(m map[net.Addr]net.Conn) { for _, conn := range m { _, err := io.WriteString(conn, msg) if err != nil { result = err return } } result = nil } return result } The answer is no, I cann\u0026rsquo;t, the result has to be a channel here. Because the closure defined in SendMsg is sent somewhere else (via the m.ops chan) to get executed - I need to get the result from the channel to block the SendMsg at the last return \u0026lt;-result - the result channel is a synchronization point. source\nFirst class functions let you pass around behaviour, not just dead data that must be interpreted. First class functions aren\u0026rsquo;t new or novel. Like the other features, first class functions should be used with restraint. First class functions are something that every Go programmer should have in their toolbox. First class functions aren\u0026rsquo;t hard, just a little unfamiliar, and that is something that can be overcome with practice. Next time you define an API it has just one method I want you to ask yourself: should this really just be a function.\nDon\u0026rsquo;t overuse channel, learn more: https://davidzhu.xyz/post/golang/advance/008-do-not-overuse-cahnnel\nSource: dotGo 2016 - Dave Cheney - Do not fear first class functions\n# 2.2. Creating middleware Middleware is basically a fancy term for reusable function that can run code both before and after your code designed to handle a web requst. In Go these are typically accomplished with closures, but in different programming languages they may be achieved in other ways.\nMiddleware is very helpful in scenarios where we need to perform common tasks on incoming HTTP requests, such as authentication, authorization, request validation, and logging. Middleware allows us to apply these tasks consistently across our application, reducing code duplication and making it easier to maintain and modify our code.\nThere are several middleware functions that are commonly used in web applications, including:\nAuthentication middleware: This middleware checks whether the user is authenticated and authorized to access the requested resource. Logging middleware: This middleware logs information about incoming requests, including request method, URL, headers, and response status. Error handling middleware: This middleware catches errors that occur during request handling and returns an appropriate error response to the client. Request validation middleware: This middleware validates incoming requests to ensure that they meet certain criteria, such as HTTP method, headers, query parameters, and request body content. Caching middleware: This middleware caches responses to certain requests to improve performance and reduce server load. Request Tracing: This middleware is used to trace the path of a request through a web application. It captures relevant information about the request and logs it for monitoring and debugging purposes. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func main() { http.HandleFunc(\u0026#34;/hello\u0026#34;, timed(hello)) http.ListenAndServe(\u0026#34;:3000\u0026#34;, nil) } func timed(f func(http.ResponseWriter, *http.Request)) func(http.ResponseWriter, *http.Request) { return func(w http.ResponseWriter, r *http.Request) { start := time.Now() f(w, r) end := time.Now() fmt.Println(\u0026#34;The request took\u0026#34;, end.Sub(start)) } } func hello(w http.ResponseWriter, r *http.Request) { fmt.Fprintln(w, \u0026#34;\u0026lt;h1\u0026gt;Hello!\u0026lt;/h1\u0026gt;\u0026#34;) } Notice that our timed() function takes in a function that could be used as a handler function, and returns a function of the same type, but the returned function is different that the one passed it. The closure being returned logs the current time, calls the original function, and finally logs the end time and prints out the duration of the request. All while being agnostic to what is actually happening inside of our handler function.\nNow all we need to do to time our handlers is to wrap them in timed(handler) and pass the closure to the http.HandleFunc() function call.\nReferences:\n5 Useful Ways to Use Closures in Go - Calhoun.io Mastering Middleware in Go: Tips, Tricks, and Real-World Use Cases | by ansu jain | Medium Function Closures - A Tour of Go ","date":"2023-09-18T23:32:55Z","permalink":"https://blog.yorforger.cc/p/function-closures-go/","title":"Function Closures - Go"},{"content":"In Git, there are two main ways to integrate changes from one branch into another: the merge and the rebase.\n# 1. fast-forward vs three-way merge There are two type of merge:\nthree-way merge, happens when the branches\u0026rsquo; commit have diverged will result a merge commit fast-forward merge, happens when there is a liner structure in the commit history we usually prevent fast-forward merge, because there is no merge commit. can be suppressed with the --no-ff option The liner structure commit structure looks like this:\n1 2 3 A---B fixbug / ...--E master Branches\u0026rsquo; diverged commit structure looks like this:\n1 2 3 A---B fixbug / ...--E--F master Video: https://youtu.be/zOnwgxiC0OA\n# 2. git rebase The Golden Rule of Rebasing reads: â€œNever rebase while youâ€™re on a public branch.â€\nSource: https://www.gitkraken.com/blog/golden-rule-of-rebasing-in-git\nOn main branch:\n1 2 3 4 5 * commit 41bc8e89e60d75e21e034aaabcbd20103a61fca4 (HEAD -\u0026gt; main) | main: Fri 15 Sep 2023 13:01:02 ADT | * commit 2220b67f9c8ccf5f47e51bff7bd3a3fca6e141b6 main: Fri 15 Sep 2023 11:47:54 ADT On fixbug branch:\n1 2 3 4 5 6 7 8 * commit 0096a2dfa2b4e4c40011213b6cce12ee73833ca9 (HEAD -\u0026gt; fixbug) | fixbug: Fri 15 Sep 2023 11:48:53 ADT | * commit fd900fa0c05632757f45fd6fee236eb84c99bb94 | fixbug: Fri 15 Sep 2023 11:48:27 ADT | * commit 2220b67f9c8ccf5f47e51bff7bd3a3fca6e141b6 main: Fri 15 Sep 2023 11:47:54 AD Now the commit history of all branches looks like this:\n1 2 3 A---B fixbug / ...--E---F main Go to main branch and make rebase.\n1 2 3 $ git switch main $ git rebase fixbug Successfully rebased and updated refs/heads/main. Check the log, you can see, these two branches combined but the commit histroy structure is linear:\n1 2 3 4 5 6 7 8 9 10 11 * commit 918260ae4f0b7f7d573a9a640ce380ea0f861a6a (HEAD -\u0026gt; main) | main: Fri 15 Sep 2023 13:01:02 ADT | * commit 0096a2dfa2b4e4c40011213b6cce12ee73833ca9 (fixbug) | fixbug: Fri 15 Sep 2023 11:48:53 ADT | * commit fd900fa0c05632757f45fd6fee236eb84c99bb94 | fixbug: Fri 15 Sep 2023 11:48:27 ADT | * commit 2220b67f9c8ccf5f47e51bff7bd3a3fca6e141b6 main: Fri 15 Sep 2023 11:47:54 ADT Now the commit history of main branch looks like this (and you can delete fixbug branch):\n1 2 3 A---B---F\u0026#39; main / ...--E As you can see, rebase just make a fast-forward merge happen even the branches has diverged.\nAnd note that the F' mean it\u0026rsquo;s a copy of original commit F (git will do this internally), this is why we should not use rebase on a shared branch, main for example, because rebase will \u0026ldquo;change\u0026rdquo; the commit history of branch main.\n# 3. git rebase vs merge Merge preserves commit history. Use merge on a public branch. Rebase rewrites (makes copy) history. Use rebase on a private branch to catch up update form remote. Why rebase rewrite commit history: https://youtu.be/zOnwgxiC0OA?si=CwbvoPI35pHgJ1pn\u0026t=401 git push --force on shared branches is an absolute no-no. Note that we say use rebase on a private branch means we can use the commandgit rebase master on a private, please don\u0026rsquo;t use git rebase fixissue on master branch which apparently is a publick branch.\nLearn more: https://youtu.be/zOnwgxiC0OA?si=CwbvoPI35pHgJ1pn\u0026t=401\nReferences:\nLearn Git Rebase in 6 minutes // explained with live animations! Git MERGE vs REBASE: The Definitive Guide Git MERGE vs REBASE ","date":"2023-09-15T10:20:23Z","permalink":"https://blog.yorforger.cc/p/git-merge-vs-git-rebase/","title":"git merge vs git rebase"},{"content":" # 1. Three trees Git as a system manages and manipulates three trees in its normal operation:\nTree Role HEAD Last commit snapshot, next parent Index Proposed next commit snapshot Working Directory Sandbox The Git index is a critical data structure in Git. It serves as the â€œstaging areaâ€ between the files you have on your filesystem and your commit history. When you run git add, the files from your working directory are hashed and stored as objects in the index, leading them to be â€œstaged changesâ€. When you run git commit, the staged changes as stored in the index are used to create that new commit.\n# 2. HEAD # 2.1. HEAD is YOU HEADis a symbolic reference pointing to wherever you are in your commit history. It follows you wherever you go, whatever you do, like a shadow. If you make a commit, HEAD will move. If you checkout something, HEAD will move. Whatever you do, if you have moved somewhere new in your commit history, HEAD has moved along with you. To address one common misconception: you cannot detach yourself from HEAD. That is not what a detached HEAD state is. If you ever find yourself thinking: \u0026ldquo;oh no, i\u0026rsquo;m in detached HEAD state! I\u0026rsquo;ve lost my HEAD!\u0026rdquo; Remember, it\u0026rsquo;s your HEAD. HEAD is you. You haven\u0026rsquo;t detached from the HEAD, you and your HEAD have detached from something else.\nAcutally, HEAD is just a special pointer that points to the local branch youâ€™re currently on.\n1 2 $ cat .git/HEAD ref: refs/heads/hugo-blog Sometimes you\u0026rsquo;ll get something like this:\n1 a3c485d9688e3c6bc14b06ca1529f0e78edd3f86 That\u0026rsquo;s what happens when HEAD points directly to a commit. This is called a detached HEAD, because HEAD is pointing to something other than a branch reference.\nIn Git, HEAD refers to the currently checked-out branchâ€™s latest commit. However, in a detached HEAD state, the HEAD does not point to any branch, but instead points to a specific commit or the remote repository.\n# 2.2. What can HEAD attach to? HEAD can point to a commit, yes, but typically it does not. Let me say that again. Typically HEAD does not point to a commit. It points to a branch reference. It is attached to that branch, and when you do certain things (e.g., commit or reset), the attached branch will move along with HEAD.\nHEAD is you. It points to whatever you checked out, wherever you are. Typically that is not a commit, it is a local branch. If HEAD does point to a commit (or tag), even if it\u0026rsquo;s the same commit (or tag) that a branch also points to, you (and HEAD) have been detached from that branch. Since you don\u0026rsquo;t have a branch attached to you, the branch won\u0026rsquo;t follow along with you as you make new commits. The HEAD, however, will.\nSource:\nhttps://stackoverflow.com/a/54935492/16317008\nhttps://circleci.com/blog/git-detached-head-state/\nhttps://youtu.be/GN36mrrM12k?si=S6_VTBQDZgG_fHre\n","date":"2023-09-15T10:18:30Z","permalink":"https://blog.yorforger.cc/p/head-and-three-trees-git/","title":"HEAD and Three Trees - Git"},{"content":" # 1. git push -f is dangerous The commit history on my local and remote repo are same:\n1 2 second commit first commit Then I added a file docs.md driectly on github and make a commit so there is another new commit history on remote repo which is different form the commit history of my local repo.\nCommit history on remote repo:\n1 2 3 create docs.md second commit first commit Files on remote repo:\n1 2 3 README.md main.c docs.md Then I made some modifications on local repo and make a commit.\nCommit history on local repo:\n1 2 3 third commit second commit first commit Files on local repo:\n1 2 README.md main.c Now when I try to push my local changes to github:\n1 2 3 4 5 6 7 8 9 $ git push origin master To github.com:shwezhu/test_repo.git ! [rejected] master -\u0026gt; master (fetch first) error: failed to push some refs to \u0026#39;github.com:shwezhu/test_repo.git\u0026#39; hint: Updates were rejected because the remote contains work that you do hint: not have locally. This is usually caused by another repository pushing hint: to the same ref. You may want to first integrate the remote changes hint: (e.g., \u0026#39;git pull ...\u0026#39;) before pushing again. hint: See the \u0026#39;Note about fast-forwards\u0026#39; in \u0026#39;git push --help\u0026#39; for details. This happens because the commit history of the master branch in local and remote repo are different.\nOne way to slolve this is to fetch the remote and merge the changes (commit history will be merged too), then push will succeed. Learn more: Push on Github get Rejected - Solved - David\u0026rsquo;s Blog\nAnother way is to use git push -f but this will overwirte your remote repo, which means **the commit history and the work place on remote rep will be overwritten **.\nAfter use git push -f, the commit history and workplace of the remote repo will looks exactly like the local:\n1 2 3 third commit second commit first commit Noew the file docs.md will miss which means git push -f is dangerous.\n# 2. â€“force-with-lease Gitâ€™s push --force is destructive because it unconditionally overwrites the remote repository with whatever you have locally, possibly overwriting any changes that a team member has pushed in the meantime. However there is a better way; the option â€“force-with-lease can help when you do need to do a forced push but still ensure you donâ€™t overwrite otherâ€™s work.\n--force on shared branches is an absolute no-no.\nLearn more: -force considered harmful; understanding git\u0026rsquo;s -force-with-lease - Atlassian Developer Blog\n","date":"2023-09-14T10:00:23Z","permalink":"https://blog.yorforger.cc/p/git-push-with-force/","title":"Git Push with force"},{"content":" # 1. Structure # 2. Capture filter # 2.1. Selcet netowk interface en0 Physical network interface utun0~4 VIrtual netwrok interface used for tunneling, learn more: Working with TUN Device on MacOS - David\u0026rsquo;s Blog loopback interface: 127.0.0.1 When you run a echo server and client on your local machine, you should select the loopback interface, not the en0 interface. # 2.2. Specify filter rules Filter by port and protocol:\n1 port 9000 Wireshark can only capture some specific ports that for HTTP package by default, so if you gonna capture HTTP package, make sure use the correct ports or goto settings to change the default ports. If you ignore this, like to capture HTTP on port 9000, you probably jut get TCP package.\nYou can find the allowed HTTP port on Preferences-\u0026gt;Protocols-\u0026gt;HTTP\nLearn more: CaptureFilters - Wireshark\n# 3. Display filter Learn more: DisplayFilters\n# 4. Practical examples Client:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 func main() { // Three-way handshake included this step // Note that we\u0026#39;re connecting to port 9000 on the server, // not use port 9000 to connect the server. conn, err := net.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;:9000\u0026#34;) if err != nil { log.Fatalf(\u0026#34;couldn\u0026#39;t connect to the server: %v\u0026#34;, err) } buf := make([]byte, 15) // send data to server, the data will be copied into kernel space // and encapsulated into tcp segment -\u0026gt; ip packet -\u0026gt; ethernet frame if _, err := conn.Write([]byte(\u0026#34;Hi, I am Coco\\n\u0026#34;)); err != nil { log.Fatalf(\u0026#34;couldn\u0026#39;t send request: %v\u0026#34;, err) } else { // Read data from server, the data are copied from kernel space // what happens in kernel space (network stack): // ethernet frame -\u0026gt; ip packet -\u0026gt; tcp segment // the data will be forwarded to this program. // If the connection is closed, return error: io.EOF _, err = conn.Read(buf) if err != nil { log.Fatalf(\u0026#34;couldn\u0026#39;t read server response: %v\u0026#34;, err) } fmt.Println(string(buf)) } _ = conn.Close() } Server:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 func main() { // Obtain the port port := fmt.Sprintf(\u0026#34;:%s\u0026#34;, os.Args[1]) // Create a tcp listener on the given port listener, err := net.Listen(\u0026#34;tcp\u0026#34;, port) if err != nil { fmt.Println(\u0026#34;failed to create listener, err:\u0026#34;, err) os.Exit(1) } fmt.Printf(\u0026#34;listening on %s\\n\u0026#34;, listener.Addr()) // listen for new connections for { // Three-way handshake included // this connection will be assigned a new port (different from the port this server is listening) // for sending and receiving data conn, err := listener.Accept() if err != nil { fmt.Println(\u0026#34;failed to accept connection, err:\u0026#34;, err) continue } // Pass an accepted connection to a handler goroutine go handleConnection(conn) } } func handleConnection(conn net.Conn) { defer conn.Close() buf := make([]byte, 15) for { // read client request data, same as client side // if the connection is closed, return error: io.EOF _, err := conn.Read(buf) if err != nil { if err != io.EOF { log.Println(\u0026#34;failed to read data, err:\u0026#34;, err) } fmt.Println(\u0026#34;connection closed by client:\u0026#34;, conn.RemoteAddr()) return } fmt.Printf(\u0026#34;request: %s\u0026#34;, buf) line := fmt.Sprintf(\u0026#34;%s\u0026#34;, buf) // Same as on client side _, _ = conn.Write([]byte(line)) } } Run server and client:\n1 2 3 4 # server $ go run main.go 9000 # client $ go run main.go Wireshark:\nThe first three is the three-way handshake packet,\n1 2 3 [SYN] seq=0 len=0 [SYN] seq=0 ack=1 len=0 [SYN] seq=1 ack=1 len=0 Note that the length of the fifth packet:\n1 2 # ACK sent with data [PSH, ACK] ... len=14 len is the data\u0026rsquo;s length, the first there packets are just three-way handshake there is no data sent, so len=0.\nThe last four packets are TCP termination four-way hand-shake:\n1 2 3 4 5 # ACK sent with FIN, this ACK is used to # ack=16 confirms that client has received the 15 byte sent by server # and client expects seq=16 from server [FIN, ACK] seq=15 ack=16 len=0 [ACK] seq=16 ack=16 The TCP ACK flag is used to confirm the last received byte by receiver.\nThe PSH flag, on the other hand, is used to tell the server to push data to the application layer immediately.\n","date":"2023-09-13T16:52:30Z","permalink":"https://blog.yorforger.cc/p/wireshark-basics/","title":"Wireshark Basics"},{"content":" # 1. TUN on MacOS On macOS, the utun interface is a type of TUN device specifically designed for VPN connections to handle the network traffic within the VPN tunnel regardless of whether VPN is enabled.\nI\u0026rsquo;ll give you an example to demonstrate the realtionship between TUN device and utun interface, the code below written in Go is to create a TUN device:\n1 2 // New() creates a new TUN/TAP interface using config. ifce, err := water.New(water.Config{DeviceType: water.TUN}) Before run this code there are 4 utun interfaces on my mac:\n1 2 3 4 5 6 7 8 $ ifconfig utun0: flags=8051\u0026lt;UP,POINTOPOINT,RUNNING,MULTICAST\u0026gt; mtu 1380 inet6 fe80::652e:88dd:ddb0:ad93%utun0 prefixlen 64 scopeid 0xf nd6 options=201\u0026lt;PERFORMNUD,DAD\u0026gt; ... utun4: flags=8051\u0026lt;UP,POINTOPOINT,RUNNING,MULTICAST\u0026gt; mtu 1380 inet6 fe80::e305:5ba8:574a:a5ac%utun4 prefixlen 64 scopeid 0x13 nd6 options=201\u0026lt;PERFORMNUD,DAD\u0026gt; After I run the Go codes above with sudo, there are 5 utun interfaces but with no ip information:\n1 2 3 4 5 6 $ ifconfig ... utun4: flags=8051\u0026lt;UP,POINTOPOINT,RUNNING,MULTICAST\u0026gt; mtu 1380 inet6 fe80::e305:5ba8:574a:a5ac%utun4 prefixlen 64 scopeid 0x13 nd6 options=201\u0026lt;PERFORMNUD,DAD\u0026gt; utun5: flags=8051\u0026lt;UP,POINTOPOINT,RUNNING,MULTICAST\u0026gt; mtu 1500 utun* is a point-to-point interface, also called a tunnel or a peer-to-peer interface, It doesn\u0026rsquo;t behave like \u0026ldquo;shared medium\u0026rdquo; interfaces such as Wi-Fi or Ethernet, which connect you to multiple devices. Instead, it behaves like a cable that just has hosts on both ends.\nThere are no layer-2 headers, no MAC addresses, and no ARP on a point-to-point interface, because everything sent through it reaches the same destination (the \u0026ldquo;peer\u0026rdquo; host).\nSource: https://superuser.com/a/1446061/1689666\n# 2. utun is an instance of TUN device You can think utun* is an instance of TUN device on Mac, a TUN device can have many instances.\nOS treat virtual network interface (tun/tap devices) as same to the physical network interface, which means virtual network interface can have anything (including ip address) that physical network interface have.\nutun* is just a network interface similar to en0, lo0, when you input ifconfig command, they will listed together:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ ifconfig lo0: flags=8049\u0026lt;UP,LOOPBACK,RUNNING,MULTICAST\u0026gt; mtu 16384 options=1203\u0026lt;RXCSUM,TXCSUM,TXSTATUS,SW_TIMESTAMP\u0026gt; inet 127.0.0.1 netmask 0xff000000 inet6 ::1 prefixlen 128 inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 nd6 options=201\u0026lt;PERFORMNUD,DAD\u0026gt; en0: flags=8863\u0026lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST\u0026gt; mtu 1500 options=6463\u0026lt;RXCSUM,TXCSUM,TSO4,TSO6,CHANNEL_IO,PARTIAL_CSUM,ZEROINVERT_CSUM\u0026gt; ether d4:57:63:da:b6:98 inet6 fe80::475:ca98:8ecc:d86%en0 prefixlen 64 secured scopeid 0xc inet 192.168.2.15 netmask 0xffffff00 broadcast 192.168.2.255 inet6 fdd0:ed77:f347:4d69:859:d993:f358:5af9 prefixlen 64 autoconf secured nd6 options=201\u0026lt;PERFORMNUD,DAD\u0026gt; media: autoselect status: active en1: flags=8963\u0026lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX,MULTICAST\u0026gt; mtu 1500 options=460\u0026lt;TSO4,TSO6,CHANNEL_IO\u0026gt; ether 36:6b:75:95:04:c0 media: autoselect \u0026lt;full-duplex\u0026gt; status: inactive utun0: flags=8051\u0026lt;UP,POINTOPOINT,RUNNING,MULTICAST\u0026gt; mtu 1380 inet6 fe80::652e:88dd:ddb0:ad93%utun0 prefixlen 64 scopeid 0xf nd6 options=201\u0026lt;PERFORMNUD,DAD\u0026gt; utun1: flags=8051\u0026lt;UP,POINTOPOINT,RUNNING,MULTICAST\u0026gt; mtu 2000 inet6 fe80::a13f:9a63:f8cb:4017%utun1 prefixlen 64 scopeid 0x10 nd6 options=201\u0026lt;PERFORMNUD,DAD\u0026gt; ... Find more about what these interface are: https://stackoverflow.com/a/55232331/16317008\ne.g.,\n1 2 utun3: flags=8051\u0026lt;UP,POINTOPOINT,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 10.8.0.18 --\u0026gt; 10.8.0.17 netmask 0xffffffff With \u0026ldquo;normal\u0026rdquo; interfaces, configuring an address with subnet mask like 192.168.1.3/24 on eth0 is really just shorthand for saying \u0026ldquo;My address is 192.168.1.3 and I also have an on-link route 192.168.1.0/24 dev eth0\u0026rdquo;. The on-link route is derived from combining the address \u0026amp; subnet mask.\nWith point-to-point interfaces, it\u0026rsquo;s actually the same idea. This example means \u0026ldquo;My address is 10.8.0.18 and I also have an on-link route 10.8.0.17/32 dev utun3.\u0026rdquo; In this case the autogenerated route is a /32, indicating only one host â€“ the \u0026ldquo;peer\u0026rdquo;.\n(Note: My examples use Linux iproute2-style syntax.) So in the end, the difference between 10.8.0.17 netmask 0xffffffff and 10.8.0.17/32 styles is just that automatic route.\nSource: https://superuser.com/a/1446061/1689666\n# 3. Set up ip for utun interface 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ tldr ifconfig - View network settings of an Ethernet adapter: ifconfig eth0 - Display details of all interfaces, including disabled interfaces: ifconfig -a - Disable eth0 interface: ifconfig eth0 down - Enable eth0 interface: ifconfig eth0 up - Assign IP address to eth0 interface: ifconfig eth0 ip_address For example, if you have two machines, one we label \u0026ldquo;local\u0026rdquo; with a LAN IP address like 192.168.0.12 and another we label \u0026ldquo;remote\u0026rdquo; with a LAN IP address like 192.168.1.14, you can assign tunnel IP addresses thusly:\n1 ifconfig tun0 inet 10.0.0.1 10.0.0.2 up on the local system, and:\n1 ifconfig tun0 inet 10.0.0.2 10.0.0.1 up on the remote system. Note the reversed perspective on the remote machine. Do not set your point to point addresses to anything on an existing subnet; it will not route properly.\nNote, if you set a wrong interface, you can cancle it with sudo ifconfig utun2 delete 10.1.0.10 10.1.0.20 or ifconfig en1 delete 192.168.141.99 for differnt types of network interfaces.\nSource: https://stackoverflow.com/a/17511998/16317008\n# 4. Use TUN capture ip packets with Go on MacOS 1 go get -u github.com/songgao/water 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func main() { ifce, err := water.New(water.Config{DeviceType: water.TUN}) if err != nil { log.Fatal(err) } log.Printf(\u0026#34;Interface Name: %s\\n\u0026#34;, ifce.Name()) packet := make([]byte, 1500) for { n, err := ifce.Read(packet) if err != nil { log.Fatal(err) } log.Printf(\u0026#34;Packet Received: % x\\n\u0026#34;, packet[:n]) } } 1 2 # NOTE: replace utunx with the name printed on your go code above $ sudo ifconfig utun5 10.1.0.10 10.1.0.20 up Then :\n1 ping -c 1 10.1.0.20 If no data printed on your go codes, restart your go codes and change a pair of ip addresses for utun interface.\nLearn more:\nsonggao/water: A simple TUN/TAP library written in native Go. TUN Device \u0026amp; utun Interface ","date":"2023-09-12T08:31:59Z","permalink":"https://blog.yorforger.cc/p/working-with-tun-device-on-macos/","title":"Working with TUN Device on MacOS"},{"content":"åŸæ–‡:\näº‘åŸç”Ÿè™šæ‹Ÿç½‘ç»œ tun/tap \u0026amp; veth-pair - luozhiyun`s Blog ç†è§£ Linux è™šæ‹Ÿç½‘å¡è®¾å¤‡ tun/tap çš„ä¸€åˆ‡ | éªé©¬é‡‘é¾™ ä¹‹å‰çš„ç›¸å…³æ–‡ç« :\nTUN Device \u0026amp; utun Interface - David\u0026rsquo;s Blog Tunneling Protocols - David\u0026rsquo;s Blog # 1. ç‰©ç†ç½‘å¡å’Œè™šæ‹Ÿç½‘å¡ # 1.1. ç‰©ç†ç½‘å¡æ”¶å‘æ•°æ®çš„æµç¨‹ ç‰©ç†ç½‘å¡å¯ä»¥æ¥æ”¶å’Œå‘é€æ•°æ®ï¼š\næ”¶ï¼šå¤–ç•Œå‘è¯¥ç‰©ç†ç½‘å¡å‘é€æ•°æ®æ—¶ï¼Œå¤–ç•Œå‘é€åˆ°ç½‘å¡çš„æ•°æ®æœ€ç»ˆä¼šä¼ è¾“åˆ°å†…æ ¸ç©ºé—´çš„ç½‘ç»œåè®®æ ˆä¸­ å‘ï¼šæœ¬æœºè¦ä»ç‰©ç†ç½‘å¡å‘é€æ•°æ®æ—¶ï¼Œæ•°æ®å°†ä»å†…æ ¸çš„ç½‘ç»œåè®®æ ˆä¼ è¾“åˆ°ç½‘å¡ï¼Œç½‘å¡è´Ÿè´£å°†æ•°æ®å‘é€å‡ºå» ç°åœ¨çš„ç½‘å¡å…·å¤‡ DMA èƒ½åŠ›ï¼Œæ‰€ä»¥ç½‘å¡å’Œç½‘ç»œåè®®æ ˆä¹‹é—´çš„æ•°æ®ä¼ è¾“ç”±ç½‘å¡è´Ÿè´£ï¼Œè€Œéç”±å†…æ ¸äº²è‡ªå ç”¨ CPU æ¥æ‰§è¡Œè¯»å’Œå†™ ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®çš„èµ·ç‚¹å’Œç»ˆç‚¹æ˜¯ç”¨æˆ·ç¨‹åºï¼Œæ‰€ä»¥å¤šæ•°æ—¶å€™çš„æ•°æ®éœ€è¦åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ (ç½‘ç»œåè®®æ ˆ) å†ä¼ è¾“ä¸€æ¬¡ï¼š\nå½“ç”¨æˆ·è¿›ç¨‹çš„æ•°æ®è¦å‘é€å‡ºå»æ—¶ï¼Œæ•°æ®ä»ç”¨æˆ·ç©ºé—´å†™å…¥å†…æ ¸çš„ç½‘ç»œåè®®æ ˆï¼Œå†ä»ç½‘ç»œåè®®æ ˆä¼ è¾“åˆ°ç½‘å¡ï¼Œæœ€åå‘é€å‡ºå» å½“ç”¨æˆ·è¿›ç¨‹ç­‰å¾…å¤–ç•Œå“åº”æ•°æ®æ—¶ï¼Œæ•°æ®ä»ç½‘å¡æµå…¥ï¼Œä¼ è¾“è‡³å†…æ ¸çš„ç½‘ç»œåè®®æ ˆï¼Œæœ€åæ•°æ®å†™å…¥ç”¨æˆ·ç©ºé—´è¢«ç”¨æˆ·è¿›ç¨‹è¯»å– åœ¨è¿™äº›è¿‡ç¨‹ä¸­ï¼Œå†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„æ•°æ®ä¼ è¾“ç”±å†…æ ¸å ç”¨ CPU æ¥å®Œæˆï¼Œå†…æ ¸å’Œç½‘å¡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ç”±ç½‘å¡çš„ DMA æ¥å®Œæˆï¼Œä¸éœ€è¦å ç”¨è¿‡å¤šçš„ CPUã€‚\n# 1.2. è™šæ‹Ÿç½‘å¡å’Œç‰©ç†ç½‘å¡çš„å¯¹æ¯” å’Œç‰©ç†ç½‘å¡å¯¹æ¯”ä¸€ä¸‹ï¼Œç‰©ç†ç½‘å¡æ˜¯ç¡¬ä»¶ç½‘å¡ï¼Œå®ƒä½äºç¡¬ä»¶å±‚ï¼Œè™šæ‹Ÿç½‘å¡åˆ™å¯ä»¥çœ‹ä½œæ˜¯ç”¨æˆ·ç©ºé—´çš„ç½‘å¡ï¼Œå°±åƒç”¨æˆ·ç©ºé—´çš„æ–‡ä»¶ç³»ç»Ÿ (fuse) ä¸€æ ·ã€‚\nç‰©ç†ç½‘å¡å’Œè™šæ‹Ÿç½‘å¡å”¯ä¸€çš„ä¸åŒç‚¹åœ¨äºç‰©ç†ç½‘å¡æœ¬èº«çš„ç¡¬ä»¶åŠŸèƒ½ï¼šç‰©ç†ç½‘å¡ä»¥æ¯”ç‰¹æµçš„æ–¹å¼ä¼ è¾“æ•°æ®ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œå†…æ ¸ä¼šå…¬å¹³å¯¹å¾…ç‰©ç†ç½‘å¡å’Œè™šæ‹Ÿç½‘å¡ï¼Œç‰©ç†ç½‘å¡èƒ½åšçš„é…ç½®ï¼Œè™šæ‹Ÿç½‘å¡ä¹Ÿèƒ½åšã€‚æ¯”å¦‚å¯ä»¥ä¸ºè™šæ‹Ÿç½‘å¡æ¥å£é…ç½® IP åœ°å€ã€è®¾ç½®å­ç½‘æ©ç ï¼Œå¯ä»¥å°†è™šæ‹Ÿç½‘å¡æ¥å…¥ç½‘æ¡¥ç­‰ç­‰ã€‚\nåªæœ‰åœ¨æ•°æ®æµç»ç‰©ç†ç½‘å¡å’Œè™šæ‹Ÿç½‘å¡çš„é‚£ä¸€åˆ»ï¼Œæ‰ä¼šä½“ç°å‡ºå®ƒä»¬çš„ä¸åŒï¼Œå³ä¼ è¾“æ•°æ®çš„æ–¹å¼ä¸åŒï¼šç‰©ç†ç½‘å¡ä»¥æ¯”ç‰¹æµçš„æ–¹å¼ä¼ è¾“æ•°æ®ï¼Œè™šæ‹Ÿç½‘å¡åˆ™ç›´æ¥åœ¨å†…å­˜ä¸­æ‹·è´æ•°æ® (å³ï¼Œåœ¨å†…æ ¸ä¹‹é—´å’Œè¯»å†™è™šæ‹Ÿç½‘å¡çš„ç¨‹åºä¹‹é—´ä¼ è¾“)ã€‚\næ­£å› ä¸ºè™šæ‹Ÿç½‘å¡ä¸å…·å¤‡ç‰©ç†ç½‘å¡ä»¥æ¯”ç‰¹æµæ–¹å¼ä¼ è¾“æ•°æ®çš„ç¡¬ä»¶åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼Œç»ä¸å¯èƒ½é€šè¿‡è™šæ‹Ÿç½‘å¡å‘å¤–ç•Œå‘é€æ•°æ®ï¼Œå¤–ç•Œæ•°æ®ä¹Ÿä¸å¯èƒ½ç›´æ¥å‘é€åˆ°è™šæ‹Ÿç½‘å¡ä¸Šã€‚èƒ½å¤Ÿç›´æ¥æ”¶å‘å¤–ç•Œæ•°æ®çš„ï¼Œåªèƒ½æ˜¯ç‰©ç†è®¾å¤‡ã€‚\nè™½ç„¶è™šæ‹Ÿç½‘å¡æ— æ³•å°†æ•°æ®ä¼ è¾“åˆ°å¤–ç•Œç½‘ç»œï¼Œä½†å´ï¼š\nå¯ä»¥å°†æ•°æ®ä¼ è¾“åˆ°æœ¬æœºçš„å¦ä¸€ä¸ªç½‘å¡ (è™šæ‹Ÿç½‘å¡æˆ–ç‰©ç†ç½‘å¡) æˆ–å…¶å®ƒè™šæ‹Ÿè®¾å¤‡ (å¦‚è™šæ‹Ÿäº¤æ¢æœº) ä¸Š å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œä¸€ä¸ªå¯è¯»å†™è™šæ‹Ÿç½‘å¡çš„ç¨‹åºï¼Œè¯¥ç¨‹åºå¯å°†æµç»è™šæ‹Ÿç½‘å¡çš„æ•°æ®åŒ…è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªç”¨æˆ·ç¨‹åºå°±åƒæ˜¯ç‰©ç†ç½‘å¡çš„ç¡¬ä»¶åŠŸèƒ½ä¸€æ ·ï¼Œå¯ä»¥æ”¶å‘æ•°æ® (å¯å°†ç‰©ç†ç½‘å¡çš„ç¡¬ä»¶åŠŸèƒ½çœ‹ä½œæ˜¯åµŒå…¥åœ¨ç½‘å¡ä¸Šçš„ç¨‹åº)ï¼Œæ¯”å¦‚ OpenVPN å°±æ˜¯è¿™æ ·çš„å·¥å…· å¾ˆå¤šäººä¼šè¯¯è§£è¿™æ ·çš„ç”¨æˆ·ç©ºé—´ç¨‹åºï¼Œè®¤ä¸ºå®ƒä»¬å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå°è£…ã€‚æ¯”å¦‚è®¤ä¸º OpenVPN å¯ä»¥åœ¨æ•°æ®åŒ…çš„åŸºç¡€ä¸Šå†å°è£…ä¸€å±‚éš§é“ IP é¦–éƒ¨ï¼Œä½†è¿™ç§ç†è§£æ˜¯é”™çš„ã€‚\nä¸€å®šè¯·æ³¨æ„ï¼Œç”¨æˆ·ç©ºé—´çš„ç¨‹åºæ˜¯æ— æ³•å¯¹æ•°æ®åŒ…åšä»»ä½•å°è£…å’Œè§£å°æ“ä½œçš„ï¼Œæ‰€æœ‰çš„å°è£…å’Œè§£å°éƒ½åªèƒ½ç”±å†…æ ¸çš„ç½‘ç»œåè®®æ ˆæ¥å®Œæˆã€‚\nä½¿ç”¨ OpenVPN ä¹‹æ‰€ä»¥å¯ä»¥å¯¹æ•°æ®å†å°è£…ä¸€å±‚éš§é“ IP å±‚ï¼Œæ˜¯å› ä¸º OpenVPN å¯ä»¥è¯»å–å·²ç»å°è£…è¿‡ä¸€æ¬¡ IP é¦–éƒ¨çš„æ•°æ®ï¼Œå¹¶å°†åŒ…å« ip é¦–éƒ¨çš„æ•°æ®ä½œä¸ºæ™®é€šæ•°æ®é€šè¿‡è™šæ‹Ÿç½‘å¡å†æ¬¡ä¼ è¾“ç»™å†…æ ¸ã€‚å› ä¸ºå†…æ ¸æ¥æ”¶åˆ°çš„æ˜¯æ¥è‡ªè™šæ‹Ÿç½‘å¡çš„æ•°æ®ï¼Œæ‰€ä»¥å†…æ ¸ä¼šå°†å…¶å½“ä½œæ™®é€šæ•°æ®ä»å¤´å¼€å§‹å°è£… (ä»å››å±‚å°è£…åˆ°äºŒå±‚å°è£…)ã€‚å½“æ•°æ®ä»ç½‘ç»œåè®®æ ˆæµå‡ºæ—¶ï¼Œå°±æœ‰äº†ä¸¤å±‚ IP é¦–éƒ¨çš„å°è£…ã€‚\næ¢å¥è¯è¯´ï¼Œæ¯ä¸€æ¬¡çœ‹ä¼¼ç”±ç”¨æˆ·ç©ºé—´ç¨‹åºè¿›è¡Œçš„é¢å¤–å°è£…ï¼Œéƒ½æ„å‘³ç€æ•°æ®è¦ä»å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå†åˆ°å†…æ ¸ç©ºé—´ã€‚ä»¥ OpenVPN ä¸ºä¾‹ï¼š\n1 tcp/ip stack --\u0026gt; tun --\u0026gt; OpenVPN --\u0026gt; tcp/ip stack --\u0026gt; Phyical NIC å…¶ä¸­ tun æ˜¯ OpenVPN åˆ›å»ºçš„ä¸€ä¸ªä¸‰å±‚è™šæ‹Ÿç½‘å¡ï¼Œtun è®¾å¤‡åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´ä¼ é€’æ•°æ®ã€‚\nå…·ä½“çš„ openvpn æ•°æ®å°è£…å’Œæ•°æ®æµå‘çš„ç»†èŠ‚ï¼Œå‚è€ƒæ›´è¯¦ç»†çš„é€šè¿‡ openvpn åˆ†æ tun å®ç°éš§é“çš„æ•°æ®æµç¨‹ã€‚\n# 1.3. ç¨‹åºå†™å…¥è™šæ‹Ÿç½‘å¡æ—¶çš„æ³¨æ„äº‹é¡¹ ç”¨æˆ·ç©ºé—´çš„ç¨‹åºä¸å¯éšæ„å‘è™šæ‹Ÿç½‘å¡å†™å…¥æ•°æ®ï¼Œå› ä¸ºå†™å…¥è™šæ‹Ÿç½‘å¡çš„è¿™äº›æ•°æ®éƒ½ä¼šè¢«å†…æ ¸ç½‘ç»œåè®®æ ˆè¿›è¡Œè§£å°å¤„ç†ï¼Œå°±åƒæ¥è‡ªç‰©ç†ç½‘å¡çš„æ•°æ®éƒ½ä¼šè¢«è§£å°ä¸€æ ·ã€‚\nå› æ­¤ï¼Œå¦‚æœç”¨æˆ·ç©ºé—´ç¨‹åºè¦å†™ tun/tap è®¾å¤‡ï¼Œæ‰€å†™å…¥çš„æ•°æ®éœ€å…·æœ‰ç‰¹æ®Šç»“æ„ï¼š\nè¦ä¹ˆæ˜¯å·²ç»å°è£…äº† PORT çš„æ•°æ®ï¼Œå³ä¼ è¾“å±‚çš„ tcp æ•°æ®æ®µæˆ– udp æ•°æ®æŠ¥ è¦ä¹ˆæ˜¯å·²ç»å°è£…äº† IP+PORT çš„æ•°æ®ï¼Œå³ ip å±‚æ•°æ®åŒ… è¦ä¹ˆæ˜¯å·²ç»å°è£…äº† IP+PORT+MAC çš„æ•°æ®ï¼Œå³é“¾è·¯å±‚æ•°æ®å¸§ è¦ä¹ˆæ˜¯å…¶å®ƒç¬¦åˆ tcp/ip åè®®æ ˆçš„æ•°æ®ï¼Œæ¯”å¦‚äºŒå±‚çš„ PPP ç‚¹å¯¹ç‚¹æ•°æ®ï¼Œæ¯”å¦‚ä¸‰å±‚çš„ icmp åè®®æ•°æ® ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºåªèƒ½å‘è™šæ‹Ÿç½‘å¡å†™å…¥å·²ç»å°è£…è¿‡çš„æ•°æ®ã€‚\nç”±äºç½‘ç»œæ•°æ®çš„å°è£…éƒ½ç”±å†…æ ¸çš„ç½‘ç»œåè®®æ ˆè´Ÿè´£ï¼Œæ‰€ä»¥ç¨‹åºå†™å…¥è™šæ‹Ÿç½‘å¡çš„æ•°æ®å®é™…ä¸Šéƒ½åŸå°ä¸åŠ¨åœ°æ¥è‡ªäºä¸Šä¸€è½®çš„ç½‘ç»œåè®®æ ˆï¼Œç”¨æˆ·ç©ºé—´ç¨‹åºæ— æ³•å¯¹è¿™éƒ¨åˆ†æ•°æ®åšä»»ä½•ä¿®æ”¹ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ—¶å†™è™šæ‹Ÿç½‘å¡çš„ç”¨æˆ·ç©ºé—´ç¨‹åºä»…å……å½“äº†ä¸€ä¸ªç‰¹æ®Šçš„ã€è½¬å‘ã€‘ç¨‹åºï¼šè¦ä¹ˆè½¬å‘å››å±‚ tcp/udp æ•°æ®ï¼Œè¦ä¹ˆè½¬å‘ä¸‰å±‚æ•°æ®åŒ…ï¼Œè¦ä¹ˆè½¬å‘äºŒå±‚æ•°æ®å¸§ã€‚\nè¿™ä¸€æ®µè¯å¯èƒ½ä¸å¥½ç†è§£ï¼Œä¸‹é¢ç»™ä¸ªç®€å•çš„ç¤ºä¾‹åˆ†æã€‚\nå‡å¦‚ç‰©ç†ç½‘å¡ eth0 ä»å¤–ç•Œç½‘ç»œæ¥æ”¶äº†è¿™ä¹ˆä¸€æ®µç‰¹æ®Šçš„ ping è¯·æ±‚æ•°æ®ï¼š\nè¿™ä»½æ•°æ®ä¼šä»ç‰©ç†ç½‘å¡ä¼ è¾“åˆ°å†…æ ¸ç½‘ç»œåè®®æ ˆï¼Œç½‘ç»œåè®®æ ˆä¼šå¯¹å…¶è§£å°ï¼Œè§£å°çš„å†…å®¹åªèƒ½æ˜¯ tcp/ip åè®®æ ˆä¸­çš„å†…å®¹ï¼Œå³åªèƒ½è§£å°å¸§å¤´éƒ¨ã€IP å¤´éƒ¨ä»¥åŠç«¯å£å¤´éƒ¨ï¼Œç½‘ç»œåè®®æ ˆè§£å°åè¿˜å‰©ä¸‹ä¸€æ®µåŒ…å«äº†å†…å±‚ IP å¤´éƒ¨ (tun çš„ IP) ä»¥åŠ icmp è¯·æ±‚çš„æ•°æ®ã€‚\nå†…æ ¸ä¼šæ ¹æ®åˆšæ‰è§£å°çš„ç«¯å£å·æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡è¿›ç¨‹ï¼Œå¹¶å°†è§£å°å‰©ä¸‹çš„æ•°æ®ä¼ è¾“ç»™è¯¥è¿›ç¨‹ï¼Œå³ä¼ è¾“ç»™ç”¨æˆ·ç©ºé—´çš„ç¨‹åºã€‚\nç”¨æˆ·ç©ºé—´çš„ç¨‹åºä¸åšä»»ä½•ä¿®æ”¹åœ°å°†è¯»å–åˆ°çš„åŒ…å«äº†å†…å±‚ IP å¤´éƒ¨å’Œ ICMP è¯·æ±‚çš„æ•°æ®åŸå°ä¸åŠ¨åœ°å†™å…¥è™šæ‹Ÿç½‘å¡è®¾å¤‡ï¼Œå†…æ ¸ä»è™šæ‹Ÿç½‘å¡æ¥æ”¶åˆ°æ•°æ®åï¼Œå°†æ•°æ®è¿›è¡Œè§£å°ï¼Œè§£å°å¾—åˆ°æœ€ç»ˆçš„ icmp è¯·æ±‚æ•°æ®ï¼Œäºæ˜¯å†…æ ¸å¼€å§‹æ„å»ºç”¨äºå“åº” ping è¯·æ±‚çš„æ•°æ®ã€‚\n# 2. æ¦‚è¿° ç›®å‰ä¸»æµçš„è™šæ‹Ÿç½‘å¡æ–¹æ¡ˆæœ‰tun/tapå’Œvethä¸¤ç§ã€‚åœ¨æ—¶é—´ä¸Š tun/tap å‡ºç°å¾—æ›´æ—©ï¼Œåœ¨ Linux Kernel 2.4 ç‰ˆä¹‹åå‘å¸ƒçš„å†…æ ¸éƒ½ä¼šé»˜è®¤ç¼–è¯‘ tun/tap çš„é©±åŠ¨ã€‚å¹¶ä¸” tun/tap åº”ç”¨éå¸¸å¹¿æ³›ï¼Œå…¶ä¸­äº‘åŸç”Ÿè™šæ‹Ÿç½‘ç»œä¸­ï¼Œ flannel çš„ UDP æ¨¡å¼ä¸­çš„ flannel0 å°±æ˜¯ä¸€ä¸ª tun è®¾å¤‡ï¼ŒOpenVPN ä¹Ÿåˆ©ç”¨åˆ°äº† tun/tap è¿›è¡Œæ•°æ®çš„è½¬å‘ã€‚\nveth æ˜¯å¦ä¸€ç§ä¸»æµçš„è™šæ‹Ÿç½‘å¡æ–¹æ¡ˆï¼Œåœ¨ Linux Kernel 2.6 ç‰ˆæœ¬ï¼ŒLinux å¼€å§‹æ”¯æŒç½‘ç»œåç©ºé—´éš”ç¦»çš„åŒæ—¶ï¼Œä¹Ÿæä¾›äº†ä¸“é—¨çš„è™šæ‹Ÿä»¥å¤ªç½‘ï¼ˆVirtual Ethernetï¼Œä¹ æƒ¯ç®€å†™åš vethï¼‰è®©ä¸¤ä¸ªéš”ç¦»çš„ç½‘ç»œåç§°ç©ºé—´ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ã€‚veth å®é™…ä¸Šä¸æ˜¯ä¸€ä¸ªè®¾å¤‡ï¼Œè€Œæ˜¯ä¸€å¯¹è®¾å¤‡ï¼Œå› è€Œä¹Ÿå¸¸è¢«ç§°ä½œ Veth-Pairã€‚\nDocker ä¸­çš„ Bridge æ¨¡å¼å°±æ˜¯ä¾é  veth-pair è¿æ¥åˆ° docker0 ç½‘æ¡¥ä¸Šä¸å®¿ä¸»æœºä¹ƒè‡³å¤–ç•Œçš„å…¶ä»–æœºå™¨é€šä¿¡çš„ã€‚\n# 3. tun/tap tun å’Œ tap æ˜¯ä¸¤ä¸ªç›¸å¯¹ç‹¬ç«‹çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œå®ƒä»¬ä½œä¸ºè™šæ‹Ÿç½‘å¡ï¼Œé™¤äº†ä¸å…·å¤‡ç‰©ç†ç½‘å¡çš„ç¡¬ä»¶åŠŸèƒ½å¤–ï¼Œå®ƒä»¬å’Œç‰©ç†ç½‘å¡çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ­¤å¤–tun/tapè´Ÿè´£åœ¨å†…æ ¸ç½‘ç»œåè®®æ ˆå’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚\ntun è®¾å¤‡æ˜¯ä¸€ä¸ªä¸‰å±‚ç½‘ç»œå±‚è®¾å¤‡ï¼Œä» /dev/net/tun å­—ç¬¦è®¾å¤‡ä¸Šè¯»å–çš„æ˜¯ IP æ•°æ®åŒ…ï¼Œå†™å…¥çš„ä¹Ÿåªèƒ½æ˜¯ IP æ•°æ®åŒ…ï¼Œå› æ­¤å¸¸ç”¨äºä¸€äº›ç‚¹å¯¹ç‚¹IPéš§é“ï¼Œä¾‹å¦‚OpenVPNï¼ŒIPSecç­‰ï¼› tap è®¾å¤‡æ˜¯äºŒå±‚é“¾è·¯å±‚è®¾å¤‡ï¼Œç­‰åŒäºä¸€ä¸ªä»¥å¤ªç½‘è®¾å¤‡ï¼Œä» /dev/tap0 å­—ç¬¦è®¾å¤‡ä¸Šè¯»å– MAC å±‚æ•°æ®å¸§ï¼Œå†™å…¥çš„ä¹Ÿåªèƒ½æ˜¯ MAC å±‚æ•°æ®å¸§ï¼Œå› æ­¤å¸¸ç”¨æ¥ä½œä¸ºè™šæ‹Ÿæœºæ¨¡æ‹Ÿç½‘å¡ä½¿ç”¨ï¼› ä»ä¸Šé¢å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºç‰©ç†ç½‘å¡å’Œ tun/tap è®¾å¤‡æ¨¡æ‹Ÿçš„è™šæ‹Ÿç½‘å¡çš„åŒºåˆ«ï¼Œè™½ç„¶å®ƒä»¬çš„ä¸€ç«¯éƒ½æ˜¯è¿ç€ç½‘ç»œåè®®æ ˆï¼Œä½†æ˜¯ç‰©ç†ç½‘å¡å¦ä¸€ç«¯è¿æ¥çš„æ˜¯ç‰©ç†ç½‘ç»œï¼Œè€Œ tun/tap è®¾å¤‡å¦ä¸€ç«¯è¿æ¥çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºä¼ è¾“é€šé“ã€‚\næ ¹æ®å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¤§çº¦çŸ¥é“è™šæ‹Ÿç½‘å¡ä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯è¿æ¥å…¶å®ƒè®¾å¤‡ï¼ˆè™šæ‹Ÿç½‘å¡æˆ–ç‰©ç†ç½‘å¡ï¼‰å’Œ Bridge è¿™æ˜¯ tap è®¾å¤‡çš„ä½œç”¨ï¼›å¦ä¸€ä¸ªæ˜¯æä¾›ç”¨æˆ·ç©ºé—´ç¨‹åºå»æ”¶å‘è™šæ‹Ÿç½‘å¡ä¸Šçš„æ•°æ®ï¼Œè¿™æ˜¯ tun è®¾å¤‡çš„ä½œç”¨ã€‚\nä¸»è¦åŒºåˆ«æ˜¯å› ä¸ºå®ƒä»¬ä½œç”¨åœ¨ä¸åŒçš„ç½‘ç»œåè®®å±‚ï¼Œæ¢å¥è¯è¯´ tapè®¾å¤‡æ˜¯ä¸€ä¸ªäºŒå±‚è®¾å¤‡æ‰€ä»¥é€šå¸¸æ¥å…¥åˆ° Bridgeä¸Šä½œä¸ºå±€åŸŸç½‘çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œtunè®¾å¤‡æ˜¯ä¸€ä¸ªä¸‰å±‚è®¾å¤‡é€šå¸¸ç”¨æ¥å®ç° vpnã€‚\n# 4. OpenVPN ä½¿ç”¨ tun è®¾å¤‡æ”¶å‘æ•°æ® OpenVPN æ˜¯ä½¿ç”¨ tun è®¾å¤‡çš„å¸¸è§ä¾‹å­ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿çš„åœ¨ä¸åŒç½‘ç»œè®¿é—®åœºæ‰€ä¹‹é—´æ­å»ºç±»ä¼¼äºå±€åŸŸç½‘çš„ä¸“ç”¨ç½‘ç»œé€šé“ã€‚å…¶æ ¸å¿ƒæœºåˆ¶å°±æ˜¯åœ¨ OpenVPN æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ‰€åœ¨çš„è®¡ç®—æœºä¸Šéƒ½å®‰è£…ä¸€ä¸ª tun è®¾å¤‡ï¼Œé€šè¿‡å…¶è™šæ‹Ÿ IP å®ç°ç›¸äº’è®¿é—®ã€‚\nä¾‹å¦‚å…¬ç½‘ä¸Šçš„ä¸¤ä¸ªä¸»æœºèŠ‚ç‚¹Aã€Bï¼Œç‰©ç†ç½‘å¡ä¸Šé…ç½®çš„IPåˆ†åˆ«æ˜¯ ipA_eth0 å’Œ ipB_eth0ã€‚ç„¶ååœ¨Aã€Bä¸¤ä¸ªèŠ‚ç‚¹ä¸Šåˆ†åˆ«è¿è¡Œ openvpn çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œå®ƒä»¬ä¼šåœ¨è‡ªå·±çš„èŠ‚ç‚¹ä¸Šåˆ›å»º tun è®¾å¤‡ï¼Œä¸”éƒ½ä¼šè¯»å–æˆ–å†™å…¥è¿™ä¸ª tun è®¾å¤‡ã€‚\nå‡è®¾è¿™ä¸¤ä¸ªè®¾å¤‡å¯¹åº”çš„è™šæ‹Ÿ IP æ˜¯ ipA_tun0 å’Œ ipB_tun0ï¼Œé‚£ä¹ˆèŠ‚ç‚¹ B ä¸Šé¢çš„åº”ç”¨ç¨‹åºæƒ³è¦é€šè¿‡è™šæ‹Ÿ IP å¯¹èŠ‚ç‚¹ A é€šä¿¡ï¼Œé‚£ä¹ˆæ•°æ®åŒ…æµå‘å°±æ˜¯ï¼š\nç”¨æˆ·è¿›ç¨‹å¯¹ ipA_tun0 å‘èµ·è¯·æ±‚ï¼Œç»è¿‡è·¯ç”±å†³ç­–åå†…æ ¸å°†æ•°æ®ä»ç½‘ç»œåè®®æ ˆå†™å…¥ tun0 è®¾å¤‡ï¼›ç„¶å OpenVPN ä»å­—ç¬¦è®¾å¤‡æ–‡ä»¶ä¸­è¯»å– tun0 è®¾å¤‡æ•°æ®ï¼Œå°†æ•°æ®è¯·æ±‚å‘å‡ºå»ï¼›å†…æ ¸ç½‘ç»œåè®®æ ˆæ ¹æ®è·¯ç”±å†³ç­–å°†æ•°æ®ä»æœ¬æœºçš„ eth0 æ¥å£æµå‡ºå‘å¾€ ipA_eth0 ã€‚\nåŒæ ·æˆ‘ä»¬æ¥çœ‹çœ‹èŠ‚ç‚¹ A æ˜¯å¦‚ä½•æ¥å—æ•°æ®ï¼š\nå½“èŠ‚ç‚¹A é€šè¿‡ç‰©ç†ç½‘å¡ eth0 æ¥å—åˆ°æ•°æ®åä¼šå°†å†™å…¥å†…æ ¸ç½‘ç»œåè®®æ ˆï¼Œå› ä¸ºç›®æ ‡ç«¯å£å·æ˜¯OpenVPNç¨‹åºæ‰€ç›‘å¬çš„ï¼Œæ‰€ä»¥ç½‘ç»œåè®®æ ˆä¼šå°†æ•°æ®äº¤ç»™ OpenVPN ï¼›\nOpenVPN ç¨‹åºå¾—åˆ°æ•°æ®ä¹‹åï¼Œå‘ç°ç›®æ ‡IPæ˜¯tun0è®¾å¤‡çš„ï¼Œäºæ˜¯å°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´å†™å…¥åˆ°å­—ç¬¦è®¾å¤‡æ–‡ä»¶ä¸­ï¼Œç„¶å tun0 è®¾å¤‡ä¼šå°†æ•°æ®å†™å…¥åˆ°åè®®æ ˆä¸­ï¼Œç½‘ç»œåè®®æ ˆæœ€ç»ˆå°†æ•°æ®è½¬å‘ç»™åº”ç”¨è¿›ç¨‹ã€‚\nä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“ä½¿ç”¨ tun/tap è®¾å¤‡ä¼ è¾“æ•°æ®éœ€è¦ç»è¿‡ä¸¤æ¬¡åè®®æ ˆï¼Œä¸å¯é¿å…åœ°ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œå¦‚æœæ¡ä»¶å…è®¸ï¼Œå®¹å™¨å¯¹å®¹å™¨çš„ç›´æ¥é€šä¿¡å¹¶ä¸ä¼šæŠŠ tun/tap ä½œä¸ºé¦–é€‰æ–¹æ¡ˆï¼Œä¸€èˆ¬æ˜¯åŸºäºç¨åä»‹ç»çš„ veth æ¥å®ç°çš„ã€‚ä½†æ˜¯ tun/tap æ²¡æœ‰ veth é‚£æ ·è¦æ±‚è®¾å¤‡æˆå¯¹å‡ºç°ã€æ•°æ®è¦åŸæ ·ä¼ è¾“çš„é™åˆ¶ï¼Œæ•°æ®åŒ…åˆ°ç”¨æˆ·æ€ç¨‹åºåï¼Œç¨‹åºå‘˜å°±æœ‰å®Œå…¨æŒæ§çš„æƒåŠ›ï¼Œè¦è¿›è¡Œå“ªäº›ä¿®æ”¹ï¼Œè¦å‘é€åˆ°ä»€ä¹ˆåœ°æ–¹ï¼Œéƒ½å¯ä»¥ç¼–å†™ä»£ç å»å®ç°ï¼Œå› æ­¤ tun/tap æ–¹æ¡ˆæ¯”èµ· veth æ–¹æ¡ˆæœ‰æ›´å¹¿æ³›çš„é€‚ç”¨èŒƒå›´ã€‚\n# 5. flannel UDP æ¨¡å¼ä½¿ç”¨ tun è®¾å¤‡æ”¶å‘æ•°æ® æ—©æœŸ flannel åˆ©ç”¨ tun è®¾å¤‡å®ç°äº† UDP æ¨¡å¼ä¸‹çš„è·¨ä¸»ç½‘ç»œç›¸äº’è®¿é—®ï¼Œå®é™…ä¸ŠåŸç†å’Œä¸Šé¢çš„ OpenVPN æ˜¯å·®ä¸å¤šçš„ã€‚\nåœ¨ flannel ä¸­ flannel0 æ˜¯ä¸€ä¸ªä¸‰å±‚çš„ tun è®¾å¤‡ï¼Œç”¨ä½œåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸å’Œç”¨æˆ·åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’ IP åŒ…ã€‚å½“æ“ä½œç³»ç»Ÿå°†ä¸€ä¸ª IP åŒ…å‘é€ç»™ flannel0 è®¾å¤‡ä¹‹åï¼Œflannel0 å°±ä¼šæŠŠè¿™ä¸ª IP åŒ…ï¼Œäº¤ç»™åˆ›å»ºè¿™ä¸ªè®¾å¤‡çš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯ flanneld è¿›ç¨‹ï¼Œflanneld è¿›ç¨‹æ˜¯ä¸€ä¸ª UDP è¿›ç¨‹ï¼Œè´Ÿè´£å¤„ç† flannel0 å‘é€è¿‡æ¥çš„æ•°æ®åŒ…ï¼š\nflanneld è¿›ç¨‹ä¼šæ ¹æ®ç›®çš„ IP çš„åœ°å€åŒ¹é…åˆ°å¯¹åº”çš„å­ç½‘ï¼Œä» Etcd ä¸­æ‰¾åˆ°è¿™ä¸ªå­ç½‘å¯¹åº”çš„å®¿ä¸»æœº Node2 çš„ IP åœ°å€ï¼Œç„¶åå°†è¿™ä¸ªæ•°æ®åŒ…ç›´æ¥å°è£…åœ¨ UDP åŒ…é‡Œé¢ï¼Œç„¶åå‘é€ç»™ Node 2ã€‚ç”±äºæ¯å°å®¿ä¸»æœºä¸Šçš„ flanneld éƒ½ç›‘å¬ç€ä¸€ä¸ª 8285 ç«¯å£ï¼Œæ‰€ä»¥ Node2 æœºå™¨ä¸Š flanneld è¿›ç¨‹ä¼šä» 8285 ç«¯å£è·å–åˆ°ä¼ è¿‡æ¥çš„æ•°æ®ï¼Œè§£æå‡ºå°è£…åœ¨é‡Œé¢çš„å‘ç»™ ContainerA çš„ IP åœ°å€ã€‚\nflanneld ä¼šç›´æ¥æŠŠè¿™ä¸ª IP åŒ…å‘é€ç»™å®ƒæ‰€ç®¡ç†çš„ TUN è®¾å¤‡ï¼Œå³ flannel0 è®¾å¤‡ã€‚ç„¶åç½‘ç»œæ ˆä¼šå°†è¿™ä¸ªæ•°æ®åŒ…æ ¹æ®è·¯ç”±å‘é€åˆ° docker0 ç½‘æ¡¥ï¼Œdocker0 ç½‘æ¡¥ä¼šæ‰®æ¼”äºŒå±‚äº¤æ¢æœºçš„è§’è‰²ï¼Œå°†æ•°æ®åŒ…å‘é€ç»™æ­£ç¡®çš„ç«¯å£ï¼Œè¿›è€Œé€šè¿‡ veth pair è®¾å¤‡è¿›å…¥åˆ° containerA çš„ Network Namespace é‡Œã€‚\nä¸Šé¢æ‰€è®²çš„ Flannel UDP æ¨¡å¼ç°åœ¨å·²ç»åºŸå¼ƒï¼ŒåŸå› å°±æ˜¯å› ä¸ºå®ƒç»è¿‡ä¸‰æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚å®¹å™¨å‘é€æ•°æ®åŒ…ç»è¿‡ docker0 ç½‘æ¡¥è¿›å…¥å†…æ ¸æ€ä¸€æ¬¡ï¼›æ•°æ®åŒ…ç”± flannel0 è®¾å¤‡è¿›å…¥åˆ° flanneld è¿›ç¨‹åˆä¸€æ¬¡ï¼›ç¬¬ä¸‰æ¬¡æ˜¯ flanneld è¿›è¡Œ UDP å°åŒ…ä¹‹åé‡æ–°è¿›å…¥å†…æ ¸æ€ï¼Œå°† UDP åŒ…é€šè¿‡å®¿ä¸»æœºçš„ eth0 å‘å‡ºå»ã€‚\n# 6. tap è®¾å¤‡ä½œä¸ºè™šæ‹Ÿæœºç½‘å¡ ä¸Šé¢æˆ‘ä»¬ä¹Ÿè¯´äº†ï¼Œtap è®¾å¤‡æ˜¯ä¸€ä¸ªäºŒå±‚é“¾è·¯å±‚è®¾å¤‡ï¼Œé€šå¸¸ç”¨ä½œå®ç°è™šæ‹Ÿç½‘å¡ã€‚ä»¥ qemu-kvm ä¸ºä¾‹ï¼Œå®ƒåˆ©ç”¨ tap è®¾å¤‡å’Œ Bridge é…åˆä½¿ç”¨æ‹¥æœ‰æå¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥å®ç°å„ç§å„æ ·çš„ç½‘ç»œæ‹“æ‰‘ã€‚\nåœ¨ qume-kvm å¼€å¯ tap æ¨¡å¼ä¹‹åï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šå‘å†…æ ¸æ³¨å†Œäº†ä¸€ä¸ªtapç±»å‹è™šæ‹Ÿç½‘å¡ tapxï¼Œx ä»£è¡¨ä¾æ¬¡é€’å¢çš„æ•°å­—ï¼› è¿™ä¸ªè™šæ‹Ÿç½‘å¡ tapx æ˜¯ç»‘å®šåœ¨ Bridge ä¸Šé¢çš„ï¼Œæ˜¯å®ƒä¸Šé¢çš„ä¸€ä¸ªæ¥å£ï¼Œæœ€ç»ˆæ•°æ®ä¼šé€šè¿‡ Bridge æ¥è¿›è¡Œè½¬å‘ã€‚\nqume-kvm ä¼šé€šè¿‡å…¶ç½‘å¡ eth0 å‘å¤–å‘é€æ•°æ®ï¼Œä» Host è§’åº¦çœ‹å°±æ˜¯ç”¨æˆ·å±‚ç¨‹åº qume-kvm è¿›ç¨‹å°†å­—ç¬¦è®¾å¤‡å†™å…¥æ•°æ®ï¼›ç„¶å tapx è®¾å¤‡ä¼šæ”¶åˆ°æ•°æ®åç”± Bridge å†³å®šæ•°æ®åŒ…å¦‚ä½•è½¬å‘ã€‚å¦‚æœ qume-kvm è¦å’Œå¤–ç•Œé€šä¿¡ï¼Œé‚£ä¹ˆæ•°æ®åŒ…ä¼šè¢«å‘é€åˆ°ç‰©ç†ç½‘å¡ï¼Œæœ€ç»ˆå®ç°ä¸å¤–éƒ¨é€šä¿¡ã€‚\nä»ä¸Šé¢çš„å›¾ä¹Ÿå¯ä»¥çœ‹å‡º qume-kvm å‘å‡ºçš„æ•°æ®åŒ…é€šè¿‡ tap è®¾å¤‡å…ˆåˆ°è¾¾ Bridge ï¼Œç„¶ååˆ°ç‰©ç†ç½‘ç»œä¸­ï¼Œæ•°æ®åŒ…ä¸éœ€è¦ç»è¿‡ä¸»æœºçš„çš„åè®®æ ˆï¼Œè¿™æ ·æ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚\n# 7. æ€»ç»“ æœ¬ç¯‡æ–‡ç« åªæ˜¯è®²äº†ä¸¤ç§å¸¸è§çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ã€‚èµ·å› æ˜¯åœ¨çœ‹ flannel çš„æ—¶å€™ï¼Œä¹¦é‡Œé¢éƒ½ä¼šè®²åˆ° flannel0 æ˜¯ä¸€ä¸ª tun è®¾å¤‡ï¼Œä½†æ˜¯ä»€ä¹ˆæ˜¯ tun è®¾å¤‡å´ä¸æ˜ç™½ï¼Œæ‰€ä»¥å¯¼è‡´ flannel ä¹Ÿçœ‹çš„ä¸æ˜ç™½ã€‚\nç»è¿‡ç ”ç©¶ï¼Œå‘ç° tun/tap è®¾å¤‡æ˜¯ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œè´Ÿè´£æ•°æ®è½¬å‘ï¼Œä½†æ˜¯å®ƒéœ€è¦é€šè¿‡æ–‡ä»¶ä½œä¸ºä¼ è¾“é€šé“ï¼Œè¿™æ ·ä¸å¯é¿å…çš„å¼•ç”³å‡º tun/tap è®¾å¤‡ä¸ºä»€ä¹ˆè¦è½¬å‘ä¸¤æ¬¡ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ flannel è®¾å¤‡ UDP æ¨¡å¼ä¸‹æ€§èƒ½ä¸å¥½çš„åŸå› ï¼Œå¯¼è‡´äº†åé¢è¿™ç§æ¨¡å¼è¢«åºŸå¼ƒæ‰ã€‚\nå› ä¸º tun/tap è®¾å¤‡ä½œä¸ºè™šæ‹Ÿç½‘ç»œè®¾å¤‡æ€§èƒ½ä¸å¥½ï¼Œå®¹å™¨å¯¹å®¹å™¨çš„ç›´æ¥é€šä¿¡å¹¶ä¸ä¼šæŠŠ tun/tap ä½œä¸ºé¦–é€‰æ–¹æ¡ˆï¼Œä¸€èˆ¬æ˜¯åŸºäºåé¢ä»‹ç»çš„ veth æ¥å®ç°çš„ã€‚veth ä½œä¸ºä¸€ä¸ªäºŒå±‚è®¾å¤‡ï¼Œå¯ä»¥è®©ä¸¤ä¸ªéš”ç¦»çš„ç½‘ç»œåç§°ç©ºé—´ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ï¼Œä¸éœ€è¦åå¤å¤šæ¬¡ç»è¿‡ç½‘ç»œåè®®æ ˆï¼Œ veth pair æ˜¯ä¸€ç«¯è¿ç€åè®®æ ˆï¼Œå¦ä¸€ç«¯å½¼æ­¤ç›¸è¿çš„ï¼Œæ•°æ®ä¹‹é—´çš„ä¼ è¾“å˜å¾—ååˆ†ç®€å•ï¼Œè¿™ä¹Ÿè®© veth æ¯”èµ· tap/tun å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚\näº†è§£æ›´å¤š:\nIntroduction to Linux interfaces for virtual networking | Red Hat Developer Linux Virtual Networking ","date":"2023-09-11T21:57:37Z","permalink":"https://blog.yorforger.cc/p/%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1-tun/tap-%E9%98%85%E8%AF%BB%E8%BD%AC%E8%BD%BD/","title":"è™šæ‹Ÿç½‘å¡ tun/tap - é˜…è¯»è½¬è½½"},{"content":" # 0. Make it eassy This is all this post is going to talk, if you know this, you don\u0026rsquo;t need to go through all this post.\na string literal is a slice of bytes:\n1 2 3 4 5 6 7 8 func main() { str := \u0026#34;æ±‰\u0026#34; for i:=0; i\u0026lt;len(str); i++{ fmt.Printf(\u0026#34;%x \u0026#34;, str[i]) } } --------------------------- e6 b1 89 a string literal consists of one or more rune values:\n1 2 3 4 5 6 7 8 9 10 11 12 13 func main() { str := \u0026#34;abcæ±‰\u0026#34; for _, s := range str { fmt.Printf(\u0026#34;%x \u0026#34;, s) } fmt.Println() for _, s := range str { fmt.Printf(\u0026#34;%c \u0026#34;, s) } } -------------------------- 61 62 63 6c49 a b c æ±‰ Note that the ways of iterating the string literal in the codes above are different.\n# 1. string literals are encoded in UTF-8 1 2 str := \u0026#34;æ±‰\u0026#34; fmt.Printf(\u0026#34;length of str: %d\u0026#34;, len(str)) Output:\n1 length of str: 3 Why the output is 3? It\u0026rsquo;s all about the encoding.\nCharacter æ±‰ is a chinese character which occupies 3 bytes in utf-8 encoding format, and its code point is 6C49. Code point is a concept defined in Unicode. If you are not familiar with these you can check my another post: https://davidzhu.xyz/post/cs-basics/001-encoding/\nIn Go, string literals always contain UTF-8 text as long as they have no byte-level escapes. Therefore, the length of str is 3 bytes. This is the string in Go runtime sourcode which will help you understand string in go:\n1 2 3 4 5 // src/runtime/string.go type stringStruct struct { str unsafe.Pointer len int } Note that: 'x' represents a single character (called a rune), whereas \u0026quot;x\u0026quot; represents a string literal containing the character x. This is same as in c++ and c.\nSize is not length, the size of a stirng value is always 2 words, learn more: Value Variable and Types - Go - David\u0026rsquo;s Blog\n# 2. string is read-only slice of bytes In Go, a string is in effect a read-only slice of bytes. We have disscussed slice in previous post.\n1 2 3 4 5 6 func main() { str := \u0026#34;æ±‰\u0026#34; for i := 0; i \u0026lt; len(str); i++ { fmt.Printf(\u0026#34;%x \u0026#34;, str[i]) } } Output:\n1 e6 b1 89 As we saw, indexing a string yields its bytes, not its characters: a string is just a bunch of bytes.\nHere is another example that I want to talk:\n1 2 3 4 5 6 7 8 func main() { str := \u0026#34;æ±‰\u0026#34; fmt.Printf(\u0026#34;%x \u0026#34;, str) fmt.Println() for i := 0; i \u0026lt; len(str); i++ { fmt.Printf(\u0026#34;%x \u0026#34;, str[i]) } } Output:\n1 2 6c49 e6 b1 89 That character æ±‰ has Unicode value U+6C49 , this is just its Unicode code point, if we want wrtie this string into a file, we have to use a encoding scheme, gbk, utf-8 and other encoding scheme. After æ±‰ is encoded by utf-8, the value represents it is e6 b1 89 Note that the value that written in the disk is e6 b1 89 which stands for æ±‰ in utf-8. Learn more: https://davidzhu.xyz/post/cs-basics/001-encoding/\n# 3. string is immutable 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 func EchoCommandArgs() { var s string // The variable os.Args is a slice of strings. // range produces a pair of values: the index and the value of the element at that index. // we ignore index with _ marker here for _, arg := range os.Args[1:]{ // s += ... will make a new string everytime, because string is immutable // The += statement makes a new string by concatenating the old string, // a space character, and the next argument, then assigns the new string to s. // The old contents of s are no longer in use, so they will be garbage-collected in due course. // If the amount of data involved is large, this could be costly. // A simpler and more efficient solution would be to use the Join function from the strings package s += arg s += \u0026#34; \u0026#34; } fmt.Println(s) fmt.Println(os.Args[1:]) fmt.Println(strings.Join(os.Args[1:], \u0026#34; \u0026#34;)) } --------------------------------------- $ go run main.go hello hi hi hello hi hi [hello hi hi] hello hi hi # 4. byte \u0026amp; rune A byte in Go is an unsigned 8-bit integer whose type is actually uint8, which can represent an ASCII character.\nGo uses rune, which has type int32, to deal with multibyte characters. rune occupies 32bit (4 bytes) and is meant to represent a Unicode CodePoint which is 4 bytes. Source: https://stackoverflow.com/a/19325804/16317008\næ±‰ is a multibyte character. Here should note that we say \u0026ldquo;rune is used to deal with multibyte characters\u0026rdquo; doesn\u0026rsquo;t mean it cannot represent singlebyte characters (ASCII), it\u0026rsquo;s just a int32 type, not something magic.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func main() { str := \u0026#34;abcæ±‰\u0026#34; for _, c := range str { fmt.Printf(\u0026#34;%T \u0026#34;, c) } fmt.Println() for _, c := range str { fmt.Printf(\u0026#34;%x \u0026#34;, c) } fmt.Println() for i := 0; i \u0026lt; len(str); i++ { fmt.Printf(\u0026#34;%x \u0026#34;, str[i]) } } Output:\n1 2 3 int32 int32 int32 int32 61 62 63 6c49 61 62 63 e6 b1 89 As we see here from the output line-3, a string literal is just a slice of bytes, but the first two line prove that we can think a string literal is just a slice of rune which is int32.\nHere is another example may help you to understand the string literal and rune:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func isValid(s string) bool { for _, c := range s { // error: Invalid operation: c == \u0026#34;{\u0026#34; (mismatched types int32 and string) if c == \u0026#34;{\u0026#34;: ... // no error // `\u0026#39;x\u0026#39;` represents a single character (called a rune) // c is a rune here if c == \u0026#39;{\u0026#39; { } } return false } # 5. Go source code is UTF-8 Source code in Go is defined to be UTF-8 text; no other representation is allowed. That implies that when, in the source code, we write the text\n1 `âŒ˜` the text editor used to create the program places the UTF-8 encoding of the symbol âŒ˜ into the source text. When we print out the hexadecimal bytes, weâ€™re just dumping the data the editor placed in the file.\nRecall the æ±‰ example we talked above, the real thing written in the disk is not its Unicode code point but the data encoded by uft-8 which is 3 bytes.\nIn short, Go source code is UTF-8, so the source code for the string literal is UTF-8 text. If that string literal contains no escape sequences, which a raw string cannot, the constructed string will hold exactly the source text between the quotes. Thus by definition and by construction the raw string will always contain a valid UTF-8 representation of its contents. Similarly, unless it contains UTF-8-breaking escapes like those from the previous section, a regular string literal will also always contain valid UTF-8.\nSome people think Go strings are always UTF-8, but they are not: only string literals are UTF-8. As we showed in the previous section, string values can contain arbitrary bytes; as we showed in this one, string literals always contain UTF-8 text as long as they have no byte-level escapes.\nTo summarize, strings can contain arbitrary bytes, but when constructed from string literals, those bytes are (almost always) UTF-8.\n# 6. []byte vs []rune A slice of byte just a slice of uint8, just a list of small numbers (0~127). We usually use a []byte slice when we want store ASCII characters which are singlebye characters, if you want store multibyte characters, you should use []rune or the string literals.\n# 7. []byte, []rune and string conversion will makes copy 1 2 3 4 5 6 7 8 9 10 11 12 13 func main() { // this is a slice not an array // you can replace []byte with []rune data := []byte{102, 97, 108, 99, 111, 110} // convert byte slice to string fmt.Println(string(data)) // string to byte slice fmt.Println([]byte(\u0026#34;falcon\u0026#34;)) } ---------------------------------------- [102 97 108 99 111 110] falcon [102 97 108 99 111 110] The compiler will allocate a new piece of memory and copy the data over when you convet string to bytes or bytes to string. The reason is that []byte is not immutable. You can change the bytes within a slice. You can grow the slice by appending bytes to the end. But a string is immutable. You cannot change it and you cannot grow it without creating a whole new string. If a string and a []byte were backed by the same memory, then the string would change when the []byte was changed, and that might not be what you expect.\nSo, each time you do []byte(â€œfredâ€) or string([]byte{0x40, 0x040}), thereâ€™s an allocation and a copy. This is done by https://golang.org/pkg/runtime/?m=all#stringtoslicebyte and https://golang.org/pkg/runtime/?m=all#slicebytetostring. And this is normally the right thing to do and normally has no significant consequences.\nReferences:\nGo byte - working with bytes in Golang []byte vs string in Go Strings, bytes, runes and characters in Go - The Go Programming Language go - Cannot assign string with single quote in golang - Stack Overflow ","date":"2023-09-11T13:50:59Z","permalink":"https://blog.yorforger.cc/p/string-bytes-runes-and-characters-go/","title":"string, bytes, runes and characters - Go"},{"content":"A properly formed git commit subject line should always be able to complete the following sentence:\nIf applied, this commit will # 1. Things to avoid when creating commits Sending large new features in a single giant commit. Mixing two unrelated functional changes. Again the reviewer will find it harder to identify flaws if two unrelated changes are mixed together. If it becomes necessary to later revert a broken commit, the two unrelated changes will need to be untangled, with further risk of bug creation. Mixing whitespace changes with functional code changes. 1 2 If a code change can be split into a sequence of patches/commits, then it should be split. Less is not more. More is more. # 2. Commit message format Each commit message consists of a header, a body, and a footer.\n1 2 3 4 5 \u0026lt;header\u0026gt; \u0026lt;BLANK LINE\u0026gt; \u0026lt;body\u0026gt; \u0026lt;BLANK LINE\u0026gt; \u0026lt;footer\u0026gt; # 2.1. Commit message header 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;type\u0026gt;(\u0026lt;scope\u0026gt;): \u0026lt;short summary\u0026gt; â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â«¸ Summary in present tense. Not capitalized. No period at the end. â”‚ â”‚ â”‚ â””â”€â«¸ Commit Scope: animations|bazel|benchpress|common|compiler|compiler-cli|core| â”‚ elements|forms|http|language-service|localize|platform-browser| â”‚ platform-browser-dynamic|platform-server|router|service-worker| â”‚ upgrade|zone.js|packaging|changelog|docs-infra|migrations|ngcc|ve| â”‚ devtools â”‚ â””â”€â«¸ Commit Type: build|ci|docs|feat|fix|perf|refactor|test The \u0026lt;type\u0026gt; and \u0026lt;summary\u0026gt; fields are mandatory, the (\u0026lt;scope\u0026gt;) field is optional.\n# Type Must be one of the following:\nbuild: Changes that affect the build system or external dependencies (example scopes: gulp, broccoli, npm) ci: Changes to our CI configuration files and scripts (examples: CircleCi, SauceLabs) docs: Documentation only changes feat: A new feature fix: A bug fix perf: A code change that improves performance refactor: A code change that neither fixes a bug nor adds a feature test: Adding missing tests or correcting existing tests # Summary Use the summary field to provide a succinct description of the change:\nuse the imperative, present tense: \u0026ldquo;change\u0026rdquo; not \u0026ldquo;changed\u0026rdquo; nor \u0026ldquo;changes\u0026rdquo; This convention matches up with commit messages generated by commands like git merge and git revert. don\u0026rsquo;t capitalize the first letter no dot (.) at the end # 3. Information in commit messages 1 2 3 4 5 6 7 commit 468e64d019f51d364afb30b0eed2ad09483e0b98 Author: [removed] Date: Mon Jun 18 16:07:37 2012 -0400 Fix missing import in compute/utils.py Fixes bug 1014829 Problem: this does not mention what imports where missing and why they were needed. This info was actually in the bug tracker, and should have been copied into the commit message, so that it would provide a self-contained description. e.g.:\n1 2 3 4 Add missing import of \u0026#39;exception\u0026#39; in compute/utils.py nova/compute/utils.py makes a reference to exception.NotFound, however exception has not been imported. # 4. Common wrods 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 feat: add support for configuring libvirt VM clock and timers feat: add libvirt version check, min 0.9.7 feat: update default policies for KVM guest PIT \u0026amp; RTC timers perf: refine serialize refactor: reformat code refactor: rename type and namespace refactor: add a comment to rpc.queue_get_for() Add, Fix, Remove, Refactor, Reformat, Optimise and Update Add = Create a capability e.g. feature, test, dependency. Remove = Remove a capability e.g. feature, test, dependency. Fix = Fix an issue e.g. bug, typo, accident, misstatement. Refactor = A code change that MUST be just a refactoring. Reformat = Refactor of formatting, e.g. omit whitespace. Optimise = Refactor of performance, e.g. speed up code. # 5. Check commit history 1 $ git config --global alias.lgg \u0026#34;log --graph --pretty=format:\u0026#39;%Cred%h%Creset -%C(yellow)%d%Creset %s %C(bold blue)\u0026lt;%an\u0026gt;%Creset\u0026#39; --abbrev-commit --date=relative\u0026#34; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 $ git lgg * d7c4459 - (HEAD, M, fromA) M \u0026lt;VonC\u0026gt; * 82b011d - (L) Merge commit \u0026#39;J\u0026#39; into fromA \u0026lt;VonC\u0026gt; |\\ | * 190265b - (J, master) J \u0026lt;VonC\u0026gt; | * ef8e325 - (I) Merge commit \u0026#39;F\u0026#39; \u0026lt;VonC\u0026gt; | |\\ | | * 4b6d976 - (F, fromB) F \u0026lt;VonC\u0026gt; | * | 45a5d4d - (H) H \u0026lt;VonC\u0026gt; | * | 834b239 - (G) Merge commit \u0026#39;E\u0026#39; \u0026lt;VonC\u0026gt; | |\\ \\ | | |/ | | * f8e9272 - (E) E \u0026lt;VonC\u0026gt; | | * 96b5538 - (D) D \u0026lt;VonC\u0026gt; | * | 49eff7f - (C) C \u0026lt;VonC\u0026gt; | |/ | * 02c3ef4 - (B) B \u0026lt;VonC\u0026gt; * | c0d9e1e - (K) K \u0026lt;VonC\u0026gt; |/ * 6530d79 - (A) A \u0026lt;VonC\u0026gt; Source: https://stackoverflow.com/a/6744268/16317008\nReferences:\nCommit message guidelines Angular Commit Format Reference Sheet knowbl/git-commit-message: Git commit message verbs used by Knowbl. Example list of verbs / first word to use in git commit title #git #commit #title ","date":"2023-09-11T07:47:23Z","permalink":"https://blog.yorforger.cc/p/commit-message-guidelines/","title":"Commit Message Guidelines"},{"content":"HTTPS is used for encryption, VPN is too. What\u0026rsquo;s difference?\nIn previou post we talked about Is HTTPS Secure Enough?, and we concluded that https is secure itself which means no one can decrypt the data without the session key. However there still are some security issues in HTTPS, the man-in-the-middle attack, for example.\n# Why do I need a VPN if https connections are secure? A VPN will secure all of the traffic between point A and point B in a tunnel. This helps ensure that you are not having your traffic intercepted by anyone at, say, the coffee shop.\nHTTPS is a secure protocol between your browser and a particular website.\nNote that the tunnel in VPN is not a physical entity but rather a logical concept used to describe the secure pathway created for data transmission. Because tunneling involves repackaging the traffic data into a different form, perhaps with encryption as standard, it can hide the nature of the traffic that is run through a tunnel. Tunneling protocol\nThis means the format of the packets transmitted between VPN clients and server are different from the format of OSI model, they are encapulated with tunneling protocol. Acts like your original packets transmitted in a magic container other people cannot know what\u0026rsquo;s in it. Acs like a tunnel.\nHowever, HTTPS will only help with traffic over port 443, which mean it only provides encryption for data exchanged between a client and a specific server, it does not encrypt all your internet traffic.\nA VPN stops that because everything is connected securely through that pipe. The primary thing that a VPN helps with is what is know as a man in the middle attack: Man-in-the-middle attack - Wikipedia\n# VPN vs Proxy In computer networks, a proxy server is a server (a computer system or an application) that acts as an intermediary for requests from clients seeking resources from other servers. Proxy server\nA virtual private network (VPN) is an encrypted connection between two or more computers. VPN connections take place over public networks, but the data exchanged over the VPN is still private because it is encrypted. IPsec | Cloudflare\nWhat a VPN does logically is turn your internet connection into a big Ethernet cable. When you are logged on to a company\u0026rsquo;s VPN, the effect is similar as though you took your computer to the company\u0026rsquo;s building and directly connected it. VPNs (usually) use encryption so that intermediate systems between you and the company (such as your ISP or a malicious wireless network sniffer) cannot eavesdrop your traffic.\nProxies, on the other hand, do not typically provide encryption for all traffic and may only encrypt specific types of traffic (such as HTTPS).\nProxies generally work on specific types of application traffic. For example, there are HTTP proxies, DNS proxies, etc. Although there are SOCKS proxies that proxy everything\u0026hellip;\nHow do sites like Netflix know I\u0026rsquo;m using a VPN?\nThis is often caused by many netflix uers use a same von to access thier streaming service.\nWe have known that: when you are logged on to a company\u0026rsquo;s VPN, the effect is similar as though you took your computer to the company\u0026rsquo;s building and directly connected it.\nIf eveybody drives the same car to Walmart, Walmart will sooner or later know it\u0026rsquo;s a rental car, but they cannot track this car back to you because everybody drives the car with same the plate.\nReferences:\nWhy do I need VPN if https connections are secure? - Quora security - What is the difference between a proxy and a VPN? - Super User How do sites like Netflix know I\u0026rsquo;m using a VPN? : VPN ","date":"2023-09-10T10:54:30Z","permalink":"https://blog.yorforger.cc/p/https-vs-vpn-vs-proxy/","title":"HTTPS vs VPN vs Proxy"},{"content":" # VPN VPNï¼ˆVirtual Private Networkï¼‰çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨éš§é“åè®®ï¼ˆTunneling Protocolï¼‰ã€‚é€šè¿‡è¿™äº›éš§é“åè®®ï¼ŒVPN èƒ½å¤Ÿä¿è¯æ•°æ®åœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸­çš„å®‰å…¨ä¼ è¾“ï¼Œä½¿å¾—VPNåœ¨ä¿æŠ¤åœ¨çº¿éšç§å’Œç»•è¿‡ç½‘ç»œé™åˆ¶æ–¹é¢éå¸¸æœ‰æ•ˆã€‚\nå¸¸è§çš„éš§é“åè®®åŒ…æ‹¬ï¼š\nIPsec (Internet Protocol Security)ï¼šç”¨äºåœ¨IPé€šä¿¡è¿‡ç¨‹ä¸­ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€è®¤è¯å’Œæœºå¯†æ€§ã€‚ OpenVPNï¼šä¸€ä¸ªåŸºäºSSL/TLSçš„å¼€æºVPNåè®®ï¼Œæä¾›é«˜åº¦çš„å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚ WireGuardï¼šä¸€ä¸ªè¾ƒæ–°çš„åè®®ï¼Œæ—¨åœ¨æä¾›æ›´é«˜çš„é€Ÿåº¦å’Œæ›´å…ˆè¿›çš„åŠ å¯†æŠ€æœ¯ã€‚ SSL/TLS (Secure Sockets Layer/Transport Layer Security)ï¼šSSL VPN usually connects using a Web browser, whereas an IPSec VPN generally requires client software on the remote system. SSL VPN is a component of virtually every Web browser. Any OS that runs a browser is supported. OpenVPN æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ VPN åè®®ï¼Œå®ƒä¸ä½¿ç”¨åƒ PPTPã€L2TP æˆ– IPsec è¿™æ ·çš„æ ‡å‡†éš§é“åè®®ã€‚ç›¸åï¼ŒOpenVPN ä½¿ç”¨è‡ªå·±çš„åè®®ï¼ŒåŸºäº SSL/TLS æ¥æä¾›åŠ å¯†å’Œå®‰å…¨è¿æ¥ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„è½¯ä»¶åº”ç”¨ç¨‹åºï¼Œå…è®¸åˆ›å»ºå®‰å…¨çš„ç‚¹å¯¹ç‚¹æˆ–ç«™ç‚¹å¯¹ç«™ç‚¹è¿æ¥ OpenVPN çš„å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š\nè‡ªå®šä¹‰åŠ å¯†åè®®ï¼šè™½ç„¶åŸºäº SSL/TLSï¼Œä½† OpenVPN æœ‰å…¶ç‹¬ç‰¹çš„å®ç°æ–¹å¼ï¼Œå…è®¸é«˜åº¦çš„å®šåˆ¶å’Œçµæ´»æ€§ã€‚ èº«ä»½éªŒè¯ï¼šæ”¯æŒå„ç§è®¤è¯æœºåˆ¶ï¼ŒåŒ…æ‹¬è¯ä¹¦ã€é¢„å…±äº«å¯†é’¥å’Œç”¨æˆ·è®¤è¯ã€‚ è·¨å¹³å°å…¼å®¹æ€§ï¼šOpenVPN å¯ä»¥åœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬ Windowsã€macOSã€Linux å’Œç§»åŠ¨å¹³å°ã€‚ # 1. Tunneling In previous post, we know that TUN and TAP are two different kernel virtual network devices, which are used for tunneling purposes. In this post, we\u0026rsquo;ll discuss what is tunneling and coomon tunneling protocols.\nIn the physical world, tunneling is a way to cross terrain or boundaries that could not normally be crossed. Similarly, in networking, tunnels are a method for transporting data across a network using protocols that are not supported by that network. Tunneling works by encapsulating packets: wrapping packets inside of other packets.\nEncapsulating packets within other packets is called \u0026ldquo;tunneling.\u0026rdquo;\nBecause tunneling involves repackaging the traffic data into a different form, perhaps with encryption as standard, it can hide the nature of the traffic that is run through a tunnel.\nEncapsulation:\nData traveling over a network is divided into packets. A typical packet has two parts: the header, which indicates the packet\u0026rsquo;s destination and which protocol it uses, and the payload, which is the packet\u0026rsquo;s actual contents.\nAn encapsulated packet is essentially a packet inside another packet. In an encapsulated packet, the header and payload of the first packet goes inside the payload section of the surrounding packet. The original packet itself becomes the payload.\nA VPN just uses one of the tunneling protocols, therefore, when you know how each tunneling protocol works, you will know the essence of VPN of that type.\n# 2. Types of Tunneling protocol In addition to GRE, IPsec, IP-in-IP, and SSH, other tunneling protocols include:\nPoint-to-Point Tunneling Protocol (PPTP) Secure Socket Tunneling Protocol (SSTP) Layer 2 Tunneling Protocol (L2TP) Virtual Extensible Local Area Network (VXLAN) # 3. IPsec - Network layer The IPsec protocol suite operates at the network layer of the OSI model. Within the term \u0026ldquo;IPsec,\u0026rdquo; \u0026ldquo;IP\u0026rdquo; stands for \u0026ldquo;Internet Protocol\u0026rdquo; and \u0026ldquo;sec\u0026rdquo; for \u0026ldquo;secure.\u0026rdquo; IPsec usually uses port 500.\nThe Internet Protocol is the main routing protocol used on the Internet; it designates where data will go using IP addresses. IPsec is secure because it adds encryption and authentication to this process.\n# 3.1. Why IPSec is important? Networking protocol suites like TCP/IP are only concerned with connection and delivery, and messages sent are not concealed. Anyone in the middle can read them. IPsec, and other protocols that encrypt data, essentially put an envelope around data as it traverses networks, keeping it secure.\n# 3.2. How does IPsec work? IPsec connections include the following steps:\nKey exchange: Keys are necessary for encryption;\nPacket headers and trailers: IP packets contain both a payload and a header. IPsec adds several headers to data packets containing authentication and encryption information. IPsec also adds trailers, which go after each packet\u0026rsquo;s payload instead of before.\nLearn more: What is IPsec? | How IPsec VPNs work | Cloudflare\n# 3.3. IPsec tunnel and IPsec transport mode Tunnel Modeï¼š\nåœ¨éš§é“æ¨¡å¼ä¸‹ï¼ŒIPsecå¯¹æ•´ä¸ªIPæ•°æ®åŒ…ï¼ˆåŒ…æ‹¬å¤´éƒ¨ä¿¡æ¯ï¼‰è¿›è¡ŒåŠ å¯†ã€‚ è¿™æ„å‘³ç€åŸå§‹çš„IPæ•°æ®åŒ…è¢«å°è£…åœ¨ä¸€ä¸ªæ–°çš„IPæ•°æ®åŒ…ä¸­ã€‚æ–°çš„æ•°æ®åŒ…æœ‰ä¸€ä¸ªæ–°çš„IPå¤´éƒ¨ã€‚ éš§é“æ¨¡å¼å¸¸ç”¨äºVPNï¼ˆVirtual Private Networkï¼Œè™šæ‹Ÿç§äººç½‘ç»œï¼‰ï¼Œå…è®¸ä¸åŒç½‘ç»œä¹‹é—´å®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚ Transport Modeï¼š\nåœ¨ä¼ è¾“æ¨¡å¼ä¸‹ï¼ŒIPsecåªåŠ å¯†IPæ•°æ®åŒ…çš„æœ‰æ•ˆè½½è·ï¼ˆPayloadï¼‰ï¼Œè€Œä¸åŠ å¯†å¤´éƒ¨ä¿¡æ¯ã€‚ # 3.4. What protocols are used in IPsec? In networking, a protocol is a specified way of formatting data so that any networked computer can interpret the data. IPsec is not one protocol, but a suite of protocols. The following protocols make up the IPsec suite:\nAuthentication Header (AH): The AH protocol ensures that data packets are from a trusted source and that the data has not been tampered with, like a tamper-proof seal on a consumer product. These headers do not provide any encryption; they do not help conceal the data from attackers.\nEncapsulating Security Protocol (ESP): ESP encrypts the IP header and the payload for each packet â€” unless transport mode is used, in which case it only encrypts the payload. ESP adds its own header and a trailer to each data packet.\nSecurity Association (SA): SA refers to a number of protocols used for negotiating encryption keys and algorithms. One of the most common SA protocols is Internet Key Exchange (IKE).\nFinally, while the Internet Protocol (IP) is not part of the IPsec suite, IPsec runs directly on top of IP.\n# 3.5. How does IPsec impact MSS and MTU? IPsec protocols add several headers and trailers to packets, all of which take up several bytes. For networks that use IPsec, either the MSS and MTU have to be adjusted accordingly, or packets will be fragmented and slightly delayed. Usually, the MTU for a network is 1,500 bytes. A normal IP header is 20 bytes long, and a TCP header is also 20 bytes long, meaning each packet can contain 1,460 bytes of payload. However, IPsec adds an Authentication Header, an ESP header, and associated trailers. These add 50-60 bytes to a packet, or more.\n# 4. GRE - Network Layer Encapsulating packets within other packets is called \u0026ldquo;tunneling.\u0026rdquo; GRE tunnels are usually configured between two routers, with each router acting like one end of the tunnel. The routers are set up to send and receive GRE packets directly to each other. Any routers in between those two routers will not open the encapsulated packets; they only reference the headers surrounding the encapsulated packets in order to forward them.\nGRE enables the usage of protocols that are not normally supported by a network, because the packets are wrapped within other packets that do use supported protocols. To understand how this works, think about the difference between a car and a ferry. A car travels over roads on land, while a ferry travels over water. A car cannot normally travel on water â€” however, a car can be loaded onto a ferry in order to do so.\nFor instance, suppose a company needs to set up a connection between the local area networks (LANs) in their two different offices. Both LANs use the latest version of the Internet Protocol, IPv6. But in order to get from one office network to another, traffic must pass through a network managed by a third party â€” which is somewhat outdated and only supports the older IPv4 protocol.\nWith GRE, the company could send traffic through this network by encapsulating IPv6 packets within IPv4 packets. Referring back to the analogy, the IPv6 packets are the car, the IPv4 packets are the ferry, and the third-party network is the water.\n# 4.1. What goes in a GRE header? GRE adds two headers to each packet: the GRE header, which is 4 bytes long, and an IP header, which is 20 bytes long. The GRE header indicates the protocol type used by the encapsulated packet. The IP header encapsulates the original packet\u0026rsquo;s header and payload. This means that a GRE packet usually has two IP headers: one for the original packet, and one added by the GRE protocol. Only the routers at each end of the GRE tunnel will reference the original, non-GRE IP header.\n# 4.2. How does the use of GRE impact MTU and MSS requirements? Like any protocol, using GRE adds a few bytes to the size of data packets. This must be factored into the MSS and MTU settings for packets. If the MTU is 1,500 bytes and the MSS is 1,460 bytes (to account for the size of the necessary IP and TCP headers), the addition of GRE 24-byte headers will cause the packets to exceed the MTU:\n1,460 bytes [payload] + 20 bytes [TCP header] + 20 bytes [IP header] + 24 bytes [GRE header + IP header] = 1,524 bytes\nAs a result, the packets will be fragmented. Fragmentation slows down packet delivery times and increases how much compute power is used, because packets that exceed the MTU must be broken down and then reassembled.\nThis can be avoided by reducing the MSS to accommodate the GRE headers. If the MSS is set to 1,436 instead of 1,460, the GRE headers will be accounted for and the packets will not exceed the MTU of 1,500:\n1,436 bytes [payload] + 20 bytes [TCP header] + 20 bytes [IP header] + 24 bytes [GRE header + IP header] = 1,500 bytes\nWhile fragmentation is avoided, the result is that payloads are slightly smaller, meaning it will take extra packets to deliver data. For instance, if the goal is to deliver 150,000 bytes of content (or about 150 kB), and if the MTU is set to 1,500 and no other layer 3 protocols are used, compare how many packets are necessary when GRE is used versus when it is not used:\nWithout GRE, MSS 1,460: 103 packets With GRE, MSS 1,436: 105 packets The extra two packets add milliseconds of delay to the data transfer. However, the usage of GRE may allow these packets to take faster network paths than they could otherwise take, which can make up for the lost time.\n# 5. SSH Tunneling - Application layer The Secure Shell (SSH) protocol sets up encrypted connections between client and server, and can also be used to set up a secure tunnel. SSH operates at layer 7 of the OSI model, the application layer. By contrast, IPsec, IP-in-IP, and GRE operate at the network layer.\nA Secure Shell (SSH) tunnel consists of an encrypted tunnel created through an SSH protocol connection. Users may set up SSH tunnels to transfer unencrypted traffic over a network through an encrypted channel. It is a software-based approach to network security and the result is transparent encryption.\nReferences:\nWhat is IPsec? | How IPsec VPNs work | Cloudflare What is tunneling? | Tunneling in networking | Cloudflare Tunneling protocol What is GRE tunneling? | How GRE protocol works | Cloudflare ","date":"2023-09-10T08:27:59Z","permalink":"https://blog.yorforger.cc/p/tunneling-protocols/","title":"Tunneling Protocols"},{"content":" # 1. Login without using keypairs Copy your ssh public key on your computer into the ~/.ssh/authorized_keys file on you EC2 instance.\nOn you local machine:\n1 2 $ cat ~/.ssh/id_rsa.pub ... Copy the content into your EC2 instance:\n1 $ sudo vi .ssh/authorized_keys Then you can login directly.\n# 2. oh-my-zsh shell 1 2 3 4 5 sudo apt install zsh -y chsh -s /bin/zsh sh -c \u0026#34;$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)\u0026#34; # wget æœ‰æ—¶å€™ä¼šå‡ºç° timeout, å¯ä»¥ç”¨ curl ä»£æ›¿: # sh -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34; # 3. Set up ufw 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 âœ ~ ufw status Status: active To Action From -- ------ ---- 22/tcp ALLOW Anywhere 22/tcp (v6) ALLOW Anywhere (v6) # if you need 443, do this: âœ ~ ufw allow 443 Rule added Rule added (v6) # or just disable âœ ~ ufw disable Learn more: ufw vs AWS Security Group - David\u0026rsquo;s Blog\n# 4. Other info After basic settings, on Alpine Linux: 1 vCPUs, 512 MB RAM, 10G SSD, Vultr VPS:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 âœ ~ df -h Filesystem Size Used Avail Use% Mounted on devtmpfs 10M 0 10M 0% /dev shm 231M 0 231M 0% /dev/shm /dev/vda2 9.2G 579M 8.2G 7% / tmpfs 93M 336K 92M 1% /run /dev/vda1 256M 266K 256M 1% /boot/efi tmpfs 231M 0 231M 0% /tmp âœ ~ speedtest-cli Testing download speed................................................................................ Download: 1648.48 Mbit/s Testing upload speed...................................................................................................... Upload: 1013.83 Mbit/s â¯ iperf -c 149.22.12.30 -R [ ID] Interval Transfer Bandwidth [ *1] 0.00-3.00 sec 77.2 MBytes 216 Mbits/sec [ *1] 3.00-6.00 sec 105 MBytes 295 Mbits/sec [ *1] 6.00-9.00 sec 101 MBytes 282 Mbits/sec â¯ iperf -c 149.22.12.30 [ ID] Interval Transfer Bandwidth [ 1] 0.00-3.00 sec 102 MBytes 286 Mbits/sec [ 1] 3.00-6.00 sec 104 MBytes 290 Mbits/sec [ 1] 6.00-9.00 sec 100 MBytes 281 Mbits/sec 1 2 # vpn x-ui bash \u0026lt;(curl -Ls https://raw.githubusercontent.com/FranzKafkaYu/x-ui/956bf85bbac978d56c0e319c5fac2d6db7df9564/install.sh) 0.3.4.4 ","date":"2023-09-09T15:53:57Z","permalink":"https://blog.yorforger.cc/p/basic-configuration-of-vps/","title":"Basic Configuration of VPS"},{"content":" # 1. DDoS attack A distributed denial-of-service (DDoS) attack is a malicious attempt to disrupt the normal traffic of a targeted server, service or network by overwhelming the target or its surrounding infrastructure with a flood of Internet traffic.\nWhen a DDoS attack happens, a large volume of traffic is sent to a website. The site under attack typically crashes because the increased traffic exhausts the bandwidth limit or overloads the websiteâ€™s servers.\nvideo: https://youtu.be/7kB9-nQJR44?si=R8qrLRhRwlqofAu5\n# 2. How does a DDoS attack work? DDoS attacks are carried out with networks of Internet-connected machines.\nThese networks consist of computers and other devices (such as IoT devices)which have been infected with malware, allowing them to be controlled remotely by an attacker. These individual devices are referred to as bots (or zombies), and a group of bots is called a botnet.\nOnce a botnet has been established, the attacker is able to direct an attack by sending remote instructions to each bot.\nWhen a victimâ€™s server or network is targeted by the botnet, each bot sends requests to the targetâ€™s IP address, potentially causing the server or network to become overwhelmed, resulting in a denial-of-service to normal traffic.\nBecause each bot is a legitimate Internet device, separating the attack traffic from normal traffic can be difficult.\n# 3. How to identify a DDoS attack The most obvious symptom of a DDoS attack is a site or service suddenly becoming slow or unavailable. But since a number of causes â€” such a legitimate spike in traffic â€” can create similar performance issues, further investigation is usually required. Traffic analytics tools can help you spot some of these telltale signs of a DDoS attack:\nSuspicious amounts of traffic originating from a single IP address or IP range A flood of traffic from users who share a single behavioral profile, such as device type, geolocation, or web browser version An unexplained surge in requests to a single page or endpoint Odd traffic patterns such as spikes at odd hours of the day or patterns that appear to be unnatural (e.g. a spike every 10 minutes) # 4. Challenge Collapsar (CC) attack - DDoS A Challenge Collapsar (CC) attack is an attack where standard HTTP requests are sent to a targeted web server frequently.\nIn 2004, a Chinese hacker nicknamed KiKi invented a hacking tool to send these kinds of requests to attack a NSFOCUS firewall named Collapsar, and thus the hacking tool was known as Challenge Collapsar, or CC for short. Consequently, this type of attack got the name CC attack.\nDDoS is not a specific attack, but a general term for a large types of attacks. There are dozens of types, and new attack methods are constantly being invented.\n# 4.1. Intercept cc attack - intercept http request (1) Hardware firewall\nSet a physical firewall before your server machine which used to filter request, this is best way but most expensive too.\n**(2) Software firewall **\nAlmost all OS has firewall installedï¼ŒLinux server usually use iptables, intercept request from IP address 1.2.3.4, for example:\n1 $ iptables -A INPUT -s 1.2.3.4 -j DROP (3) Web server\nWeb can also used to intercept IP address 1.2.3.4, on nginx:\n1 2 3 location / { deny 1.2.3.4; } On Apache, modify the .htaccess file:\n1 2 3 4 \u0026lt;RequireAll\u0026gt; Require all granted Require not ip 1.2.3.4 \u0026lt;/RequireAll\u0026gt; Web server have a impact impact on the performance when used in firewall and cannot protect when there are huge DDoS attack.\nLearn more: https://www.ruanyifeng.com/blog/2018/06/ddos.html\nReferences:\nWhat is a distributed denial-of-service (DDoS) attack? | Cloudflare What is a distributed denial-of-service (DDoS) attack? | Cloudflare Denial-of-service attack ","date":"2023-09-09T09:29:57Z","permalink":"https://blog.yorforger.cc/p/ddos-attack/","title":"DDoS Attack"},{"content":" # 1. TUN/TAP Devices In computer networking, TUN and TAP are two different kernel virtual network devices. Though both are for tunneling purposes, TUN and TAP can\u0026rsquo;t be used together because they transmit and receive packets at different layers of the network stack. TUN (network TUNnel) devices are used for IP packet-level tunneling, while TAP (network TAP) devices are used for Ethernet frame-level tunneling.\nA network interface can be a physical device, called network interface controller (NIC), such as an ethernet card or wireless adapter, or a virtual device, such as a TUN or TAP interface.\nSource: https://www.baeldung.com/linux/create-check-network-interfaces\nTUN/TAP provides packet reception and transmission for user space programs. It can be seen as a simple Point-to-Point or Ethernet device, which, instead of receiving packets from physical media, receives them from user space program and instead of sending packets via physical media writes them to the user space program. It interacts with user space program not the kernel.\nSource: https://docs.kernel.org/networking/tuntap.html\n# 2. TUN/TAP \u0026amp; Network Stack TUN/TAP is an operating-system interface for creating network interfaces managed by userspace. This is usually used to implement userspace Virtual Private Networks[1] (VPNs), for example with OpenVPN, OpenSSH (Tunnel configuration or -w argument), l2tpns, etc.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 +--------------------------------------------+ | Processes | +--------------------------------------------+ â†• Socket interface +---------------------------------------------+ | Network Stack (kernel) |\u0026lt;--+ +---------------------------------------------+ | â†• Eth. frame â†• Eth. frame â†• IP packet | +--------------+ +-------------+ +------------+ | | enp2s0 | | tap0 | | tun0 | | +--------------+ +-------------+ +------------+ | â†‘ Eth. frame â†• Eth. frameÂ¹ â†• IP packetÂ¹ | +--------------+ +-------------+ +------------+ | | Driver | | Process | | Process | | +--------------+ +-------------+ +------------+ | â†• Eth. frameÂ² â†‘ â†‘ | +--------------+ +---------------+--------------+ | Eth. Adapter | (encapsulated packets) +--------------+ â†• Eth. frame +--------------+ | Eth. Network | +--------------+ Physical netdev Ethernet VPN IP VPN Â¹: via /dev/net/tun Â²: over PCI Express for example There are many applications running on our OS (reside in user space), they send network packets with socket interface (on linux). All the packets through socket interface will go to one place: the Network Stack (resides in kernel). And the packets from the Network Stack only have two direction to go, one is the physical network interfce (NIC), another direction is the virtual network devices tap/tun, and we can get the packets from tap/tun which usually used in VPN application (resides in user space). Of course, VPN applicatipn (user space) can write packet into tap/tun devices and after written into tap/tun the packet will goes to Network Stack, and there are two direction again\u0026hellip;\nYou probably notice that if we use TUN/TAP devices to handle the packets from other normal applications, the packet seem to go through the Network Stack twice: the normal applications write data into socket interface and these packets will go through Netwok Stack and intercepted by TUN/TAP devices, then after vpn handles these packets, these packet will be sent to Network Stack again, which probably not efficient. (Notice that in qemu-kvm, tap device works with bridge, and the packets goes to bridge directly without going through Network Stack which is more efficient)\nApplications send or receive packet to/from socket interface:\n1 int socket = socket(AF_PACKET,SOCK_RAW,IPPROTO_IP) VPN application send or receive packet to/from tun devices:\n1 2 3 4 5 6 7 8 9 // Request a TUN device int fd = open(\u0026#34;/dev/net/tun\u0026#34;, O_RDWR); // receives a (single) packet or frame from the virtual network interface; // Read an IP packet (because TUN works on IP layer): ssize_t count = read(fd, buffer, BUFFLEN); // sends a (single) packet or frame to the virtual network interface; write(...) Source: TUN/TAP interface (on Linux) - /dev/posts/\n# 3. TUN vs. TAP There are two types of virtual network interfaces managed by /dev/net/tun:\nTUN interfaces transport IP packets (layer 3); TAP interfaces transport Ethernet frames (layer 2). # 3.1. TUN interfaces (L3) TUN interfaces (IFF_TUN) transport layer 3 (L3) Protocol Data Units (PDUs):\nin practice, it transports IPv4 and/or IPv6 packets; read() gets a L3 PDU (an IP packet); you must write() L3 PDUs (an IP packet); there is no layer 2 (Ethernet, etc.) involved in the interface; # 3.2. TAP interfaces (L2) TAP interfaces (IFF_TUN) transport layer 2 (L2) PDUs:\nin practice, it transports Ethernet frames (i.e. this is a virtual Ethernet adapter); read() gets a L2 PDU; you must write() L2 PDUs. Source: TUN/TAP interface (on Linux) - /dev/posts/\n# 4. Set up TUN/TAP devices Because TUN is a layer 3 connection, it acts as a point-to-point link. Weâ€™ll assign these parameters:\nlocal address (for your machine): 192.0.2.1 remote address (for Scapy): 192.0.2.2 On Linux, you would use:\n1 2 3 sudo ip link set tun0 up sudo ip addr add 192.0.2.1 peer 192.0.2.2 dev tun0 # sudo ip addr add 192.0.2.1 peer 192.0.2.2 dev tun0 up On BSD and macOS, use:\n1 2 3 sudo ifconfig tun0 up sudo ifconfig tun0 192.0.2.1 192.0.2.2 # sudo ifconfig tun0 192.0.2.1 192.0.2.2 up Source: https://scapy.readthedocs.io/en/latest/layers/tuntap.html#tuntapinterface-reference\n","date":"2023-09-08T17:54:59Z","permalink":"https://blog.yorforger.cc/p/tun/tap-devices/","title":"TUN/TAP Devices"},{"content":" # 1.error interface The error type is an interface type. An error variable represents any value that can describe itself as a string.\n1 2 3 type error interface { Error() string } Interface error is a built-in type, as with all other built in types, is predeclared in the universe block. The most commonly-used error implementation is the errors packageâ€™s unexported errorString type.\n1 2 3 4 5 6 7 8 // errorString is a trivial implementation of error. type errorString struct { s string } func (e *errorString) Error() string { return e.s } errorString is an unexported type which means we cannot use it directly outside of errors package, but we can use New function declared in the same package to create a value of errorString.\n1 2 3 4 // New returns an error that formats as the given text. func New(text string) error { return \u0026amp;errorString{text} } The type of function returns is an error but it actually returns a pointer, a little weird probably for newb from c++. In Go everything can implement a interface an int, string even a pointer. It\u0026rsquo;s all about if the method set of that type contians all the methods declared in a interface, learn more: Methods Receivers \u0026amp; Concurrency - Go - David\u0026rsquo;s Blog\n# 2. Summarize the context # 2.1. Ways to create an error value You can create an error with these functions:\nerrors.New(), fmt.Errorf(), often used to provide conetxt. Use a custom error type, typically used for provide error details. # 2.2. Summarize the context when create an error value It is the error implementationâ€™s responsibility to summarize the context. The error returned by os.Open formats as â€œopen /etc/passwd: permission denied,â€ not just â€œpermission denied.â€\n1 2 3 4 5 6 func Sqrt(f float64) (float64, error) { if f \u0026lt; 0 { return 0, fmt.Errorf(\u0026#34;math: square root of negative number %g\u0026#34;, f) } // implementation } 1 2 3 if err != nil { return nil, fmt.Errorf(\u0026#34;math: failed to calculate sqrt: %v\u0026#34;, err) } # 3. Some common ways for error handling We have talked that there are three ways to create an error, now let\u0026rsquo;s discuss how to use them in practice.\n# 3.1. Create error value with a custom error type - provide details In many cases fmt.Errorf is good enough, but since error is an interface, you can use arbitrary data structures as error values, to allow callers to inspect the details of the error.\nThe json package specifies a SyntaxError type that the json.Decode function returns when it encounters a syntax error parsing a JSON blob.\n1 2 3 4 5 6 type SyntaxError struct { msg string // description of error Offset int64 // error occurred after reading Offset bytes } func (e *SyntaxError) Error() string { return e.msg } The Offset field isnâ€™t even shown in the default formatting of the error, but callers can use it to add file and line information to their error messages:\n1 2 3 4 5 6 7 8 if err := dec.Decode(\u0026amp;val); err != nil { if serr, ok := err.(*json.SyntaxError); ok { // serr.Offset provide detials about error line, col := findLine(f, serr.Offset) return fmt.Errorf(\u0026#34;%s:%d:%d: %v\u0026#34;, f.Name(), line, col, err) } return err } # 3.2. Don\u0026rsquo;t return error dirctly - avoid repetitive error handling # 3.2.1. Return a bool value instead to indicate an abnormal state Hereâ€™s a simple example from the bufio packageâ€™s Scanner type. Its Scan method performs the underlying I/O, which can of course lead to an error. Yet the Scan method does not expose an error at all. Instead, it returns a boolean, and a separate method, to be run at the end of the scan, reports whether an error occurred. Client code looks like this:\n1 2 3 4 5 6 7 8 scanner := bufio.NewScanner(input) for scanner.Scan() { token := scanner.Text() // process token } if err := scanner.Err(); err != nil { // process the error } Sure, there is a nil check for an error, but it appears and executes only once. The Scan method could instead have been defined as\n1 func (s *Scanner) Scan() (token []byte, error) and then the example user code might be (depending on how the token is retrieved),\n1 2 3 4 5 6 7 8 scanner := bufio.NewScanner(input) for { token, err := scanner.Scan() if err != nil { return err // or maybe break } // process token } This isnâ€™t very different, but there is one important distinction. In this code, the client must check for an error on every iteration, but in the real Scanner API, the error handling is abstracted away from the key API element, which is iterating over tokens. With the real API, the clientâ€™s code therefore feels more natural: loop until done, then worry about errors. Error handling does not obscure the flow of control.\n# 3.2.1. Return nothing 1 2 3 4 5 6 7 8 9 10 11 12 13 _, err = fd.Write(p0[a:b]) if err != nil { return err } _, err = fd.Write(p1[c:d]) if err != nil { return err } _, err = fd.Write(p2[e:f]) if err != nil { return err } // and so on The code above is very repetitive. A function literal closing over the error variable would help:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 var err error write := func(buf []byte) { if err != nil { return } _, err = w.Write(buf) } write(p0[a:b]) write(p1[c:d]) write(p2[e:f]) // and so on if err != nil { return err } This pattern works well, but requires a closure in each function doing the writes; a separate helper function is clumsier to use because the err variable needs to be maintained across calls (try it).\nWe can make this cleaner, more general, and reusable by borrowing the idea from the Scan method above.\nI defined an object called an errWriter, something like this:\n1 2 3 4 type errWriter struct { w io.Writer err error } and gave it one method, write. It doesnâ€™t need to have the standard Write signature, and itâ€™s lower-cased in part to highlight the distinction. The write method calls the Write method of the underlying Writer and records the first error for future reference:\n1 2 3 4 5 6 func (ew *errWriter) write(buf []byte) { if ew.err != nil { return } _, ew.err = ew.w.Write(buf) } As soon as an error occurs, the write method becomes a no-op but the error value is saved.\nGiven the errWriter type and its write method, the code above can be refactored:\n1 2 3 4 5 6 7 8 ew := \u0026amp;errWriter{w: fd} ew.write(p0[a:b]) ew.write(p1[c:d]) ew.write(p2[e:f]) // and so on if ew.err != nil { return ew.err } This is cleaner, even compared to the use of a closure, and also makes the actual sequence of writes being done easier to see on the page. There is no clutter anymore. Programming with error values (and interfaces) has made the code nicer.\nIn fact, this pattern appears often in the standard library. The archive/zip and net/http packages use it. More salient to this discussion, the bufio packageâ€™s Writer is actually an implementation of the errWriter idea. Although bufio.Writer.Write returns an error, that is mostly about honoring the io.Writer interface. The Write method of bufio.Writer behaves just like our errWriter.write method above, with Flush reporting the error, so our example could be written like this:\n1 2 3 4 5 6 7 8 b := bufio.NewWriter(fd) b.Write(p0[a:b]) b.Write(p1[c:d]) b.Write(p2[e:f]) // and so on if b.Flush() != nil { return b.Flush() } There is one significant drawback to this approach, at least for some applications: there is no way to know how much of the processing completed before the error occurred. If that information is important, a more fine-grained approach is necessary. Often, though, an all-or-nothing check at the end is sufficient.\nWeâ€™ve looked at just one technique for avoiding repetitive error handling code. Keep in mind that the use of errWriter or bufio.Writer isnâ€™t the only way to simplify error handling, and this approach is not suitable for all situations. The key lesson, however, is that errors are values and the full power of the Go programming language is available for processing them.\nReferences:\nError handling and Go - The Go Programming Language Errors are values - The Go Programming Language ","date":"2023-09-08T09:13:06Z","permalink":"https://blog.yorforger.cc/p/error-handling-go/","title":"Error handling - Go"},{"content":" # 1. Four types of parameter Default argument Keyword arguments (named arguments) Positional arguments Arbitrary arguments (variable-length arguments *args and **kwargs) # 2. Parameters vs arguments 1 2 3 4 5 6 # a and b here are pamameter def my_sum(a, b): # function definition returen a + b # a and 99 are arguments my_sum(1, 99) # function call # 3. Positional arguments vs keyword argumentss 1 2 def add(lhs, rhs): ... For this function we have many ways to call it, add(10, 20), add(lhs=10, rhs=20) and add(10, rhs=20),\nIn add(10, 20), 10, 20 are positional arguments,\nIn add(lhs=10, rhs=20), lhs=10 and rhs=20 are keyword arguments,\nIn add(10, rhs=20), 10 is positional arguments, rhs=20 is keyword arguments,\n# 4. Arbitrary positional arguments (*args) We can pass multiple arguments to the function. Internally all these values are represented in the form of a tuple.\n1 2 3 4 5 def percentage(sub1, sub2, sub3): avg = (sub1 + sub2 + sub3) / 3 print(\u0026#39;Average\u0026#39;, avg) percentage(56, 61, 73) This function works, but itâ€™s limited to only three arguments.\n1 2 3 4 5 6 7 8 9 10 11 # function with variable-length arguments def percentage(*args): sum = 0 for i in args: # get total sum = sum + i # calculate average avg = sum / len(args) print(\u0026#39;Average =\u0026#39;, avg) percentage(56, 61, 73) # 5. Arbitrary keyword arguments (**kwargs) arbitrary keyword arguments use dictionary to store keyword arguments,\n1 2 3 4 5 6 7 8 9 10 11 12 # function with variable-length keyword arguments def percentage(**kwargs): sum = 0 for sub in kwargs: # get argument name sub_name = sub # get argument value sub_marks = kwargs[sub] print(sub_name, \u0026#34;=\u0026#34;, sub_marks) # pass multiple keyword arguments percentage(math=56, english=61, science=73) Output:\n1 2 3 math = 56 english = 61 science = 73 We can learn a lot from the source code if some python program:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 def __prepare_create_request( cls, api_key=None, api_base=None, api_type=None, api_version=None, organization=None, **params, ): deployment_id = params.pop(\u0026#34;deployment_id\u0026#34;, None) engine = params.pop(\u0026#34;engine\u0026#34;, deployment_id) model = params.get(\u0026#34;model\u0026#34;, None) timeout = params.pop(\u0026#34;timeout\u0026#34;, None) stream = params.get(\u0026#34;stream\u0026#34;, False) headers = params.pop(\u0026#34;headers\u0026#34;, None) model = params.get(\u0026quot;model\u0026quot;, None) : It tries to retrieve the \u0026ldquo;model\u0026rdquo; key from the params dictionary, If that key exists, it uses that value, If that key does not exist, it uses the default value None.\ndeployment_id = params.pop(\u0026quot;deployment_id\u0026quot;, None): Same as params.get() but it will removes that key.\nReferences:\nPython Function Arguments [4 Types] â€“ PYnative Dictionary - Python ","date":"2023-09-07T22:51:26Z","permalink":"https://blog.yorforger.cc/p/variable-parameter-python/","title":"Variable Parameter Python"},{"content":" # 1. Useful commands 1 $ go test -run \u0026#34;ExampleSession|TestSession\u0026#34; -v Note that the -run flag is used for specifying test functions, not benchmarks, not fuzz test. Because example test is similar to test function, you can specify both example and test function with -run flag. If you want to specify benchmarks, use -bench flag:\n1 2 3 4 5 6 7 8 9 10 -bench regexp Run benchmarks matching the regular expression. -run regexp Run only tests and examples matching the regular expression. # Flags below can be used with flags above. -race enable data race detection. -cover enable code coverage instrumentation. Note that -bench does not disable the normal test selection. If you want run the benchmark test only you should pass -run=xxx to disable the normal test selection.\n1 2 3 4 go test -run=xxx -bench \u0026#39;BenchmarkDirectRead|BenchmarkLimitedRead\u0026#39; # just one function, no single quote is fine: $ go test -run=xxx -bench BenchmarkStore Learn more: go command - cmd/go - Go Packages\n# 2. -bench \u0026amp; -benchmem The benchmark tool only reports heap allocations. Stack allocations via escape analysis are less costly, possibly free, so are not reported.\n1 2 3 â¯ go test -run=xxx -bench \u0026#39;BenchmarkDirectRead|BenchmarkLimitedRead\u0026#39; -benchmem BenchmarkDirectRead-8 38036484 31.47 ns/op 48 B/op 1 allocs/op BenchmarkLimitedRead-8 12315 97480 ns/op 72 B/op 2 allocs/op The -8 indicates that these benchmarks were run with a GOMAXPROCS value of 8, meaning up to 8 OS threads were used concurrently. This is typically set to the number of CPU cores available.\n38036484`` for BenchmarkDirectRead and 12315`` for BenchmarkLimitedRead are the number of iterations the benchmark function was executed.\n48 B/op: This means that on average, 48 bytes are being allocated per operation (op) in the benchmarked function.\nSource:\nhttps://stackoverflow.com/questions/56832207/golang-benchmark-why-does-allocs-op-show-0-b-op https://stackoverflow.com/a/35588683/16317008 ","date":"2023-09-05T15:10:18Z","permalink":"https://blog.yorforger.cc/p/unit-test-basic-commands-go/","title":"Unit Test Basic Commands - Go"},{"content":" # 1. Different behaviors - pointer and value receiver There are two reasons to use a pointer receiver:\nThe first is so that the method can modify the value that its receiver points to.\nThe second is to avoid copying the value on each method call. This can be more efficient if the receiver is a large struct, for example.\n\u0026ldquo;the value\u0026rdquo; above refers to an object of the struct, but there is no object in golang, we call all of them value.\nI\u0026rsquo;ll explain it to you the different behaviors between pointer receiver and value receiver first, see the code below:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 type Person struct { name string } func (p Person) foo() *Person { // As in all languages in the C family, everything in Go is passed by value. // \u0026#39;p\u0026#39; here, is a copy of \u0026#39;coco\u0026#39; return \u0026amp;p } func (p Person) setName(name string) { // \u0026#39;p\u0026#39; here, is a copy of \u0026#39;coco\u0026#39; p.name = name } func (p Person) getName() string { return p.name } func main() { coco := Person{name: \u0026#34;Coco\u0026#34;} coco.setName(\u0026#34;Bella\u0026#34;) fmt.Println(coco.getName()) // print: Coco } As you can see here, value receiver method will make a copy of that \u0026ldquo;object\u0026rdquo;. There is no object in golang, using term \u0026ldquo;object\u0026rdquo; here is for easy understanding. This is that if you want to avoid copying the value of the struct on each method call, try to use a pointer receiver. And if you want modify the value\u0026rsquo;s fields, try to use a pointer receiver.\nI find a snippet in go source code, e.g.,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 type Handler interface { ServeHTTP(ResponseWriter, *Request) } type HandlerFunc func(ResponseWriter, *Request) // 1. We don\u0026#39;t need to modify any fileds of the value of HandlerFunc, just a function // 2. There is no a lot copies, when we call this method, just a copy of function type, // small as a pointer so choosing a value receiver probably more appropriate here // or thinking in this way probably better // I know what I do, this is a function type, it has no filed // no concurrency issues we mentioned above func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) { f(w, r) } NOTE: Generally, in practice, we seldom use pointer types whose base types are slice types, map types, channel types, function types, string types and interface types. The costs of copying values of these assumed base types are very small.\nSource: https://go101.org/article/value-copy-cost.html\n# 2. Method receivers in concurrency I came across a satement about when to use value receiver but forget where I found:\nYou should notice that value receivers are concurrency safe, while pointer receivers are not concurrency safe. So if there is no a lot copy, and you don\u0026rsquo;t need modify any field of the value, try to use value receiver.\nIs this correct, yes it\u0026rsquo;s correct to some extend, but things probably are more complicated when come across concurrent programming.\nI find a good blog talks about this written by Dave Cheney, and I\u0026rsquo;ll share some parts of the blog here:\nObviously if your method mutates its receiver, it should be declared on *T. However, if the method does not mutate its receiver, is it safe to declare it on T instead *T?\nIt turns out that the cases where it is safe to do so are very limited. For example, it is well known that you should not copy a sync.Mutex value as that breaks the invariants of the mutex. As mutexes control access to other things, they are frequently wrapped up in a struct with the value they control:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package counter type Val struct { mu sync.Mutex val int } func (v *Val) Get() int { v.mu.Lock() defer v.mu.Unlock() return v.val } func (v *Val) Add(n int) { v.mu.Lock() defer v.mu.Unlock() v.val += n } Most Go programmers know that it is a mistake to forget to declare the Get or Add methods on the pointer receiver *Val. However any type that embeds a Val to utilise its zero value, must also only declare methods on its pointer receiver otherwise it may inadvertently copy the contents of its embedded typeâ€™s values.\n1 2 3 4 5 6 7 type Stats struct { a, b, c counter.Val } func (s Stats) Sum() int { return s.a.Get() + s.b.Get() + s.c.Get() // whoops } A similar pitfall can occur with types that maintain slices of values, and of course there is the possibility for an unintended data race.\nIn short, I think that you should prefer declaring methods on *T unless you have a strong reason to do otherwise.\n","date":"2023-09-02T22:18:20Z","permalink":"https://blog.yorforger.cc/p/methods-receivers-concurrency-go/","title":"Methods Receivers \u0026 Concurrency - Go"},{"content":" # Problem On github shwezhu.github.io repository I have two branch already, one is master for static html files that is generate web page, another is backup for backup of my hexo themes files and blogs.\nI want backup the hugo theme files with my blog files.\n# Solution I\u0026rsquo;m using hugo now but I don\u0026rsquo;t want to override or delete the theme files for hexo, therefore, I cannot just fetch remote branch backup and merge it with my local branch and then push. This will override the files stored on backup before.\n1 2 3 4 # should not do this git fetch origin backup git branch -a git merge origin/backup --allow-unrelated-histories So I create a new branch called backup-hugo, and push all files to this branch.\n1 2 3 4 5 6 7 cd blogs git init # you can add .gitignore here git add . git commit... git branch -M backup-hugo # rename current branch git push -u origin backup-hugo # Other Findings During this process, when I do commit I got wrong message that there is another git repository under themes/even/, however, I have do git add ., what should I do now is to go to themes/even/ and delete .git file, then undo git add which is called unstage file from index area,\n1 2 3 4 5 6 cd themes/even. rm -rf .git cd .. \u0026amp;\u0026amp; cd .. git rm --cached themes/even/.git git add . git commit... git rm --cached is a very useful command, it can make file from tracked to untracked status.\n","date":"2023-09-01T14:12:50Z","permalink":"https://blog.yorforger.cc/p/backup-blogs-with-git-sovled/","title":"Backup Blogs with Git - Sovled"},{"content":" # 1. Run a script A hello world script:\n1 2 #!/usr/bin/bash echo \u0026#34;hello world\u0026#34; The first here specifies which shell should execute this script, if you don\u0026rsquo;t write, the default shell on your computer will run it, check all the shells on your computer:\n1 2 3 4 5 6 7 8 9 10 11 $ cat /etc/shells # List of acceptable shells for chpass(1). # Ftpd will not allow users to connect who are not using # one of these shells. /bin/bash /bin/csh /bin/dash /bin/ksh /bin/sh /bin/tcsh /bin/zsh Don\u0026rsquo;t write a wrong location of bash interpreter, /bin/nmsd below doesn\u0026rsquo;t exist, execute this script will go wrong:\n1 2 3 4 5 6 7 $ cat script.sh #!/bin/nmsd echo \u0026#34;hello world\u0026#34; $ chmod u+x script.sh $ ./script.sh zsh: ./a.sh: bad interpreter: /bin/ash: no such file or directory chmod u+x will made the file executable for your user (it will only add it for your user, though it may be already executable by the group owner, or \u0026ldquo;other\u0026rdquo;). chmod a+x (\u0026lsquo;all plus executable bit\u0026rsquo;) makes the file executable by everyone. The u is standing for \u0026ldquo;user\u0026rdquo;. That means that the executable flag only applies to the current user of the file.\nu for user (the user who is owner of the file g for group (other users in the file group o for others (users not in the file group a for all (all users # 2. Bash variables are untyped Bash does not type variables like C and related languages, defining them as integers, floating points, or string types. In Bash, all variables are strings. A string that is an integer can be used in integer arithmetic, which is the only type of math that Bash is capable of doing.\nThe assignment VAR=10 sets the value of the variable VAR to 10. To print the value of the variable, you can use the statement echo $VAR.\nNote: The syntax of variable assignment is very strict. There must be no spaces on either side of the equal = sign in the assignment statement.\nIt is not suitable for scientific computing or anything that requires decimals, such as financial calculations.\n# 3. for loop and array 1 2 3 4 5 6 for item in (list) do command_one command_two ... done e.g.,\n1 2 3 4 5 6 7 #!/usr/bin/bash archs=(amd64 arm64 ppc64le ppc64 s390x) for arch in ${archs} do env GOOS=linux GOARCH=${arch} go build -o prepnode_${arch} done 1 2 3 4 5 # rename all file under current folder form lowercase to capital for file in *; do mv \u0026#34;$file\u0026#34; `echo $file | tr \u0026#39;a-z\u0026#39; \u0026#39;A-Z\u0026#39;` done But this isn\u0026rsquo;t the best choice, the command below will rename all files recursively which the code above cannot do,\n1 2 $ brew install rename $ find . -depth -execdir rename -f \u0026#39;y/A-Z/a-z/\u0026#39; {} \\; You probably wonder what is the \u0026quot;\u0026quot;, * and ; above, I\u0026rsquo;ll explain it to you next.\n# 4. Control operators ;: Will run one command after another has finished, irrespective of the outcome of the first. This means even there is wrong in fiest command, the second can execute. \u0026amp;\u0026amp;: if the precceeding command goes wrong, the commands left won\u0026rsquo;t be executed. ||: It executes the command on the right only if the command on the left returned an error. 1 2 3 4 5 6 7 8 9 10 11 # even command `cd fd.sh` goes wrong, command `ls` can be executed $ cd fd.sh; ls cd: not a directory: fd.sh economic fd.sh test.sh $ cd fd.sh \u0026amp;\u0026amp; ls cd: not a directory: fd.sh $ cd fd.sh || ls cd: not a directory: fd.sh economic fd.sh test.sh # 5. Quotes # 5.1. Why need qoutes Quoting is used to remove the special meaning of metacharacters or words to the shell. Quoting can be used to disable special treatment for special characters, to prevent reserved words from being recognized as such, and to prevent parameter expansion.\nMetacharacter: a character that, when unquoted, separates words. A metacharacter is a space, tab, newline, or one of the following characters: *, ?, |, \u0026amp;, ;, (, ), \u0026lt;, or \u0026gt;, etc\u0026hellip;\nParameter Expansion: The $ character introduces parameter expansion, command substitution, or arithmetic expansion. source\nFor example, you want to print \u0026lt;-$1500.**\u0026gt;; (update?) [y|n], but \u0026lt;\u0026gt;*;$ has a special meaning in bash, and printing it directly won\u0026rsquo;t work.\nYou can use escape character \\ to solve this problem:\n1 2 bash-3.2$ echo \\\u0026lt;-\\$1500.\\*\\*\\\u0026gt;\\; \\(update\\?\\) \\[y\\|n\\] \u0026lt;-$1500.**\u0026gt;; (update?) [y|n] But this is not elegant, you can use single quote to solve this problem:\n1 2 bash-3.2$ echo \u0026#39;\u0026lt;-$1500.**\u0026gt;; (update?) [y|n]\u0026#39; \u0026lt;-$1500.**\u0026gt;; (update?) [y|n] Why does this work? Because all special characters between single quotes lose their special meaning, I find a table will help:\nSr.No. Quoting \u0026amp; Description 1 **Single quote ** All special characters between these quotes lose their special meaning. 2 Backslash \\ Any character immediately following the backslash loses its special meaning. 3 Backquote Anything in between back quotes would be treated as a command and would be executed. 4 The characters $ and \u0026lsquo;`\u0026rsquo; retain their special meaning within double quotes. # 5.2. Backqoute You may wonder what does back quote mean in the table, I\u0026rsquo;ll give you an example:\n1 2 3 4 $ cat a.txt hello world $ A=`cat a.txt`; echo \u0026#34;$A\u0026#34; hello world The code between back quotes will be executed, and if there is output, you can save it into a variable,\n# 5.3. Double quotes Sometimes * may acts like it remains its spcecial meaning in double quotes:\nWithout any special options:\nInside double quotes (\u0026quot;), the asterisk * retains its literal meaning and does not perform globbing (expansion to match filenames).\nFor example, \u0026quot;*\u0026quot; will be treated as a literal asterisk character.\nWith some spcecial options:\nfind . -name \u0026quot;*.sh\u0026quot; -type f , in the command the -name \u0026quot;*.sh\u0026quot; the \u0026quot;*.sh\u0026quot; acts as a pattern, the double quotes prevent the shell from interpreting the asterisk as a wildcard character and expanding it to match filenames in the current directory. Therefore, in the given command, \u0026quot;*.c\u0026quot; is treated as a literal string by the shell. The find command receives the pattern \u0026quot;*.c\u0026quot; as an argument, and it performs the matching internally during its execution. Which acts like the * doesn\u0026rsquo;t lose its special meaning. # 6. $ \u0026amp; * in bash # 6.1. $ $ has many use cases, I\u0026rsquo;ll introduce one here, in bash scripting, variables are used to store values, the $ symbol is used to retrieve the value of a variable Value.\n1 name=\u0026#34;Mark\u0026#34;; echo \u0026#34;My name is $name\u0026#34; âš  Don\u0026rsquo;t forget $ and \u0026lsquo;back quote\u0026rsquo; sign retain their special meaning between double quote.\n# 6.2. * âš  * will lose its special meaning between double quote.\nThe Shell (bash) considers an asterisk * to be a wildcard character that can match one or more occurrences of any character, including no character.\nThe â€œ*â€ character is a shortcut for â€œeverythingâ€. Thus, if you enter ls *, you will see all of the contents of a given directory.\nls *fq lists every file that ends with a fq. ls /usr/bin/*.sh This lists every file in /usr/bin directory that ends in the characters .sh. * can be placed anywhere in your pattern: ls Mov10*fq Now when you check the command we did before, you may understand:\n1 2 3 4 5 # rename all file under current folder form lower-case to upper-case for file in *; do mv \u0026#34;$file\u0026#34; `echo $file | tr \u0026#39;a-z\u0026#39; \u0026#39;A-Z\u0026#39;` done # 5. Arithmetic expansion Parameter Expansion: The $ character introduces parameter expansion, command substitution, or arithmetic expansion. source\nThe behaviour of bash interpreter is different from other programming interpreter so if you write code like below:\n1 2 3 #!/usr/bin/bash $ a=3; b=5; c=a+b; echo $c # Print: a+b You may not get the result you want, the correct way to do this:\n1 2 3 $ a=3; b=5; c=$((a+b)); echo $c $ a=3; b=5; echo $((a+b)) $ a=3; b=5; let c=\u0026#34;a+b\u0026#34;; echo $c $((...)) is called arithmetic expansion, which is typical of the bash and ksh shells. This allows doing simple integer arithmetic, no floating point stuff though. The result of the expression replaces the expression, as in echo $((1+1)) would become echo 2 ((...)) is referred to as arithmetic evaluation and can be used as part of if ((...)); then or while ((...)) ; do statements. Arithmetic expansion $((..)) substitutes the output of the operation and can be used to assign variables as in i=$((i+1)) but cannot be used in conditional statements. let is a bash and ksh keyword which allows for variable creation with simple arithmetic evaluation. If you try to assign a string there like let a=\u0026quot;hello world\u0026quot; you\u0026rsquo;ll get a syntax error. # 6. Conclusion There must be no spaces on either side of the equal = sign in the assignment statement. Three control operators: ;, ||, \u0026amp;\u0026amp; set defalul shell: chsh -s /bin/zsh, switch shell temporarily: shell-name + enter check version of shell: echo \u0026quot;$ZSH_VERSION\u0026quot;, echo \u0026quot;$BASH_VERSION\u0026quot; check all shells: cat /etc/shells References:\nbash - \u0026lsquo;chmod u+x\u0026rsquo; versus \u0026lsquo;chmod +x\u0026rsquo; - Ask Ubuntu Linux: Difference between \u0026ldquo;chmod +x\u0026rdquo; and \u0026ldquo;chmod u+x\u0026rdquo; Quoting (Bash Reference Manual) Unix / Linux - Shell Quoting Mechanisms bash - Understanding backtick (`) - Unix \u0026amp; Linux Stack Exchange Shell Expansions (Bash Reference Manual) The Shell | Introduction to the command line interface (Shell) ","date":"2023-09-01T12:23:59Z","permalink":"https://blog.yorforger.cc/p/shell-script-basic-syntax/","title":"Shell Script Basic Syntax"},{"content":" # 1. Recover 1 $ hugo new site blogs \u0026amp;\u0026amp; cd blogs # 2. Deploy to Github Pages # 2.1. Local Repository 1 2 3 4 5 6 $ cd blogs/public/ $ git init $ git remote add origin git@github.com:shwezhu/shwezhu.github.io.git ... $ git branch -M master $ git push origin master # 2.2. Remote Repository Go to Settings -\u0026gt; Pages -\u0026gt; Build and deployment\nSource: depoly from a branch\nBranch: choose master\nThen go to Actions options, you can see your page is building in progess, when it finished, visit: https://your-username.github.io\nYou probably need wait about 10 mintes even your the processof building bolgs has been finished, try to clear cache of your browser and restart your browser if you constantly get 404 page for yor website.\n# 3. Custom Domain (optional) Update DNS Records of your domain according to the provided ip address by github:\nGo to Settings -\u0026gt; Pages -\u0026gt; Custom domain: input your domain. And wait about 15 mintes to take effect (try to clear your browser cache).\nIf https cannot enable, try to remove your custom domain and wait minutes add again. The CNAME DNS Records has to be set towww, when I set blog the https cannot be enabled.\nLearn more: https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site\n# 4. Issues - 404 page Hugo will make the url into lowercase automatically, therefore, make sure all you blog files and folders under /content/post/ are lowercase. Otherwise, you will get 404 for that blog.\nAnd if you didn\u0026rsquo;t make it lowercase before generate html pages with hugo command, then you need delete all the generated html files under /public/post/ then run hugo command again, this should work.\n# 5. Insert Images Put images under /static/file-name/ and insert image with![](/file-name/xxx.png),\nOn Typora, go to settings -\u0026gt; images -\u0026gt; When instert, choose custome folder and write someting like this:\n1 /Users/David/blogs/static/${filename} then, write typora-root-url: ../../../static at front matter of blog, if you don\u0026rsquo;t know how to wtite, you can choose option:\nFromat -\u0026gt; Image -\u0026gt; Use Image Root Path, then typora will add someting like typora-root-url: ../../../static in yur md file at the front matter part. Then both typora and website will disply image correctly.\n# 6. Backup \u0026amp; Recover # 6.1. Backup Please check: Backup Blogs with Git - David\u0026rsquo;s Blog\n# 6.2. Recover 1 hugo new site blogs Copy the files stored in github into folder blogs/, then\n1 hugo server and visit localhost to check\u0026hellip;\nReferences: https://olowolo.com/post/hugo-quick-start/\n","date":"2023-08-31T23:51:57Z","permalink":"https://blog.yorforger.cc/p/write-blog-with-hugo-deploy-to-github-pages/","title":"Write Blog with Hugo \u0026 Deploy to Github Pages"},{"content":" # 1. Why do we need encoding To transmit a data structure across a network or to store it in a file, it must be encoded and then decoded again. Cause computer just know binary.\nThere are many encodings available, of course: JSON, XML, Googleâ€™s protocol buffers, and more. And now thereâ€™s another, provided by Goâ€™s gob package.\n# 2. encoding/gob # 2.1. Why gob Why define a new encoding? Itâ€™s a lot of work and redundant at that. Why not just use one of the existing formats? Well, for one thing, we do! Go has packages supporting all the encodings just mentioned (the protocol buffer package is in a separate repository but itâ€™s one of the most frequently downloaded). And for many purposes, including communicating with tools and systems written in other languages, theyâ€™re the right choice.\nBut for a Go-specific environment, such as communicating between two servers written in Go, thereâ€™s an opportunity to build something much easier to use and possibly more efficient.\nGob is much more preferred when communicating between Go programs. However, gob is currently supported only in Go and, well, C, so only ever use that when you\u0026rsquo;re sure no program written in any other programming language will try to decode the values. source\n# 2.2. Googleâ€™s Protocol Buffers misfeatures Gobs implements thress important features compared with Google\u0026rsquo;s Protocol Buffers:\nThe type being encoded does\u0026rsquo;t need to be a struct, it can be a map, slice, array etc\u0026hellip; Don\u0026rsquo;t need all fields of a type exist when decoding and encoding. If the varibale being transmitted has \u0026ldquo;zero value\u0026rdquo; for its type, it doesn\u0026rsquo;t need to be transmitted. Decoder know its type, it will set its default value automatically. # 2.3. How does gob work - value of encoded gob data is just integer The encoded gob data isnâ€™t about types like int8 and uint16. Instead, somewhat analogous to constants in Go, its integer values are abstract, sizeless numbers, either signed or unsigned. When you encode an int8, its value is transmitted as an unsized, variable-length integer. When you encode an string, its value is also transmitted as an unsized, variable-length integer.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 func main() { // Initialize the encoder and decoder. Normally enc and dec would be // bound to network connections and the encoder and decoder would // run in different processes. var network bytes.Buffer // Stand-in for a network connection enc := gob.NewEncoder(\u0026amp;network) // Will write to network. dec := gob.NewDecoder(\u0026amp;network) // Will read from network. message := \u0026#34;hello, there\u0026#34; // Encode (send) the value. _ = enc.Encode(message) fmt.Println(network.Bytes()) // Decode (receive) the value. var ms string _ = dec.Decode(\u0026amp;ms) fmt.Println(network.Bytes()) fmt.Println(ms) } ------------------------------------------ [15 12 0 12 104 101 108 108 111 44 32 116 104 101 114 101] [] hello, there As you can see, all encoded data is a variable-length integer, bytes.Buffer is just a struct, network is an object of it, network.Bytes() returns a slice holding the unread portion of the buffer so it print [] on second line,\n1 2 3 4 5 type Buffer struct { buf []byte // contents are the bytes buf[off : len(buf)] off int // read at \u0026amp;buf[off], write at \u0026amp;buf[len(buf)] lastRead readOp // last read operation, so that Unread* can work correctly. } Besides, enc.Encode(message) does two things: encode message and transmit it, similar todec.Decode(\u0026amp;ms).\n# 2.4. Values are flattened A stream of gobs is self-describing. Each data item in the stream is preceded by a specification of its type, expressed in terms of a small set of predefined types. Pointers are not transmitted, but the things they point to are transmitted; that is, the values are flattened. Nil pointers are not permitted, as they have no value. Recursive types work fine, but recursive values (data with cycles) are problematic. source\nI find a blog, which implement a function that can deep copy a map with gobs, even the map has a map inside. Golang: deepcopy map[string]interface{}. Could be used for any other Go type with minor modifications.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // Package deepcopy provides a function for deep copying map[string]interface{} // values. Inspired by the StackOverflow answer at: // http://stackoverflow.com/a/28579297/1366283 // // Uses the golang.org/pkg/encoding/gob package to do this and therefore has the // same caveats. // See: https://blog.golang.org/gobs-of-data // See: https://golang.org/pkg/encoding/gob/ package deepcopy import ( \u0026#34;bytes\u0026#34; \u0026#34;encoding/gob\u0026#34; ) func init() { gob.Register(map[string]interface{}{}) } // Map performs a deep copy of the given map m. func Map(m map[string]interface{}) (map[string]interface{}, error) { var buf bytes.Buffer enc := gob.NewEncoder(\u0026amp;buf) dec := gob.NewDecoder(\u0026amp;buf) err := enc.Encode(m) if err != nil { return nil, err } var copy map[string]interface{} err = dec.Decode(\u0026amp;copy) if err != nil { return nil, err } return copy, nil } # 2.5. Types on the wire The first time you send a given type, the gob package includes in the data stream a description of that type. In fact, what happens is that the encoder is used to encode, in the standard gob encoding format, an internal struct that describes the type and gives it a unique number. (Basic types, plus the layout of the type description structure, are predefined by the software for bootstrapping.) After the type is described, it can be referenced by its type number.\nThus when we send our first type T, the gob encoder sends a description of T and tags it with a type number, say 127. All values, including the first, are then prefixed by that number, so a stream of T values looks like:\n1 (\u0026#34;define type id\u0026#34; 127, definition of type T)(127, T value)(127, T value), ... CommonType holds elements of all types. It is a historical artifact, kept for binary compatibility and exported only for the benefit of the package\u0026rsquo;s encoding of type descriptors. It is not intended for direct use by clients.\n1 2 3 4 type CommonType struct { Name string Id typeId } # 2.6. Functions and channels Functions and channels will not be sent in a gob. Attempting to encode such a value at the top level will fail. A struct field of chan or func type is treated exactly like an unexported field and is ignored.\n# 2.7. gob.Register method Register records a type, identified by a value for that type, under its internal type name. That name will identify the concrete type of a value sent or received as an interface variable. Only types that will be transferred as implementations of interface values need to be registered. Expecting to be used only during initialization, it panics if the mapping between types and names is not a bijection.\n1 func Register(value any) If you\u0026rsquo;re dealing with concrete types (structs) only, you don\u0026rsquo;t really need it. Once you\u0026rsquo;re dealing with interfaces you must register your concrete type first.\nFor example, let\u0026rsquo;s assume we have these struct and interface (the struct implements the interface):\n1 2 3 4 5 6 7 8 9 10 11 type Getter interface { Get() string } type Foo struct { Bar string } func (f Foo) Get() string { return f.Bar } To send a Foo over gob as a Getter and decode it back, we must first call\n1 gob.Register(Foo{}) So the flow would be:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // init and register buf := bytes.NewBuffer(nil) gob.Register(Foo{}) // create a getter of Foo g := Getter(Foo{\u0026#34;wazzup\u0026#34;}) // encode enc := gob.NewEncoder(buf) enc.Encode(\u0026amp;g) // decode dec := gob.NewDecoder(buf) var gg Getter if err := dec.Decode(\u0026amp;gg); err != nil { panic(err) } Now try removing the Register and this won\u0026rsquo;t work because gob wouldn\u0026rsquo;t know how to map things back to their appropriate type.\n# 2.8. gob.Register When there is an interface, be careful, you should figure out all the possiable concrete types (implementations) of the interface would be, and if these concrete type is not primitive type, you need register for them. You don\u0026rsquo;t need to register for interface itself.\n1 2 3 4 5 6 7 8 gob.Register(map[string]int{}) expectedCopy := map[string]interface{}{ \u0026#34;id\u0026#34;: \u0026#34;0007\u0026#34;, \u0026#34;cats\u0026#34;: map[string]int{ \u0026#34;kitten\u0026#34;: 3, \u0026#34;milo\u0026#34;: 1, }, } If you don\u0026rsquo;t register for map[string]int you will get an error\n1 error: gob: type not registered for interface: map[string]int All of this because we have map[string]interface{}, there is an interface, according to gob package, Only types that will be transferred as implementations of interface values need to be registered.\nYou need to register for nothing if expectedCopy type is map[string]map[string]int (because there is no interface):\n1 2 3 4 5 6 7 8 // don\u0026#39;t need this: gob.Register(map[string]map[string]int{}) // don\u0026#39;t need this: gob.Register(map[string]int{}) expectedCopy := map[string]map[string]int{ \u0026#34;cats\u0026#34;: map[string]int{ \u0026#34;kitten\u0026#34;: 3, \u0026#34;milo\u0026#34;: 1, }, } Note that you don\u0026rsquo;t need to register for a slice of primitive type or primitive type itself when they are the implementations of an interface, because Go has done that for you:\n1 2 3 4 5 6 7 8 9 10 func registerBasics() { Register(int(0)) ... Register(float32(0)) Register(complex64(0i)) Register([]uint(nil)) ... Register([]bool(nil)) Register([]string(nil)) } Therefore, if you want encode expectedOriginal below, you need register for nothing:\n1 2 3 4 // Go has done this for use: gob.Register([]string{}) expectedOriginal: map[string]interface{}{ \u0026#34;cats\u0026#34;: []string{\u0026#34;Coco\u0026#34;, \u0026#34;Bella\u0026#34;}, }, If the implementation\u0026rsquo;s type of the interface is a custom type, you have to register for that type:\n1 2 3 4 5 6 7 8 type Cat struct { Name string } // you have to register for Cat gob.Register(Cat{}) expectedOriginal := map[string]interface{}{ \u0026#34;cats\u0026#34;: Cat{Name: \u0026#34;jack\u0026#34;}, } Similarly to we have talked above:\n1 2 3 4 5 // don\u0026#39;t need this: gob.Register(Cat{}) // there is no interface expectedOriginal := map[string]Cat { \u0026#34;cats\u0026#34;: Cat{Name: \u0026#34;jack\u0026#34;}, } And don\u0026rsquo;t forget, the first letter of the field of Cat must be Capital, namely, expored fields, otherwise, it (the field) won\u0026rsquo;t encode by gob.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 type Cat struct { Name string } func main() { m := map[interface{}][]Cat{ \u0026#34;cats\u0026#34;: []Cat{{Name: \u0026#34;jack\u0026#34;}}, } buf := new(bytes.Buffer) enc := gob.NewEncoder(buf) dec := gob.NewDecoder(buf) if err := enc.Encode(m); err != nil { fmt.Sprintf(\u0026#34;failed to copy map: %v\u0026#34;, err) } result := make(map[interface{}][]Cat) if err := dec.Decode(\u0026amp;result); err != nil { fmt.Sprintf(\u0026#34;failed to copy map: %v\u0026#34;, err) } fmt.Println(result) } # 3. encoding/json Marshal() â†’ to encode GO values to JSON in string format Unmarshal() â†’ to decode JSON data to GO values 1 2 func Marshal(v interface{}) ([]byte, error) func Unmarshal(data []byte, v interface{}) error # 3.1. json.Marshal() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 type Cat struct { // lowercase field cannot be exported // `json:\u0026#34;name\u0026#34;` makes \u0026#34;Name\u0026#34; to \u0026#34;name\u0026#34; in json string after apply json.Marshal() // check in output Name string `json:\u0026#34;name\u0026#34;` Age int IsAdult bool } func main() { data, _ := json.Marshal(Cat{ Name: \u0026#34;Kitten\u0026#34;, Age: 2, IsAdult: true, }) println(data) println(string(data)) data, _ = json.Marshal(\u0026#34;Hello\u0026#34;) println(data) println(string(data)) } ---------------------------------- [40/48]0x140000161b0 {\u0026#34;name\u0026#34;:\u0026#34;Kitten\u0026#34;,\u0026#34;Age\u0026#34;:2,\u0026#34;IsAdult\u0026#34;:true} [7/8]0x1400001c1a8 \u0026#34;Hello\u0026#34; âš ï¸Note: Channel, complex, and function values cannot be encoded in JSON. Attempting to encode such a value causes Marshal to return an UnsupportedTypeError. json package - encoding/json - Go Packages\nIn the past, if you use json.Marshal() to encode map, you need to ensure that the type of the key is strin, otherwise, it will fail, It\u0026rsquo;s not because of Go, but because of Json: Json does not support anything else than strings for keys.\nLearn more: https://stackoverflow.com/questions/24284612/failed-to-json-marshal-map-with-non-string-keys\nBut now you can use json.Marshal() to encode the map whose key\u0026rsquo;s type is int, but not float:\n1 2 3 4 5 6 7 m := make(map[float32]string) m[3] = \u0026#34;helllo\u0026#34; b, err := json.Marshal(m) if err != nil { panic(err) } // panic: json: unsupported type: map[float32]string Therefore, you may want do something like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // JSONSerializer encode the session map to JSON. type JSONSerializer struct{} // Serialize to JSON. Will err if there are unmarshalable key values func (s JSONSerializer) Serialize(ss *sessions.Session) ([]byte, error) { m := make(map[string]interface{}, len(ss.Values)) for k, v := range ss.Values { ks, ok := k.(string) if !ok { err := fmt.Errorf(\u0026#34;Non-string key value, cannot serialize session to JSON: %v\u0026#34;, k) fmt.Printf(\u0026#34;redistore.JSONSerializer.serialize() Error: %v\u0026#34;, err) return nil, err } m[ks] = v } return json.Marshal(m) } Code from: https://github.com/boj/redistore\nNow support for non string key types for maps for json Marshal/UnMarshal has been added through the use of TextMarshaler and TextUnmarshaler interfaces here. You could just implement these interfaces for your key types and then json.Marshal would work as expected. Learn more: https://stackoverflow.com/a/55879732/16317008\n# 3.2. json.Unmarshal() 1 2 3 4 5 6 7 8 9 10 11 12 13 func main() { data, _ := json.Marshal(Cat{ Name: \u0026#34;Kitten\u0026#34;, Age: 2, IsAdult: true, }) cat := Cat{} _ = json.Unmarshal(data, \u0026amp;cat) fmt.Println(cat) } ---------------------------------- {Kitten 2 true} # 3.3. json.NewDecoder() \u0026amp; json.Unmarshal() Use json.Decoder if your data is coming from an io.Reader stream, or you need to decode multiple values from a stream of data. Use json.Unmarshal if you already have the JSON data in memory. If you check the signature, you should understand:\n1 2 3 func NewDecoder(r io.Reader) *Decoder func Unmarshal(data []byte, v any) error Source: https://stackoverflow.com/a/21198571/16317008\nReferences:\nGobs of data - The Go Programming Language gob package - encoding/gob - Go Packages difference between encoding/gob and encoding/json go - What\u0026rsquo;s the purpose of gob.Register method? - Stack Overflow go - gob.Register() by type or for each variable? - Stack Overflow Learn more:\nGolang Benchmark: gob vs json gob - The Go Programming Language ","date":"2023-08-31T11:38:20Z","permalink":"https://blog.yorforger.cc/p/encoding/gob-encoding/json-in-go/","title":"encoding/gob \u0026 encoding/json in Go"},{"content":" # Tricks # remove an element from a slice 1 2 3 // remove the element at index i from a a = append(a[:i], a[i+1:]...) # handle close() 1 2 3 4 5 6 7 8 9 10 11 12 13 // credit to: https://gist.github.com/benbjohnson/9eebd201ec096ab6430e1f33411e6427 func doSomething() error { f, err := os.Create(\u0026#34;foo\u0026#34;) if err != nil { return err } // ensure that it\u0026#39;s definitely closed by the end defer f.Close() if _, err := f.Write([]byte(\u0026#34;bar\u0026#34;); err != nil { return err } return f.Close() } Why we bother to care about getting error from f.Close()? We have got error from f.Write(). Well, there are a lot to say, learn more: Don\u0026rsquo;t Defer Close() on Writable Files - Go Notes\n# Common mistakes # 1. Encoding non-exported fields struct value with gobs gobs can encode the exported fields of a struct value, if a sturct without exported field, when you try encode its value, you will get a nil.\nFunctions and channels will not be sent in a gob. Attempting to encode such a value at the top level will fail. A struct field of chan or func type is treated exactly like an unexported field and is ignored.\n# 2. Use var to declare channel Variables declared without an explicit initial value are given their zero value. Zero value for a channel is nil, read and write a nil channel will block forever. The code below is a common mistake:\n1 2 3 4 5 6 7 8 9 go func() { var expiredSessions chan []*Session // expiredSessions == nil var errSession := chan error // errSession == nil store.GetExpiredSessions(expiredSessions, errSession) select { case sessions, _ := \u0026lt;-expiredSessions: ... } }() Don\u0026rsquo;t use var to declare channel, map or slice values, use make(), keep this convension you will won\u0026rsquo;t make mistakes.\nLearn more: https://davidzhu.xyz/post/golang/basics/003-collections/#5-var-vs-make\n# 3. Using goroutines on a loop iterator variable In Go, the loop iterator variable is a single variable that takes different values in each loop iteration.\n1 2 3 4 5 6 7 8 9 10 11 func main() { var out []*int for i := 0; i \u0026lt; 3; i++ { out = append(out, \u0026amp;i) } fmt.Println(\u0026#34;Values:\u0026#34;, *out[0], *out[1], *out[2]) fmt.Println(\u0026#34;Addresses:\u0026#34;, out[0], out[1], out[2]) } Values: 3 3 3 Addresses: 0x40e020 0x40e020 0x40e020 For example, you might write something like this, using a closure:\n1 2 3 4 5 6 // this is bad for _, val := range values { go func() { fmt.Println(val) }() } Because the closures are all only bound to that one variable, there is a very good chance that when you run this code you will see the last element printed for every iteration instead of each value in sequence, because the goroutines will probably not begin executing until after the loop.\nThe proper way to write that closure loop is:\n1 2 3 4 5 for _, val := range values { go func(val interface{}) { fmt.Println(val) }(val) } Avoid mixing anonymous functions and goroutines. Concurrency Made Easy\nLearn more:\nhttps://go.dev/doc/effective_go#channels https://github.com/golang/go/wiki/CommonMistakes ","date":"2023-08-27T17:12:55Z","permalink":"https://blog.yorforger.cc/p/tricks-and-common-mistakes-go/","title":"Tricks and Common Mistakes - Go"},{"content":"Original: https://qr.ae/pyztor\nWhy is a multithreaded web server better than a single thread server? It isnâ€™t.\nThere are four basic ways how a web server can handle concurrency:\nforking an OS process per request (like old versions of Apache) spawning an OS thread per request (like a new versions of Apache) using a single-threaded event loop (like nginx) using green threads or lightweight processes scheduled by a VM runtime instead of the OS (like in Erlang) Currently the most common approaches are number 2 and 3.\nThere are pros and cons of both of them. For I/O-bound operations (a characteristic of a typical web server) you get better performance and higher number of concurrent requests when you use a single-threaded event loop. But the drawback is that you need to use exclusively asynchronous non-blocking I/O for all operations or otherwise youâ€™ll block the event loop and lose performance. For that reason itâ€™s easier to implement a multi-threaded server but you pay in performance.\nFor CPU-bound operations (less common for a usual web server, maybe more common for a computationally intensive API) itâ€™s best to have one OS thread or process per core. Itâ€™s easy to do with single-threaded event loops because you can run a cluster of a number of processes one per core. Itâ€™s hard to do with multi-threaded servers because if spawning threads is your only way to handle concurrent requests then you cannot really control how many threads you will have - as you donâ€™t control the number of requests. Once you have more threads than the number of CPU cores then you loose performance for context switches and you also use a lot of RAM.\nThat is why a single-threaded nginx server performs better than a multi-threaded Apache web server (and that is why nginx was created in the first place). Also Redis, a database known for exceptionally high performance is single-threaded.\nA real example I can give you is this: My first web server was Apache running on a Linux machine with 500MB of RAM. It forked a new process for every request (it actually had a pool so there was not much forking involved but it had to keep those processes alive to reuse them and kill them once in a while to avoid resource leakage).\nMy OS used around 100MB of RAM. Every Apache process used 20MB of RAM. It meant that my server could only handle 20 concurrent requests and there was no way around it because I had no more RAM. The processes were mostly blocked on I/O so the CPU utilization was very low, every request above those 20 had to wait and if those 20 was e.g. long running downloads then my server was completely unresponsive.\nWhen nginx web server was introduced it used a single-threaded event loop and didnâ€™t block for any request. It could handle much more concurrent requests, having no problem with the mythical c10k problem - nginx was basically created to solve the c10k problem (10,000 concurrent requests).\nImagine how much RAM is wasted for 10,000 threads if you could even spawn that many and how much time is used for context switches.\nMemory usage of multi-threaded Apache vs single-threaded nginx:\nIncidentally, this is the reason why Ryan Dahl used a non-blocking I/O and a single-threaded event loop in Node.js and he still uses the same idea in Deno, because that is the way to write high performance network servers (contrary to what you might read in other answers here).\nNote that nginx â€œcore functionalityâ€ doc mentions that on most servers nginx defaults to multiple workers (which will be ran as threads) so itâ€™s not always â€œsingle threaded.â€ from a comment of this blog\n","date":"2023-08-26T19:03:59Z","permalink":"https://blog.yorforger.cc/p/is-multithreaded-server-better-than-a-single-thread-server/","title":"Is Multithreaded Server Better than a Single Thread Server?"},{"content":" # 1. Shell expansion When the shell receives a command, either from the user typing at the keyboard, or from a shell script, it breaks it up into words. After this happens, the shell performs seven operations on the words, which can change how they are interpreted. There are seven operations are collectively known as \u0026lsquo;shell expansion\u0026rsquo;.\nThe seven operations that the shell performs are:\nBrace Expansion - expanding values between braces, such as file{1..3} into file1 file2 file3 Tilde Expansion - expanding the ~ tilde symbol for the home directory into the path to the home directory, such as ~/effective-shell into /home/dwmkerr/effective-shell Parameter Expansion - expanding terms that start with a $ symbol into parameter values, such as $HOME into the value of the variable named HOME Command Substitution - evaluation of the contents of $(command) sequences, which are used to run commands and return the results to the shell command line Arithmetic Expansion - evaluation of the contents of $((expression)) sequences, which are used to perform basic mathematical operations Word Splitting - once all of the previous operations are run, the shell splits the command up into \u0026lsquo;words\u0026rsquo;, which are the units of text that you can run loops over Pathname Expansion - the shell expands wildcards and special characters in pathnames, such as *.txt into the set of files that are matched by the sequence Brace Expansion\n1 2 3 4 5 6 7 8 9 10 11 mkdir /tmp/{one,two,three} # The line above is expanded to: mdkir /tmp/one /tmp/two /tmp/three touch file{1..5}.txt # The line above is expanded to: touch file1.txt file2.txt file3.txt file4.txt file5.txt for x in {0..10..2}; do print $x; done # The line above is expanded to: for x in 0 2 4 6 8 10; do print $x; done Parameter Expansion\n1 2 3 4 fruit=apples echo \u0026#34;I like $fruit\u0026#34; # The line above is expanded to: echo \u0026#34;I like apples\u0026#34; When using parameter expansion it is generally preferable to surround the name of the parameter with braces - this allows you to tell the shell unambiguously what the name of the parameter is. For example:\n1 2 3 echo \u0026#34;My backup folder is: ${HOME}backup\u0026#34; # The line above is expanded to: echo \u0026#34;My backup folder is: /home/dwmkerrbackup\u0026#34; You should use\u0026quot;My backup folder is: ${HOME}backup\u0026quot;, not \u0026quot;I like $fruit\u0026quot; style.\nTilde Expansion\n1 2 3 cd ~/effective-shell # The line above is expanded to: cd $HOME/effective-shell Note that if you want check what the command exactly is after expansion, check it with echo:\n1 2 3 4 5 6 $ ls one.txt two.txt three.dat $ echo rm *.txt rm one.txt two.txt # 2. Wildcard pattern # 2.1. Wildcard pattern in shell A string is a wildcard pattern if it contains one of the characters ?, *, or [, Globbing is the operation that expands a wildcard pattern into the list of pathnames matching the pattern. Matching is defined by:\nA ? (not between brackets) matches any single character. A * (not between brackets) matches any string, including the empty string. Don\u0026rsquo;t forget * may lose its special meaning in double qoutes, but it depends, at some conditions, it won\u0026rsquo;t lost its special meaning for globing wich is filepath expansion. Learn more: Shell Script Basic Syntax - David\u0026rsquo;s Blog\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Expands to: tar xvf file1.tar file2.tar file42.tar ... tar xvf *.tar # Delete all files ends with .txt under current folder rm *.txt # with double, it won\u0026#39;t be expanded $ rm \u0026#34;*.txt\u0026#34; rm: *.txt: No such file or directory # search for a string in your current directory and all other subdirectories $ grep -r â€˜helloâ€™ * a.txt:hello world sub/c.txt:hello, this is... sub/b.txt:hello, this is... # check what the command is after expansion $ echo grep -r â€˜helloâ€™ * # 2.2. Metacharacter in regular expressions In regular expression the * is a metacharacter that represents zero or more occurrences of the preceding element.\n1 2 3 4 $ printf \u0026#34;colour\\ncolor\\ncolouur\\n\u0026#34; | egrep \u0026#39;colou*r\u0026#39; colour color colouur References:\nglob(7) - Linux manual page\nUnderstanding Shell Expansion | Effective Shell\n","date":"2023-08-26T11:30:20Z","permalink":"https://blog.yorforger.cc/p/shell-expansion/","title":"Shell Expansion"},{"content":" # 1. Concurrency Safe In a program with two or more goroutines, the steps within each goroutine happen in the familiar order, but in general we donâ€™t know whether an event x in one goroutine happens before an event y in another goroutine, or happens after it, or is simultaneous with it. When we cannot confidently say that one event happens before the other, then the events x and y are concurrent.\nThat function is concurrency-safe if it continues to work correctly even when called concurrently, that is, from two or more goroutines with no additional synchronization. We can generalize this notion to a set of collaborating functions, such as the methods and operations of a particular type. A type is concurrency-safe if all its accessible methods and operations are concurrency-safe.\nConcurrency-safe types are the exception rather than the rule, so you should access a variable concurrently only if the documentation for its type says that this is safe. We avoid concurrent access to most variables either by confining them to a single goroutine or by maintaining a higher-level invariant of mutual exclusion.\nIn contrast, exported package-level functions are generally expected to be concurrency-safe. Since package-level variables cannot be confined to a single goroutine, functions that modify them must enforce mutual exclusion.\n# 2. Data Race A data race occurs whenever two goroutines access the same variable concurrently and at least one of the accesses is a write. Notice that \u0026ldquo;access the same variable concurrently\u0026rdquo; means: there are two or more goroutines (threads) to access a same variable x, and we cannot assure the order of accessing variable x.\nAussume we have these code:\n1 2 3 4 5 var balance int func Deposit(amount int) { balance = balance + amount } func Balance() int { return balance } And there are two goroutines access balance concurrently,\n1 2 3 4 5 6 7 8 // Alice: go func() { bank.Deposit(200) // A1 fmt.Println(\u0026#34;=\u0026#34;, bank.Balance()) // A2 }() // Bob: go bank.Deposit(100) // B Alice deposits $200, then checks her balance, while Bob deposits $100. Since the steps A1 and A2 occur concurrently with B, we cannot predict the order in which they happen. Intuitively, it might seem that there are only three possible orderings, which weâ€™ll call â€œAlice first,â€ â€œBob first,â€ and â€œAlice/Bob/Alice.â€ The following table shows the value of the balance variable after each step. The quoted strings represent the printed balance slips.\nIn all cases the final balance is $300. The only variation is whether Aliceâ€™s balance slip includes Bobâ€™s transaction or not, but the customers are satisfied either way.\nBut this intuition is wrong. There is a fourth possible outcome, in which Bobâ€™s deposit occurs in the middle of Aliceâ€™s deposit, after the balance has been read (balance + amount) but before it has been updated (balance = ...), causing Bobâ€™s transaction to disappear. This is because Aliceâ€™s deposit operation A1 is really a sequence of two operations, a read and a write; call them A1r and A1w. Hereâ€™s the problematic interleaving:\n1 2 3 4 5 6 7 Data race 0 A1r 0 ... = balance + amount # happend in the middle, balance = 100 but A1 will make balance = balance + amount which equals to 200 above B 100 A1w 200 balance = ... A2 \u0026#34;= 200\u0026#34; After A1r, the expression balance + amount evaluates to 200, so this is the value written during A1w, despite the intervening deposit. The final balance is only $200.\nWeâ€™ll repeat the definition, since it is so important: A data race occurs whenever two goroutines access the same variable concurrently and at least one of the accesses is a write. It follows from this definition that there are three ways to avoid a data race:\nfirst way: not to write the variable try to use read only variable second way: avoid accessing the variable from multiple goroutines (confined to a single goroutine) access the variable need to write in only one goroutine which called monitor goroutine other goroutine want to modify this variable can notify the monitor goroutine of that variable Since other goroutines cannot access the variable directly, they must use a channel to send the confining goroutine a request to query or update the variable. This is what is meant by the Go mantra â€œDo not communicate by sharing memory; instead, share memory by communicating.â€ Hereâ€™s the bank example rewritten with the balance variable confined to a monitor goroutine called teller:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // Package bank provides a concurrency-safe bank with one account. package bank var deposits = make(chan int) // send amount to deposit var balances = make(chan int) // receive balance func Deposit(amount int) { deposits \u0026lt;- amount } func Balance() int { return \u0026lt;-balances } func teller() { var balance int // balance is confined to teller goroutine for { select { case amount := \u0026lt;-deposits: balance += amount case balances \u0026lt;- balance: } } } func init() { go teller() // start the monitor goroutine } You can see, when there are some variables in a package, we better tell user if it is concurrency-safe.\nThe third way to avoid a data race is to allow many goroutines to access the variable, but only one at a time. This approach is known as mutual exclusion.\n# 3. Mutual Exclusion # 3.1. Mutex vs Semaphore A semaphore is a non-negative integer variable that is shared between various threads. Mutex is a specific kind of binary semaphore that is used to provide a locking mechanism.\n1 2 3 P(mutex); execute CS; V(mutex); Mutex Semaphore A mutex is an object. A semaphore is an integer. Mutex works upon the locking mechanism. Semaphore uses signaling mechanism Operations on mutex:LockUnlock Operation on semaphore:WaitSignal Mutex doesnâ€™t have any subtypes. Semaphore is of two types:Counting SemaphoreBinary Semaphore A mutex can only be modified by the process that is requesting or releasing a resource. Semaphore work with two atomic operations (Wait, signal) which can modify it. If the mutex is locked then the process needs to wait in the process queue, and mutex can only be accessed once the lock is released. If the process needs a resource, and no resource is free. So, the process needs to perform a wait operation until the semaphore value is greater than zero. # 3.2. Mutual Exclusion: sync.Mutex In Section 8.6, we used a buffered channel as a counting semaphore to ensure that no more than 20 goroutines made simultaneous HTTP requests. With the same idea, we can use a channel of capacity 1 to ensure that at most one goroutine accesses a shared variable at a time. A semaphore that counts only to 1 is called a binary semaphore.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 var ( sema = make(chan struct{}, 1) // a binary semaphore guarding balance balance int ) func Deposit(amount int) { sema \u0026lt;- struct{}{} // acquire token balance = balance + amount \u0026lt;-sema // release token } func Balance() int { sema \u0026lt;- struct{}{} // acquire token b := balance \u0026lt;-sema // release token return b } This pattern of mutual exclusion is so useful that it is supported directly by the Mutex type from the sync package. Its Lock method acquires the token (called a lock) and its Unlock method releases it:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import \u0026#34;sync\u0026#34; var ( mu sync.Mutex // guards balance balance int ) func Deposit(amount int) { mu.Lock() balance = balance + amount mu.Unlock() } func Balance() int { mu.Lock() b := balance mu.Unlock() return b } # 3.3. Read/Write Mutexes: sync.RWMutex Since the Balance function only needs to read the state of the variable, it would in fact be safe for multiple Balance calls to run concurrently, so long as no Deposit or Withdraw call is running. In this scenario we need a special kind of lock that allows read-only operations to proceed in parallel with each other, but write operations to have fully exclusive access. This lock is called a multiple readers, single writer lock, and in Go itâ€™s provided by sync.RWMutex:\n1 2 3 4 5 6 7 8 var mu sync.RWMutex var balance int func Balance() int { mu.RLock() // readers lock defer mu.RUnlock() return balance } # 4. Memory Synchronization You may wonder why the Balance method needs mutual exclusion, either channel-based or mutex-based. After all, unlike Deposit, it consists only of a single operation, so there is no danger of another goroutine executing â€œin the middleâ€ of it.\nThe reason is that synchronization is about more than just the order of execution of multiple goroutines; synchronization also affects memory.\nIn a modern computer there may be dozens of processors, each with its own local cache of the main memory. For efficiency, writes to memory are buffered within each processor and flushed out to main memory only when necessary. Synchronization primitives like channel communications and mutex operations cause the processor to flush out and commit all its accumulated writes so that the effects of goroutine execution up to that point are guaranteed to be visible to goroutines running on other processors.\nConsider the possible outputs of the following snippet of code:\n1 2 3 4 5 6 7 8 9 var x, y int go func() { x = 1 // A1 fmt.Print(\u0026#34;y:\u0026#34;, y, \u0026#34; \u0026#34;) // A2 }() go func() { y = 1 // B1 fmt.Print(\u0026#34;x:\u0026#34;, x, \u0026#34; \u0026#34;) // B2 }() Since these two goroutines are concurrent and access shared variables without mutual exclusion, there is a data race, so we should not be surprised that the program is not deterministic.\n1 2 3 4 y:0 x:1 x:0 y:1 x:1 y:1 y:1 x:1 The fourth line could be explained by the sequence A1,B1,A2,B2 or by B1,A1,A2,B2, for example. However, these two outcomes might come as a surprise:\n1 2 x:0 y:0 y:0 x:0 but depending on the compiler, CPU, and many other factors, they can happen too. What possible interleaving of the four statements could explain them?\nWithin a single goroutine, the effects of each statement are guaranteed to occur in the order of execution; goroutines are sequentially consistent. But in the absence of explicit synchronization using a channel or mutex, there is no guarantee that events are seen in the same order by all goroutines. Although goroutine A must observe the effect of the write x = 1 before it reads the value of y, it does not necessarily observe the write to y done by goroutine B, so A may print a stale value of y.\nIt is tempting to try to understand concurrency as if it corresponds to some interleaving of the statements of each goroutine, but as the example above shows, this is not how a modern compiler or CPU works. Because the assignment and the Print refer to different variables, a compiler may conclude that the order of the two statements cannot affect the result, and swap them. If the two goroutines execute on different CPUs, each with its own cache, writes by one goroutine are not visible to the other goroutineâ€™s Print until the caches are synchronized with main memory.\nAll these concurrency problems can be avoided by the consistent use of simple, established patterns. Where possible, confine variables to a single goroutine; for all other variables, use mutual exclusion.\n# 5. Race Conditions vs Data Race A race condition is a flaw that occurs when the timing or ordering of events affects a programâ€™s correctness. Generally speaking, some kind of external timing or ordering non-determinism is needed to produce a race condition; typical examples are context switches, OS signals, memory operations on a multiprocessor, and hardware interrupts.\nA data race occurs whenever two goroutines access the same variable concurrently and at least one of the accesses is a write.\nRace conditions are pernicious because they may remain latent in a program and appear infrequently, perhaps only under heavy load or when using certain compilers, platforms, or architectures. This makes them hard to reproduce and diagnose.\n1 2 3 4 5 6 transfer1 (amount, account_from, account_to) { if (account_from.balance \u0026lt; amount) return NOPE; account_to.balance += amount; account_from.balance -= amount; return YEP; } Of course this is not how banks really move money, but the example is useful anyway because we understand intuitively that account balances should be non-negative and that a transfer must not create or lose money. When called from multiple threads without external synchronization, this function admits both data races (multiple threads can concurrently try to update an account balance) and race conditions (in a parallel context it will create or lose money). We can try to fix it like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 transfer2 (amount, account_from, account_to) { atomic { bal = account_from.balance; } if (bal \u0026lt; amount) return NOPE; atomic { account_to.balance += amount; } atomic { account_from.balance -= amount; } return YEP; } Here â€œatomicâ€ is implemented by the language runtime, perhaps simply by acquiring a thread mutex at the start of the atomic block and releasing it at the end, perhaps using some sort of transaction, or perhaps by disabling interrupts â€” for purposes of the example it doesnâ€™t matter as long as the code inside the block executes atomically.\ntransfer2 has no data races when called by multiple threads, but obviously it is an extremely silly function containing race conditions that will cause it to create or lose money almost as badly as the unsynchronized function. From a technical point of view, the problem with transfer2 is that it permits other threads to see memory states where a key invariant â€” conservation of money â€” is broken.\nTo preserve the invariant, we have to use a better locking strategy. As long as atomicâ€™s semanatics are to end the atomic section on any exit from the block, the solution can be blunt:\n1 2 3 4 5 6 7 8 transfer3 (amount, account_from, account_to) { atomic { if (account_from.balance \u0026lt; amount) return NOPE; account_to.balance += amount; account_from.balance -= amount; return YEP; } } This function is free of data races and also of race conditions.\nEverything in this post is pretty obvious, but Iâ€™ve observed real confusion about the distinction between data race and race condition by people who should know better (for example because they are doing research on concurrency correctness). Muddying the waters further, even when people are perfectly clear on the underlying concepts, they sometimes say â€œrace conditionâ€ when the really mean â€œdata race.â€ Certainly Iâ€™ve caught myself doing this.\n# 6. Conclusion concurrent envolves two or more threads, and it\u0026rsquo;s all about the unpredictable order of the execution.\nconcurrency-safe type if that all its accessible methods and operations are concurrency-safe.\nA data race occurs whenever two goroutines access the same variable concurrently and at least one of the accesses is a write.\ndata race can cause data lost, the bank example when there is data race, you\u0026rsquo;d better use Mutual Exclusion: sync.RWMutex, sync.Mutex Mutex vs Semaphore\nA race condition is a flaw that occurs when the timing or ordering of events affects a programâ€™s correctness.\nReferences:\n9.1 Race Conditions | The Go Programming Language Mutex vs Semaphore - GeeksforGeeks Race Condition vs. Data Race â€“ Embedded in Academia ","date":"2023-08-24T19:16:59Z","permalink":"https://blog.yorforger.cc/p/concurrency-with-shared-variables/","title":"Concurrency with Shared Variables"},{"content":" # 1. Two Styles of Concurrent Programming Go enables two styles of concurrent programming.\ncommunicating sequential processes or CSP goroutines and channels shared memory multithreading traditional model multiple threads # 2. Goroutines vs OS Threads Creation and Destruction Creating and destroying OS threads requires interacting with the operating system, involving system calls. Go routines managed by Go scheduler, in user space, no system calls. Context Switching needs a full context switch in os thread Level of Operation User Space Level vs Kernel Space Level Goroutines are multiplexed onto a smaller number of OS threads. Stack Size growable stack vs fixed-size stack # 2.1. Growable Stacks Each OS thread has a fixed-size block of memory (often as large as 2MB) for its stack. This fixed-size stack is simultaneously too much and too little. Yet despite their size, fixed-size stacks are not always big enough for the most complex and deeply recursive of functions. Changing the fixed size can improve space efficiency and allow more threads to be created, or it can enable more deeply recursive functions, but it cannot do both.\nIn contrast, a goroutine starts life with a small stack, typically 2KB. A goroutineâ€™s stack, like the stack of an OS thread, holds the local variables of active and suspended function calls, but unlike an OS thread, a goroutineâ€™s stack is not fixed; it grows and shrinks as needed. The size limit for a goroutine stack may be as much as 1GB.\n# 2.2. Goroutine Scheduling OS threads are scheduled by the OS kernel. Every few milliseconds, a hardware timer interrupts the processor, which causes a kernel function called the scheduler to be invoked. This function suspends the currently executing thread and saves its registers in memory, looks over the list of threads and decides which one should run next, restores that threadâ€™s registers from memory, then resumes the execution of that thread. Because OS threads are scheduled by the kernel, passing control from one thread to another requires a full context switch, that is, saving the state of one user thread to memory, restoring the state of another, and updating the schedulerâ€™s data structures. This operation is slow, due to its poor locality and the number of memory accesses required\nThe Go runtime contains its own scheduler that uses a technique known as m:n scheduling, because it multiplexes (or schedules) m goroutines on n OS threads. The job of the Go scheduler is analogous to that of the kernel scheduler, but it is concerned only with the goroutines of a single Go program.\nUnlike the operating systemâ€™s thread scheduler, the Go scheduler is not invoked periodically by a hardware timer, but implicitly by certain Go language constructs. For example, when a goroutine calls time.Sleep or blocks in a channel or mutex operation, the scheduler puts it to sleep and runs another goroutine until it is time to wake the first one up. Because it doesnâ€™t need a switch to kernel context, rescheduling a goroutine is much cheaper than rescheduling a thread.\n# 3. Goroutine Model go-routines are user-space threads not kernel threads, kernel threads created and managed by OS (sleep, wait, running), OS doesn\u0026rsquo;t know user-space threads exist, Go shcduler multiplexes (or schedules) m goroutines on n OS threads, which is known as m:n scheduling.\nLearn how goroutine works:\n{% youtube YHRO5WQGh0k %}\n# 3.1. Physical Thread vs Kernel Thread A \u0026ldquo;hardware thread\u0026rdquo; is just a confusing name for a logical core, aka execution context. It has nothing to do with software threads or kernel threads. One physical core may support more than 1 logical core, e.g. via hyperthreading or other SMT.\nA hardware thread is a set of registers that are able to hold the context of a software thread. Having two \u0026ldquo;hardware threads\u0026rdquo; enables a single CPU to concurrently execute the instructions of two software threads without help from the OS. P.S.: If a software thread is like an automobile, then a hardware thread is like a lane on a highway in which the automobile can drive. OK, that\u0026rsquo;s kind of a weak anaology, but what I\u0026rsquo;m trying to say is that a \u0026ldquo;hardware thread\u0026rdquo; and a thread in your program don\u0026rsquo;t have much more in common with each other than the lane on the highway has in common with your car.\n\u0026ndash;multithreading - Kernel threads VS CPU threads - Stack Overflow\nLearn more Hyper-Threading \u0026amp; Physical Threads æ— è®ºè¯­è¨€å±‚é¢ä½•ç§å¹¶å‘æ¨¡å‹, åˆ°äº†æ“ä½œç³»ç»Ÿä¸€å®šæ˜¯è¿è¡Œåœ¨ kernel thread ä¸Šçš„, ä¸Šé¢æˆ‘ä»¬è¯´åˆ°Goçš„åšæ³•æ˜¯æŠŠå¤šä¸ª user-space threads æ˜ å°„åˆ°ä¸€ä¸ª kernel thread, ä»¥å‡å°‘kernel threadåˆ‡æ¢æ—¶å¸¦æ¥çš„æ¶ˆè€—, é‚£å…¶ä»–è¯­è¨€æ€ä¹ˆåšçš„å‘¢? åœ¨C++é‡Œ, æ˜¯é€šè¿‡syscallç›´æ¥è°ƒç”¨OSçš„kernel thread, çº¿ç¨‹æ‰€æœ‰çš„è¡Œä¸ºå¦‚åˆ›å»º, ç»ˆæ­¢, åˆ‡æ¢ç­‰æ“ä½œéƒ½ç”±å†…æ ¸æ¥å®Œæˆ, ä¸€ä¸ªç”¨æˆ·æ€çš„çº¿ç¨‹å¯¹åº”ä¸€ä¸ªç³»ç»Ÿçº¿ç¨‹, è¿™æ—¶å€™C++åœ¨é¢‘ç¹åˆ›å»ºåˆ é™¤threadçš„æ—¶å€™å°±è¦è€ƒè™‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€äº†, å› ä¸ºæ“ä½œçš„ç›´æ¥æ˜¯kernel thread, æ¯”å¦‚æ¥ä¸€ä¸ªtcpè¿æ¥å°±åˆ›å»ºä¸€ä¸ªthread, å¼€é”€å¤ªå¤§äº†, æ‰€ä»¥è¿™æ—¶å€™å°±å‡ºç°äº†çº¿ç¨‹æ± , è¯´åˆ°åº•æˆ‘ä»¬å°±æ˜¯æƒ³è¦å‡å°‘kernel threadåˆ›å»ºåˆ‡æ¢çš„æ¬¡æ•°, ä»¥å‡å°‘å¼€é”€, ä½ çœ‹æ— è®ºC++è¿˜æ˜¯Goéƒ½æœ‰è‡ªå·±çš„è§£å†³åŠæ³•, å‰è€…æ˜¯é€šè¿‡thread poolæ¥å¯¹kernel threadé‡å¤åˆ©ç”¨, è€Œåè€…å› ä¸ºé€šè¿‡map å¤šä¸ªgoroutineåˆ°è¾ƒå°‘ä¸ªkernel thread, å®ç°å¯¹kernel threadçš„é‡å¤åˆ©ç”¨, å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°, å‡å°‘å¼€é”€,\n# 4. Frequently Asked Questions (FAQ) # 4.1. why goroutines instead of threads? Goroutines are part of making concurrency easy to use. The idea, which has been around for a while, is to multiplex independently executing functionsâ€”coroutinesâ€”onto a set of threads. When a coroutine blocks, such as by calling a blocking system call, the run-time automatically moves other coroutines on the same operating system thread to a different, runnable thread so they won\u0026rsquo;t be blocked. The programmer sees none of this, which is the point. The result, which we call goroutines, can be very cheap: they have little overhead beyond the memory for the stack, which is just a few kilobytes.\nTo make the stacks small, Go\u0026rsquo;s run-time uses resizable, bounded stacks. A newly minted goroutine is given a few kilobytes, which is almost always enough. When it isn\u0026rsquo;t, the run-time grows (and shrinks) the memory for storing the stack automatically, allowing many goroutines to live in a modest amount of memory. The CPU overhead averages about three cheap instructions per function call. It is practical to create hundreds of thousands of goroutines in the same address space. If goroutines were just threads, system resources would run out at a much smaller number.\n# 4.2. why is there no goroutine ID? Goroutines do not have names; they are just anonymous workers. They expose no unique identifier, name, or data structure to the programmer. Some people are surprised by this, expecting the go statement to return some item that can be used to access and control the goroutine later.\nThe fundamental reason goroutines are anonymous is so that the full Go language is available when programming concurrent code. By contrast, the usage patterns that develop when threads and goroutines are named can restrict what a library using them can do.\nHere is an illustration of the difficulties. Once one names a goroutine and constructs a model around it, it becomes special, and one is tempted to associate all computation with that goroutine, ignoring the possibility of using multiple, possibly shared goroutines for the processing. If the net/http package associated per-request state with a goroutine, clients would be unable to use more goroutines when serving a request.\nMoreover, experience with libraries such as those for graphics systems that require all processing to occur on the \u0026ldquo;main thread\u0026rdquo; has shown how awkward and limiting the approach can be when deployed in a concurrent language. The very existence of a special thread or goroutine forces the programmer to distort the program to avoid crashes and other problems caused by inadvertently operating on the wrong thread.\nFor those cases where a particular goroutine is truly special, the language provides features such as channels that can be used in flexible ways to interact with it.\n# 5. Conclusion OS thread has a fixed-size block of memory (as large as 2MB) for its stack. A goroutine starts life with a small stack, typically 2KB but goroutineâ€™s stack is not fixed. Thread stack holds the local variables of active and suspended function calls. OS threads are scheduled by the OS kernel, Go runtime contains its own scheduler that uses a technique known as m:n scheduling, goroutine is much cheaper than rescheduling a thread. A great bolg: Share memory by communicating Â· The Ethically-Trained Programmer\nå‚è€ƒ:\n9.8 Goroutines and Threads | The Go Programming Language Frequently Asked Questions (FAQ) - The Go Programming Language GopherCon 2018: Kavya Joshi - The Scheduler Saga multithreading - Kernel threads VS CPU threads - Stack Overflow ä¹¦ç±ã€ŠGoå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ Effective Go - The Go Programming Language https://zhuanlan.zhihu.com/p/60613088 ","date":"2023-08-24T14:58:18Z","permalink":"https://blog.yorforger.cc/p/goroutines-model/","title":"Goroutines Model"},{"content":" # 1. Goroutines When a program starts, its only goroutine is the one that calls the main function, so we call it the main goroutine. The go statement itself completes immediately:\n1 2 f() // call f(); wait for it to return go f() // create a new goroutine that calls f(); don\u0026#39;t wait The code below will just print helllo, this because when main function returns, all goroutines are abruptly terminated and the program exits.\n1 2 3 4 5 6 7 func main() { go func() { time.Sleep(time.Millisecond * 100) fmt.Println(\u0026#34;hello form another goroutine\u0026#34;) }() fmt.Println(\u0026#34;hello\u0026#34;) } Other than (é™¤äº†) by returning from main or exiting the program, there is no programmatic way for one goroutine to stop another, but there are ways to communicate with a goroutine to request that it stop itself.\n# 2. Channels A Go channel is a means of communication that enables data sharing between goroutines. Each channel has a type associated with it.\n1 2 data := \u0026lt;- ch // read from a channel ch ch \u0026lt;- data // write to a channel ch # 2.1. Unbuffered channel This creates an unbuffered channel of type int. An unbuffered channel is one that can only hold one value at a time.\n1 ch := make(chan int) Sends and receives on an unbuffered channel will block until the corresponding operation is ready to proceed. Run this will cause a dealock error,\n1 2 3 4 5 6 7 8 9 10 func main() { ch := make(chan int) // This send operation will block until there is a receive operation // ready to proceed. ch \u0026lt;- 42 // This receive operation will block until there is a send operation // ready to proceed. val := \u0026lt;-ch fmt.Println(val) } With the nature of unbuffered channel, we can do something like this:\n1 2 3 4 5 6 7 8 9 10 func main() { ch := make(chan bool) go func() { // Do some work ch \u0026lt;- true }() // Wait for the goroutine to finish on another goroutine, // main() function for example \u0026lt;-ch } # 2.2. Buffered channel You can also specify the buffer size of a channel when creating it. A buffered channel allows for multiple values to be stored in the channel at once before they shall be read.\n1 ch := make(chan int, 3) # 2.3. Buffered channel vs unbuffered channel ch := make(chan int, 1) is totally different from ch := make(chan int), the code below won\u0026rsquo;t get deadlock error:\n1 2 3 4 5 6 7 func main() { ch := make(chan int, 1) ch \u0026lt;- 42 // if you put another \u0026#34;ch \u0026lt;- 42\u0026#34; below, there will be a deadlock error val := \u0026lt;-ch fmt.Println(val) } # 2.4. Read \u0026amp; send on closed channel # 2.4.1 Read on a closed channel A closed channel returns the default value of that type:\n1 2 3 4 5 6 7 8 9 10 11 12 func main() { c := make(chan bool, 1) c \u0026lt;- true fmt.Println(\u0026lt;-c) close(c) fmt.Println(\u0026lt;-c) fmt.Println(\u0026lt;-c) } ------------------------------ true false false We can also check whether a channel is open or closed with the help of the given syntax:\n1 ele, ok:= \u0026lt;- channel_name If the value of ok is true, this indicates that the channel is open and read operations can be done.\n# 2.4.2 Send and close a closed channel Send or close a closed channel will cause panic.\n1 2 3 4 5 ch = make(chan bool) ch \u0026lt;- true close(ch) // this will get a panic ch \u0026lt;- true Don\u0026rsquo;t close a channel from the receiver side and don\u0026rsquo;t close a channel if the channel has multiple concurrent senders. -\u0026gt; Don\u0026rsquo;t close (or send values to) closed channels. Close channel elegently: https://qcrao91.gitbook.io/go/channel/ru-he-you-ya-di-guan-bi-channel\n# 2.5. Read \u0026amp; send on a nil channel An attempt to send/read value on a nil channel will block that goroutine forerver.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func main() { s := make(chan bool, 1) s\u0026lt;- true \u0026lt;-s go func() { s = nil s\u0026lt;- true fmt.Println(\u0026#34;hello from goroutine 2\u0026#34;) }() fmt.Println(\u0026#34;hello from goroutine 1\u0026#34;) time.Sleep(time.Second * 3) fmt.Println(\u0026#34;hi from goroutine 1 after seconds\u0026#34;) } --------------------------------------- hello from goroutine 1 hi from goroutine 1 after seconds If you don\u0026rsquo;t know whether a channel is closed or not and blindly write to it, then you have a badly designed program. Redesign it so that there is no way to write into it after it is closed. A comment from Stack Overflow\nHow to know if a channel is closed only by sending value to it? Answer: You can\u0026rsquo;t.\nlearn more: https://stackoverflow.com/a/61101887/16317008\n# 3. Should a channel has to be closed It\u0026rsquo;s OK to leave a Go channel open forever and never close it. When the channel is no longer used, it will be garbage collected.\nNote that it is only necessary to close a channel if the receiver is looking for a close. Closing the channel is a control signal on the channel indicating that no more data follows.\nDesign Question: Channel Closing\nSource: https://stackoverflow.com/a/8593986/16317008\n# 4. Use cases of channels # 4.1. Synchronization between goroutines Traditional threading models require the programmer to communicate between threads using shared memory. Typically, shared data structures are protected by locks, and threads will contend over those locks to access the data. Instead of explicitly using locks to mediate access to shared data, Go encourages the use of channels to pass references to data between goroutines.\nChannels can be used to ensure that one goroutine doesn\u0026rsquo;t proceed until another goroutine has completed its work. This is particularly useful in scenarios where data needs to be shared between two or more goroutines, and it\u0026rsquo;s important to ensure that the data isn\u0026rsquo;t modified by multiple goroutines at the same time.\nNOTE: Channels can be used to ensure one goroutine doesn\u0026rsquo;t proceed until another goroutine has completed its work. Doesn\u0026rsquo;t mean channels ensure that itself. You need to implement this by utilizing channel. This is the channel use case for notification.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // main goroutine won\u0026#39;t exit until the worker goroutine has completed its work. // this is channel\u0026#39;s use case for notification // you can use this to ensue that data isn\u0026#39;t modified by multiple goroutines at a same time. func main() { done := make(chan struct{}) go func() { fmt.Println(\u0026#34;working...\u0026#34;) time.Sleep(time.Second) fmt.Println(\u0026#34;done\u0026#34;) done\u0026lt;- struct{}{} }() \u0026lt;-done } Actually, in essence, synchronization between goroutines implemented by channel is just a channel\u0026rsquo;s use case for notification.\nThe code above only can limit one groutine access the data at a time, if you want to prevent concurrent modifications to a variable while retaining the ability to read, which means enables more than one groutine to access the data, you\u0026rsquo;d typically embed a sync.RWMutex. This is no exemption.\nWhen you pass a data let\u0026rsquo;s say cat to an unbuffered channel in a goroutine g1, this operation let\u0026rsquo;s say ch \u0026lt;- cat will block until another goroutine let\u0026rsquo;s sayg2 takes cat out from the channel. After the g2 got data, this is done, ch \u0026lt;- cat won\u0026rsquo;t block. Then g2 can do anything to your cat and g1 can also access cat, which means you have to consider data race even you send your data with channel. For example. when you pass a cat to a channel, what if cat has a slice or a pointer in its field? Whenver use channel pass value, you should remember that everything passed by value in go, and the direct value not the underlying value. You pass a pointer to a channel, there is a copy for an address, not the underlying value that pinter point to.\nBut there is an exception, you pass a simple value to channel not struct value, not slice, not a map or pointer value, just a int, string value because these simple value has no underlying values, and everything passed by value, when a int passed to a channel, there is a copy for that int value, therefore you don\u0026rsquo;t need to consider data race.\nFor large objects like arrays or large structs, passing a pointer is usually the logical thing to do to avoid expensive copies. But you should consider and promise that when one gouroutine write the data, there is no other goroutine access that data. You can use sync.RWMutex, you can add another for notification after the writing operation is done by using the blocking nature of a channel.\nLearn more: go - does passing pointer through channel break the csp design?\n# 4.2. Use channels for notifications Notifications can be viewed as special requests/responses in which the responded values are not important. Generally, we use the blank struct type struct{} as the element types of the notification channels, for the size of type struct{} is zero, hence values of struct{} doesn\u0026rsquo;t consume memory.\n# 4.3. Use Channels as counting semaphores This is the buffered channel\u0026rsquo;s use case, this blog gives an excellent example: Share memory by communicating Â· The Ethically-Trained Programmer\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 // Share memory by communicating // https://blog.carlmjohnson.net/post/share-memory-by-communicating/ package semaphores type Semaphore struct { acquire chan bool release chan struct{} stop chan chan struct{} } func New(n int) *Semaphore { s := Semaphore{ acquire: make(chan bool), release: make(chan struct{}), stop: make(chan chan struct{}), } go s.start(n) return \u0026amp;s } func (s *Semaphore) start(max int) { count := 0 for { var acquire = s.acquire // nil always blocks sends and read operation if count \u0026gt;= max { acquire = nil } select { case acquire \u0026lt;- true: count++ case s.release \u0026lt;- struct{}{}: count-- case wait := \u0026lt;-s.stop: close(s.acquire) // Drain remaining calls to Release for count \u0026gt; 0 { s.release \u0026lt;- struct{}{} count-- } close(wait) return } } } // Acquire a closed channel returns its default value as many times as it is called. // if s.acquire is closed, the Acquire() get called in other goroutine will return false immediately // if s.acquire is not closed, and no data written into it, Acquire() will block func (s *Semaphore) Acquire() bool { return \u0026lt;-s.acquire } func (s *Semaphore) Release() { \u0026lt;-s.release } func (s *Semaphore) Stop() { blocker := make(chan struct{}) s.stop \u0026lt;- blocker \u0026lt;-blocker } References:\nShare Memory By Communicating - The Go Programming Language Understanding Go Channels: An Overview for Beginners Closing the Channel in Golang - Scaler Topics Share memory by communicating Â· The Ethically-Trained Programmer Learn more: Channel Use Cases -Go 101\n","date":"2023-08-24T10:06:10Z","permalink":"https://blog.yorforger.cc/p/goroutine-channel-go-basics/","title":"Goroutine \u0026 Channel - Go Basics"},{"content":" # é—®é¢˜æè¿° å†™å®Œåšå®¢æŠŠå†…å®¹ push åˆ°äº† GitHub, å‘ç°æœ‰ä¸ªæ–‡ä»¶ a.txt ä¸åº”è¯¥è¢«è¿½è¸ª, a.txt å·²ç»è¢«è¿½è¸ªäº†,\n# åŸå› åˆ†æ é¦–å…ˆä½ å¯èƒ½ä¼šæƒ³åˆ° ç›´æ¥åœ¨æœ¬åœ°åˆ é™¤ a.txt commit, ç„¶å push å°±è¡Œäº†, å¯æ˜¯å³ä½¿è¿™æ · GitHubä¾ç„¶ä¼šæœ‰ a.txt , å†µä¸” a.txt ä¸èƒ½åˆ é™¤, å°±æ˜¯ç•™åœ¨æœ¬åœ°æœ‰ç”¨ä½†æ˜¯å› ä¸ºéšç§ä¸æƒ³æ”¾åˆ°GitHub, è€Œä¸”è¿™ä¹ˆåšå²‚ä¸æ˜¯å¤ªç²—é²äº†,\n# è§£å†³åŠæ³• è§£å†³æ–¹æ³•ä¸å”¯ä¸€, è¿™é‡Œä»‹ç»ä¸¤ä¸ª,\nå…¶ä¸­ä¸€ä¸ªå¯è¡Œçš„æ˜¯åœ¨ GitHub æ‰‹åŠ¨åˆ é™¤ a.txt , ç„¶ååœ¨æœ¬åœ°è¿›è¡Œ fetch, å†merge, ummm, è²Œä¼¼æ¯”å‰é¢è¿˜ç²—é²,\næ¯”è¾ƒä¼˜é›…çš„åšæ³•æ˜¯åœ¨æœ¬åœ°ä»“åº“ä½¿ç”¨ git rm --cached \u0026lt;filename\u0026gt; è®© a.txt ä» tracked -\u0026gt; untracked,\nç„¶åæŠŠ a.txt åŠ å…¥åˆ° .gitignore, å†è¿›è¡Œ commit å’Œ push, æ­¤æ—¶ github ä¸Šçš„ a.txt ä¼šæ¶ˆå¤±\n","date":"2023-08-20T07:40:57Z","permalink":"https://blog.yorforger.cc/p/pushed-a-wrong-file-to-github-solved/","title":"Pushed a Wrong File to Github - Solved"},{"content":" # 1. Introduction Source Code: gptbot\n# 2. Database - gorm Don\u0026rsquo;t Open db connection for each request, initialize a global DB and use it for all requests.\nClose is one of the most misused methods, most application don\u0026rsquo;t need it, be sure you really need it.\nit is not necessary to close when crash, and you can still Close DB connection in V2.\njinzhu - creator of gorm\n1 2 3 4 5 6 func main() { db, _ := gorm.Open(sqlite.Open(\u0026#34;gpt_bot.db\u0026#34;), \u0026amp;gorm.Config{}) store, _ := redistore.NewRediStore(10, \u0026#34;tcp\u0026#34;, \u0026#34;:6379\u0026#34;, \u0026#34;\u0026#34;, []byte(os.Getenv(\u0026#34;SESSION_KEY\u0026#34;))) ... http.Handle(\u0026#34;/login\u0026#34;, LoginHandler(db, store)) } As you can see, we use a global database connection here accross all handler, and it\u0026rsquo;s worth noticing that every HTTP request that comes in to the server gets its own goroutine. Therefore, you have to consider data race in the handers.\nBecause we share the db across all handlers, we have to consider that if db is thread-safe. I find some answers on stack overflow which explains well:\nDoes gorm.Open() create a new connection pool every time it\u0026rsquo;s called?\nyes, try to reuse the returned DB object.\ngorm.Open does the following: (more or less):\nlookup the driver for the given dialect call sql.Open to return a DB object call DB.Ping() to force it to talk to the database This means that the recommendations for sql.Open apply to gorm.Open:\nThe returned DB is safe for concurrent use by multiple goroutines and maintains its own pool of idle connections. Thus, the Open function should be called just once. It is rarely necessary to close a DB.\nAlso note that the connection pool can be configured as such, in both GORM v1 and v2:\n1 2 3 4 5 6 7 8 // SetMaxIdleConns sets the maximum number of connections in the idle connection pool. db.DB().SetMaxIdleConns(10) // SetMaxOpenConns sets the maximum number of open connections to the database. db.DB().SetMaxOpenConns(100) // SetConnMaxLifetime sets the maximum amount of time a connection may be reused. db.DB().SetConnMaxLifetime(time.Hour) // d, err := db.DB() // d.SetMaxIdleConns(10) # 3. Session - gorilla/session # 3.1. encode before save When try to save data in session, we usually use the Values field of session, for example,\n1 session.Values[\u0026#34;username\u0026#34;] = \u0026#34;Jack\u0026#34; The first problem I came across is that, you can save int, bool, string and other basic value into session.Values[] directly, but when you try to assign other type value, custom object, array to session.Values[\u0026quot;xxx\u0026quot;] for example, you have to encode the value before assignment, so that gorilla/session can save data to Redis and read correctly for later request . Otherwise, you cannot get the value corrctly, I mean, after you restart your server, you cannot get the session stored in the Redis, the IsNew will be always true, this is because the encoing issues,\nI want to save a slice into session, which is chat history, so I have to encode it before assign it to session.Values[\u0026quot;messages\u0026quot;], I\u0026rsquo;ll choose encoding/json here, you can choose other encoding tech, encoding/gob for example,\n1 2 3 // chatHistory == []openai.ChatCompletionMessage data, _ := json.Marshal(chatHistory) session.Values[\u0026#34;messages\u0026#34;] = data Bacause json.Marshal(chatHistory) encodes the object I passed in and return as a []byte, so the type of the variable data above is []byte, so I set session.Values[\u0026quot;messages\u0026quot;] as a emtpy byte slice at begining, when login,\n1 2 3 4 5 6 func initSession(session *sessions.Session) error { session.Options.MaxAge = 20 session.Values[\u0026#34;authenticated\u0026#34;] = true session.Values[\u0026#34;messages\u0026#34;] = []byte{} return nil } When you want get message that stored in session, you just need to get the encoded value which is []byte, and pass it to json.Unmarshal(), this function will convert the encoded value back to golang object,\ngo - gorilla/sessions persistent between server restarts? - Stack Overflow\n# 3.2. reset MaxAge whenever call session.Save I don\u0026rsquo;t know if I did it wrong, or it\u0026rsquo;s a bug in gorilla/sessions, for example, I set the MaxAge of the session to 60 seconds when user first logged in I create session, and for later request, for example, user will send request for talking with chatGPT, and during this process, the server will update the history message which stored in session.Values[\u0026quot;messages\u0026quot;], after update the value of session.Values[\u0026quot;messages\u0026quot;], we should call session.Save() so that this update can be saved for later request,\nBut this will make session.Options.MaxAge back to its defalult value, which is 30 days, so you should set it again when you call session.Save(),\n1 2 3 4 5 ... session.Values[\u0026#34;messages\u0026#34;] = data // set MaxAge whenever you call session.Save(r, w) session.Options.MaxAge = 24 * 3600 _ = session.Save(r, w) Otherwise, the session stored in Redis won\u0026rsquo;t be deleted until 30 days later, and your user will keep logged in satus for 30 days,\ngo - Sessions variables in golang not saved while using gorilla sessions - Stack Overflow\nReturn and wrap error in low layer function (try to provide more context info), only handle errors and log info on the top of the function call stack.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 func parseUsernamePassword(r *http.Request) (*map[string]string, error) { userInfo := make(map[string]string) if err := r.ParseForm(); err != nil { // wrap error which can provide more context info // usually, say: \u0026#34;failed to\u0026#34; + \u0026#34;function name\u0026#34; + \u0026#34;error\u0026#34; // but not always return nil, fmt.Errorf(\u0026#34;falied to parse username and password: %v\u0026#34;, err) } ... } func updateMessage(w http.ResponseWriter, r *http.Request, store *redistore.RediStore) error { session, err := store.Get(r, \u0026#34;session_id\u0026#34;) if err != nil { return fmt.Errorf(\u0026#34;cannot update message: %v\u0026#34;, err) } ... if err = session.Save(r, w); err != nil { return fmt.Errorf(\u0026#34;cannot update message: %v\u0026#34;, err) } ... } Learn more: Error handling - Go - David\u0026rsquo;s Blog\n# 4. Session or redis cache I did some experiments , found that a query with gorm for sqlite3 takes about 380us, it\u0026rsquo;s not that much, and there will no that many users can overwhelm my server, so I finally decide query the tokens value from database everytime when user make a request to chat with ChatGPT,\n1 2 3 4 5 6 7 8 9 10 11 12 13 // https://stackoverflow.com/a/45791377/16317008 start := time.Now() err = db.Limit(1).Find(\u0026amp;user, \u0026#34;username = ?\u0026#34;, (*userInfo)[\u0026#34;username\u0026#34;]).Error t := time.Now() fmt.Println(t.Sub(start)) -------------------------------- 1.514166ms // first time 542.125Âµs 387.625Âµs 484.958Âµs 477.417Âµs 377.959Âµs .. # 5. Session store sessions need a place to store, in-memory, file or Redis, package gorilla/sessions provides two way to save sessions, one is file, another is in-memory,\n1 2 3 var store = sessions.NewCookieStore([]byte(os.Getenv(\u0026#34;SESSION_KEY\u0026#34;))) // or var store = NewFilesytemStore(\u0026#34;path/to/file\u0026#34;, []byte(os.Getenv(\u0026#34;SESSION_KEY\u0026#34;))) I choose redis to save sessions with redistore library, which implements a redis store based on gorilla/sessions,\n1 var store, _ = redistore.NewRediStore(10, \u0026#34;tcp\u0026#34;, \u0026#34;:6379\u0026#34;, \u0026#34;\u0026#34;, []byte(os.Getenv(\u0026#34;SESSION_KEY\u0026#34;))) You can use gorilla/sessions which help you save session in-memory, if you want save sessions on a redis server too, you have to install Redis on your computer, learn more about session and Redis:\nIntroduce Redis | æ©˜çŒ«å°å…«çš„é±¼ Cookie \u0026amp; Session | æ©˜çŒ«å°å…«çš„é±¼ Go æ¯æ—¥ä¸€åº“ä¹‹ gorilla/sessions - å¤§ä¿Šçš„åšå®¢ GoAuthentication/readme.md at master Â· karankumarshreds/GoAuthentication ","date":"2023-08-18T09:20:57Z","permalink":"https://blog.yorforger.cc/p/golang-web-a-simple-gptbot-with-openai-api/","title":"Golang Web - A Simple gptbot with Openai API"},{"content":"ä¼—æ‰€å‘¨çŸ¥ï¼ŒHTTP æ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯æ¯æ¬¡å‘å‡ºè¯·æ±‚æ—¶ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚æ— æ³•å¾—çŸ¥ä¸Šä¸€æ¬¡è¯·æ±‚æ‰€åŒ…å«çš„çŠ¶æ€æ•°æ®ï¼Œå¦‚ä½•èƒ½æŠŠä¸€ä¸ªç”¨æˆ·çš„çŠ¶æ€æ•°æ®å…³è”èµ·æ¥å‘¢ï¼Ÿ\næ¯”å¦‚åœ¨æ·˜å®çš„æŸä¸ªé¡µé¢ä¸­ï¼Œä½ è¿›è¡Œäº†ç™»é™†æ“ä½œã€‚å½“ä½ è·³è½¬åˆ°å•†å“é¡µæ—¶ï¼ŒæœåŠ¡ç«¯å¦‚ä½•çŸ¥é“ä½ æ˜¯å·²ç»ç™»é™†çš„çŠ¶æ€ï¼Ÿ\n# 1. cookie é¦–å…ˆäº§ç”Ÿäº† cookie è¿™é—¨æŠ€æœ¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜, cookie æ˜¯ http åè®®çš„ä¸€éƒ¨åˆ†, å®ƒçš„å¤„ç†åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥:\næœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ cookie é€šå¸¸ä½¿ç”¨ HTTP åè®®è§„å®šçš„ set-cookie å¤´æ“ä½œ è§„èŒƒè§„å®š cookie çš„æ ¼å¼ä¸º name=value æ ¼å¼, ä¸”å¿…é¡»åŒ…å«è¿™éƒ¨åˆ† æµè§ˆå™¨å°† cookie ä¿å­˜ æ¯æ¬¡è¯·æ±‚æµè§ˆå™¨éƒ½ä¼šå°† cookie å‘å‘æœåŠ¡å™¨ æµè§ˆå™¨å¯ä»¥è‡ªåŠ¨å‘é€ cookie, å³ä¸ç”¨åœ¨å‰ç«¯å†™ js ä»£ç æ‰‹åŠ¨å‘é€, æœåŠ¡å™¨è¿”å› cookie çš„æ—¶éœ€æŒ‡å®š Expires/MaxAge å‚æ•°, å®¢æˆ·ç«¯æµè§ˆå™¨æ”¶åˆ° response å(ä¹ŸåŒ…æ‹¬ cookie), è‹¥ cookie çš„ MaxAge æ—¶é—´å·²è¿‡, åˆ™æµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®æ­¤ cookie ä¸º invalid, ä¹‹åå‘é€è¯·æ±‚å¹¶ä¸ä¼šå¸¦ä¸Šè¯¥ cookie, å¦å¤– Expires/MaxAgeåªç”¨æŒ‡å®šå…¶ä¸€, ä½†æ˜¯æœªæ¥å…¼å®¹ä¸€äº›è€æµè§ˆå™¨å¦‚ IE, æœ‰æ—¶å€™ä¼šåŒæ—¶è®¾ç½® MaxAge å’Œ Expires\näº†è§£æ›´å¤š: https://stackoverflow.com/a/35729939/16317008\nå…¶ä»–å¯é€‰çš„ cookie å‚æ•°ä¼šå½±å“å°† cookie å‘é€ç»™æœåŠ¡å™¨ç«¯çš„è¿‡ç¨‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š\npathï¼šè¡¨ç¤º cookie å½±å“åˆ°çš„è·¯å¾„ï¼ŒåŒ¹é…è¯¥è·¯å¾„æ‰å‘é€è¿™ä¸ª cookieã€‚ expires å’Œ maxAgeï¼šå‘Šè¯‰æµè§ˆå™¨è¿™ä¸ª cookie ä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Œexpires æ˜¯ UTC æ ¼å¼æ—¶é—´ï¼ŒmaxAge æ˜¯ cookie å¤šä¹…åè¿‡æœŸçš„ç›¸å¯¹æ—¶é—´ã€‚å½“ä¸è®¾ç½®è¿™ä¸¤ä¸ªé€‰é¡¹æ—¶ï¼Œä¼šäº§ç”Ÿ session cookieï¼Œsession cookie æ˜¯ transient çš„ï¼Œå½“ç”¨æˆ·å…³é—­æµè§ˆå™¨æ—¶ï¼Œå°±è¢«æ¸…é™¤ã€‚ä¸€èˆ¬ç”¨æ¥ä¿å­˜ session çš„ session_idã€‚ secureï¼šå½“ secure å€¼ä¸º true æ—¶ï¼Œcookie åœ¨ HTTP ä¸­æ˜¯æ— æ•ˆï¼Œåœ¨ HTTPS ä¸­æ‰æœ‰æ•ˆã€‚ httpOnlyï¼šæµè§ˆå™¨ä¸å…è®¸è„šæœ¬æ“ä½œ document.cookie å»æ›´æ”¹ cookieã€‚ä¸€èˆ¬æƒ…å†µä¸‹éƒ½åº”è¯¥è®¾ç½®è¿™ä¸ªä¸º trueï¼Œè¿™æ ·å¯ä»¥é¿å…è¢« xss æ”»å‡»æ‹¿åˆ° cookieã€‚ ä¸Šé¢è¯´åˆ°çš„ expires æ ¼å¼æ˜¯ UTC, æ„å‘³ç€æœåŠ¡å™¨æŠŠ cookie ä¼ ç»™å®¢æˆ·ç«¯æ—¶, è‹¥è®¾ç½®äº† expires, åˆ™éœ€è¦å…ˆå¤„ç†ä¸€ä¸‹æ—¶é—´å³æŠŠæ ¼å¼è½¬ä¸º UTC æ ¼å¼, è§„å®š expires æ ¼å¼å¿…é¡»æ—¶ UTC çš„åŸå› æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å¯èƒ½ä¸åœ¨åŒä¸€ä¸ªæ—¶åŒº, æ¯”å¦‚æœåŠ¡å™¨æ‰€åœ¨ä½ç½®æ—¶åŒºä¸º UTC-3, å®¢æˆ·ç«¯çš„æ—¶åŒºä¸º UTC, æ­¤æ—¶æœåŠ¡å™¨æ¯” UTC æ…¢äº†ä¸‰å°æ—¶, æ­¤æ—¶è‹¥æœåŠ¡å™¨ç›´æ¥è®¾ç½® cookie expires ä¸º Now() + 30, æŒ‡çš„æ˜¯åŠå°æ—¶åè¿‡æœŸ, å¯æ˜¯ä¼ åˆ°å®¢æˆ·ç«¯ç«‹åˆ»è¿‡æœŸäº†, å› ä¸ºå®¢æˆ·ç«¯æµè§ˆå™¨é»˜è®¤æ¥è‡ªæœåŠ¡å™¨çš„ cookie expires æ˜¯ UTC,\nä¸‹é¢å°±æ˜¯æœåŠ¡å™¨ä¼ å› cookie expires æ²¡æœ‰ä¸ºå…¶æŒ‡å®šæ—¶åŒºçš„ä¾‹å­, å¯ä»¥çœ‹åˆ°è¯·æ±‚æ˜¯ Jun 20 å‘å‡ºçš„, cookie è¿‡æœŸæ—¶é—´å´æ˜¯ Jun 19:\næœåŠ¡å™¨ç«¯ Python Flask å¤„ç† http requestæ—¶, è®¾ç½® cookie æ–¹å¼å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 @app.route(\u0026#34;/\u0026#34;) def index(): session = request.cookies.get(\u0026#39;session_id\u0026#39;) # ä¸ºå®¢æˆ·ç«¯è®¾ç½® cookie, ä»¥ä¾¿ä¹‹åæ¥è‡ªå®ƒçš„è¯·æ±‚ä¸ç”¨éªŒè¯èº«ä»½ login if session_id is None: resp = make_response(render_template(\u0026#39;index.html\u0026#39;)) resp.set_cookie(\u0026#39;session\u0026#39;, session, # è¿™é‡Œä½¿ç”¨ç›¸å¯¹æ—¶é—´, ä¸ç”¨è®¾ç½®æ—¶åŒº max_age=datetime.timedelta(minutes=2), httponly=True) # å…¶å®ƒé€»è¾‘ ... return resp # å…¶å®ƒé€»è¾‘ ... All HTTP date/time stamps MUST be represented in Greenwich Mean Time (GMT), without exception. For the purposes of HTTP, GMT is exactly equal to UTC (Coordinated Universal Time). source\nBoth GMT and UTC display the same time.\n# 2. session Sessionå’ŒCookieçš„ç›®çš„ç›¸åŒ, éƒ½æ˜¯ä¸ºäº†å¼¥è¡¥HTTPåè®®æ— çŠ¶æ€çš„ç¼ºé™·, Sessionå’ŒCookieéƒ½æ˜¯ç”¨æ¥ä¿å­˜å®¢æˆ·ç«¯çŠ¶æ€ä¿¡æ¯çš„æ‰‹æ®µ, ä¸åŒä¹‹å¤„åœ¨äºCookieæ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨æ–¹ä¾¿å®¢æˆ·ç«¯è¯·æ±‚æ—¶ä½¿ç”¨, Sessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡ç«¯ç”¨äºå­˜å‚¨å®¢æˆ·ç«¯è¿æ¥çŠ¶æ€ä¿¡æ¯çš„, ä»å­˜å‚¨çš„æ•°æ®ç±»å‹æ¥çœ‹, Cookieä»…æ”¯æŒå­˜å‚¨å­—ç¬¦ä¸², Sessionå¯æ”¯æŒå¤šç§æ•°æ®ç±»å‹ source\nhttp æ˜¯æ— çŠ¶æ€çš„, å³ä¸‹ä¸€æ¬¡è¯·æ±‚æ— æ³•å¾—çŸ¥ä¸Šä¸€æ¬¡è¯·æ±‚æ‰€åŒ…å«çš„çŠ¶æ€æ•°æ®, æ‰€ä»¥äº§ç”Ÿäº† cookie, ä½¿æœåŠ¡å™¨å¯ä»¥â€œè®°ä½â€å®¢æˆ·ç«¯, å¤§è‡´é€»è¾‘ä¸º:\næœåŠ¡å™¨å¤„ç†å“åº”å®¢æˆ·ç«¯æ—¶é¡ºå¸¦è¿”å›ä¸€ä¸ª cookie object å®¢æˆ·ç«¯(æµè§ˆå™¨) å‘é€ http request æ—¶, é¡ºå¸¦å‘é€ä¸€ä¸ª cookie object (è‹¥æ­¤æ—¶æµè§ˆå™¨æœ‰ç›¸å…³cookie, ä¸”æ²¡è¿‡æœŸ) cookie åœ¨æœåŠ¡å™¨ç«¯äº§ç”Ÿ, ä¹‹ååœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å¾€è¿”å‘é€, å› æ­¤ cookie ä¸èƒ½ä¿å­˜æ¯”è¾ƒé‡è¦çš„éšç§æ•°æ®, å¯æ˜¯å¾ˆå¤šæ—¶å€™æœåŠ¡å™¨éœ€è¦ä¸´æ—¶è®°ä½å®¢æˆ·ç«¯çš„ä¿¡æ¯, æ­¤æ—¶å°±äº§ç”Ÿäº† session çš„æ¦‚å¿µ, å³åœ¨æœåŠ¡å™¨å†…å­˜ç»´æŠ¤ä¸€ä¸ªæ•°æ®ç»“æ„, ç”¨æ¥ä¸´æ—¶ä¿å­˜æ¯ä¸ªå®¢æˆ·ç«¯çš„æ•°æ®, ç„¶åä¸ºæ¯ä»½æ•°æ®è®¾ç½®ä¸€ä¸ª session_id, å¤„ç† http request æ—¶, å…ˆæŸ¥çœ‹å…¶ cookie é‡Œæœ‰æ²¡æœ‰ session_id å­—æ®µ:\nè‹¥å­˜åœ¨å°±æ ¹æ®æ­¤ id ç¡®å®šè¯¥è¯·æ±‚çš„èº«ä»½, è¿™æ ·æœåŠ¡å™¨å°±çŸ¥é“ä½ æ˜¯ä¸Šæ¬¡è®¿é—®è¿‡çš„æŸæŸæŸ, ç„¶åä»æœåŠ¡å™¨çš„å­˜å‚¨ä¸­å–å‡ºä¸Šæ¬¡è®°å½•åœ¨ä½ èº«ä¸Šçš„æ•°æ®,\nå¦åˆ™æ–°å»ºä¸€ä¸ª session, ç„¶åæŠŠè¯¥ session çš„ session_id æ”¾åˆ° cookie é‡Œ, (åœ¨cookieé‡Œè®¾ç½® seesion_id å­—æ®µ), è¿™æ ·, æœåŠ¡å™¨æ—¢èƒ½æŠŠç”¨æˆ·çš„é‡è¦ä¿¡æ¯å®‰å…¨ä¿å­˜, åˆèƒ½ç¡®è®¤æ¯ä¸ªè¯·æ±‚çš„èº«ä»½, å³æŠŠé‡è¦ä¿¡æ¯å­˜åœ¨æœåŠ¡å™¨ä¸å¤–éœ², é€šè¿‡ session_id æ¥åŒ¹é… session å’Œ http request,\næ‰€ä»¥ cookie å°±æ˜¯ç”¨æ¥ä¼ é€’ session_id çš„ä¸œè¥¿, è€Œ session_id åˆ™ç”¨æ¥å”¯ä¸€æ ‡è¯† session, å³ä¼šè¯, session å°±æ˜¯ä¸ªæ•°æ®ç»“æ„, ç”¨æ¥ä¸´æ—¶å­˜å‚¨ä¸€ä¸ªä¼šè¯çš„ä¿¡æ¯, å¦‚å®¢æˆ·ç«¯A, B, ä¸ æœåŠ¡å™¨ S ä¹‹é—´,åˆ™æœ‰ä¸¤ä¸ª session, A - S, B - S\n# 3. session å­˜å‚¨ Sessionåœ¨æœåŠ¡ç«¯æ˜¯å¦‚ä½•å­˜å‚¨çš„å‘¢ï¼Ÿ\næœåŠ¡ç«¯å¯é‡‡ç”¨å“ˆå¸Œè¡¨æ¥ä¿å­˜Sessionå†…å®¹ï¼Œä¸€èˆ¬è€Œè¨€å¯åœ¨å†…å­˜ä¸­åˆ›å»ºç›¸åº”çš„æ•°æ®ç»“æ„ï¼Œä¸è¿‡ä¸€æ—¦æ–­ç”µå†…å­˜ä¸­æ‰€æœ‰çš„ä¼šè¯æ•°æ®å°†ä¼šä¸¢å¤±ã€‚å› æ­¤å¯å°†ä¼šè¯æ•°æ®å†™å…¥åˆ°æ–‡ä»¶æˆ–ä¿å­˜åˆ°æ•°æ®åº“ï¼Œè™½ç„¶ä¼šå¢åŠ I/Oå¼€é”€ï¼Œä½†å¯ä»¥å®ç°æŸç§ç¨‹åºçš„æŒä¹…åŒ–ï¼Œä¹Ÿæ›´æœ‰åˆ©äºå…±äº«ã€‚\nsession å¯ä»¥å­˜æ”¾åœ¨:\nå†…å­˜ cookie æœ¬èº« redis æˆ– memcached ç­‰ç¼“å­˜ä¸­ æ•°æ®åº“ä¸­ ç¼“å­˜çš„æ–¹æ¡ˆæ¯”è¾ƒå¸¸è§, å­˜æ•°æ®åº“çš„è¯, æŸ¥è¯¢æ•ˆç‡ç›¸æ¯”å‰ä¸‰è€…éƒ½å¤ªä½, ä¸æ¨è\nå‚è€ƒ:\nhttps://gist.github.com/HellMagic/6e49af318d45311ee2860ac7d7bf09f6 Go Session - Goè¯­è¨€ä¸­æ–‡ç½‘ - Golangä¸­æ–‡ç¤¾åŒº äº†è§£æ›´å¤š:\nGo æ¯æ—¥ä¸€åº“ä¹‹ gorilla/securecookie - å¤§ä¿Šçš„åšå®¢ Go æ¯æ—¥ä¸€åº“ä¹‹ gorilla/sessions - å¤§ä¿Šçš„åšå®¢ ","date":"2023-08-17T07:39:56Z","permalink":"https://blog.yorforger.cc/p/cookie-session/","title":"Cookie \u0026 Session"},{"content":" # Problem GitHub æ–°å»ºä¸€ä¸ª repository, å¹¶é€‰æ‹©äº†è‡ªåŠ¨åˆ›å»º README.md, åœ¨æœ¬åœ°åˆå§‹åŒ–é¡¹ç›®åè¿›è¡Œpush, æŠ¥é”™:\n1 2 3 4 5 6 7 8 9 $ git push -u origin master To github.com:shwezhu/gptbot.git ! [rejected] master -\u0026gt; master (fetch first) error: failed to push some refs to \u0026#39;github.com:shwezhu/gptbot.git\u0026#39; hint: Updates were rejected because the remote contains work that you do hint: not have locally. This is usually caused by another repository pushing hint: to the same ref. You may want to first integrate the remote changes hint: (e.g., \u0026#39;git pull ...\u0026#39;) before pushing again. hint: See the \u0026#39;Note about fast-forwards\u0026#39; in \u0026#39;git push --help\u0026#39; for details. # åŸå› åˆ†æ è¿œç¨‹ä»“åº“å­˜åœ¨æœ¬åœ°ä»“åº“æ²¡æœ‰çš„ commit, å¯¼è‡´ push è¢«æ‹’ç»,\n# è§£å†³åŠæ³• fetch ä¸‹æ¥æŸ¥çœ‹éƒ½æ˜¯ä»€ä¹ˆ commit, å†å†³å®šæ˜¯å¦è¿›è¡Œ merge,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 # git fetch \u0026lt;remote\u0026gt; \u0026lt;branch\u0026gt;, \u0026lt;branch\u0026gt; is optional git fetch origin # list all branches git branch -v -a * master a48d922 Rework handler remotes/origin/master f6c60de Initial commit # check the work on the remote git checkout origin/master Note: switching to \u0026#39;origin/master\u0026#39; # åˆ‡æ¢è¿œç¨‹åˆ†æ”¯å, workplace åªå‰©ä¸‹ä¸€ä¸ª `README.md` æ–‡ä»¶, # å‘ç°æ²¡ä»€ä¹ˆé—®é¢˜, åˆ‡æ¢å›æœ¬åœ°åŸåˆ†æ”¯, (å‡è£…æŸ¥çœ‹å˜åŒ–) git switch master # æ³¨æ„ å¦‚æœæŸ¥çœ‹å˜åŒ–åä½ ä¸æƒ³åˆå¹¶è¿™ä¸ªè¿œç¨‹åˆ†æ”¯ ç›´æ¥åˆ é™¤è¯¥åˆ†æ”¯å³å¯ # git branch -r -d origin/master, å¿…é¡»åŠ ä¸Š -r å¦åˆ™æŠ¥é”™æ‰¾ä¸åˆ°åˆ†æ”¯ git merge origin/master fatal: refusing to merge unrelated histories git merge origin/master --allow-unrelated-histories Merge made by the \u0026#39;ort\u0026#39; strategy. README.md | 1 + 1 file changed, 1 insertion(+) create mode 100644 README.md # æŸ¥çœ‹ commit history git log commit 14daf2d5ae37dea131416629c6df22e1fe8ab456 (HEAD -\u0026gt; master) Merge: a48d922 f6c60de Author: David Zhu \u0026lt;shaowenzhu@dal.ca\u0026gt; Date: Tue Aug 15 23:03:47 2023 -0300 Merge remote-tracking branch \u0026#39;origin/master\u0026#39; commit f6c60de218933dcb40e507a88998318b4644034c (origin/master) Author: David Zhu \u0026lt;shwezhu@qq.com\u0026gt; Date: Wed Aug 16 06:29:10 2023 +0800 Initial commit commit a48d922d19e96b76f71dd09e0048f16d8feea03d Author: David Zhu \u0026lt;shaowenzhu@dal.ca\u0026gt; Date: Tue Aug 15 19:28:27 2023 -0300 Rework handler # æ­¤æ—¶å† push git push -u origin master # æ€»ç»“ é€šè¿‡ git fetch origin æ‹‰å–è¿œç¨‹ä»“åº“çš„commit\né€šè¿‡ git branch -v -a æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯, é€‰æ‹©æ˜¯å¦è¿›è¡Œmerge\næ‰§è¡Œ merge æ—¶ git ä¼šè‡ªåŠ¨åšä¸€æ¬¡ commit\ngit merge origin/master --allow-unrelated-histories\n","date":"2023-08-15T22:18:50Z","permalink":"https://blog.yorforger.cc/p/push-on-github-get-rejected-solved/","title":"Push on Github get Rejected - Solved"},{"content":"{% youtube iJ2muJniikY %}\nè§†é¢‘å†…å®¹ä½ç½®:\nCross Site Request Forgery: 1:16:00 CSRF Spring CSRF Filter æºç åˆ†æ: 1:22:00 Trace level log åˆ†æ: 1:26:00 1 2 3 logging: level: org.springframework.security: TRACE # 1:30:35 ç†è®º: AuthenticationManager, ProviderManager, AuthenticationProvider Authentication Object stands for either the request to login or the result of a successful login request ,\nä¸Šå›¾ä¸­, å¦‚æœè´¦å·å¯†ç æ­£ç¡®, åˆ™ ProviderManager è¿”å›çš„ UsernamePasswordAuthenticationToken å°±æ˜¯åŒä¸€ä¸ªå¯¹è±¡, åªä¸è¿‡å†…å®¹ä» password, username å˜æˆäº†ä¸€ä¸ª richer object (å†…å®¹æ›´ä¸°å¯Œ), å¦‚ UserDetails å¯¹è±¡å¯èƒ½åŒ…å« ä½ å–œæ¬¢çš„é¢œè‰², ç”Ÿæ—¥, ç­‰ä¿¡æ¯, è€Œ Authority å¯¹è±¡å¯èƒ½åŒ…å«ä½ çš„æƒé™, å¦‚ user è¿˜æ˜¯ admin,\nProviderManager is the most commonly used implementation of AuthenticationManager.\nAuthenticationProvider is used by ProviderManager to perform a specific type of authentication.\n1 2 3 4 5 6 7 8 9 10 11 12 public interface AuthenticationManager { Authentication authenticate(Authentication authentication) throws AuthenticationException; } // æˆ‘ä»¬ç»å¸¸è‡ªå·±å®ç°è¿™ä¸ªæ¥å£, å®ç°è‡ªå®šä¹‰ AuthenticationProvider public interface AuthenticationProvider { Authentication authenticate(Authentication authentication) throws AuthenticationException; boolean supports(Class\u0026lt;?\u0026gt; authentication); } Basically AuthenticationProvider is the specialized version of the ProviderManager that says I only deal with username password authentication tokens, I only deal with robot authentications, I only deal with over 2 login authentication tokens.\nAnd this allows you to extend Spring Security in a very specific place for changing the way someone logs in, without having to write a custom filter that takes the request, that does some transformation, maybe you don\u0026rsquo;t need to go that far, maybe you have special rules around, you know the email of the user that comes in, well here an AuthenticationProvider would be good enough.\nA ProviderManager just like this, kind of the same idea of the filters, but applied to transforming authentication requests into authenciated objects, it\u0026rsquo;s a for loop over a list of AuthenticationProvider.\n# 1:35:50 å®è·µ: AuthenticationProviders, ProviderManager, AuthenticationProvider Our website is great, it has two beautiful pages I can log in with username and password, or with Google login, and have a robot a robot account, I can hit my endpoints and get stuff with credentials that are not in the database for example,\nThe problem with my website is that I have a an admin called Daniel, he\u0026rsquo;s really fine, he\u0026rsquo;s neat, he\u0026rsquo;s kind he\u0026rsquo;s very handsome, uh but he has really bad memory, and and for for the for the love of anything he cannot remember his password, that\u0026rsquo;s very unfortunate, so we\u0026rsquo;re going to make an escape hatch for Daniel so that he doesn\u0026rsquo;t have to remember his password, and so we\u0026rsquo;re going to do this by implementing a special AuthenticationProvider,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public class DavidAuthenticationProvider implements AuthenticationProvider { @Override public Authentication authenticate(Authentication authentication) throws AuthenticationException { var username = authentication.getName(); if (\u0026#34;david\u0026#34;.equals(username)) { return UsernamePasswordAuthenticationToken.authenticated( \u0026#34;david\u0026#34;, null, AuthorityUtils.createAuthorityList(\u0026#34;ROLE_admin\u0026#34;) ); } // What do we do in case it\u0026#39;s not Daniel // Well we don\u0026#39;t know what to do with this, like the user password this must be handled //by some other AuthenticationProvider, so to Signal this, we\u0026#39;re returning null return null; } @Override public boolean supports(Class\u0026lt;?\u0026gt; authentication) { return UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication); } } UsernamePasswordAuthenticationToken: å®ç°äº† Authentication æ¥å£, å°±åƒæˆ‘ä»¬ä¸ŠèŠ‚è‡ªå®šä¹‰çš„ RobotAuthentication, éƒ½æ˜¯ç”¨æ¥ä»£è¡¨ä¸€ä¸ªè‡ªå®šä¹‰çš„è®¤è¯ç”¨æˆ· (authentication request), åªä¸è¿‡æˆ‘ä»¬çš„ RobotAuthentication ç”¨æ¥ä»£è¡¨é€šè¿‡ http header è®¤è¯çš„ç”¨æˆ· (authentication request), è€Œå‰è€…åˆ™ä»£è¡¨: An Authentication implementation that is designed for simple presentation of a username and password.\nisAssignableFrom(): Determines if the class or interface represented by this Class object is either the same as, or is a superclass or superinterface of, the class or interface represented by the specified Class parameter.\nåˆ«å¿˜äº† Class\u0026lt;T\u0026gt; æ˜¯ä¸ªåŒ…è£…å™¨, å‚è€ƒ: https://davidzhu.xyz/2023/08/05/Java/Basics/002-reflection-object-class å› æ­¤ supports() æ–¹æ³•ä»£è¡¨çš„æ„æ€æ˜¯: If the authentication argument is an instance of UsernamePasswordAuthenticationToken or any of its subclasses, the method returns true, indicating that this AuthenticationProvider implementation supports the provided authentication object. Otherwise, it returns false. The authenticate() method is responsible for performing the authentication process based on the provided authentication object and returning a fully authenticated Authentication object if the authentication is successful.\nwhen the ProviderManager calls this authenticate() method, it\u0026rsquo;s going to always pass in a UsernamePasswordAuthenticationToken or a subclass. This is the same way as we did with the the filter:\nDo I want to handle this request, is it the right type? DavidAuthenticationProvider çš„ supports(Class\u0026lt;?\u0026gt; authentication) ç”¨æ¥åˆ¤æ–­å‚æ•° authentication æ˜¯ä¸æ˜¯å±äº UsernamePasswordAuthenticationTokenå­ç±»æˆ–å°±æ˜¯è¯¥ç±»å‹, è‹¥æ˜¯æ‰å¯è¿›è¡Œå¤„ç† RobotFilter çš„ doFilterInternal() ä¸­æˆ‘ä»¬åˆ¤æ–­ header ä¸­æ˜¯å¦æœ‰ \u0026ldquo;x-robot-password\u0026rdquo; å­—æ®µ, è‹¥æ— åˆ™ç›´æ¥è°ƒç”¨ doFilter() å¹¶ return, And is the is the content of the payload the thing I care about? RobotFilter åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡® DavidAuthenticationProvider åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦ä¸º david The other thing that the AuthenticationProvider can do is throw in an AuthenticationException, so basically this account has expired and so you\u0026rsquo;re not allowed to log in, or the credentials are wrong,\nAuthenticationProvider can return three things, either an authentication object so the result of something that passed me credentials and they said the credentials are good, and an exception if I want to say stop processing this is invalid this should not go forever, or null if we delegate to the rest.\nIf nothing can authenticate, if every provider returns null, it will throw an exception in the end , and the ProviderManager will say no I don\u0026rsquo;t care about this,\nWe mount it into the filter chain, go to the WebSecurityConfig:\n1 2 3 4 5 6 7 ... .formLogin(withDefaults()) .oauth2Login(withDefaults()) .addFilterBefore(new RobotFilter(), UsernamePasswordAuthenticationFilter.class) // åœ¨è¿™ .authenticationProvider(new DavidAuthenticationProvider()) .build(); # 1:41:20 æ€»ç»“è§£é‡Š ä¸ºä»€ä¹ˆ æˆ‘ä»¬åº”è¯¥è‡ªå®šä¹‰AuthenticationProvider è€Œä¸æ˜¯ ä¸€ä¸ª FIlter Usually when you want to do a custom authentication, you should do a custom AuthenticationProvider rather than a full filter.\nWhen I log in ProviderManager produces an event, when I fail to log in and it also produces an event a spring event, so this means we can listen to those events and do stuff when an event is done.\n# 1:45:00 Change our Custom RobotFilter to Custom AuthenticationProvider æºç : https://github.com/shwezhu/springboot-learning/tree/master/3-spring-security-authenciation-provider\næ³¨æ„ç»“æ„, æ¯”èµ·ä¸‹é¢è¿™ä¸ª:\n1 2 3 4 5 6 7 8 9 10 11 12 @Override public Authentication authenticate(Authentication authentication) throws AuthenticationException { var authRequest = (RobotAuthentication) authentication; var password = authRequest.getPassword(); if (this.passwords.contains(password)) { // å¯ä»¥å‘ç°, å®ç°äº†Authenticationæ¥å£çš„ç±»ä¸€èˆ¬æœ‰ä¸ª authenticated() é™æ€æ–¹æ³•, ä¹Ÿå¯ç§°ä¸ºfactory method // æ¯”å¦‚æˆ‘ä»¬çš„è‡ªå®šä¹‰RobotAuthentication,å†æ¯”å¦‚UsernamePasswordAuthenticationToken return RobotAuthentication.authenticated(); } else { throw new BadCredentialsException(\u0026#34;You are not Mr Robot ğŸ¤–ï¸\u0026#34;); } } ç”¨è¿™æ ·çš„ç»“æ„æ›´å¥½:\n1 2 3 4 5 6 7 8 9 @Override public Authentication authenticate(Authentication authentication) throws AuthenticationException { var authRequest = (RobotAuthentication) authentication; var password = authRequest.getPassword(); if (!this.passwords.contains(password)) { throw new BadCredentialsException(\u0026#34;You are not Mr Robot ğŸ¤–ï¸\u0026#34;); } return RobotAuthentication.authenticated(); } # 1:56:00 AuthenticationProvider è°ƒç”¨é¡ºåºåŠä¼˜ç‚¹ 1 2 3 logging: level: org.springframework.security: TRACE ä»å›¾ä¸­å¯ä»¥çœ‹å‡º ä½¿ç”¨å¦‚ä¸‹ç™»å½•, åˆ™ä¼šåŒ¹é…åˆ°æˆ‘ä»¬çš„ DavidAuthenticationProvider,\n1 $ curl -u \u0026#34;david:asd\u0026#34; http://localhost:8080/private -v è‹¥ä½¿ç”¨æ­£å¸¸ç”¨æˆ·å¯†ç ç™»å½•, åˆ™ä¼šè·³è¿‡ DavidAuthenticationProvider, ä½¿ç”¨ DaoAuthenticationProvider éªŒè¯,\n1 curl -u \u0026#34;user-1:asd\u0026#34; http://localhost:8080/private -v çœ‹å®Œä¸Šå›¾ä¼šå‘ç°æ¯æ¬¡ RobotFilter éƒ½å…ˆäº UsernamePasswordAuthenticationFilter è°ƒç”¨, è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ SecurityChain é…ç½®ä»£ç :\n1 2 ... .addFilterBefore(new RobotFilter(authManager), UsernamePasswordAuthenticationFilter.class) ä»ä¸Šé¢çš„è¾“å‡ºæˆ‘ä»¬ä¼šå‘ç°:\n1 2 Invoking BasicAuthenticationFilter Found username \u0026#39;david\u0026#39; in Basic Authorization header è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é€šè¿‡ä»£ç \n1 2 3 ... .formLogin(withDefaults()) .httpBasic(withDefaults()) æŠŠ BasicAuthenticationFilter åŠ å…¥åˆ°äº† Security, ç„¶åéªŒè¯çš„æ—¶å€™æ­£å¦‚è¾“å‡ºé‚£æ ·, ä¸€å±‚ä¸€å±‚çš„è°ƒç”¨Filter, è¿›è¡ŒåŒ¹é…, æˆ‘ä»¬æ­¤æ—¶ä½¿ç”¨çš„æ˜¯å‘½ä»¤è¡Œ curl -u \u0026quot;\u0026quot; è¿›è¡ŒéªŒè¯çš„, è€Œ BasicAuthenticationFilter å°±æ˜¯åšè¿™ä¸ªçš„, å¦‚æœæˆ‘ä»¬æŠŠ BasicAuthenticationFilter ä»æˆ‘ä»¬çš„SecurityChianä¸­ç§»é™¤ä¹Ÿå°±æ˜¯åˆ é™¤ä»£ç  .httpBasic(withDefaults()), é‚£æˆ‘ä»¬é€šè¿‡ curl -u æä¾›çš„è´¦å·å¯†ç å°±ä¸ä¼šè¢«å‘ç°, ç„¶åå¯¼è‡´éªŒè¯å¤±è´¥, åŸå› æ˜¯æ‰€æœ‰çš„ filter éƒ½è¢«ä¾æ¬¡æ‰ç”¨å®Œ, ä½†ä¾ç„¶æ²¡æœ‰å‘ç°åŒ¹é…çš„,\né€šè¿‡è¿™ä¸ªæˆ‘ä»¬ä¹Ÿä¼šå‘ç°, å¦‚æœä½¿ç”¨è‡ªå®šä¹‰ filter è¿›è¡ŒéªŒè¯, å¦‚ä½¿ç”¨ DavidFIlter, è€Œä¸æ˜¯DavidAuthenticationProvider, é‚£æˆ‘ä»¬è¿˜éœ€è¦å»éªŒè¯ post é‡Œé¢çš„è´¦å·å¯†ç , å…·ä½“åˆ†æå‚è€ƒè§†é¢‘ 1:58:15\n# 1:59:25 FilterChain è°ƒç”¨é¡ºåº # 2:00:00 Recap # 2:01:35 Configurers - \u0026ldquo;navigate Spring Security\u0026rdquo; Configurers are an abstraction that allows you to configure the filter chain and do multiple operations on the the HTTP builder(),\nRobotLoginConfigurer.java\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 public class RobotLoginConfigurer extends AbstractHttpConfigurer\u0026lt;RobotLoginConfigurer, HttpSecurity\u0026gt; { private final List\u0026lt;String\u0026gt; passwords = new ArrayList\u0026lt;\u0026gt;(); @Override public void init(HttpSecurity builder) throws Exception { // step 1 // initializes a bunch of objects // -\u0026gt; AuthenticationProviders // all the AuthenticationProviders are populated at init() they\u0026#39;re put in the builder, builder.authenticationProvider(new RobotAuthenticationProvider(passwords)); } @Override public void configure(HttpSecurity builder) throws Exception { // step 2 // this also initializes objects, but can reuse objects from step 1, even from other configurers // -\u0026gt; Filters // each filter chain may have their own AuthenticationManager var authenticationManager = builder.getSharedObject(AuthenticationManager.class); builder.addFilterBefore(new RobotFilter(authenticationManager), UsernamePasswordAuthenticationFilter.class); } public RobotLoginConfigurer password(String password) { this.passwords.add(password); return this; } } WebSecurityConfig.java\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { http .authorizeHttpRequests(authorizeConfig -\u0026gt; { authorizeConfig.requestMatchers(\u0026#34;/\u0026#34;).permitAll(); authorizeConfig.requestMatchers(\u0026#34;/error\u0026#34;).permitAll(); authorizeConfig.requestMatchers(\u0026#34;/favicon.ico\u0026#34;).permitAll(); authorizeConfig.anyRequest().authenticated(); }) .formLogin(withDefaults()) // By calling httpBasic(), an instance of the BasicAuthenticationFilter is added to the filter chain. // https://stackoverflow.com/a/57577530/16317008 // ä¸ºäº†å®ç°é€šè¿‡ curl -u \u0026#34;user:password\u0026#34; http://localhost:8080/private ç™»å½• .httpBasic(withDefaults()) .oauth2Login(withDefaults()) // return HttpSecurity .authenticationProvider(new DavidAuthenticationProvider()) // return HttpSecurity .apply(new RobotLoginConfigurer()) // return Configurer .password(\u0026#34;beep-boop\u0026#34;) // return Configurer .password(\u0026#34;boop-beep\u0026#34;); return http.build(); } # 2:10:40 Lambda DSL ","date":"2023-08-08T20:58:54Z","permalink":"https://blog.yorforger.cc/p/csrf-filter-providermanager-authenticationproviders-spring%E5%AD%A6%E4%B9%A0%E4%B8%83/","title":"CSRF Filter \u0026 ProviderManager \u0026 AuthenticationProviders, Springå­¦ä¹ (ä¸ƒ)"},{"content":" # è§†é¢‘ä»‹ç» æ­¤æ–‡ç« å‚è€ƒè§†é¢‘çš„ 54:35 ä¹‹å, ç”¨äºåšç¬”è®°, å¯ç›´æ¥è§‚çœ‹è§†é¢‘:\n{% youtube iJ2muJniikY %}\nå…³äº authentication object, å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡æˆ–è€…è§‚çœ‹è§†é¢‘ 33:00, å…³äº filter chain, å¯å‚è€ƒè§†é¢‘ 39:15, æˆ–å‚è€ƒ: FIlter Architecture Spring Security # åŠŸèƒ½é™ˆè¿° æ·»åŠ ä¸€ä¸ªç®¡ç†å‘˜è§’è‰², å¯ä»¥ä¸ç”¨ç™»å½•, é€šè¿‡ special header å°±å¯è®¿é—®æ‰€æœ‰éœ€è¦è®¤è¯çš„é¡µé¢, å¤§æ¦‚ä¸‹é¢è¿™æ ·: curl localhost:8080/private -H \u0026quot;x-robot-password: beep-boop\u0026quot; -v # é¡¹ç›®ç»“æ„ æ­¤æ–‡ç« æ‰€ç”¨ä»£ç åœ¨ä¸Šä¸€ç¯‡æ–‡ç« åŸºç¡€ä¸Šç¼–å†™, æœ¬ç¯‡æ–‡ç« ä»£ç åœ°å€: https://github.com/shwezhu/springboot-learning/tree/master/spring-mr-robot-filter-demo\n1 2 3 4 5 6 7 â””â”€â”€ david â””â”€â”€ zhu â”œâ”€â”€ RobotAuthentication.java â”œâ”€â”€ RobotFilter.java â”œâ”€â”€ SpringSecurityDemoApplication.java â”œâ”€â”€ WebController.java â””â”€â”€ WebSecurityConfig.java ä¸»è¦æ˜¯ä¸ºäº†ç†è§£ FilterChian æ˜¯ä¸€ä¸ª list ç»“æ„, å³æœ‰å¤šä¸ª filter, ç„¶åæ¯ä¸ª filter éƒ½æœ‰ doFilter æ–¹æ³•, ä»–ä»¬æ˜¯åœ¨æ–¹æ³•ä½“é‡Œè¢«è°ƒç”¨çš„ è€Œä¸æ˜¯ for loop ç»“æ„è¢«å¾ªç¯è°ƒç”¨, è¿™æ ·çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å†³å®šåœ¨æ–¹æ³•ä½“çš„å“ªéƒ¨åˆ†è¿›è¡Œ doFilter è°ƒç”¨, doFilter å°±æ˜¯è¿›å…¥ä¸‹ä¸€ä¸ª filter, è¿™é‡Œè¯´çš„ä¸å‡†ç¡®, æ·±å…¥ç†è§£å‚è€ƒ: FIlter Architecture Spring Security\n# è‡ªå®šä¹‰ Filter - RobotFilterç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class RobotFilter extends OncePerRequestFilter { @Override protected void doFilterInternal( HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException { System.out.println(\u0026#34;ğŸ¤–ï¸ HELLO FORM Robot Filter~\u0026#34;); // Every Filter has a doFilter() method, // But they are not called by for loop over a list of filters // but actually a chain of responsibility // video: https://youtu.be/iJ2muJniikY, at 00:42:53 filterChain.doFilter(request, response); } } æŠŠè¯¥ Filter æ·»åŠ åˆ° SecurityFilterChain, åœ¨æˆ‘ä»¬ä¸Šç¯‡æ–‡ç« å¸¸è§çš„ WebSecurityConfig ç±»å†…,\n1 2 3 4 5 6 7 8 9 10 11 12 13 @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { return http .authorizeHttpRequests(authorizeConfig -\u0026gt; { authorizeConfig.requestMatchers(\u0026#34;/\u0026#34;).permitAll(); ... }) .formLogin(withDefaults()) .oauth2Login(withDefaults()) // !!! add this line below: .addFilterBefore(new RobotFilter(), UsernamePasswordAuthenticationFilter.class) .build(); } ç„¶åè¾“å…¥\n1 2 $ curl localhost:8080 Hello David~% é¡¹ç›®ç»ˆç«¯è¾“å‡º,\n1 ğŸ¤–ï¸ HELLO FORM Robot Filter~ è§£é‡Šä¸‹ä¸ºä½•ç»§æ‰¿ OncePerRequestFilter ,\næ¯ä¸ª servlet éƒ½å¯ä»¥æœ‰ä¸åŒçš„ SecurityFilterChain, ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡¹ç›®å¯ä»¥æœ‰å¤šä¸ª SecurityFilterChain, åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„ä¸€ä¸ª WebSecurityConfig ç±», æˆ‘ä»¬åœ¨è¯¥ç±»ä¸­é…ç½®äº† SecurityFilterChain, å…¶å® SecurityFilterChain å¯ä»¥æœ‰å¤šä¸ª, å³æˆ‘ä»¬ç°åœ¨çš„é¡¹ç›®ä¸å¤Ÿå¤æ‚, åªç”¨äº†ä¸€ä¸ª, æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å†åŠ ä¸ª SecurityFilterChain è®©å…¶åªå¤„ç† /api/** ç›¸å…³ endpoints, å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { return http // https://stackoverflow.com/a/75219552/16317008 .securityMatcher(\u0026#34;/api\u0026#34;) .authorizeHttpRequests(authorizeConfig -\u0026gt; { authorizeConfig.requestMatchers(\u0026#34;/\u0026#34;).permitAll(); ... }) .formLogin(withDefaults()) ... } å†™ JSP çš„æ—¶å€™ä¸€ä¸ª servlet è´Ÿè´£çš„æ˜¯ä¸€ä¸ªå¯¹åº”çš„ endpoint, æˆ‘ä»¬å†™ spring ä»£ç çš„æ—¶å€™åªæ˜¯ç”¨ä¸ªç®€å•çš„æ³¨è§£æŒ‡å®šå¯¹åº”endpoint, Spring æ¡†æ¶åœ¨åº•å±‚å¸®æˆ‘ä»¬å®ç°äº†å¯¹åº”çš„ servlet , ç„¶åè¿è¡Œçš„æ—¶å€™è¿™äº› servlet è¿è¡Œåœ¨ tomcat ä¸­, tomcat ä¼šæŠŠæ¯ä¸ª request åˆ†ç±»ç„¶åè½¬å‘ç»™å¯¹åº”çš„ servlet, è¯´è¿™äº›åªæ˜¯æƒ³è¯´, servlet æ‰æ˜¯çœŸæ­£å¤„ç† request çš„ä¸œè¥¿, å³äº§ç”Ÿ http response, è€Œ filter åˆ™æ˜¯å·¥ä½œåœ¨ servlet ä¹‹å‰æˆ–è€…ä¹‹åå¸®æˆ‘ä»¬è¿‡æ»¤, è®¤è¯ request, servlet å¾ˆç¬¨, åªè´Ÿè´£å¤„ç†ä¼ ç»™ä»–çš„ request, åƒæ˜¯ä¸ªæ²¡å¤§è„‘çš„å·¥å‚,\nä¸Šé¢æˆ‘ä»¬æåˆ°, æ¯ä¸ª servlet éƒ½å¯ä»¥æœ‰ä¸åŒçš„ SecurityFilterChain, äºæ˜¯å†çœ‹ä¸‹é¢è¿™äº›è§£é‡Šä½¿ç”¨ OncePerRequestFilter çš„åŸå› , ä½ å°±èƒ½çœ‹æ‡‚äº†,\nThe request could be dispatched to a different (or the same) servlet using the request dispatcher. A common use-case is in Spring Security, where authentication and access control functionality is typically implemented as filters that sit in front of the main application servlets. When a request is dispatched using a request dispatcher, it has to go through the filter chain again (or possibly a different one) before it gets to the servlet that is going to deal with it. The problem is that some of the security filter actions should only be performed once for a request. Hence the need for this filter. What is OncePerRequestFilter? - Stack Overflow\nA Filter can be called either before or after servlet execution. When a request is dispatched to a servlet, the RequestDispatcher may forward it to another servlet. There\u0026rsquo;s a possibility that the other servlet also has the same filter. In such scenarios, the same filter gets invoked multiple times. Spring guarantees that the OncePerRequestFilter is executed only once for a given request. What Is OncePerRequestFilter? | Baeldung\nå…¶å®è¿™é‡Œè¿˜æœ‰éœ€è¦æ·±å…¥æ¢è®¨çš„ä¸œè¥¿, æ¯”å¦‚ RequestDispatcher æ˜¯åšä»€ä¹ˆçš„, ç°åœ¨æˆ‘ä»¬è¦çŸ¥é“çš„æ˜¯, ä¸€ä¸ªé¡¹ç›®å¯ä»¥æœ‰å¤šä¸ª FilterChain, Servlet æ‰æ˜¯çœŸæ­£å¤„ç† http requestçš„ä¸œè¥¿, FilterChain åªæ˜¯å¸® servlet è¿‡æ»¤ request, è‡³äº æ¯ä¸ª request æ€ä¹ˆè¢« tomcat åˆ†é…åˆ° å¯¹åº”servletçš„, è¿™è¿˜éœ€è¦æ·±å…¥çš„å­¦ä¹ æ‰èƒ½ç†è§£, å…³äº FIlterChain å¯å‚è€ƒ: Architecture Spring Security\n# å®ç°æ€è·¯ åˆ›å»ºæˆ‘ä»¬çš„ç‰¹æ®Š RobotFilter, é€šè¿‡ç»§æ‰¿ OncePerRequestFilter å®ç° å› ä¸ºè®¿é—®çš„é¡µé¢éœ€è¦ authenticated, å› æ­¤åˆ›å»ºç‰¹æ®Š RobotFilter æ—¶, éœ€è¦æ–°å»ºä¸€ä¸ª authentication object RobotAuthentication æ¥è¡¨ç¤º robot ç”¨æˆ· åœ¨è´¦å·å¯†ç ç™»å½•è®¤è¯ filter å‰æ·»åŠ æˆ‘ä»¬åˆšè‡ªå®šä¹‰çš„ RobotFilter, é€šè¿‡ä¿®æ”¹ WebSecurityConfig::securityFilterChain æ–¹æ³•å®ç° æœ¬æ–‡ä¸»è¦å‚è€ƒ: Spring Security, demystified by Daniel Garnier Moiroux\n","date":"2023-08-07T20:58:53Z","permalink":"https://blog.yorforger.cc/p/spring-security-filter-chian-%E8%87%AA%E5%AE%9A%E4%B9%89-robotfilter-spring%E5%AD%A6%E4%B9%A0%E5%85%AD/","title":"Spring Security Filter Chian è‡ªå®šä¹‰ RobotFilter, Springå­¦ä¹ (å…­)"},{"content":" # 1. Optional Class Java 8 Optional å®šä¹‰å¦‚ä¸‹:\n1 2 3 // A container object which may or may not contain a non-null value. If a value is present, `isPresent()` will return `true` and `get()` will return the value. public final class Optional\u0026lt;T\u0026gt; extends Object ä¹‹å‰è®¨è®ºçš„ java.lang.Class, ä¹Ÿæ˜¯ä¸€ä¸ªç±»åŒ…è£…å™¨, è‹¥ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¸º Optional\u0026lt;?\u0026gt; åˆ™å°±æ˜¯è¿”å› Optional\u0026lt;?\u0026gt; çš„å¯¹è±¡, è¿™å¾ˆå®¹æ˜“çœ‹å‡ºæ¥, ä¸è¦åŠ ä¸ªæ³›å‹å°±è¿·äº†, å¦‚ä¸€ä¸ªæ–¹æ³•çš„ç­¾åä¸º public Cat foo(); åˆ™è¯¥æ–¹æ³•è¿”å›çš„ä¸€å®šæ˜¯ Cat çš„å¯¹è±¡,\nOptional å°±æ˜¯ä¸ºäº†å‡å°‘æˆ‘ä»¬çš„ null check ä»£ç , Helps you avoid NullPointerException, æ‰€ä»¥ä¸è¦ä¹±ç”¨ optional, ä¸‹é¢è¿™ä¸ªè§†é¢‘è®²çš„å¾ˆå¥½:\n{% youtube vKVzRbsMnTQ %}\nçœ‹å®Œè§†é¢‘å†å•°å—¦å‡ å¥, æ­¤æ–‡ç« çœ‹ä¼¼æ˜¯äº†è§£ Java 8 Optional, å…¶å®æ¶‰åŠåˆ°äº†genericså’Œfunctional interface, äº†è§£åé˜…è¯»æºç ä¹Ÿä¼šå®¹æ˜“å¾ˆå¤š, å› ä¸ºå¾ˆå¤šéƒ½ç”¨åˆ°äº†è¿™ä¸¤ä¸ªç‰¹æ€§, äº†è§£æ›´å¤š:\nFunctional Interfaces \u0026amp; Anonymous Classes \u0026amp; Lambda Expressions - Java | æ©˜çŒ«å°å…«çš„é±¼ java.lang.Object \u0026amp; java.lang.Class | æ©˜çŒ«å°å…«çš„é±¼ # 2. Method Reference å­¦ Spring Security, çœ‹åˆ°ä¸€æ®µè‡ªå®šä¹‰ä»£ç , ç”¨æ¥è·å–é€šè¿‡ Open ID ç™»å½•ç”¨æˆ·çš„ email:\n1 2 3 4 5 6 7 private static String getName(Authentication authentication) { return Optional.of(authentication.getPrincipal()) .filter(OidcUser.class::isInstance) .map(OidcUser.class::cast) .map(OidcUser::getEmail) .orElseGet(authentication::getName); } # 2.1. filter() ç®€å•åˆ†æä¸€ä¸‹ filter(),\n1 public Optional\u0026lt;T\u0026gt; filter(Predicate\u0026lt;? super T\u0026gt; predicate); å…³äº filter() çš„ä»‹ç»: If a value is present, and the value matches the given predicate, return an Optional describing the value, otherwise return an empty Optional. è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢?\nå‡è®¾æˆ‘ä»¬æœ‰ä¸ªæ–¹æ³• getCat() å¯ä»¥ä»æ•°æ®åº“è·å– Cat å¯¹è±¡, ç„¶åæˆ‘ä»¬è°ƒç”¨å®ƒ:\n1 Optional\u0026lt;Cat\u0026gt; optionalCat = getCat(\u0026#34;Milo\u0026#34;); æ­¤æ—¶ optionalCat å°±æ˜¯ä¸€ä¸ª Cat å¯¹è±¡çš„åŒ…è£…å™¨, a Optional that describes the value, ç„¶åæˆ‘ä»¬æ¥ç€åšä¸‹é¢çš„äº‹æƒ…:\n1 optionalCat.filter(cat -\u0026gt; cat.getName().equals(\u0026#34;Milo\u0026#34;)); å¦‚æœ optionalCat ä¸ä¸ºç©º, ä¸” lambada è¡¨è¾¾å¼è¿”å›å€¼ä¸º true å³ä¸Šé¢è¡¨è¿°: If a value is present, and the value matches the given predicate, åˆ™ return an Optional describing the value, å³ç›¸å½“äºå¯¹ cat å¯¹è±¡è¿›è¡ŒäºŒæ¬¡ç­›é€‰, ç¬¬ä¸€æ¬¡ä¸ä¸ºç©º, ç¬¬äºŒæ¬¡éœ€è¦ cat åå­—ä¸º â€œmiloâ€, è‹¥è¿™ä¿©æ¡ä»¶éƒ½æ»¡è¶³, æ­¤æ—¶ filter() æ‰ä¼šè¿”å›ä¸€ä¸ª Optional\u0026lt;Cat\u0026gt; å¯¹è±¡, ä¹Ÿå°±æ˜¯å’Œæœ€åˆçš„ optionalCat ç›¸åŒ, è‹¥é‚£ä¸¤ä¸ªæ¡ä»¶æœ‰ä¸€ä¸ªæ²¡æ»¡è¶³, åˆ™ filter() è¿”å›ä¸€ä¸ªç©º Optional å¯¹è±¡,\nå¦å¤–è¯¥æ–¹æ³•å‚æ•°ç±»å‹æ˜¯ä¸€ä¸ª functional interface, å³ Predicate\u0026lt;? super T\u0026gt; , å¯ä»¥çœ‹çœ‹å…¶å®šä¹‰,\n1 2 3 4 5 @FunctionalInterface public interface Predicate\u0026lt;T\u0026gt; { boolean test(T t); ... } å¦‚æœä½ äº†è§£ functional interface, ä¸éš¾å‘ç°å¯¹äºè¿™ç§å‚æ•°ç±»å‹æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼  lambda expression, ä½†æ˜¯ä¸Šé¢ä»£ç ä¼ çš„æ˜¯ OidcUser.class::isInstance è¿™æ˜¯ä»€ä¹ˆé¬¼? åˆ«æ…Œ, è¿™ä¸æ˜¯ c++ çš„ namespace, è¿™æ˜¯ Java 8 çš„æ–°ç‰¹æ€§ Method Reference,\nMethod references are a special type of lambda expressions. They\u0026rsquo;re often used to create simple lambda expressions by referencing existing methods. Method References in Java\nä¸å¾—ä¸è¯´ Java 8 å¸¦æ¥äº†å¾ˆå¤šçš„æ–°çš„ç‰¹æ€§: Optional, Method Reference, Lambda,\n# 2.2. map() å¯¹äºå¦ä¸€ä¸ªæ–¹æ³• map() , åˆ™æ˜¯ä¼šè¿”å›ä¸€ä¸ªæ–°ç±»å‹çš„ Optional å¯¹è±¡,\n1 public \u0026lt;U\u0026gt; Optional\u0026lt;U\u0026gt; map(Function\u0026lt;? super T,? extends U\u0026gt; mapper); If a value is present, apply the provided mapping function to it, and if the result is non-null, return an Optional describing the result. Otherwise return an empty Optional.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class Main { public static void main(String[] args) { Optional\u0026lt;Cat\u0026gt; optionalCat = getCat(\u0026#34;Milo\u0026#34;); int age = optionalCat .filter(cat -\u0026gt; cat.getName().equals(\u0026#34;Milo\u0026#34;) ) .map(Cat::getAge) .orElse(0); System.out.println(age); } public static Optional\u0026lt;Cat\u0026gt; getCat(String name) { // æ¨¡æ‹ŸæŸ¥æ‰¾æ•°æ® Cat cat = new Cat(name, 2); return Optional.ofNullable(cat); } } è‹¥ filter() è¿”å›çš„ä¸æ˜¯ç©º Optional, ä¸” Cat::getAge æ²¡æœ‰è¿”å›ç©ºå€¼, åˆ™è¿”å›ä¸€ä¸ªæ–°çš„ Optional, ç±»å‹ä¸º Optional, å³ return an Optional describing the result,\n","date":"2023-08-06T15:44:52Z","permalink":"https://blog.yorforger.cc/p/java-8-optional-method-reference/","title":"Java 8 Optional \u0026 Method Reference"},{"content":" # 1. Anonymous Classes Anonymous Class Extending a Class Anonymous Class Implementing an Interface å¦‚ä½•ç†è§£å‘¢, å¦‚ Cat cat = new Cat() {...}, è‹¥ Cat æ˜¯ä¸ªç±», é‚£å¯¹è±¡ cat å°±æ˜¯ä¸ªç±»å‹ä¸ºåŒ¿åçš„ç±», åªä¸è¿‡è¿™ä¸ªç±»ç»§æ‰¿äº† Cat , åŒç†è‹¥ Cat æ˜¯ä¸ªæ¥å£ interface, é‚£å¯¹è±¡ cat çš„ç±»å‹å°±æ˜¯ a class that implements the interface Cat , å…·ä½“å¯å‚è€ƒä¸‹é¢è¿™ä¸ªè§†é¢‘, è®²å¾—å¾ˆå¥½:\n{% youtube DwtPWZn6T1A %}\n# 2. Functional Interfaces \u0026amp; Lambda Expressions è‹¥æƒ³å®šä¹‰ä¸€ä¸ªæ–¹æ³•, ä¸”è¿™ä¸ªæ–¹æ³•çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•, å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ functional interface All a Lambda is, is a shorcut to define an implementation of a functional interface. Functional interface åªå¯ä»¥æœ‰ä¸€ä¸ª abstract method, ä½†å¯ä»¥æœ‰å¤šä¸ª default, static methods, æœ€å¥½ä½¿ç”¨æ³¨è§£ @FunctionalInterface , å®ƒå‘Šè¯‰ç¼–è¯‘å™¨ç›¸å…³ä¿¡æ¯, è‹¥æ¥å£æœ‰å¤šä¸ª abstract methods, é‚£ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™, å¸¸è§çš„ functional interface æœ‰: Runnable, ActionListener, and Comparable, ä¸¾ä¸ªä¾‹å­, Java åˆ›å»ºçº¿ç¨‹ä¸€èˆ¬å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 public class Main { public static void main(String[] args) { // Creating and starting a thread using lambda expression Thread myThread = new Thread(() -\u0026gt; { // Code to be executed in the thread System.out.println(\u0026#34;Thread is running\u0026#34;); }); myThread.start(); } } ä½ çœ‹ Thread() çš„æ„é€ æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ª lambda è¡¨è¾¾å¼, æˆ‘ä»¬å»çœ‹çœ‹å…¶å‡½æ•°åŸå‹,\n1 2 3 public Thread(Runnable task) { ... } æ­¤æ—¶ä¸ç”¨çœ‹, Runnable è‚¯å®šæ˜¯ä¸ª functional interface, ä¸ç„¶æ˜¯æ²¡åŠæ³•æ¥å— lambdaçš„,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 /** * Represents an operation that does not return a result. * * \u0026lt;p\u0026gt; This is a {@linkplain java.util.function functional interface} * whose functional method is {@link #run()}. * * @author Arthur van Hoff * @see java.util.concurrent.Callable * @since 1.0 */ @FunctionalInterface public interface Runnable { /** * Runs this operation. */ void run(); } å…·ä½“å‚è€ƒä¸‹é¢è¿™ä¸ªè§†é¢‘, è®²çš„å¾ˆå¥½:\n{% youtube tj5sLSFjVj4 %}\nç»†å“è¿™å¥è¯:\nOne of the most welcome changes in Java 8 was the introduction of lambda expressions, as these allow us to forego anonymous classes, greatly reducing boilerplate code and improving readability. Method References in Java\nBack in ye olden times before Java 8, we had to use the clunky old anonymous class syntax for this sort of thing, leading to code that looked something like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 object.gimmeFunction(new SingleMethodInterface(){ @Override public bool really(int n){ return n==\u0026#34;really\u0026#34;.hashCode(); } }); Collections.sort(emplyeesList, new Comparator() { public int compare(Employee a1, Employee a2){ return a1.getId().compareTo(a2.getId()); }}); File[] hiddenFiles = new File(\u0026#34;directory_name\u0026#34;).listFiles(new FileFilter() { public boolean accept(File file) { return file.getName().endsWith(\u0026#34;.xml\u0026#34;); }}); // With lambda: File[] hiddenFiles = new File(\u0026#34;directory_name\u0026#34;).listFiles( file -\u0026gt; file.getName().endsWith(\u0026#34;.xml\u0026#34;)); å¦å¤– Functional Interface ä¹Ÿå¤šç”¨åœ¨è¿”å›å€¼, å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 @FunctionalInterface public interface ApplicationListener\u0026lt;E extends ApplicationEvent\u0026gt; extends EventListener {...}; @Bean // ApplicationListener\u0026lt;AuthenticationSuccessEvent\u0026gt; æ˜¯ä¸ª functional interface // æ‰€ä»¥è¯¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸ª lambda expression public ApplicationListener\u0026lt;AuthenticationSuccessEvent\u0026gt; successListener() { return event -\u0026gt; System.out.printf( \u0026#34;\\uD83C\\uDF89 Success [%s] %s %n\u0026#34;, event.getAuthentication().getClass().getName(), event.getAuthentication().getName() ); } äº†è§£æ›´å¤š:\nlambda - What did Java programmers do before Java 8 if they wanted to pass a function around? - Stack Overflow\nLambda Expressions Before And After Java 8 - Java Code Geeks - 2023\n","date":"2023-08-06T12:03:53Z","permalink":"https://blog.yorforger.cc/p/functional-interfaces-anonymous-classes-lambda-expressions-java/","title":"Functional Interfaces \u0026 Anonymous Classes \u0026 Lambda Expressions - Java"},{"content":" # 1. java.lang.Object å®šä¹‰:\n1 public class Object {...} The java.lang.Object class is the root of the class hierarchy. Every class has Object as a superclass. æ‰€æœ‰çš„ç±»(åŒ…æ‹¬è‡ªå®šä¹‰ç±»)éƒ½è‡ªåŠ¨ç»§æ‰¿äº†ç±» java.lang.Object, ä½ å¯ä»¥è‡ªå·±åˆ›å»ºä¸ªç±», ç„¶åæŸ¥çœ‹å…¶å¯¹è±¡å¯è°ƒç”¨çš„æ–¹æ³•, å¦‚ä¸‹:\nå¯ä»¥çœ‹åˆ°ä¸€äº›æ–¹æ³•å¦‚ equals(), getClass(), è¿™éƒ½æ˜¯ Cat ç»§æ‰¿è‡ªç±» Object æ‰€å¾—,\n1 public final Class\u0026lt;?\u0026gt; getClass() äº†è§£æ›´å¤š: Object (Java Platform SE 8 ),\n# 2. java.lang.Class Class å®šä¹‰å¦‚ä¸‹ (æ³¨æ„åŒºåˆ† Class å’Œ class, å‰è€…æ˜¯ç±», åè€…æ˜¯å…³é”®å­—):\n1 2 3 public final class Class\u0026lt;T\u0026gt; extends Object implements Serializable, GenericDeclaration, Type, AnnotatedElement ä¸ java.lang.Objetc ä¸åŒ, java.lang.Class æ˜¯ final çš„, æ‰€ä»¥æ²¡æœ‰ç±»å¯ä»¥ç»§æ‰¿å®ƒ, è€Œä¸”å®ƒå”¯ä¸€çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„, è¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½é€šè¿‡æ­£å¸¸çš„æ–¹å¼æ¥åˆ›å»º Class çš„å¯¹è±¡.\næ³¨æ„ java.lang.Class æ˜¯æ³›å‹ç±», å› æ­¤æˆ‘ä»¬ç»å¸¸å¯ä»¥è§åˆ°ç±»ä¼¼ Class\u0026lt;?\u0026gt; xxx = cat.getClass() çš„å£°æ˜,\n# 2.1. java.lang.Class ä¸ºä½•å­˜åœ¨ å…¶å®åˆšå¼€å§‹ä¸€ç›´æƒ³ä¸æ˜ç™½ç±» java.lang.Class åˆ°åº•æ˜¯ä»€ä¹ˆ, ä¸ºä»€ä¹ˆå­˜åœ¨?\nå› ä¸ºåœ¨æˆ‘çš„å°è±¡é‡Œ, ä¸€ä¸ªæ³›å‹ç±»ä¸€èˆ¬éƒ½æ˜¯ä½œä¸º collection å­˜åœ¨, å¦‚ ArrayList, List ç­‰, ä»–ä»¬ä½¿ç”¨æ³›å‹æ˜¯ä¸ºäº†ä»£ç çš„ reuse, æ¯”å¦‚å­˜ string, Integer, ç­‰, ä½†æ˜¯ java.lang.Class å‘¢? å®ƒåˆä¸æ˜¯ collection, ä¸ºä»€ä¹ˆè¦ç”¨æ³›å‹å‘¢?\næˆ‘ç°åœ¨çš„ç†è§£æ˜¯ java.lang.Class æ˜¯ä¸€ä¸ªç±»çš„åŒ…è£…å™¨, ä¹Ÿæ˜¯ä¸ºäº†ä»£ç çš„ reuse, æŸ¥çœ‹ java.lang.Class çš„æ–¹æ³•:\ngetClassLoader(), getDeclaredMethods(), getFields() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 class Employee extends Person { ... ... } public class Main { public static void main(String[] args) throws NoSuchFieldException { Class\u0026lt;?\u0026gt; myClass = Employee.class; System.out.println(\u0026#34;Name: \u0026#34; + myClass.getName()); System.out.println(\u0026#34;Simple name: \u0026#34; + myClass.getSimpleName()); System.out.println(\u0026#34;Superclass: \u0026#34; + myClass.getSuperclass()); System.out.println(\u0026#34;Interfaces: \u0026#34; + Arrays.toString(myClass.getInterfaces())); System.out.println(\u0026#34;Methods: \u0026#34; + Arrays.toString(myClass.getMethods())); System.out.println(\u0026#34;Fields\u0026#34; + Arrays.toString(myClass.getFields())); } } ä¸éš¾å‘ç°æ‰€æœ‰çš„ç±»éƒ½å¯ä»¥ç”¨åˆ°è¿™äº›æ–¹æ³•, è¿™ä¹Ÿæ˜¯åå°„çš„æ ¹åŸº, runtime çš„æ—¶å€™ç”¨æ¥è·å–æŸä¸ªç±»çš„ä¿¡æ¯, åœ¨ä»‹ç» java.lang.Object çš„æ—¶å€™, Object çš„ä¸€ä¸ªæ–¹æ³•å¦‚ä¸‹:\n1 public final Class\u0026lt;?\u0026gt; getClass() è¿™ä¸ªè¿”å›å€¼ Class\u0026lt;?\u0026gt; ä»£è¡¨ä»€ä¹ˆ? ä»£è¡¨æ–¹æ³•å¯ä»¥è¿”å› getClass() ä»»ä½•ç±»å‹çš„å¯¹è±¡, å¦‚ Class\u0026lt;Integer\u0026gt;, Class\u0026lt;String\u0026gt;, or Class\u0026lt;Object\u0026gt;. ä½ å¯èƒ½ä¼šåé©³, ä¸æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡å•Š, ä½ çœ‹ä½ è¿”å›çš„æ˜¯ Class\u0026lt;Integer\u0026gt; è€Œä¸å¯ä»¥è¿”å› Integer çš„å¯¹è±¡, ummm, åˆ«å¿˜äº†å‰é¢è¯´çš„, java.klang.Class æ˜¯ä½œä¸ºä¸€ä¸ªç±»é¢åŒ…è£…å™¨å­˜åœ¨çš„, ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·çš„ä¸€ä¸ªç±»åŒ…è£…å™¨? å› ä¸ºåå°„æœºåˆ¶,\nEvery time JVM creates an object , it also creates a java.lang.Class object that describes the type of the object . All instances of the same class share the same java.lang.Class object and you can obtain the java.lang.Class object by calling the getClass() method of the object. This method is inherited from java.lang.Object class . è¿™é‡Œè¯´çš„å¾ˆæ™•å„ç§ object, æ¯”å¦‚ä¸€ä¸ªç±» Cat, å½“ä½ ç¬¬ä¸€æ¬¡åˆ›å»º Cat çš„å¯¹è±¡æ—¶, å¦‚ cat_1, æ­¤æ—¶ä¸€ä¸ª java.lang.Class çš„å¯¹è±¡å°±ä¼šè¢«åˆ›å»º, ç±»å‹æ˜¯ Class\u0026lt;Cat\u0026gt; ç”¨æ¥æè¿°ç±» Cat, ä¹‹åä½ æƒ³è·å¾—åˆšè¢«åˆ›å»ºçš„è¿™ä¸ª java.lang.Class çš„å¯¹è±¡(ç±»å‹ä¸ºClass\u0026lt;Cat\u0026gt; ) , ä½ å¯ä»¥è°ƒç”¨ getClass() æ–¹æ³•, å³ cat_1.getClass(), æ­¤æ—¶åˆšå¥½è¯´æ˜äº†æ³›å‹ wildcard çš„é‡è¦æ€§, å³ getClass() çš„è¿”å›å€¼ç±»å‹åªèƒ½æ˜¯ Class\u0026lt;?\u0026gt; , å¦åˆ™å½“ä½ å†åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡å¦‚ Dog çš„æ—¶å€™, éš¾é“è¿˜è¦å†å¦é‡è½½ä¸ª getClass() å‡½æ•°å—? å³: public final Class\u0026lt;Cat\u0026gt; getClass(), public final Class\u0026lt;Dog\u0026gt; getClass(), è¿™ä¹Ÿå¤ªç¦»è°±äº†,\nWhen a class (say, Cat) is accessed for the very first time (e.g., say an instance of it is created ~ new Hello()), then class loader (a component of JVM) loads it (the bytecodes) and creates an instance of java.lang.Class that represents the class in context, i.e., Cat. Thereafter, when you are creating an object of that same class (Cat), this java.lang.Class instance would be used by JVM to create the object. This java.lang.Class object is also the entry point to use reflection and it can also be used to get meta-information about the class like the class name, super-class name, etc.\n# 2.2. ä¸ºä»€ä¹ˆéœ€è¦åå°„ We need java.lang.Class.forName() and java.lang.Class.newInstance() because many times it happens that we don\u0026rsquo;t know the name of the class to instantiate while writing code , we may get it from config files , database , network or from any Java application . This is the reflective way of creating an object which is one of the most powerful feature of Java and which makes way for many frameworks e.g. Spring , Struts which uses Java reflection .\nCan you create an object without using new operator in Java?\n1 2 Class c = Class.forName(\u0026#34;java.lang.String\u0026#34;); String object = (String) c.newInstance(); # 3. Creating a java.lang.Class object # 3.1. Class.forName() Since class Class doesnâ€™t contain any constructor, there is static factory method present in class Class, which is Class.forName(), used for creating object of class Class. Below is the syntax :\n1 2 3 4 5 6 7 8 public class Main { public static void main(String[] args) throws ClassNotFoundException { String nameOfClass = \u0026#34;Employee\u0026#34;; Class\u0026lt;?\u0026gt; cls = Class.forName(nameOfClass); ClassLoader cLoader = cls.getClassLoader(); System.out.println(cLoader); } } # 3.2. Myclass.class Please note that this method is used with class name, not with class instances.\n# 3.3. obj.getClass() obj.getClass()å®šä¹‰åœ¨java.lang.Object.javaä¸‹:\n1 2 3 4 5 public final native Class\u0026lt;?\u0026gt; getClass(); e.g., A a = new A(); // Any class A Class c = a.getClass(); å‚è€ƒ:\njava lang Class Class - java.lang.Class Class in Java https://qr.ae/pyJqWx ","date":"2023-08-05T19:47:51Z","permalink":"https://blog.yorforger.cc/p/java.lang.object-java.lang.class/","title":"java.lang.Object \u0026 java.lang.Class"},{"content":" # 1. Why Generics? è‡³äºæ³›å‹æé«˜ç±»å‹å®‰å…¨æ€§çš„è¯é¢˜, æš‚ä¸è®¨è®º, è¿™å¤ªå“²å­¦äº†, åªä¸¾ä¾‹å­, æ²¡æœ‰æ³›å‹ä¹‹å‰, è€ƒè™‘å¦‚ä½•å®ç°ä¸€ä¸ªå®¹å™¨(å¯ä»¥è£…æ‰€æœ‰çš„ç±»å‹), æç¤º, å¯ä»¥ç”¨ Object ç±»,\nå…·ä½“å®ç°å¯å‚è€ƒ: Java Array | æ©˜çŒ«å°å…«çš„é±¼,\nå¯ä»¥çœ‹å‡º, åœ¨ retrieve æ•°æ®çš„æ—¶å€™, æ¯æ¬¡éƒ½éœ€è¦ type cast, è¿™å¾ˆéº»çƒ¦ä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™, ä¹Ÿä¸ä¼˜é›…,\nä½¿ç”¨æ³›å‹å®ç°ä¸€ä¸ªç®€å•çš„å®¹å™¨, å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 class MyContainer\u0026lt;T\u0026gt; { private static final int DEFAULT_CAPACITY = 10; private int size; private Object[] elements; public MyContainer() { elements = new Object[DEFAULT_CAPACITY]; size = 0; } public void addItem(T element) { if (size \u0026lt; elements.length) { elements[size] = element; size++; } else { // Handle array resizing or throw an exception } } @SuppressWarnings(\u0026#34;unchecked\u0026#34;) public T get(int index) { if (index \u0026lt; 0 || index \u0026gt;= size) { // handle exception } return (T) elements[index]; } } public class Main { public static void main(String []args){ MyContainer\u0026lt;String\u0026gt; container = new MyContainer\u0026lt;\u0026gt;(); container.addItem(\u0026#34;Hello\u0026#34;); // container.addItem(2); // this will cause error String str_1 = container.get(0); // no need to explicit cast System.out.println(str_1); } } æ­¤æ¬¡å­¦æ³›å‹ä¸»è¦æ˜¯ä¸ºäº†é˜…è¯»æºç , å¸¸è§ç¬¦å·:\nE: Element K: Key N: Number T: Type V: Value S,U,V etc. - 2nd, 3rd, 4th types\n# 2. Bounded Types Oftentimes there are cases where we need to specify a generic type, but we want to control which types can be specified, rather than keeping the gate wide open. Bounded types can be used to restrict the bounds of the generic type by specifying the extends or the super keyword in the type parameter section to restrict the type by using an upper bound or lower bound, respectively.\n1 2 3 \u0026lt;T extends UpperBoundType\u0026gt; \u0026lt;T super LowerBoundType\u0026gt; e.g.,\n1 2 3 4 5 6 7 8 public class GenericNumberContainer \u0026lt;T extends Number\u0026gt; { // ... } GenericNumberContainer\u0026lt;Integer\u0026gt; gn = new GenericNumberContainer\u0026lt;Integer\u0026gt;(); gn.setObj(3); // Type argument String is not within the upper bounds of type variable T GenericNumberContainer\u0026lt;String\u0026gt; gn2 = new GenericNumberContainer\u0026lt;String\u0026gt;(); # 3. Wildcards In some cases, it is useful to write code that specifies an unknown type. The question mark (?) wildcard character can be used to represent an unknown type using generic code. Wildcards can be used with parameters, fields, local variables, and return types. However, it is a best practice to not use wildcards in a return type, because it is safer to know exactly what is being returned from a method.\nConsider the case where we would like to write a method to verify whether a specified object exists within a specified List. We would like the method to accept two arguments: a List of unknown type as well as an object of any type.\n1 2 3 4 5 6 7 public static \u0026lt;T\u0026gt; void checkList(List\u0026lt;?\u0026gt; myList, T obj){ if(myList.contains(obj)){ System.out.println(\u0026#34;The list contains the element: \u0026#34; + obj); } else { System.out.println(\u0026#34;The list does not contain the element: \u0026#34; + obj); } } Oftentimes wildcards are restricted using upper bounds or lower bounds. Much like specifying a generic type with bounds, for example, if we wanted to alter the checkList method to accept only Lists that extend the Number type,\n1 2 3 4 5 6 7 8 9 public static \u0026lt;T\u0026gt; void checkNumber(List\u0026lt;? extends Number\u0026gt; myList, T obj){ if(myList.contains(obj)){ System.out.println(\u0026#34;The list \u0026#34; + myList + \u0026#34; contains the element: \u0026#34; + obj); } else { System.out.println(\u0026#34;The list \u0026#34; + myList + \u0026#34; does not contain the element: \u0026#34; + obj); } } # 3.1. Wildcards vs Object Now, since Object is the inherent super-type of all types in Java, we would be tempted to think that it can also represent an unknown type. In other words, List\u003c?\u003e and List could serve the same purpose. But they don\u0026rsquo;t.\n1 2 3 4 5 6 7 8 9 10 11 public static void printListObject(List\u0026lt;Object\u0026gt; list) { for (Object element : list) { System.out.print(element + \u0026#34; \u0026#34;); } } public static void printListWildCard(List\u0026lt;?\u0026gt; list) { for (Object element: list) { System.out.print(element + \u0026#34; \u0026#34;); } } Given a list of Integers, say:\n1 List\u0026lt;Integer\u0026gt; li = Arrays.asList(1, 2, 3); printListObject(li) will not compile, and we\u0026rsquo;ll get this error:\n1 The method printListObject() is not applicable for the arguments (List\u0026lt;Integer\u0026gt;) Whereas printListWildCard(li) will compile and will output 1 2 3 to the console.\n# 3.2. Wildcards vs T 1 2 3 4 // æŒ‡å®šé›†åˆå…ƒç´ åªèƒ½æ˜¯T ç±»å‹ List\u0026lt;T\u0026gt; list=new ArrayList\u0026lt;T\u0026gt;(); // é›†åˆå…ƒç´ å¯ä»¥æ˜¯ä»»æ„ç±»å‹, è¿™ç§æ²¡æœ‰æ„ä¹‰, wildcard ç»å¸¸ç”¨åœ¨æ–¹æ³•çš„å½¢å‚å£°æ˜ä¸­, åœ¨è¿™åªæ˜¯ä¸ºäº†è¯´æ˜ç”¨æ³• List\u0026lt;?\u0026gt; list=new ArrayList\u0026lt;?\u0026gt;(); ï¼Ÿå’Œ T éƒ½è¡¨ç¤ºä¸ç¡®å®šçš„ç±»å‹ï¼ŒåŒºåˆ«åœ¨äºæˆ‘ä»¬å¯ä»¥å¯¹ T è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯å¯¹ ? ä¸è¡Œï¼š\n1 2 T t = operate(); // å¯ä»¥ ï¼Ÿ car = operate(); // ä¸å¯ä»¥ T æ˜¯ä¸€ä¸ª ç¡®å®šçš„ ç±»å‹, é€šå¸¸ç”¨äºæ³›å‹ç±»å’Œæ³›å‹æ–¹æ³•çš„å®šä¹‰, ï¼Ÿæ˜¯ä¸€ä¸ª ä¸ç¡®å®š çš„ç±»å‹, é€šå¸¸ç”¨äºå£°æ˜æ³›å‹æ–¹æ³•çš„å½¢å‚, è¿”å›å€¼, æˆ–åˆ›å»ºå˜é‡å¦‚Class\u0026lt;?\u0026gt; xxx = cat.getClass(),\nå¦‚æœè¿˜æ— æ³•ç†è§£å¯ä»¥å‚è€ƒ: java.lang.Object \u0026amp; java.lang.Class | æ©˜çŒ«å°å…«çš„é±¼\n# 4. Type Erasure Java generics only exit during compile time. Javaçš„æ³›å‹åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ç¼–è¯‘å™¨è¿™ä¸ªå±‚æ¬¡ä¸Šå®ç°çš„ï¼Œåœ¨ç”Ÿæˆçš„ bytecode ä¸­ä¸åŒ…å«æ³›å‹ä¸­çš„ç±»å‹ä¿¡æ¯çš„ï¼Œä½¿ç”¨æ³›å‹çš„æ—¶å€™åŠ ä¸Šç±»å‹å‚æ•°ï¼Œåœ¨ç¼–è¯‘å™¨ç¼–è¯‘çš„æ—¶å€™ä¼šdiscardï¼Œè¿™ä¸ªè¿‡ç¨‹æˆä¸ºtype erasure\n# 4.1. é€šè¿‡ä¸¤ä¸ªä¾‹å­è¯æ˜Javaç±»å‹çš„ç±»å‹æ“¦é™¤ åŸå§‹ç±»å‹ç›¸ç­‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 public class Test { public static void main(String[] args) { ArrayList\u0026lt;String\u0026gt; list1 = new ArrayList\u0026lt;String\u0026gt;(); list1.add(\u0026#34;abc\u0026#34;); ArrayList\u0026lt;Integer\u0026gt; list2 = new ArrayList\u0026lt;Integer\u0026gt;(); list2.add(123); System.out.println(list1.getClass() == list2.getClass()); } } é€šè¿‡åå°„æ·»åŠ å…¶å®ƒç±»å‹å…ƒç´  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class Test { public static void main(String[] args) throws Exception { ArrayList\u0026lt;Integer\u0026gt; list = new ArrayList\u0026lt;Integer\u0026gt;(); list.add(1); //è¿™æ ·è°ƒç”¨ add æ–¹æ³•åªèƒ½å­˜å‚¨æ•´å½¢ï¼Œå› ä¸ºæ³›å‹ç±»å‹çš„å®ä¾‹ä¸º Integer list.getClass().getMethod(\u0026#34;add\u0026#34;, Object.class).invoke(list, \u0026#34;asd\u0026#34;); for (int i = 0; i \u0026lt; list.size(); i++) { System.out.println(list.get(i)); } } } # 4.2. ç±»å‹æ“¦é™¤åä¿ç•™çš„åŸå§‹ç±»å‹ åœ¨ä¸Šé¢ï¼Œä¸¤æ¬¡æåˆ°äº†åŸå§‹ç±»å‹ï¼Œä»€ä¹ˆæ˜¯åŸå§‹ç±»å‹ï¼Ÿ\nåŸå§‹ç±»å‹ å°±æ˜¯æ“¦é™¤å»äº†æ³›å‹ä¿¡æ¯, æœ€ååœ¨å­—èŠ‚ç ä¸­çš„ç±»å‹å˜é‡çš„çœŸæ­£ç±»å‹, æ— è®ºä½•æ—¶å®šä¹‰ä¸€ä¸ªæ³›å‹ï¼Œç›¸åº”çš„åŸå§‹ç±»å‹éƒ½ä¼šè¢«è‡ªåŠ¨æä¾›ï¼Œç±»å‹å˜é‡æ“¦é™¤ï¼Œå¹¶ä½¿ç”¨å…¶bound typeï¼ˆunbounded typeçš„å˜é‡ç”¨Objectï¼‰æ›¿æ¢,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public class Pair\u0026lt;T\u0026gt; { private T value; public T getValue() { return value; } public void setValue(T value) { this.value = value; } } // Pairçš„åŸå§‹ç±»å‹ä¸º public class Pair { private Object value; public Object getValue() { return value; } public void setValue(Object value) { this.value = value; } } å› ä¸ºåœ¨Pair\u0026lt;T\u0026gt;ä¸­ï¼ŒT æ˜¯ä¸€ä¸ªæ— é™å®šçš„ç±»å‹å˜é‡ï¼Œæ‰€ä»¥ç”¨Objectæ›¿æ¢ï¼Œå…¶ç»“æœå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œä½†å¦‚æœç±»å‹å˜é‡æ˜¯boundï¼Œé‚£ä¹ˆåŸå§‹ç±»å‹å°±ç”¨ç¬¬ä¸€ä¸ªè¾¹ç•Œçš„ç±»å‹å˜é‡ç±»æ›¿æ¢ã€‚\næ¯”å¦‚: Pairè¿™æ ·å£°æ˜çš„è¯, é‚£ä¹ˆåŸå§‹ç±»å‹å°±æ˜¯Comparable\n1 public class Pair\u0026lt;T extends Comparable\u0026gt; {} # 5. ç±»å‹æ“¦é™¤å¼•èµ·çš„é—®é¢˜åŠè§£å†³æ–¹æ³• # 5.1. è‡ªåŠ¨ç±»å‹è½¬æ¢ å› ä¸ºç±»å‹æ“¦é™¤çš„é—®é¢˜ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ³›å‹ç±»å‹å˜é‡æœ€åéƒ½ä¼šè¢«æ›¿æ¢ä¸ºåŸå§‹ç±»å‹ã€‚\næ—¢ç„¶éƒ½è¢«æ›¿æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è·å–get()çš„æ—¶å€™ï¼Œä¸éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢å‘¢ï¼Ÿå› ä¸ºget()å·²ç»å¸®æˆ‘ä»¬castäº†.\nçœ‹ä¸‹ArrayList.get()æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 public E get(int index) { Objects.checkIndex(index, size); return elementData(index); } E elementData(int index) { return (E) elementData[index]; } # 5.2. æ³›å‹ç±»å‹å˜é‡ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ 1 2 ArrayList\u0026lt;int\u0026gt; arr; //error ArrayList\u0026lt;Integer\u0026gt; arr; ä¸èƒ½ç”¨ç±»å‹å‚æ•°æ›¿æ¢åŸºæœ¬ç±»å‹ã€‚å°±æ¯”å¦‚ï¼Œæ²¡æœ‰ArrayList\u0026lt;double\u0026gt;ï¼Œåªæœ‰ArrayList\u0026lt;Double\u0026gt;ã€‚å› ä¸ºå½“ç±»å‹æ“¦é™¤åï¼ŒArrayListçš„åŸå§‹ç±»å‹å˜ä¸ºObjectï¼Œä½†æ˜¯Objectç±»å‹ä¸èƒ½å­˜å‚¨doubleå€¼ï¼Œåªèƒ½å¼•ç”¨Doubleçš„å€¼ã€‚\n# 5.3. æ³›å‹åœ¨é™æ€æ–¹æ³•å’Œé™æ€ç±»ä¸­çš„é—®é¢˜ 1 2 3 4 5 6 public class Test2\u0026lt;T\u0026gt; { public static T one; //ç¼–è¯‘é”™è¯¯ public static T show(T one){ //ç¼–è¯‘é”™è¯¯ return null; } } å› ä¸ºæ³›å‹ç±»ä¸­çš„æ³›å‹å‚æ•°çš„å®ä¾‹åŒ–æ˜¯åœ¨å®šä¹‰å¯¹è±¡çš„æ—¶å€™æŒ‡å®šçš„ï¼Œè€Œé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ä¸éœ€è¦ä½¿ç”¨å¯¹è±¡æ¥è°ƒç”¨ã€‚å¯¹è±¡éƒ½æ²¡æœ‰åˆ›å»ºï¼Œå¦‚ä½•ç¡®å®šè¿™ä¸ªæ³›å‹å‚æ•°æ˜¯ä½•ç§ç±»å‹ï¼Œæ‰€ä»¥å½“ç„¶æ˜¯é”™è¯¯çš„ã€‚\nä½†æ˜¯è¦æ³¨æ„åŒºåˆ†ä¸‹é¢çš„ä¸€ç§æƒ…å†µï¼š\n1 2 3 4 5 public class Test2\u0026lt;T\u0026gt; { public static \u0026lt;T \u0026gt;T show(T one){ //è¿™æ˜¯æ­£ç¡®çš„ return null; } } å› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œåœ¨æ³›å‹æ–¹æ³•ä¸­ä½¿ç”¨çš„Tæ˜¯è‡ªå·±åœ¨æ–¹æ³•ä¸­å®šä¹‰çš„ Tï¼Œè€Œä¸æ˜¯æ³›å‹ç±»ä¸­çš„T\nå‚è€ƒ:\nGenerics: How They Work and Why They Are Important https://www.cnblogs.com/wuqinglong/p/9456193.html èŠä¸€èŠ-JAVA æ³›å‹ä¸­çš„é€šé…ç¬¦ Tï¼ŒEï¼ŒKï¼ŒVï¼Œï¼Ÿ - æ˜é‡‘ ","date":"2023-08-05T18:44:52Z","permalink":"https://blog.yorforger.cc/p/java-generics/","title":"Java Generics"},{"content":"å…³äº type safety, ä¸€ç›´æ²¡æœ‰ä¸€ä¸ªç¡®åˆ‡çš„å®šä¹‰, æ¯ä¸ªè¯­è¨€çš„ä½œè€…å¯¹ type safety å¯èƒ½æœ‰ä¸åŒçš„ç†è§£, æˆ‘æ¯”è¾ƒå–œæ¬¢çš„æ˜¯ç»´åŸºç™¾ç§‘å¯¹ type safety çš„å®šä¹‰, å³ type safety é˜»æ­¢æˆ–è€…ä½¿ type errors ä¸å®¹æ˜“å‘ç”Ÿ, è€Œä»€ä¹ˆæ˜¯ type errors åœ¨ä¸‹é¢è¿™æ®µè¯é‡Œä¹Ÿç»™å‡ºäº†å®šä¹‰:\nIn computer science, type safety is the extent to which a programming language discourages or prevents type errors. The behaviors classified as type errors are usually that result from attempts to perform operations on values that are not of the appropriate data type, e.g., adding a string to an integer when there\u0026rsquo;s no definition on how to handle this case. This classification is partly based on opinion. https://en.wikipedia.org/wiki/Type_safety\næ„Ÿè§‰ç»´åŸºç™¾ç§‘å¯¹ç±»å‹å®‰å…¨çš„å®šä¹‰ä¸ Why Rust ä¸€ä¹¦çš„ä½œè€…è§‚ç‚¹ä¸è°‹è€Œåˆ:\nIf a program has been written so that no possible execution can exhibit undefined behavior, we say that program is well defined. If a languageâ€™s type system ensures that every program is well defined, we say that language is type safe.\nundefined behavior: åœ¨ c99 çš„å®šä¹‰ä¸­, undefined behaviors æœ‰å¾ˆå¤š: å¦‚åˆ†æ¯ä¸º 0, è®¿é—®è¶…å‡ºæ•°ç»„å¤§å°çš„ä½ç½® (c æ˜¯æ²¡æœ‰è¶Šç•Œæ£€æŸ¥çš„), è®©ä¸€ä¸ªintèƒ½è¡¨ç¤ºçš„æœ€å¤§æ•°åŠ ä¸€,\n1 2 3 4 5 int main(int argc, char **argv) { unsigned long a[1]; a[3] = 0x7ffff7b36cebUL; return 0; } According to C99, because this program accesses an element off the end of the array a, its behavior is undefined, meaning that it can do anything whatsoever.\nA carefully written C or C++ program might be well defined, but C and C++ are not type safe: the program shown earlier has no type errors, yet exhibits undefined behavior. By contrast, Python is type safe. Python is willing to spend processor time to detect and handle out-of-range array indices in a friendlier fashion than C:\n1 2 3 4 5 6 \u0026gt;\u0026gt;\u0026gt; a = [0] \u0026gt;\u0026gt;\u0026gt; a[3] = 0x7ffff7b36ceb Traceback (most recent call last): File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; IndexError: list assignment index out of range \u0026gt;\u0026gt;\u0026gt; Python raised an exception, which is not undefined behavior: the Python documentation specifies that the assignment to a[3] should raise an IndexError exception, as we saw. Certainly, a module like ctypes that provides unconstrained access to the machine can introduce undefined behavior into Python, but the core language itself is type safe. Java, JavaScript, Ruby, and Haskell are similar in this way.\nNote that being type safe is independent of whether a language checks types at compile time or at runtime: C checks at compile time, and is not type safe; Python checks at runtime, and is type safe.\nä»¥ä¸Šè®¨è®ºæ¥è‡ª: Why Rust Chapter 1 , æ„Ÿå…´è¶£å¯ä»¥è‡ªå·±ç¿»é˜…,\n","date":"2023-08-05T18:32:53Z","permalink":"https://blog.yorforger.cc/p/type-safety-from-why-rusy-jim-blandy/","title":"Type Safety from Why Rusy - Jim Blandy"},{"content":"ä¸¤ç‚¹å¾ˆé‡è¦:\nArrays are objects in Java, we can find their length using the object property length. This is different from C/C++, where we find length using sizeof(). The length of an array is established when the array is created. After creation, its length is fixed. However, an array reference can be made to point to another array. æ•°ç»„è¿›è¡Œæ’åºçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ Arrays ç±»æä¾›çš„ sort() æ–¹æ³•:\n1 2 int[] anArray = new int[] {5, 2, 1, 4, 8}; Arrays.sort(anArray); æœ‰æ—¶è¦ä»æ•°ç»„ä¸­æŸ¥æ‰¾æŸä¸ªå…·ä½“çš„å…ƒç´ , å¦‚æœæ•°ç»„æå‰è¿›è¡Œäº†æ’åºå°±å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•,\n1 2 int[] anArray = new int[] {1, 2, 3, 4, 5}; int index = Arrays.binarySearch(anArray, 4); åœ¨æ²¡æœ‰èŒƒå‹å‡ºç°çš„æ—¶å€™, å®¹å™¨ä¸€èˆ¬åˆ©ç”¨ Object å®ç°, ç¼ºç‚¹æ˜¾è€Œæ˜“è§, æ¯æ¬¡å–å‡ºæ•°æ®éƒ½éœ€è¦å¼ºåˆ¶è½¬æ¢, è¿™å°±å®¹æ˜“å‡ºç°å› å¿˜è®°æ˜¾ç¤ºè½¬æ¢ç±»å‹æˆ–è½¬æ¢é”™ç±»å‹è€Œå¯¼è‡´çš„ç±»å‹ç›¸å…³é”™è¯¯, å³é™ä½äº† Java çš„ type safety, å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 public class Main { public static void main(String []args){ MyContainer container = new MyContainer(6); container.addItem(\u0026#34;Hello\u0026#34;); container.addItem(42); container.addItem(true); // We have to cast and must cast the correct type to avoid ClassCastException! String str = (String) container.getItem(0); int number = (int) container.getItem(1); boolean bool = (boolean) container.getItem(2); System.out.println(str); System.out.println(number); System.out.println(bool); } } class MyContainer { private Object[] items; private int size; public MyContainer(int capacity) { size = 0; items = new Object[capacity]; } public int getSize() { return size; } public void addItem(Object item) { if (size \u0026lt; items.length) { items[size] = item; size++; } else { // Handle array resizing or throw an exception System.out.println(\u0026#34;Error: array is full.\u0026#34;); } } public Object getItem(int index) { if (index \u0026gt;= 0 \u0026amp;\u0026amp; index \u0026lt; items.length) { return items[index]; } else { // Handle index out of bounds or throw an exception return null; } } } ","date":"2023-08-05T16:14:53Z","permalink":"https://blog.yorforger.cc/p/java-array/","title":"Java Array"},{"content":" # 0. é¡¹ç›®ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 â””â”€â”€ src â”œâ”€â”€ main â”‚Â â”œâ”€â”€ java â”‚Â â”‚Â â””â”€â”€ david â”‚Â â”‚Â â””â”€â”€ zhu â”‚Â â”‚Â â”œâ”€â”€ SpringSecurityDemoApplication.java â”‚Â â”‚Â â”œâ”€â”€ WebController.java â”‚Â â”‚Â â””â”€â”€ WebSecurityConfig.java â”‚Â â””â”€â”€ resources â”‚Â â”œâ”€â”€ application.yaml â”‚Â â”œâ”€â”€ static â”‚Â â””â”€â”€ templates ä¾‹å­åœ°å€: https://github.com/shwezhu/springboot-learning/tree/master/spring-security-get-started-demo\n# 1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ spring boot é¡¹ç›® - Controller ç±» åˆ›å»ºä¸€ä¸ª spring é¡¹ç›®æ€è·¯, é¦–å…ˆè¦æƒ³åˆ°åˆ›å»ºçš„ä¸€ä¸ªç±»æ˜¯ Controller, å› ä¸ºæˆ‘ä»¬è¦å¤„ç†ä¸åŒçš„ endpoints, æ¯”å¦‚å« WebController.java, åå­æ— æ‰€è°“, åªè¦åŠ ä¸Š @Controller/@RestController çš„ç±»éƒ½æ˜¯ Controller, ç„¶åè€ƒè™‘ä½ çš„è¿™ä¸ª Controller æ˜¯è¦è¿”å›ç®€å•çš„ json å¯¹è±¡è¿˜æ˜¯ web é¡µé¢, å‰è€…çš„è¯å°±é€‰æ‹© @RestController ä¿®é¥°ä½ çš„ Controller, è‡³äºè¿™ä¸¤ä¸ªæ³¨è§£çš„åŒºåˆ«, å¯ä»¥å‚è€ƒ: Spring Booté¡¹ç›®åŠè¸©å‘æ€»ç»“ Springå­¦ä¹ (ä¸€)\nåˆ›å»ºä¸€ä¸ªç®€å•çš„ spring boot é¡¹ç›®, ä¾èµ–åªé€‰æ‹© spring web, ä¹‹åæ…¢æ…¢æ·»åŠ å„ç§ä¾èµ–, åˆ›å»ºä¸€ä¸ªç®€å•çš„ Controller, å¦‚ä¸‹:\nç”±äºæ²¡æœ‰ä½¿ç”¨ spring security, ç°åœ¨è¿™ä¸¤ä¸ª endpoints éƒ½å¯ä»¥é€šè¿‡ http://localhost:8080/private æˆ– http://localhost:8080 è®¿é—®,\n# 2. ä½¿ç”¨ spring security ä¿æŠ¤ web application åœ¨é¡¹ç›®ä¸­æ·»åŠ  spring security ä¾èµ–, æ­¤ä¾‹ä½¿ç”¨çš„ gradle, å› æ­¤ç¼–è¾‘ build.gradle, æ·»åŠ :\n1 implementation \u0026#39;org.springframework.boot:spring-boot-starter-security\u0026#39; è‹¥ä½ ç”¨çš„maven, å¯ä»¥ç¼–è¾‘ pom.xml è¿›è¡Œæ·»åŠ ä¾èµ–, æ·»åŠ å®Œå reload é…ç½®ç„¶åç›´æ¥è¿è¡Œé¡¹ç›®, æ­¤æ—¶ä¸¤ä¸ªendpoints, / å’Œ /private éƒ½é»˜è®¤å—åˆ°äº†ä¿æŠ¤, éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®,\n1 2 3 4 5 6 7 8 9 # -v, --verbose: Makes the fetching more verbose/talkative. $ curl localhost:8080 -v ... \u0026gt; GET / HTTP/1.1 \u0026gt; Host: localhost:8080 \u0026gt; Accept: */* \u0026lt; HTTP/1.1 401 \u0026lt; Set-Cookie: JSESSIONID=9342C2B61BCD3507B78E3602EC448A59; Path=/; HttpOnly ... ä»è¾“å‡ºå¯ä»¥çœ‹åˆ° http code: 401,\n401 Unauthorized is the status code to return when the client provides no credentials or invalid credentials.\nåªæ·»åŠ äº† spring security ä¾èµ–, ç„¶åè¿è¡Œé¡¹ç›®, æˆ‘ä»¬çš„é¡µé¢å°±è¢«ä¿æŠ¤, ä¸å¾—ä¸è¯´ spring é»˜é»˜åœ°åœ¨èƒŒåå¸®æˆ‘ä»¬åšäº†å¾ˆå¤š, ä¹‹æ‰€ä»¥éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®é‚£ä¸¤ä¸ª endpointsçš„åŸå› æ˜¯åœ¨ spring securityä¸­ everything is secure by default, ä½†æˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¿™äº›é…ç½®,\nåœ¨è¿›è¡Œä¸‹ä¸€æ­¥çš„æ—¶å€™è¦æ³¨æ„, å³ä½¿æˆ‘ä»¬è¯•å›¾è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢æ¯”å¦‚ http://localhost:8080/foo , å¾—åˆ°çš„ä¾æ—§æ˜¯ 401 forbidden code, å³ä¼šç›´æ¥è·³å‡ºç™»å½•é¡µé¢, è€Œä¸æ˜¯å‘Šè¯‰ä½  404, é¡µé¢ä¸å­˜åœ¨, å³æ‰€æœ‰è®¿é—®æ­¤ç½‘å€çš„è¯·æ±‚éƒ½è¢« spring security æ‹¦æˆª, åªæœ‰ä½ æˆåŠŸç™»å½•, æ‰èƒ½è®¿é—®é¡µé¢, æ­¤æ—¶å› ä¸ºé¡µé¢ä¸å­˜åœ¨, ä½ å¾—åˆ°çš„æ˜¯ 404 code, æ³¨æ„æ­¤æ—¶é»˜è®¤ç”¨æˆ·åä¸º user, å¯†ç ä¼šåœ¨ç¨‹åºè¿è¡Œä¸­æ–­è¾“å‡º, å¯ä»¥å°è¯•ä¸€ä¸‹, å…·ä½“æ‹¦æˆªè¿‡ç¨‹å¦‚ä¸‹, å¯è§ä¸»è¦æ˜¯ SecurityFilterChain ç±»çš„ä½œç”¨,\nThis section examines how form-based login works within Spring Security. First, we see how the user is redirected to the login form:\nThe preceding figure builds off our SecurityFilterChain diagram:\nFirst, a user makes an unauthenticated request to the resource (/private) for which it is not authorized. Spring Securityâ€™s AuthorizationFilter indicates that the unauthenticated request is Denied by throwing an AccessDeniedException. Since the user is not authenticated, ExceptionTranslationFilter initiates Start Authentication and sends a redirect to the login page with the configured AuthenticationEntryPoint. In most cases, the AuthenticationEntryPoint is an instance of LoginUrlAuthenticationEntryPoint. The browser requests the login page to which it was redirected. Something within the application, must render the login page. è¿‡ç¨‹å¯å‚è€ƒ: Form Login :: Spring Security\n# 3. è‡ªå®šä¹‰ spring security - WebSecurityConfig ç±» æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ç”¨æ¥ä¿®æ”¹ spring security çš„é»˜è®¤é…ç½®, å³æŒ‡å®š spring security çš„è¡Œä¸º, æ¯”å¦‚æŒ‡å®šè®¿é—®å“ªä¸ªpageéœ€è¦è®¤è¯æ‰è¡Œ, æ”¯æŒä»€ä¹ˆæ–¹å¼ç™»å½•, å¦‚ form ç™»å½•, è°·æ­Œç™»å½•, ä»¥åŠç™»å‡ºè¡Œä¸ºå’Œè·å–ç”¨æˆ·ä¿¡æ¯(æˆ‘ä»¬ç™»å½•éœ€è¦æ¯”å¯¹ç”¨æˆ·ä¿¡æ¯å§, å¯†ç æ˜¯å¦åŒ¹é…ç­‰), æˆ‘æŠŠè¿™ä¸ªç±»å‘½åä¸º WebSecurityConfig.java, è¿™ä¹Ÿæ˜¯ç¬¬äºŒä¸ªé‡è¦çš„ç±», ç¬¬ä¸€ä¸ªæ˜¯ç¬¬ä¸€èŠ‚æˆ‘ä»¬è®²åˆ°çš„ Controller,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @Configuration @EnableWebSecurity public class WebSecurityConfig { @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { return http // authorizeHttpRequests(): Allows restricting access based upon the HttpServletRequest using RequestMatcher implementations (i.e. via URL patterns). .authorizeHttpRequests( authorizeHttp -\u0026gt; { // Method authenticated(): Specify that URLs are allowed by any authenticated user. authorizeHttp.requestMatchers(\u0026#34;/private\u0026#34;).authenticated(); // exempt all http request from authentication except for \u0026#34;/private\u0026#34; authorizeHttp.anyRequest().permitAll(); }) // Enable form login, if I need login, show me a form // without this, when you access page that needs authentication will get Whitelabel Error Page with code 403 .formLogin(withDefaults()) .build(); } // UserDetailsService, an interface, is used to retrieve user-related data. // It is used to retrieve user-related data from a data source, such as a database or a file for authentication and authorization purposes. // e.g., It has one method named loadUserByUsername() which can be overridden to customize the process of finding the user. // It is used by the DaoAuthenticationProvider to load details about the user during authentication. @Bean public UserDetailsService userDetailsService() { // We are using in memory user password for demo purpose return new InMemoryUserDetailsManager( User.builder() .username(\u0026#34;david\u0026#34;) // The {noop} prefix is a marker indicates that the password should be treated as plain text. .password(\u0026#34;{noop}asd\u0026#34;) .authorities(\u0026#34;ROLE_user\u0026#34;) .build() ); } } æ­¤æ—¶è®¿é—® http://localhost:8080/private , æˆ‘ä»¬ä¼šè¢«è‡ªåŠ¨è½¬åˆ°ç™»å½•é¡µé¢, è´¦å·å¯†ç ä¸å†æ˜¯ä¸Šé¢é‚£èŠ‚ç”±springè‡ªåŠ¨ç”Ÿæˆ, è€Œæ˜¯æˆ‘ä»¬è‡ªå·±åˆ¶å®šçš„, å¯ä»¥çœ‹ä»£ç ä¸­çš„æ³¨é‡Š, æ³¨æ„æ­¤æ—¶æˆ‘ä»¬ç”¨çš„ InMemoryUserDetailsManager ä¸€èˆ¬æ˜¯ä½œä¸ºdemoæ¥å±•ç¤º, å³åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶ç”¨æˆ·ç”¨äº form ç™»å½•, å®é™…å¼€å‘ è¦ä»æ•°æ®åº“æˆ–æ–‡ä»¶ä¸­è·å–ç”¨æˆ·çš„å¯†ç ä¿¡æ¯æ¥æ¯”å¯¹, å…·ä½“æ–¹æ³•ä¹‹åä¼šè®²,\nå¦‚æœæ­¤æ—¶ä½ æŒ‰ç…§ç¬¬äºŒèŠ‚æˆ‘ä»¬æ‰€åšçš„å»å°è¯•è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢, http://localhost:8080/foo ä¼šå¾—åˆ° Whitelabel Error Page with code 403, ä½ å¯ä»¥å°è¯•ä¸€ä¸‹, çœ‹çœ‹, è¿™å°±å’Œç¬¬äºŒèŠ‚æˆ‘ä»¬å¾—åˆ°çš„ç»“æœä¸åŒ, åœ¨ç¬¬äºŒèŠ‚ä¸­æˆ‘ä»¬ä¼šè¢«è·³è½¬åˆ°ç™»å½•é¡µé¢, è¿™æ˜¯å› ä¸ºä»€ä¹ˆå‘¢? ä¸ºä»€ä¹ˆç»“æœä¼šä¸ç›¸åŒ?\nè¿˜è®°å¾—ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ spring security çš„è®¾è®¡å“²å­¦æ˜¯ secure by default, å³åœ¨ç¬¬äºŒèŠ‚ä¸­æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹ä»»ä½• spring securityçš„è¡Œä¸º, åªæ˜¯æ·»åŠ äº†ä¾èµ–, æ‰€ä»¥æ­¤æ—¶è®¿é—®æ‰€æœ‰çš„é¡µé¢éƒ½éœ€è¦ç™»å½•, å³ä½¿æ˜¯ä¸ªä¸å­˜åœ¨çš„é¡µé¢, ä½†æ˜¯åœ¨è¿™èŠ‚æˆ‘ä»¬ä¿®æ”¹äº† spring securityçš„è¡Œä¸º, ä»”ç»†çœ‹ä¸Šé¢å…³äºæ§åˆ¶å“ªäº›endpointä¸éœ€è¦è®¤è¯ä¾¿å¯è®¿é—®çš„ä»£ç ä½ ä¼šå‘ç°æˆ‘ä»¬å¹¶æ²¡æœ‰éµå®ˆè¿™ä¸ªåŸåˆ™, æˆ‘ä»¬æ­£åœ¨åšçš„æ˜¯ expose everything, and secure some specific endpoints, è¿™æ˜¯ä¸å¯¹çš„, æˆ‘ä»¬è¦åè¿‡æ¥å†™, æ”¹æˆ:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { return http .authorizeHttpRequests( authorizeHttp -\u0026gt; { authorizeHttp.requestMatchers(\u0026#34;/\u0026#34;).permitAll(); authorizeHttp.requestMatchers(\u0026#34;/error\u0026#34;).permitAll(); authorizeHttp.requestMatchers(\u0026#34;/favicon.ico\u0026#34;).permitAll(); // Method authenticated(): Specify that URLs are allowed by any authenticated user. authorizeHttp.anyRequest().authenticated(); }) // Enable form login, if I need login, show me a form // without this, when you access page that needs authentication will get Whitelabel Error Page with code 403 .formLogin(withDefaults()) .build(); } æ­¤æ—¶æ‰æ˜¯ secure by default: expose some specific endpoints, and secure everything, ä½ å†è®¿é—® http://localhost:8080/foo , å°±ä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢,\n# 4. Single sign-on (SSO) å¯è·³è¿‡ Using SSO enables we can use open ID, æ¯”å¦‚å¹³æ—¶ç™»å½•æŒ‰é’®ä¸‹çš„ sign in with Google, è¿™ç§, å°±æ˜¯ä¾é çš„ Open ID, åœ¨ spring å®ç°è¿™ä¸ªå¾ˆç®€å•,\né¦–å…ˆéœ€è¦æ·»åŠ ä¾èµ–, ç¼–è¾‘ build.gradle dependencies éƒ¨åˆ†, æ·»åŠ :\n1 implementation \u0026#39;org.springframework.boot:spring-boot-starter-oauth2-client\u0026#39; ç„¶åç¬¬äºŒæ­¥å°±æ˜¯ enable oauth2-login, è¿˜è®°å¾—ä¸Šé¢é‚£èŠ‚é‡Œæˆ‘ä»¬å¦‚ä½•ä½¿èƒ½ form login çš„å—, ç±»ä¼¼åœ°, æˆ‘ä»¬åªç”¨åœ¨ä½¿èƒ½ form login çš„åœ°æ–¹æ·»åŠ ä¸€è¡Œä»£ç , to tell the SecurityFilterChain that we also want to be able to login in with oauth2 login,\n1 2 3 4 5 // .... .formLogin(withDefaults()) .oauth2Login(withDefaults()) // æ–°åŠ çš„ä»£ç  .build(); // ... ç¬¬ä¸‰æ­¥å°±æ˜¯è¦åœ¨è°·æ­Œæ³¨å†Œç›¸å…³ä¿¡æ¯, å³æˆ‘ä»¬åœ¨ç”¨è°·æ­Œç™»å½•, ä¹Ÿç®—æ˜¯ç”¨äº†è°·æ­Œç›¸å…³çš„service, ä¸èƒ½è¯´ç›´æ¥ä¸ç»è¿‡è°·æ­Œç›¸å…³è®¤è¯å°±ç”¨äº†å§, æ­¤æ—¶æˆ‘ä»¬å…ˆæŠŠæ–‡ä»¶ java/resources/application.properties ä¿®æ”¹æˆ application.yaml, å†…å®¹ä¸º:\n1 2 3 4 5 6 7 8 spring: security: oauth2: client: registration: google: client-id: client-secret: ç„¶åå‰©ä¸‹çš„å°±æ˜¯ä»è°·æ­Œè·å– client-id å’Œ client-secret, å…·ä½“é…ç½®å¯å‚è€ƒ: Setting up OAuth 2.0 - Google Cloud Platform Console Help\nç„¶åç‚¹ create, å³å¯è·å¾— client-id å’Œ client-secret, ç„¶åå¡«å…¥ application.yaml ä¸­, è®°ä½å“¦, æäº¤è¿œç¨‹ä»“åº“çš„æ—¶å€™åˆ«å¿˜æŠŠè¿™ä¸ªæ–‡ä»¶åŠ å…¥åˆ° .gitignore ä¸­, ç„¶åè¿è¡Œç¨‹åºå°±å¯ä»¥å®ç°è°·æ­Œç™»å½•äº†,\nOAuth (short for \u0026ldquo;Open Authorization\u0026rdquo;) is an open standard for access delegation, commonly used as a way for internet users to grant websites or applications access to their information on other websites but without giving them the passwords. OAuth\nå¦å¤–æ³¨æ„è¿™ä¸ªæœåŠ¡éƒ½æ˜¯å…è´¹çš„, ä¸æ”¾å¿ƒçš„è¯å¯ä»¥åˆ° https://console.cloud.google.com/welcome/ æŸ¥çœ‹ç®¡ç†ä½ çš„ project (çœ‹åˆ°æœ‰çš„ä¸€å¹´è®¢é˜…è´¹è¦15k, è¿™æ˜¯åœ¨è‡ªæˆ‘å®‰æ…°),\n# 5. è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯ - Authentication Object è¿™é‡Œå°±è¦æåˆ°ä¸€ä¸ªé‡è¦çš„å¯¹è±¡, å³ Authentication Object, å®ƒä»£è¡¨ either the request to login or the result of a successful login request ,\nAuthentication: represents the user. Contains: ï»¿ï»¿Principal: user \u0026ldquo;identity\u0026rdquo; (name, email\u0026hellip;) ï»¿ï»¿GrantedAuthorities: \u0026ldquo;permissions\u0026rdquo; (roles,..) isAuthenticated(): almost always true, å¦‚æœä¸æ˜¯ true, é‚£è¿™ä¸ª request åŸºæœ¬ä¼šè¢« blocked, é‚£æˆ‘ä»¬ä¹Ÿæ— æ³•è·å¾—è¿™ä¸ª Authentication äº†, å› ä¸º SecurityFilterChain çš„è¿™ä¸ªä»£ç : authorizeHttp.anyRequest().authenticated(), å³é™¤äº†é‚£å‡ ä¸ª endpoints çš„è¯·æ±‚ä¸éœ€è¦è®¤è¯, å…¶ä»–çš„éƒ½éœ€è¦ authenticated, ï»¿ï»¿details: details about the request ï»¿ï»¿(Credentials): \u0026ldquo;password\u0026rdquo;, often null äº†è§£æ›´å¤šå…³äº Authentication: Servlet Authentication Architecture :: Spring Security\næˆ‘ä»¬å¯ä»¥é€šè¿‡ Authentication object æ¥è·å–ç”¨æˆ·åå¯†ç ç­‰ä¿¡æ¯, è¿™ä¹Ÿæ˜¯ç¬¬ä¸‰ä¸ªé‡è¦çš„ç±», åªä¸è¿‡è¿™ä¸ªç±»ä¸æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„, è€Œæ˜¯ spring å¹³å°çš„, äº†è§£æ›´å¤š: Authentication (Spring Security 3.0.8.RELEASE API) Authentication Object: Represents the token for an authentication request or for an authenticated principal once the request has been processed by the AuthenticationManager.authenticate(Authentication) method. Once the request has been authenticated, the Authentication will usually be stored in a thread-local SecurityContext managed by the SecurityContextHolder by the authentication mechanism which is being used. In Spring Security, the term \u0026ldquo;authenticated principal\u0026rdquo; refers to the authenticated user or entity. It represents the currently logged-in user or entity who has successfully completed the authentication process. In most cases, the framework transparently takes care of managing the security context and authentication objects for you. Authentication\næ³¨æ„, authentication object å°±åœ¨ SecurityContext, å®ƒæ˜¯ thread-local, æ‰€ä»¥æ¯”å¦‚ä½ çš„æœåŠ¡å™¨ tomcat æœ‰100ä¸ªçº¿ç¨‹æ¥å¤„ç† request, æ¯ä¸ªçº¿ç¨‹å†…çš„ SecurityContextéƒ½ä¸ä¸€æ ·, è€Œä¸” SecurityContext global static, é™¤æ­¤ä¹‹å¤–, when a request comes in, runs on a thread, and when it\u0026rsquo;s done, some other request is going to use this thread, and the SecurityContext will be clean before this,\næ‰€ä»¥ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è·å–å®ƒ, å³å¦‚æœæœ‰æ—¶å€™ä½ æœ‰ä¸ª Controller, ç„¶åæœ‰å››äº”ä¸ªæ–¹æ³• nested, ä¸ç”¨åƒä¸‹é¢é‚£æ ·é€šè¿‡å‚æ•° inject authentication object, å¤ªéº»çƒ¦äº†, å¯ä»¥ç›´æ¥è·å¾—,\nvar authentication = SecurityContextHolder.getContext().getAuthentication();\nhttps://youtu.be/iJ2muJniikY?t=2085\nçœ‹çœ‹ authentication å¯¹è±¡çš„æ–¹æ³•:\ngetPrincipal() The identity of the principal being authenticated. In the case of an authentication request with username and password, this would be the username. getCredentials() The credentials that prove the principal is correct. This is usually a password, but could be anything relevant to the AuthenticationManager. ä¸€ä¸ªCredentialsè¾“å‡º: org.springframework.security.core.userdetails.User [Username=david, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, credentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_user]] ä¿®æ”¹å‰é¢å®šä¹‰çš„ Controller, inject Authentication object to the /private endpoint,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @RestController public class WebController { @GetMapping(\u0026#34;/\u0026#34;) public String publicPage() { return \u0026#34;Hello David~\u0026#34;; } @GetMapping(\u0026#34;/private\u0026#34;) public String privatePage(Authentication authentication) { return \u0026#34;Hi ~[\u0026#34; + authentication.getName() + \u0026#34;]~, you\u0026#39;ve logged in. ğŸ‰\u0026#34;; } } ç„¶åè¿è¡Œé¡¹ç›®, ç™»å½•åå¾—åˆ°è¾“å‡º:\n1 Hi ~[david]~, you\u0026#39;ve logged in. ğŸ‰ # 6. æŸ¥çœ‹ OpenID ç”¨æˆ·é‚®ç®± ä¿®æ”¹ Controller ä»£ç , æ–°åŠ ä¸€ä¸ªè‡ªå®šä¹‰æ–¹æ³•, getName()\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @RestController public class WebController { @GetMapping(\u0026#34;/\u0026#34;) public String publicPage() { return \u0026#34;Hello David~\u0026#34;; } @GetMapping(\u0026#34;/private\u0026#34;) public String privatePage(Authentication authentication) { return \u0026#34;Hi ~[\u0026#34; + getName(authentication) + \u0026#34;]~, you\u0026#39;ve logged in. ğŸ‰\u0026#34;; } private static String getName(Authentication authentication) { return Optional.of(authentication.getPrincipal()) .filter(OidcUser.class::isInstance) .map(OidcUser.class::cast) .map(OidcUser::getEmail) .orElseGet(authentication::getName); } } è¿è¡Œåé€‰æ‹©è°·æ­Œç™»å½•, è¾“å‡º: Hi ~[shehu@gmail.com]~, you\u0026rsquo;ve logged in. ğŸ‰\n# 7. é€šè¿‡ debug æŸ¥çœ‹ Authentication Object è®¾ç½®æ–­ç‚¹,\nè®¿é—® /private é¡µé¢è¾“å…¥å¯†ç ç™»å½•, è¿”å› IDE,\nä¸‹é¢æ˜¯é€šè¿‡ ouath Google ç™»å½•ä¹‹åçš„ Authentication ä¿¡æ¯,\n# 8. æ€»ç»“ æ€»ç»“å¤§æ¦‚ä» 25:00 å·¦å³å¼€å§‹,\n{% youtube iJ2muJniikY %}\næœ¬æ–‡ä¸»è¦å‚è€ƒ: https://youtu.be/iJ2muJniikY\n","date":"2023-08-04T19:16:49Z","permalink":"https://blog.yorforger.cc/p/spring-security-authentication-spring%E5%AD%A6%E4%B9%A0%E4%BA%94/","title":"Spring Security Authentication, Springå­¦ä¹ (äº”)"},{"content":" # å®ç°åŠŸèƒ½ è®¿é—® http://localhost:8080/ çš„æ—¶å€™ä¸»é¡µåˆ—å‡ºæ‰€æœ‰çš„çŒ«çŒ«ä¿¡æ¯(name+age), å¯é€šè¿‡å‚æ•°æŸ¥æ‰¾æŸä¸ªçŒ«çŒ«ä¿¡æ¯å¦‚ http://localhost:8080/?name=Max, å¦‚æœçŒ«çŒ«Maxå­˜åœ¨å°†ä¼šåˆ—å‡ºå…¶ä¿¡æ¯, ä¸å­˜åœ¨åˆ™è¿›è¡Œæç¤º, é€šè¿‡å®ç°ä»¥ä¸ŠåŠŸèƒ½å±•ç¤ºå¦‚ä½•é€šè¿‡controllerå¾€htmlæ¨¡æ¿æ’å…¥æ•°æ®, å½¢æˆåŠ¨æ€htmlé¡µé¢,\næ³¨æ„æ­¤ä¾‹å­ä¸­ html æ¨¡æ¿å°±æ˜¯ index.html, æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯, é€šè¿‡åœ¨htmlçš„ä¸€äº›æ ‡ç­¾é‡Œæ·»åŠ ä¸€äº›Thymeleafå±æ€§, ç„¶åhtmlå°±æˆäº†htmlæ¨¡æ¿,\næºç : https://github.com/shwezhu/springboot-learning/tree/master/thymeleaf-example\n# é¡¹ç›®ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 src â”œâ”€â”€ java â”‚Â â””â”€â”€ com â”‚Â â””â”€â”€ david â”‚Â â”œâ”€â”€ ThymeleafExampleApplication.java â”‚Â â”œâ”€â”€ bean â”‚Â â”‚Â â””â”€â”€ Cat.java â”‚Â â””â”€â”€ controller â”‚Â â””â”€â”€ MainController.java â””â”€â”€ resources â”œâ”€â”€ application.properties â”œâ”€â”€ static â”‚Â â””â”€â”€ css â”‚Â â””â”€â”€ main.css â””â”€â”€ templates â””â”€â”€ index.html # æ·»åŠ ä¾èµ– åœ¨pom.xmlä¸­åŠ å…¥å¹¶reload\n1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-thymeleaf\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ³¨æ„, ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºæœ¬ä¾‹å­ç”¨çš„æ˜¯spring boot, ç”¨springé…ç½®èµ·æ¥ä¼šå¾ˆéº»çƒ¦,\n# ä»£ç è§£é‡Š ç†è§£äº†Thymeleafçš„é€»è¾‘, ä¹‹åçœ‹ç€æ–‡æ¡£è‡ªå·±å°±èƒ½å†™äº†, è¿™é‡Œåªè®²ä¸€ä¸ª, å¯¹äºä¸‹é¢ä»£ç , å½“è®¿é—® http://localhost:8080/ çš„æ—¶å€™, å¾—åˆ°é¡µé¢å¦‚ä¸‹:\né¦–å…ˆè‹¥ä¸åœ¨htmlæ–‡ä»¶ä¸­ä½¿ç”¨Thymeleafçš„æ—¶å€™, controllerä»£ç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 @RestController public class GreetingController { @GetMapping(\u0026#34;/greeting\u0026#34;) public Greeting greeting(@RequestParam(value = \u0026#34;name\u0026#34;, defaultValue = \u0026#34;World\u0026#34;) String name) { // ... return new Greeting(); // è¿”å›çš„Greetingä¼šè¢«springè‡ªåŠ¨è½¬ä¸ºjsonå¯¹è±¡ } } è¯¥controlleræ˜¯ä¸ªç®€å•çš„ restful api, ç”¨æ¥è¿”å›ç®€å•çš„jsonæ•°æ®, è‹¥ä¸ç†è§£æ­¤æ®µä»£ç å¯ä»¥åˆ°ç¬¬ä¸€ä¸ªSpring Booté¡¹ç›®åŠè¸©å‘æ€»ç»“ Springå­¦ä¹ (ä¸€) æŸ¥çœ‹ç›¸å…³æ³¨è§£çš„è§£é‡Š,\né€šè¿‡thymeleafå‘htmlæ’å…¥æ•°æ®, æ­¤æ—¶çš„controllerå¦‚ä¸‹,\n1 2 3 4 5 6 7 8 @Controller public class MainController { @GetMapping(\u0026#34;/\u0026#34;) public String home(Model model) { model.addAttribute(\u0026#34;title\u0026#34;, \u0026#34;hello little kittens\u0026#34;); return \u0026#34;index\u0026#34;; // return index.html } } å¯¹åº”çš„index.htmlä»£ç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;!DOCTYPE HTML\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34; xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Spring Boot Thymeleaf Example\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt; \u0026lt;span th:text=\u0026#34;\u0026#39;Hello, \u0026#39; + ${title}\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¯ä»¥æ³¨æ„åˆ°controllerçš„æ–¹æ³•åªæ˜¯å¤šäº†ä¸€ä¸ªå‚æ•°å³ç±» org.springframework.ui.Model çš„å¯¹è±¡, ç„¶åé€šè¿‡è°ƒç”¨å…¶å¯¹è±¡çš„addAttribute()æ–¹æ³•å‘å°†è¦è¿”å›çš„htmlä¸­åŠ¨æ€åœ°æ’å…¥æ•°æ®, æ­¤ä¾‹ä¸­æ’å…¥çš„æ•°æ®ä¸ºå­—ç¬¦ä¸²\u0026quot;hello little kittens\u0026quot;, å¾€å“ªæ’å…¥? å½“ç„¶æ˜¯\u0026quot;title\u0026quot; å±æ€§, ç„¶åå°±å¯ä»¥åœ¨index.htmlé¢„è®¿é—®\u0026quot;title\u0026quot; çš„å€¼, æ³¨æ„, è¿™é‡Œè¯´æ˜¯é¢„é˜²é—®æ˜¯å› ä¸ºå˜é‡titleçš„æ•°æ®è¿˜æ²¡åˆ°, éœ€è¦controllerçš„æ–¹æ³•æ‰§è¡Œåˆ°return \u0026quot;index\u0026quot;; çš„æ—¶å€™, æ•°æ®æ‰ç®—æ˜¯çœŸçš„åˆ°äº† index.html, æ•°æ®å¤„ç†çš„å¤§è‡´è¿‡ç¨‹å¦‚ä¸‹:\nå®¢æˆ·ç«¯å‘é€httpè¯·æ±‚, Springæ¡†æ¶è°ƒç”¨controllerå¯¹åº”çš„å‡½æ•° controllerå¯¹åº”æ–¹æ³•çš„è¯­å¥æ‰§è¡Œå®Œæ¯•(å¦‚æŸ¥è¯¢æ•°æ®åº“, å‘Modelå¯¹è±¡æ·»åŠ å±æ€§), å‡½æ•°è¿”å›å­—ç¬¦ä¸²\u0026quot;index\u0026quot;, Springæ¡†æ¶æ‹¿åˆ°è¯¥å‡½æ•°è¿”å›çš„å­—ç¬¦ä¸² \u0026quot;index\u0026quot;, Springå°†ä¼šåœ¨é¡¹ç›®templateæ–‡ä»¶å¤¹ä¸‹æŸ¥æ‰¾æ–‡ä»¶ index.html , å¹¶é…åˆthymeleafä¹‹ç±»çš„ä¸œè¥¿å°† Model å¯¹è±¡çš„å†…å®¹æ’å…¥åˆ°index.htmlé‡Œå¯¹åº”çš„tagé‡Œ, å¦‚ä¸Šé¢çš„ä¾‹å­å°±æ˜¯æŠŠ\u0026quot;hello little kittens\u0026quot;, æ’å…¥åˆ°æ ‡ç­¾ \u0026lt;span th:text=\u0026quot;'Hello, ' + ${title}\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;é‡Œ, ç„¶åSpringè¿”å›æœ€ç»ˆå½¢æˆçš„ index.html ç»™å®¢æˆ·ç«¯ å¤§æ¦‚å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹, ä½†ç»†èŠ‚åº”è¯¥ä¸æ˜¯, æ¯”å¦‚æ’å…¥æ•°æ®çš„æ—¶å€™æ˜¯springåšçš„è¿˜æ˜¯thymeleaf, è¿™ä¸ªæ„Ÿå…´è¶£å¯ä»¥å»è°·æ­Œ, è¿™é‡Œåªæ˜¯å™è¿°å¤§è‡´çš„å¤„ç†è¿‡ç¨‹, ä»¥ä¾¿ç¼–å†™thymeleafä»£ç æœ‰æ€è·¯,\næ‰€ä»¥ä½ æ‡‚äº†å—? controlleræ–¹æ³•é€šè¿‡è¿”å›å­—ç¬¦ä¸²æ¥æŒ‡å®šè¦è¿”å›çš„htmlæ–‡ä»¶, è€Œæˆ‘ä»¬æƒ³è¦æ’å…¥åˆ°htmlä¸­çš„æ•°æ®åˆ™é€šè¿‡è°ƒç”¨model.addAttribute()æ¥æŒ‡å®š, è¿™ä¸ªè¿‡ç¨‹å°±ç›¸å½“äºåˆ¶é€ é›¶ä»¶, è€Œé›¶ä»¶çš„ç»„è£…, ä¹Ÿå°±æ˜¯æ±½è½¦çš„æ ·å­, å°±æ˜¯æˆ‘ä»¬ç¼–å†™çš„â€œç‰¹æ®Šçš„â€index.htmlæ–‡ä»¶, ä¹Ÿå°±æ˜¯æ‰€è°“çš„æ¨¡æ¿, å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆä¸ªè¿‡ç¨‹, å¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°ä½ ,\nå…¶ä»–å†…å®¹å¯å‚è€ƒ: Introduction to Using Thymeleaf in Spring | Baeldung\n# æ€»ç»“ æ€»ç»“ä¸‹, Spring MVC, åˆ°ç°åœ¨å­¦äº†Vå’ŒC, Cå³æˆ‘ä»¬å¸¸å†™çš„Controller, Vå³æ˜¯View, å°±æ˜¯æ¯æ¬¡ Controller çš„methodè¿”å›çš„é‚£ä¸ªview, åœ¨Spring Bootç›®å½•ç»“æ„ä¸€èˆ¬å¦‚ä¸‹,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 â”œâ”€â”€ src â”‚Â â”œâ”€â”€ main â”‚Â â”‚Â â”œâ”€â”€ java â”‚Â â”‚Â â”‚Â â””â”€â”€ com â”‚Â â”‚Â â”‚Â â””â”€â”€ david â”‚Â â”‚Â â”‚Â â”œâ”€â”€ ThymeleafExampleApplication.java â”‚Â â”‚Â â”‚Â â”œâ”€â”€ bean â”‚Â â”‚Â â”‚Â â””â”€â”€ controller â”‚Â â”‚Â â””â”€â”€ resources â”‚Â â”‚Â â”œâ”€â”€ application.properties â”‚Â â”‚Â â”œâ”€â”€ static â”‚Â â”‚Â â”‚Â â””â”€â”€ css â”‚Â â”‚Â â”‚Â â””â”€â”€ main.css â”‚Â â”‚Â â””â”€â”€ templates â”‚Â â”‚Â â””â”€â”€ index.html åœ¨HTMLæ ‡ç­¾æ’å…¥ä¸€äº›å±æ€§å°±æˆäº†Thymeleafæ¨¡æ¿ä¹Ÿå°±æ˜¯é¡¹ç›®ä¸­çš„ index.html, å¦‚\u0026lt;span th:text=\u0026quot;${cat.name}\u0026quot; /\u0026gt;, è€Œcontrolleré€šè¿‡è®¾ç½®Model å¯¹è±¡å±æ€§å‘index.htmlæ’å…¥æ•°æ®, è¿›è€Œå½¢æˆå†…å®¹ä¸åŒçš„ index.html è¿”å›ç»™å®¢æˆ·ç«¯, åƒæ˜¯åœ¨æ­ç§¯æœ¨,\næ³¨æ„ä¸Šé¢æˆ‘ä»¬æåˆ°çš„ controller åªæ˜¯ä¸ªæ³›æŒ‡, å®é™…ä¸Š controller å°±æ˜¯ä¸ªæ™®é€šçš„ç±», è¢«æ³¨è§£@Controller, @RestController, ä¿®é¥°çš„å°±æ˜¯ controller class, ç„¶åè¯¥ç±»çš„methodä¸€èˆ¬è¢« @GetMapping(\u0026quot;/cat\u0026quot;), @PostMapping(\u0026quot;/cat/add\u0026quot;) ç­‰æ³¨è§£ä¿®é¥°, æ¥å¤„ç†ä¸åŒçš„httpè¯·æ±‚, å³çœŸæ­£å¤„ç†httpè¯·æ±‚å¹¶è¿”å›htmlæ–‡ä»¶çš„æ˜¯ controller classçš„method,\n","date":"2023-08-01T13:55:48Z","permalink":"https://blog.yorforger.cc/p/thymeleaf-spring%E5%AD%A6%E4%B9%A0%E5%9B%9B/","title":"Thymeleaf, Springå­¦ä¹ (å››)"},{"content":" # 1. ORM Object-Relational Mapping (ORM) is a technique that lets you query and manipulate data from a database using an object-oriented paradigm.\nWhen most people say â€œORMâ€ they are referring to the library that implements this technique.\nWhichever ORM library you choose, they all use the same principles. There are a lot of ORM libraries around here:\nJava: Hibernate. PHP: Propel or Doctrine (I prefer the last one). Python: the Django ORM or SQLAlchemy (My favorite ORM library ever). C#: NHibernate or Entity Framework è‡³äºLibraryå’ŒFramework, çŸ¥é“å„è‡ªçš„ä¸€ä¸ªä¾‹å­å°±è¡Œäº†, æ¯”å¦‚JQueryå°±æ˜¯Library(å°±å®ç°äº†ä¸€äº›åŠŸèƒ½å°è£…æˆä»£ç è®©ä½ ç”¨), è€ŒSpringå°±å±äºæ¡†æ¶, è‡³äº Spring åˆ°åº•æ˜¯ä»€ä¹ˆ, æˆ‘ä¹Ÿåˆšå¼€å§‹å­¦, æ²¡æœ‰ææ˜ç™½å‘¢,\næ³¨æ„: JPA æ˜¯ä¸€å¥—è§„èŒƒï¼Œä¸æ˜¯ä¸€å¥—äº§å“ï¼Œé‚£ä¹ˆåƒ Hibernate, TopLink, JDO ä»–ä»¬æ˜¯ä¸€å¥—äº§å“ï¼Œå¦‚æœè¯´è¿™äº›äº§å“å®ç°äº†è¿™ä¸ª Jpa è§„èŒƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å«ä»–ä»¬ä¸º Jpa çš„å®ç°äº§å“ã€‚åŸæ–‡\n# 2. JDBC vs MySQL Connector JDBC stands for Java Database Connectivity: Java JDBC API\nSometimes, I always mistake MySQL driver for JDBC, a little funny, Lol. JDBC is part of JDK, which is java\u0026rsquo;s standard library, like code belowjava.sql.* belongs to Java SE API, which is also called JDBC API.\nSo what is MySQL driver, like com.mysql.cj.jdbc.Driver which we often add dependency to our maven project. Actually com.mysql.cj.jdbc.Driver is MySQL Connector, and we don\u0026rsquo;t use any of its code in our program, we just need to tell JDBC that which driver we use (Class.forName(\u0026quot;com.mysql.cj.jdbc.Driver\u0026quot;); ), and the query and insert statements are all executed by JDBC API (JDBC will commucate with mysql database with MySQL Connector, namely, mysql-jdbc-driver),\nAfter look at these codes below, you will understand,\nDatabase.java:\n1 2 3 4 5 6 7 package database; import java.sql.Connection; import java.sql.SQLException; public interface Database { public Connection connect() throws SQLException; } MysqlDatabase.java:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package database; // java.sql.* å±äº Java SE API, è¿™å°±æ˜¯ JDBC API import java.sql.Connection; import java.sql.DriverManager; import java.sql.SQLException; public class MysqlDatabase implements Database{ private final String url, user, password; public MysqlDatabase(String url, String user, String password) { this.url = url; this.user = user; this.password = password; } @Override public Connection connect() throws SQLException { try { // You must load jdbc driver, otherwise you will get null for connection. Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); } catch (ClassNotFoundException e) { // Instead of printing error simply, you should do some logging here System.err.println(\u0026#34;Cannot find sql drive: com.mysql.jdbc.Driver\u0026#34;); return null; } return DriverManager.getConnection(this.url, this.user, this.password); } } GetTemperatureServlet.java\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 ... public Connection getConnection() { Database database = new MysqlDatabase(\u0026#34;jdbc:mysql://localhost:3306/greenhouse\u0026#34;, \u0026#34;root\u0026#34;, \u0026#34;778899\u0026#34;); Controller controller = new Controller(database); Connection conn = null; try { conn = controller.getConnection(); } catch (SQLException e) { logger.error(e.getMessage()); } return conn; } public JsonArray getData(String sql, HttpServletResponse response) throws IOException { ResultSet resultSet = null; PreparedStatement statement = null; ArrayList\u0026lt;DataEntity\u0026gt; results = new ArrayList\u0026lt;\u0026gt;(); Connection conn = getConnection(); try { statement = conn.prepareStatement(sql); resultSet = statement.executeQuery(); while (resultSet.next()) { results.add(new DataEntity(resultSet.getDouble(1), resultSet.getDate(2).toString())); } } catch (SQLException e) { ... } Gson gson = new Gson(); JsonElement jsonElement = gson.toJsonTree(results, new TypeToken\u0026lt;ArrayList\u0026lt;DataEntity\u0026gt;\u0026gt;(){}.getType()); ... } As code above, ResultSet, PreparedStatement and Connection they are all belong to java.sql.* which is part of java se api, namely, JDBC. So now you know that we don\u0026rsquo;t commucate with MySQL database with MySQL Connector directly, actually, we conmmucate with MySQL(retrive \u0026amp; insert data) with JDBC API(java.sql.*) and JDBC API commucate with MySQL Connector, and MySQL COnnector commucate with MySQL database.\nMySQL :: MySQL Connectors\nOverview (Java Platform SE 8 )\n# 3. JPA vs Hibernate JPA (Java Persistence API) is a standard for ORM (Object Relational Mapping) Hibernate is a JPA provider JDBC (Java Database Connectivity ) API belongs to Java SE API We have known what is JDBC in the paragraph above, let\u0026rsquo;s look at what is JPA.\nJPA is a standard for Object Relational Mapping (ORM). This is a technology which allows you to map between objects in code and database tables. This can hide the SQL from the developer so that all they deal with are Java classes, and the provider allows you to save them and load them magically. Mostly, XML mapping files or annotations on getters and setters can be used to tell the JPA provider which fields on your object map to which fields in the DB. The most famous JPA provider is Hibernate, so it\u0026rsquo;s a good place to start for concrete examples.\næ‰€ä»¥JPAåªæ˜¯ä¸ªJavaçš„ORMæ ‡å‡†, è€ŒHibernateå®ç°äº†JPA,\nUnder the hood, Hibernate and most other providers for JPA write SQL and use JDBC API to read and write from and to the DB. Simply think, JPA is a Java ORM, and Hibernate implements JPA using JDBC API,\nå‚è€ƒ:\njava - JPA or JDBC, how are they different? - Stack Overflow ","date":"2023-07-30T16:55:47Z","permalink":"https://blog.yorforger.cc/p/orm-vs-jpa-vs-hibernate-jdbc-vs-mysql-driver-spring%E5%AD%A6%E4%B9%A0%E4%B8%89/","title":"ORM vs JPA vs Hibernate \u0026 JDBC vs MySQL Driver, Springå­¦ä¹ (ä¸‰)"},{"content":" # 1. Install Maven 1.Go to Maven Download site\n2.Set Environment Variables\n1 2 3 4 5 6 7 8 tar -xvf apache-maven-3.6.3-bin.tar.gz export M2_HOME=\u0026#34;/Users/shaowen/Downloads/Programs/apache-maven-3.9.1\u0026#34; PATH=\u0026#34;${M2_HOME}/bin:${PATH}\u0026#34; export PATH source .bash_profile mvn -version # 2. Maven Artifact In Maven terminology, the artifact is the resulting output of the maven build, generally a jar or war or other executable file. Artifacts in maven are identified by a coordinate system of groupId, artifactId, and version. Maven uses the groupId, artifactId, and version to identify dependencies (usually other jar files) needed to build and run your code. - https://stackoverflow.com/a/2487510/16317008\nAn artifact is a file, usually a JAR, that gets deployed to a Maven repository.\nA Maven build produces one or more artifacts, such as a compiled JAR and a \u0026ldquo;sources\u0026rdquo; JAR.\nEach artifact has a group ID (usually a reversed domain name, like com.example.foo), an artifact ID (just a name), and a version string. The three together uniquely identify the artifact.\nA project\u0026rsquo;s dependencies are specified as artifacts. - https://stackoverflow.com/a/2487511/16317008\nä¹‹å‰å†™çš„å…³äºå¦‚ä½•å‘å¸ƒ war åˆ° tomcat æœåŠ¡å™¨çš„æ–‡ç« , ç”¨çš„å°±æ˜¯ maven build war, å½“ç„¶ maven ä¹Ÿå¯ä»¥æŠŠæˆ‘ä»¬çš„é¡¹ç›® build æˆ jar æ–‡ä»¶, æ‰€ä»¥ artifact åœ¨ maven ä¸­çš„æ„æ€å°±æ˜¯ maven çš„è¾“å‡º, maven æ‰€buildçš„æ–‡ä»¶, æˆ‘ä»¬çš„ spring boot é¡¹ç›®ä¹Ÿæ˜¯ä¸€ä¸ª artifact, ä¸å…¶è¯´ spring boot é¡¹ç›®ä¸å¦‚è¯´æ˜¯ maven é¡¹ç›®, å› ä¸ºå¦‚è¿‡æˆ‘ä»¬ä¸ç”¨ gradle çš„è¯, é‚£æ¯ä¸ªspring boot é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹éƒ½ä¼šæœ‰ä¸€ä¸ª pom.xml æ–‡ä»¶, åœ¨å…¶å¼€å¤´ä½ å¯ä»¥çœ‹åˆ° groupid, artifactidç­‰æ ‡ç­¾,è¿™ä¸å°±æ˜¯æ ‡æ³¨ä¸€ä¸ª artifact çš„æ ‡ç­¾å—, ç„¶åpom.xml ä¸­çš„dependencyæ ‡ç­¾é‡Œçš„ä¾èµ–å°±æ˜¯ä¸€ä¸ªä¸ªçš„ maven artifacts, è¿™å…¶å®å°±æ˜¯ç¬¬ä¸‰æ–¹æŠŠå¥¹ä»¬çš„mavené¡¹ç›®æ‰“åŒ…æˆjarä¾›æˆ‘ä»¬ä½¿ç”¨, æˆ‘ä»¬åªç”¨æ·»åŠ ä¾èµ–å°±å¥½, è‡³äºè¿™äº›ä¾èµ–(artifacts)ä¸‹è½½å®‰è£…åéƒ½ä¿å­˜åœ¨äº† Maven repository, å…·ä½“æŠŠmaven é¡¹ç›®build æˆ war/jar packageå¯å‚è€ƒ:\næ‰‹åŠ¨éƒ¨ç½²WaråŒ…åˆ°Tomcatä¸Šä¹‹ä½•ä¸ºWar åˆ›å»ºç¬¬ä¸€ä¸ªSpring Booté¡¹ç›®åŠæ³¨æ„äº‹é¡¹ # 3. Maven Repository Maven Repositoryæœ‰3ç§ç±»å‹:\nLocal Repository Central Repository Remote Repository Maven Local Repository æ˜¯æœ¬æœºä¸­çš„ä¸€ä¸ªç›®å½•, å¦‚æœç›®å½•ä¸å­˜åœ¨, æ‰§è¡Œmavenæ—¶å°±ä¼šå…ˆåˆ›å»ºå®ƒ, é»˜è®¤æƒ…å†µä¸‹, mavenæœ¬åœ°å­˜å‚¨åº“æ˜¯%USER_HOME%/.m2 , æˆ‘ä»¬å¯ä»¥åœ¨mavené…ç½®æ–‡ä»¶æŸ¥çœ‹local repository, ä½ç½®åœ¨ maven å®‰è£…è·¯å¾„ä¸‹, MAVEN_HOME/conf/settings:\næŸ¥çœ‹ .m2 çš„å†…å®¹,\n1 2 3 4 5 6 7 8 $ ls ~/.m2/repository/ antlr commons-codec junit aopalliance commons-collections log4j logkit\tmysql .... $ ls .m2/repository/log4j/log4j/1.2.12 _remote.repositories log4j-1.2.12.jar.sha1 log4j-1.2.12.pom.sha1 log4j-1.2.12.jar log4j-1.2.12.pom é˜…è¯»æ›´å¤š: Maven-Repositoryå­˜å‚¨åº“ # 4. Artifact \u0026amp; Group åˆ›å»ºå¥½mavené¡¹ç›®å, åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ä¸ªpom.xmlæ–‡ä»¶, è¿™ä¸ªå°±æ˜¯mavençš„é…ç½®æ–‡ä»¶, ä½ å¯ä»¥åœ¨é‡Œé¢æ·»åŠ å„ç§ä¾èµ–, æ¯”å¦‚æƒ³ç”¨mysql driver, gson, log4jç­‰ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™, ç›´æ¥åœ¨dependenciesæ ‡ç­¾ä¸‹æ·»åŠ :\n1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.32\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; é‚£ä¹ˆé—®é¢˜æ¥äº†, ä¸Šé¢dependenceæ ‡ç­¾ä¸‹çš„artifactIdå’ŒgroupIdæ˜¯ä»€ä¹ˆå‘¢? ä»”ç»†è§‚å¯Ÿpom.xmlå†…å®¹ä½ ä¼šå‘ç°, åœ¨å…¶å¼€å¤´ä¹Ÿæ˜¯è¿™äº›å¥‡æ€ªçš„æ ‡ç­¾:\n1 2 3 4 5 \u0026lt;groupId\u0026gt;com.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ServletDemo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;ServletDemo\u0026lt;/name\u0026gt; \u0026lt;packaging\u0026gt;war\u0026lt;/packaging\u0026gt; å…¶ä¸­ï¼ŒgroupIdç±»ä¼¼äºJavaçš„åŒ…åï¼Œé€šå¸¸æ˜¯å…¬å¸æˆ–ç»„ç»‡åç§°ï¼ŒartifactIdç±»ä¼¼äºJavaçš„ç±»åï¼Œé€šå¸¸æ˜¯é¡¹ç›®åç§°ï¼Œå†åŠ ä¸Šversionï¼Œä¸€ä¸ªMavenå·¥ç¨‹å°±æ˜¯ç”±groupIdï¼ŒartifactIdå’Œversionä½œä¸ºå”¯ä¸€æ ‡è¯†,\nåœ¨Mavené¡¹ç›®ä¸­ï¼Œç±»çš„classpathè·¯å¾„æ˜¯ç”±Mavenä¾èµ–ç®¡ç†æœºåˆ¶å†³å®šçš„ã€‚Mavené€šè¿‡pom.xmlç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨\u0026lt;dependency\u0026gt;å£°æ˜ä¸€ä¸ªä¾èµ–åï¼ŒMavenä¼šæ ¹æ®pom.xmlæ–‡ä»¶ä¸­çš„é…ç½®å°†ä¾èµ–ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°é¡¹ç›®çš„classpathä¸­ã€‚\n# 5. æŸ¥çœ‹classpath Mac, LinuxæŸ¥çœ‹å½“å‰mavené¡¹ç›®çš„classpath, æ³¨æ„è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹è¾“å…¥æ­¤å‘½ä»¤, ä¸ç„¶ä¼šæç¤ºé”™è¯¯æ‰¾ä¸åˆ°pom.xmlæ–‡ä»¶,\n1 2 mvn -q exec:exec -Dexec.executable=echo -Dexec.args=\u0026#34;%classpath\u0026#34; /Users/shaowen/Codes/IDEA/ServletDemo/target/classes:/Users/shaowen/.m2/repository/com/mysql/mysql-connector-j/8.0.32/mysql-connector-j-8.0.32.jar:/Users/shaowen/.m2/repository/log4j/log4j/1.2.17/log4j-1.2.17.jar å¯ä»¥çœ‹åˆ°, classpathè·¯å¾„çš„ç¬¬ä¸€ä¸ªæ˜¯/Users/shaowen/Codes/IDEA/ServletDemo/target/classes/, è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢å°±æ˜¯æˆ‘ä»¬project/src/main/java/ä¸‹çš„ç±», ç¼–è¯‘æˆçš„classæ–‡ä»¶ éƒ½æ”¾è¿™ä¸‹é¢äº†. æ‰€ä»¥é¡¹ç›®å°±æ˜¯è¿™ä¹ˆæ‰¾åˆ°æˆ‘ä»¬ç¼–å†™çš„ç±»çš„,\näº†è§£æ›´å¤šå…³äºè¾“å‡ºclasspath: https://stackoverflow.com/a/45043803/16317008\n# 6. Common Maven Commands Maven Command Description mvn \u0026ndash;version Prints out the version of Maven you are running. mvn clean Clears the target directory into which Maven normally builds your project. mvn package Builds the project and packages the resulting JAR file into the target directory. mvn package -Dmaven.test.skip=true Builds the project and packages the resulting JAR file into the target directory - without running the unit tests during the build. mvn clean package Clears the target directory and Builds the project and packages the resulting JAR file into the target directory. mvn clean package -Dmaven.test.skip=true Clears the target directory and builds the project and packages the resulting JAR file into the target directory - without running the unit tests during the build. mvn verify Runs all integration tests found in the project. mvn clean verify Cleans the target directory, and runs all integration tests found in the project. mvn install Builds the project described by your Maven POM file and installs the resulting artifact (JAR) into your local Maven repository mvn install -Dmaven.test.skip=true Builds the project described by your Maven POM file without running unit tests, and installs the resulting artifact (JAR) into your local Maven repository mvn clean install Clears the target directory and builds the project described by your Maven POM file and installs the resulting artifact (JAR) into your local Maven repository mvn clean install -Dmaven.test.skip=true Clears the target directory and builds the project described by your Maven POM file without running unit tests, and installs the resulting artifact (JAR) into your local Maven repository mvn dependency:copy-dependencies Copies dependencies from remote Maven repositories to your local Maven repository. mvn clean dependency:copy-dependencies Cleans project and copies dependencies from remote Maven repositories to your local Maven repository. mvn clean dependency:copy-dependencies package Cleans project, copies dependencies from remote Maven repositories to your local Maven repository and packages your project. mvn dependency:tree Prints out the dependency tree for your project - based on the dependencies configured in the pom.xml file. mvn dependency:tree -Dverbose Prints out the dependency tree for your project - based on the dependencies configured in the pom.xml file. Includes repeated, transitive dependencies. mvn dependency:tree -Dincludes=com.fasterxml.jackson.core Prints out the dependencies from your project which depend on the com.fasterxml.jackson.core artifact. mvn dependency:tree -Dverbose -Dincludes=com.fasterxml.jackson.core Prints out the dependencies from your project which depend on the com.fasterxml.jackson.core artifact. Includes repeated, transitive dependencies. mvn dependency:build-classpath Prints out the classpath needed to run your project (application) based on the dependencies configured in the pom.xml file. æ³¨æ„(1): mvn install è¯´çš„æ˜¯æŠŠä½ çš„ maven é¡¹ç›®æ„å»ºæˆ jaræˆ–è€…war, ç„¶åæ”¾åˆ° .m2/respository/ ä¸‹, è€Œä¸æ˜¯ä¸‹è½½å®‰è£… pom.xml ä¸­çš„ä¾èµ–åˆ°æœ¬åœ°ä»“åº“, å…·ä½“è¾“å‡º:\n1 2 3 4 5 6 7 8 9 10 11 12 13 [INFO] Building jar: /Users/David/Codes/IDEA/my-app/target/my-app-0.0.1-SNAPSHOT.jar [INFO] [INFO] --- spring-boot:3.1.2:repackage (repackage) @ my-app --- [INFO] Replacing main artifact /Users/David/Codes/IDEA/my-app/target/my-app-0.0.1-SNAPSHOT.jar with repackaged archive, adding nested dependencies in BOOT-INF/. [INFO] [INFO] --- install:3.1.1:install (default-install) @ my-app --- [INFO] Installing /Users/David/Codes/IDEA/my-app/target/my-app-0.0.1-SNAPSHOT.jar to /Users/David/.m2/repository/com/example/my-app/0.0.1-SNAPSHOT/my-app-0.0.1-SNAPSHOT.jar [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 2.483 s [INFO] Finished at: 2023-07-30T13:56:58-03:00 [INFO] ------------------------------------------------------------------------ æ³¨æ„(2):\nKeep in mind, that when you execute the clean goal of Maven, the target directory is removed, meaning you lose all compiled classes from previous builds. That means, that Maven will have to build all of your project again from scratch, rather than being able to just compile the classes that were changed since last build. This slows your build time down. However, sometimes it can be nice to have a clean, fresh build, e.g. before releasing your product to the world - mostly for your own \u0026ldquo;feeling\u0026rdquo; of knowing everything was built from scratch and working. - Maven Commands\n# 7. Executing Build Life Cycles, Phases and Goals When you run the mvn command you pass one or more arguments to it. These arguments specify either a build life cycle, build phase or build goal. For instance to execute the clean build life cycle you execute this command:\n1 mvn clean To execute the site build life cycle you execute this command:\n1 mvn site # 7.1. Executing the Default Life Cycle The default life cycle is the build life cycle which generates, compiles, packages etc. your source code.\nYou cannot execute the default build life cycle directly, as is possible with the clean and site. Instead you have to execute a specific build phase within the default build life cycle.\nThe most commonly used build phases in the default build life cycle are:\nBuild Phase Description validate Validates that the project is correct and all necessary information is available. This also makes sure the dependencies are downloaded. compile Compiles the source code of the project. test Runs the tests against the compiled source code using a suitable unit testing framework. These tests should not require the code be packaged or deployed. package Packs the compiled code in its distributable format, such as a JAR. install Install the package into the local repository, for use as a dependency in other projects locally. deploy Copies the final package to the remote repository for sharing with other developers and projects. Executing one of these build phases is done by simply adding the build phase after the mvn command, like this:\n1 mvn compile This example Maven command executes the compile build phase of the default build life cycle. This Maven command also executes all earlier build phases in the default build life cycle, meaning the validate build phase.\n# 7.2. Executing Build Phases You can execute a build phase located inside a build life cycle by passing the name of the build phase to the Maven command. Here are a few build phase command examples:\n1 2 3 mvn pre-clean mvn compile mvn package Maven will find out what build life cycle the specified build phase belongs to, so you don\u0026rsquo;t need to explicitly specify which build life cyle the build phase belongs to.\næœ¬èŠ‚æ¥è‡ª: Maven Commands\n","date":"2023-07-30T14:11:30Z","permalink":"https://blog.yorforger.cc/p/maven%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4-spring%E5%AD%A6%E4%B9%A0%E4%BA%8C/","title":"Mavençš„ç›¸å…³æ¦‚å¿µä¸å¸¸ç”¨æŒ‡ä»¤ Springå­¦ä¹ (äºŒ)"},{"content":" # é”™è¯¯æ€»ç»“ (1) æ‰€æœ‰Javaä»£ç éƒ½è¦åœ¨javaç›®å½•ä¸‹, å³ä¸å¯åˆ é™¤javaç›®å½•, å¦åˆ™, è¿è¡Œ./mvnw clean packageæŠ¥é”™, ä½ å¯ä»¥è‡ªå·±è¯•è¯•\n1 2 3 4 5 6 7 8 9 â”œâ”€â”€ pom.xml â”œâ”€â”€ src â”‚Â â”œâ”€â”€ main â”‚Â â”‚Â â”œâ”€â”€ java â”‚Â â”‚Â â”‚Â â””â”€â”€ com â”‚Â â”‚Â â”‚Â â”œâ”€â”€ MyAppApplication.java â”‚Â â”‚Â â”‚Â â””â”€â”€ restservice â”‚Â â”‚Â â”‚Â â”œâ”€â”€ Greeting.java â”‚Â â”‚Â â”‚Â â””â”€â”€ GreetingController.java (2) controller ç­‰ç»„ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹éœ€è¦åœ¨ä¸»ç±»çš„åŒçº§æˆ–è€…æ¬¡çº§ç›®å½•, å¦åˆ™è¿è¡Œç¨‹åºè®¿é—®http://localhost:8080/greetingä¼šå‡ºç°é”™è¯¯:\n1 2 3 Whitelabel Error Page This application has no explicit mapping for /error, so you are seeing this as a fallback. Tue Jun 30 17:24:02 CST 2023 There was an unexpected error (type=Not Found, status=404). No message available ä¸»ç±»å°±æ˜¯è¢«@SpringBootApplicationä¿®é¥°çš„é‚£ä¸ªç±»,\næ­£ç¡®ç»“æ„:\n1 2 3 4 5 6 7 8 9 10 11 12 â”œâ”€â”€ java â”‚Â â””â”€â”€ com â”‚Â â”œâ”€â”€ MyAppApplication.java â”‚Â â””â”€â”€ restservice â”‚Â â”œâ”€â”€ Greeting.java â”‚Â â””â”€â”€ GreetingController.java # or â”œâ”€â”€ java â”‚Â â””â”€â”€ com â”‚Â â”œâ”€â”€ MyAppApplication.java â”‚Â â”œâ”€â”€ Greeting.java â”‚Â â””â”€â”€ GreetingController.java é”™è¯¯ç»“æ„:\n1 2 3 4 5 6 â”œâ”€â”€ java â”‚Â â”œâ”€â”€ com â”‚Â â”‚Â â””â”€â”€ MyAppApplication.java â”‚Â â””â”€â”€ restservice â”‚Â â”œâ”€â”€ Greeting.java â”‚Â â””â”€â”€ GreetingController.java å…·ä½“å¯å‚è€ƒ: spring - This application has no explicit mapping for /error - Stack Overflow\n# æ–°æ¦‚å¿µ Record Class å‚ç…§ Greeting.java æºç å‘ç° Greeting ä¸ä¼ ç»Ÿçš„ç±»ä¸åŒ, æ²¡æœ‰æ„é€ å‡½æ•°, æ›´åƒæ˜¯ä¸ªå‡½æ•°,\nOne of the main advantages of records over POJOs is that they reduce the amount of boilerplate code needed to define a class. For example, a POJO might require a constructor, getters, setters, equals, hashCode, and toString methods, all of which must be manually defined. With records, all of these methods are automatically generated based on the recordâ€™s fields. - Java Records vs POJO\nPOJO Class: What Is a Pojo Class? | Baeldung\n# Jackson å¯èƒ½ä¼šå¥½å¥‡, ä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨ json åº“, ç›´æ¥è¿”å›æ˜¯ä¸€ä¸ªGreetingå¯¹è±¡,ä½†å¾—åˆ°çš„å†…å®¹å´æ˜¯ json æ ¼å¼çš„ä¿¡æ¯å‘¢? æ•™ç¨‹é‡Œç»™çš„è§£é‡Š:\nThis application uses the Jackson JSON library to automatically marshal instances of type Greeting into JSON. Jackson is included by default by the web starter.\nåŸæ¥æ˜¯ spring boot é›†æˆäº† Jackson, ä»£ç é‡Œæ²¡æœ‰ç”¨ç›¸å…³çš„ä»£ç æ˜¯å› ä¸ºSpring Boot ç”¨äº† ObjectMapper ,\nWhen using JSON format, Spring Boot will use an ObjectMapper instance to serialize responses and deserialize requests. Spring Boot: Jackson ObjectMapper\n# æºç è§£é‡Š é¡¹ç›®åˆ›å»ºè¿‡ç¨‹å¯å‚è€ƒ: Getting Started | Building a RESTful Web Service\n1 2 3 4 5 6 7 8 9 10 11 12 // MyApplicaiton.java package com; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class MyAppApplication { public static void main(String[] args) { SpringApplication.run(MyAppApplication.class, args); } } 1 2 3 // Greeting.java package com.restservice; public record Greeting(long id, String content) { } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // GreetingController.java package com.restservice; import java.util.concurrent.atomic.AtomicLong; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestParam; import org.springframework.web.bind.annotation.RestController; // æ­¤ç±»è¢«@RestControllerä¿®é¥°, å½“å…¶æ‰€æœ‰methodsè¿”å›ä¸€ä¸ªç±»çš„å¯¹è±¡æ—¶, springå°†è‡ªåŠ¨å¤„ç†è¢«è¿”å›çš„å¯¹è±¡, è½¬ä¸ºjsonæ ¼å¼è¿”å› // @RestController = @Controller + @ResponseBody @RestController public class GreetingController { private static final String template = \u0026#34;Hello, %s!\u0026#34;; private final AtomicLong counter = new AtomicLong(); @GetMapping(\u0026#34;/greeting\u0026#34;) public Greeting greeting(@RequestParam(value = \u0026#34;name\u0026#34;, defaultValue = \u0026#34;World\u0026#34;) String name) { // è¿”å›çš„Greetingä¼šè¢«springè‡ªåŠ¨è½¬ä¸ºjsonå¯¹è±¡ return new Greeting(counter.incrementAndGet(), String.format(template, name)); } } The @GetMapping annotation ensures that HTTP GET requests to /greeting are mapped to the greeting() method. There are companion annotations for other HTTP verbs (e.g. @PostMapping for POST). There is also a @RequestMapping annotation that they all derive from, and can serve as a synonym (e.g. @RequestMapping(method=GET)). @RequestParam binds the value of the query string parameter name into the name parameter of the greeting() method. If the name parameter is absent in the request, the defaultValue of World is used. This code uses Spring @RestController annotation, which marks the class as a controller where every method returns a domain object instead of a view. @RestController = @Controller + @ResponseBody. @Controller is used to declare common web controllers which can return HTTP response but @RestController is used to create controllers for REST APIs which can return JSON. The Greeting object must be converted to JSON. Thanks to Springâ€™s HTTP message converter support, you need not do this conversion manually. Because Jackson 2 is on the classpath, Springâ€™s MappingJackson2HttpMessageConverter is automatically chosen to convert the Greeting instance to JSON. @SpringBootApplication is a convenience annotation that adds all of the following: @Configuration: Tags the class as a source of bean definitions for the application context. @EnableAutoConfiguration: Tells Spring Boot to start adding beans based on classpath settings, other beans, and various property settings. For example, if spring-webmvc is on the classpath, this annotation flags the application as a web application and activates key behaviors, such as setting up a DispatcherServlet. @ComponentScan: Tells Spring to look for other components, configurations, and services in the com/example package, letting it find the controllers. æœ€åä¸€ä¸ªæ²¡æ€ä¹ˆçœ‹æ˜ç™½, ä¹Ÿä¸æ‰“ç®—ç°åœ¨å¼„æ˜ç™½, æƒ³ç€éšç€å­¦ä¹ çš„æ·±å…¥, æ…¢æ…¢çš„å¯¹ spring æœ‰ä¸ªæ›´æ¸…æ™°çš„è®¤è¯†çš„æ—¶å€™, å°±æ…¢æ…¢æ‡‚äº†,\nä¸Šé¢å…³äº @RestController çš„è§£é‡Š: \u0026hellip; every method returns a domain object instead of a view, è¿™é‡Œçš„viewæŒ‡çš„æ˜¯è¿”å›htmlæ–‡ä»¶, ä¹Ÿå°±æ˜¯è¯´è‹¥ä½ æƒ³æä¾›å¤„ç†restful apiç„¶åè¿”å›ç®€å•çš„jsonæ•°æ®æœåŠ¡, é‚£å°±ç”¨ @RestController ä¿®é¥°è¯¥ controller, ç„¶åè®©è¯¥controllerçš„æ¯ä¸ªæ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªå¯¹è±¡, å‰©ä¸‹çš„äº¤ç»™ spring æ¡†æ¶, å®ƒä¼šè‡ªåŠ¨å¸®ä½ æŠŠè¿”å›çš„å¯¹è±¡è½¬ä¸ºjsonå¯¹è±¡ç„¶åè¿”å›ç»™å®¢æˆ·ç«¯,\nIf you use Maven, you can run the application by using ./mvnw spring-boot:run. Alternatively, you can build the JAR file with ./mvnw clean package and then run the JAR file, as follows:\n1 java -jar target/gs-rest-service-0.1.0.jar Now that the service is up, visit http://localhost:8080/greeting\n","date":"2023-07-29T16:47:46Z","permalink":"https://blog.yorforger.cc/p/%E5%88%9B%E5%BB%BAspring-boot%E9%A1%B9%E7%9B%AE%E5%8F%8A%E8%B8%A9%E5%9D%91%E6%80%BB%E7%BB%93-spring%E5%AD%A6%E4%B9%A0%E4%B8%80/","title":"åˆ›å»ºSpring Booté¡¹ç›®åŠè¸©å‘æ€»ç»“ Springå­¦ä¹ (ä¸€)"},{"content":" # Java Packages \u0026amp; API A package is a namespace that organizes a set of related classes and interfaces. Think of it as a folder in a file directory. We use packages to avoid name conflicts, and to write a better maintainable code. Packages are divided into two categories:\nBuilt-in Packages (packages from the Java API) User-defined Packages (create your own packages) # Built-in Packages The Java API is a library of prewritten classes, that are free to use, included in the Java Development Environment. The library contains components for managing input, database programming, and much much more. The complete list can be found at Oracles website: https://docs.oracle.com/javase/8/docs/api/.\nThe library (Java API) is divided into packages and classes. Meaning you can either import a single class (along with its methods and attributes), or a whole package that contain all the classes that belong to the specified package.\nJava API å°±æ˜¯æ‰€è°“çš„ Built-in Packageså’¯, ç›´è§‚æ„Ÿå—ä¸‹\n# User-defined Packages To create your own package, you need to understand that Java uses a file system directory to store them. Just like folders on your computer:\n1 2 3 â””â”€â”€ src â””â”€â”€ mypack â””â”€â”€ Cat.java To create a package, use the package keyword:\n1 2 3 4 package mypack; class Cat { ... } æ³¨æ„å“¦, package åº”è¯¥åœ¨ src ç›®å½•ä¸‹, ç„¶åå«æœ‰ main å‡½æ•°çš„ä¸»ç±»ä¹Ÿåº”è¯¥åœ¨ src ä¸‹, ä¸ç„¶åœ¨å¯¼å…¥packageæ—¶æ˜¯æ²¡åŠæ³•æ‰¾åˆ° packageçš„,\n# e.g., æ³¨æ„çœ‹ç›®å½•ç»“æ„,\næ³¨æ„çœ‹ç¬¬ä¸€è¡Œ, å£°æ˜æ‰€åœ¨çš„package\nè‹¥æ— å£°æ˜\næœ€åæ³¨æ„, çœŸæ­£çš„å®Œæ•´ç±»åæ˜¯åŒ…å.ç±»å, JVM åªçœ‹å®Œæ•´ç±»å, JVM è®¤ä¸ºåªè¦åŒ…åä¸åŒ, ç±»å°±ä¸åŒ,\nå¦å¤–packageæ²¡æœ‰çˆ¶å­å…³ç³», java.utilå’Œjava.util.zipæ˜¯ä¸åŒçš„åŒ…, ä¸¤è€…æ²¡æœ‰ä»»ä½•ç»§æ‰¿å…³ç³»,\n# Import a Package To import a whole package, end the sentence with an asterisk sign (*). The following example will import ALL the classes in the java.util package:\n1 import java.util.*; # Import a Class If you find a class you want to use, for example, the Scanner class, which is used to get user input, write the following code:\n1 import java.util.Scanner; In the example above, java.util is a package, while Scanner is a class of the java.util package.\nå‚è€ƒ:\nWhat Is a Package? (The Javaâ„¢ Tutorials \u0026gt; Learning the Java Language \u0026gt; Object-Oriented Programming Concepts) Java Packages ","date":"2023-07-27T20:11:43Z","permalink":"https://blog.yorforger.cc/p/java-packages%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%BF%E7%94%A8/","title":"Java Packagesä»‹ç»åŠä½¿ç”¨"},{"content":"æˆ‘çš„ç”µè„‘æœ‰ä¸¤ä¸ªjdk, ä¸€ä¸ªæ˜¯æˆ‘è‡ªå·±ä¸‹è½½çš„jdk17, ä¸€ä¸ªæ˜¯ç”µè„‘é¢„å®‰è£…çš„jdk19:\n1 2 3 4 5 ls /Library/Java/JavaVirtualMachines/jdk-19.jdk/Contents/Home/ LICENSE bin include legal man README conf jmods lib release ls ~/Downloads/Programs/jdk-17-0-3-1/Home/ LICENSE README bin conf include jmods legal lib release éƒ½è¯´JDKåŒ…æ‹¬JRE, ç„¶åJREé‡Œé¢æœ‰JVM, ä½†æ˜¯ç°åœ¨æ–°ç‰ˆæœ¬çš„JDKé‡Œæ²¡æœ‰JREæ–‡ä»¶å¤¹äº†, JREè¢«å•ç‹¬å®‰è£…äº†, é‚£ä¹ˆç°åœ¨å¯¹äºæ–°ç‰ˆæœ¬çš„JDKæ¥è¯´, JREæ˜¯ä¸æ˜¯ä»ç„¶å±äºJDKå‘¢? çŸ¥é“è¿™ä¸ªé—®é¢˜å’Œç°å®å°±è¡Œäº†, è‡³äºå±ä¸å±äºæ— æ‰€è°“, æƒ³æ€ä¹ˆè¯´å°±æ€ä¹ˆè¯´å‘—, å…³é”®æ˜¯æˆ‘ä»¬å¾—çŸ¥é“, ä»€ä¹ˆæ˜¯JVM, ä»€ä¹ˆæ˜¯JDKæ‰æ˜¯é‡è¦çš„.\nIn macOS, the JDK installation path is /Library/Java/JavaVirtualMachines/jdk-10.jdk/Contents/Home/. In macOS, the JRE installation path is /Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/. ä½†æ˜¯æˆ‘å»æ‰¾jreå´æ²¡æ‰¾åˆ°, å®˜æ–¹è¯´ When you install JDK 10, the public JRE (Release 10) also gets installed automatically. ä»–è¯´çš„è¿™ç§å®‰è£…æ˜¯ä¸‹è½½dmgæ–‡ä»¶, è€Œæˆ‘ä¸‹çš„æ˜¯å…å®‰è£…ç‰ˆæœ¬çš„zipåŒ…, è§£å‹å‡ºæ¥å°±ç”¨äº†, æ‰€ä»¥ummmm, å…·ä½“ä¹Ÿä¸æ¸…æ¥šä»¥åå†æƒ³å§\u0026hellip;\n","date":"2023-07-26T21:49:41Z","permalink":"https://blog.yorforger.cc/p/jdk-jre/","title":"JDK \u0026 JRE"},{"content":" # java \u0026amp; javac ä¸¤ä¸ªæŒ‡ä»¤\nTechnically, javac is the program that translates Java code into bytecode (.class file) - an intermediate format which is understandable by the Java Virtual Machine (JVM).\nAnd java is the program that starts the JVM, which in turn, loads the .class file, verifies the bytecode and executes it.\n-classpath classpath, or -cp classpath, specifies a list of directories, JAR files, and ZIP archives to search for class files.\nOn Windows, semicolons (;) separate entities in this list; on other platforms it is a colon (:).\nSpecifying classpath overrides any setting of the CLASSPATH environment variable. If the class path option isn\u0026rsquo;t used and classpath isn\u0026rsquo;t set, then the user class path consists of the current directory (.).\næ³¨æ„ä¸Šé¢è¯´çš„, java å¯åŠ¨ JVM, ç„¶å JVM å¯¼å…¥å­—èŠ‚ç æ–‡ä»¶, åˆ«ç†è§£é”™äº†, è‡³äº -cp å°±æ˜¯ç”¨æ¥å‘Šè¯‰ JVM å»å“ªæœç´¢ç”¨ç¨‹åºä¸­åˆ°çš„ç±»çš„å­—èŠ‚ç æ–‡ä»¶.calss,\n# æ‰‹åŠ¨ç¼–è¯‘å¹¶è¿è¡Œjavaç¨‹åº ç›®å½•ç»“æ„:\n1 2 3 4 5 â”œâ”€â”€ myproject â”‚Â â””â”€â”€ src â”‚Â â”œâ”€â”€ Main.java â”‚Â â””â”€â”€ animal â”‚Â â””â”€â”€ Cat.java ä»£ç å†…å®¹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // Cat.java package animal; public class Cat { String name; public Cat(String name) { this.name = name; System.out.println(\u0026#34;mew~\u0026#34;); } } // Main.java import animal.Cat; public class Main { public static void main(String []args){ Cat cat = new Cat(\u0026#34;kitty\u0026#34;); } } åœ¨srcä¸‹ç¼–è¯‘:\n1 javac Main.java ç¼–è¯‘åå¤šå‡ºäº†ä¸¤ä¸ªå­—èŠ‚ç æ–‡ä»¶, å¦‚ä¸‹:\n1 2 3 4 5 6 7 â”œâ”€â”€ myproject â”‚Â â””â”€â”€ src â”‚Â â”œâ”€â”€ Main.class â”‚Â â”œâ”€â”€ Main.java â”‚Â â””â”€â”€ animal â”‚Â â”œâ”€â”€ Cat.class â”‚Â â””â”€â”€ Cat.java å¯ä»¥å‘ç°, æˆ‘ä»¬åªæ˜¯ç¼–è¯‘äº†Main.java, è¢«å…¶ç”¨åˆ°çš„ç±» Cat.java ä¹Ÿè¢«ç¼–è¯‘äº†, ç„¶ååœ¨å…¶å®ƒæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œè¯¥ç¨‹åº, ç”¨ -cp æ¥æŒ‡æ˜ classpath, å³å‘Šè¯‰ JVM å»å“ªæ‰¾ user-defined class å­—èŠ‚ç æ–‡ä»¶,\n1 2 $ java -cp myproject/src Main mew~ # How JVM Finds Classes è¿™ä¸ªæ ‡é¢˜æœ¬æ¥æ˜¯\u0026quot;How the Java Launcher Finds Classes\u0026quot;,å¾ˆå…·æœ‰è¿·æƒ‘æ€§, å› ä¸ºåŠ è½½ç±»çš„æ˜¯ JVM, ä¸‹é¢ä¹ŸæŒ‡å‡ºäº†æ˜¯ JVM åŠ è½½ç±», æ‰€ä»¥ç›´æ¥æ”¹äº†æ ‡é¢˜, åŸæ–‡æ¥è‡ªoracle,\nThe Java launcher, java, initiates the Java virtual machine. The virtual machine searches for and loads classes in this order:\nBootstrap classes - Classes that comprise the Java platform, including the classes in rt.jar and several other important jar files.\nExtension classes - Classes that use the Java Extension mechanism. These are bundled as .jar files located in the extensions directory.\nUser classes - Classes defined by developers and third parties that do not take advantage of the extension mechanism. You identify the location of these classes using the -classpath option on the command line (the preferred method) or by using the CLASSPATH environment variable.\nIn general, you only have to specify the location of user classes. Bootstrap classes and extension classes are found \u0026ldquo;automatically\u0026rdquo;.\næ³¨æ„è¿™é‡Œè¯´çš„å…¶å®å°±æ˜¯ç±»åŠ è½½çš„è¿‡ç¨‹, å³ JVM æ€ä¹ˆæŸ¥æ‰¾å¹¶åŠ è½½ç±»å¯¹åº”çš„æ¯ä¸ªå­—èŠ‚ç æ–‡ä»¶, è€Œä¸æ˜¯ java launcher, å®ƒåªæ˜¯è´Ÿè´£å¯åŠ¨ JVM çš„, -cp çš„ä½œç”¨åœ¨è¿™å†æ¬¡è¢«æŒ‡å‡º, å¯ä»¥å‚è€ƒä¸Šé¢çš„ä¾‹å­\n# How JVM Finds Bootstrap Classes Bootstrap classes are the classes that implement the Java 2 Platform. Bootstrap classes are in the rt.jar and several other jar files in the jre/lib directory. These archives are specified by the value of the bootstrap class path which is stored in the sun.boot.class.path system property. This system property is for reference only, and should not be directly modified.\n# How JVM Finds Extension Classes Extension classes are classes which extend the Java platform. Every .jar file in the extension directory, jre/lib/ext, is assumed to be an extension and is loaded using the Java Extension Framework. Loose class files in the extension directory will not be found. They must be contained in a .jar file (or .zip file). There is no option provided for changing the location of the extension directory.\nIf the jre/lib/ext directory contains multiple .jar files, and those files contain classes with the same name, such as:\n1 smart-extension1_0.jar contains class smart.extension.Smartsmart-extension1_1.jar contains class smart.extension.Smart the class that actually gets loaded is undefined.\n# How JVM Finds User Classes User classes are classes which build on the Java platform. To find user classes, the launcher refers to the user class path \u0026ndash; a list of directories, JAR archives, and ZIP archives which contain class files.\nA class file has a subpath name that reflects the class\u0026rsquo;s fully-qualified name. For example, if the class com.mypackage.MyClass is stored under /myclasses, then /myclasses must be in the user class path and the full path to the class file must be /myclasses/com/mypackage/MyClass.class. If the class is stored in an archive named myclasses.jar, then myclasses.jar must be in the user class path, and the class file must be stored in the archive as com/mypackage/MyClass.class.\nThe user class path is specified as a string, with a colon (:) separating the class path entries on Solaris, and a semi-colon (;) separating entries on Microsoft Windows systems. The java launcher puts the user class path string in the java.class.path system property. The possible sources of this value are:\nThe default value, \u0026ldquo;.\u0026rdquo;, meaning that user class files are all the class files in the current directory (or under it, if in a package). The value of the CLASSPATH environment variable, which overrides the default value. The value of the -cp or -classpath command line option, which overrides both the default value and the CLASSPATH value. The JAR archive specified by the -jar option, which overrides all other values. If this option is used, all user classes must come from the specified archive. åŸæ–‡:\nHow Classes are Found ","date":"2023-07-26T17:52:40Z","permalink":"https://blog.yorforger.cc/p/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8Cjava%E7%A8%8B%E5%BA%8F%E4%B9%8Bjvm%E5%8A%A0%E8%BD%BD%E7%B1%BB%E7%9A%84%E9%A1%BA%E5%BA%8F/","title":"æ‰‹åŠ¨ç¼–è¯‘è¿è¡ŒJavaç¨‹åºä¹‹JVMåŠ è½½ç±»çš„é¡ºåº"},{"content":"These problems were at the forefront of the minds of HTTP/2 developers,\nThat said, unless you are implementing a web server (or a custom client) by working with raw TCP sockets, then you wonâ€™t see any difference: all the new, low-level framing is performed by the client and server on your behalf.\nIf you are unable to attend a meeting, you might ask someone to attend \u0026ldquo;on your behalf,\u0026rdquo; meaning that they will participate in the meeting and represent your interests and opinions in your absence.\nIn fact, there are some developers who advocate for building extremely fineâ€‘grained 10â€“100 LOC services.\nNginx wrote a fantastic series on the various concepts of microservices, please give this a read.\nWhen the topic of high-performance, in-memory caching surfaces, Redis invariably stands out. Renowned for its speed, flexibility, and rich feature set, Redis has cemented its position as a top-tier caching solution. For Go developers keen on optimizing application performance, understanding Redis becomes pivotal.\nGoâ€™s concurrency features, paired with Redisâ€™s in-memory data structure store, allows developers to implement robust caching mechanisms, elevating the Go-Redis performance to new heights.\nDon\u0026rsquo;t sweat your english, I wouldn\u0026rsquo;t have pegged you for non-native if you hadn\u0026rsquo;t said anything ;)\nThus the performance increase is substantial.\nDuring todayâ€™s press conference in which Hollywood actors confirmed that they were going on strike, Duncan Crabtree-Ireland, SAG-AFTRAâ€™s chief negotiator, revealed a proposal from Hollywood studios that sounds ripped right out of a Black Mirror episode.\nA groundbreaking AI proposal that \u0026hellip;.\nSAG strike live updates: Hollywood actors join LA and NYC picket lines as union begins first day of strike. è¿™é‡Œ picket lines å…¶å®å°±æ˜¯ä¸€è¡ŒæŠ—è®®çš„äººåœ¨è¡—ä¸Š, åƒçº¿ä¸€æ ·, åŠ å…¥ picket lines å°±æ˜¯åŠ å…¥æŠ—è®®\nLOS ANGELES, July 14 (Reuters) - Striking Hollywood actors joined film and television writers on picket lines on Friday, the first day of a dual work stoppage that has forced U.S. studios to shutter productions as workers battle over pay in the streaming TV era.\nLOS ANGELES: æ´›æ‰çŸ¶ Stoppage: ç½¢å·¥ Global temperatures were soaring to historic highs as the world\u0026rsquo;s two biggest carbon emitters, the United States and China, sought on Monday to reignite talks on climate change.\nsought: seek With scientists saying the target of keeping global warming within 1.5 degrees Celsius of pre-industrial levels is moving beyond reach, evidence of the crisis was everywhere.\nProlonged high temperatures in China are threatening power grids and crops and raising concerns about a repeat of last year\u0026rsquo;s drought, the most severe in 60 years.\nProlonged: Something prolonged is long and drawn-out â€” it\u0026rsquo;s taking longer than it should. A prolonged wait is usually annoying. Moscow halts grain deal after bridge to Crimea struck\n\u0026hellip;., just hours after a blast knocked out Russia\u0026rsquo;s bridge to Crimea in what Moscow called a strike by Ukrainian sea drones.\nstrike: ä¾µè¢­, ç½¢å·¥ Teslaâ€™s revenue soars amid rampant price cutting\nrampant price cutting If you do that, you\u0026rsquo;re essentially saying, \u0026ldquo;Air travel in the United Stated is a weak link problem.\u0026rdquo; We\u0026rsquo;re limited by how good are appalling New York airports are more than by how good are best airports are.\n","date":"2023-07-14T18:50:37Z","permalink":"https://blog.yorforger.cc/p/%E8%8B%B1%E8%AF%AD%E9%98%85%E8%AF%BB%E4%B8%80/","title":"è‹±è¯­é˜…è¯»(ä¸€)"},{"content":"å†™åœ¨å‰é¢, æ¯ä¸ªäººçš„å­¦ä¹ æ–¹æ³•éƒ½ä¸ä¸€æ ·, æˆ‘çš„å¹¶ä¸ä¸€å®šé€‚åˆä½ , ä½ è¦è‡ªå·±é€šè¿‡åˆ·é¢˜æ€»ç»“å‡ºæ¥é€‚åˆè‡ªå·±çš„é«˜æ•ˆæ–¹æ³•, çŸ¥ä¹, è°·æ­Œä¸Šæœ‰å¾ˆå¤šç›¸å…³çš„æ–‡ç« , è¦å­¦ä¼šè‡ªå·±æŸ¥èµ„æ–™, ä¸æ‡‚å¾—è¦å­¦ä¼šè‡ªå·±æŸ¥, è¿™ä¹Ÿæ˜¯æœ€é‡è¦çš„èƒ½åŠ›, æ¯”å¦‚é›…æ€å¤‡è€ƒæ–¹æ³•, é›…æ€å¬åŠ›æŠ€å·§, ç„¶åç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šè®ºå›è®¨è®ºæ€ä¹ˆå­¦ä¹ é›…æ€, æ¯”å¦‚å¾®åšä¸Š, æœ‰é›…æ€è¯é¢˜, ä¸‹é¢çš„è¯„è®ºå°±ä¼šæœ‰ç›¸å…³çš„è®¨è®º, ä½ é€šè¿‡è‡ªå·±çš„æŸ¥æ‰¾æ…¢æ…¢çš„å»ä¸°å¯Œè‡ªå·±çš„çŸ¥è¯†æé«˜è‡ªå·±è¿™æ‰æ˜¯æœ€é‡è¦çš„\nä¸æ­¢æ˜¯é›…æ€, å…¶å®ƒé—®é¢˜ä¹Ÿæ˜¯ä¸€æ ·, åˆšé«˜ä¸­æ¯•ä¸šçš„æ—¶å€™é‡åˆ°äº‹æƒ…æˆ‘ä¹Ÿä¸çŸ¥é“å…·ä½“æ€ä¹ˆåš, ç¬¬ä¸€ä»¶äº‹æƒ³çš„æ˜¯é—®åˆ«äºº, é‚£åˆ«äººæ€ä¹ˆçŸ¥é“çš„å‘¢? éƒ½æ˜¯é€šè¿‡è‡ªå·±åœ¨ç½‘ä¸ŠæŸ¥èµ„æ–™ æŸ¥ç™¾åº¦ æŸ¥çŸ¥ä¹ é€›è®ºå› ç™¾åº¦è´´å§ è¿™ç§ æ…¢æ…¢çš„çŸ¥é“çš„, è¦å­¦ä¼šåˆ©ç”¨äº’è”ç½‘, æ‰‹æœºä¸æ­¢æ˜¯ç”¨æ¥æ‰“æ¸¸æˆå’ŒèŠå¤©çœ‹å°è§†é¢‘çš„å·¥å…·,\n# å¬åŠ› å¤‡è€ƒ\né»˜å†™é›…æ€ç‹ä¸Šçš„å•è¯ ç»ƒä¹ \né›…æ€çœŸé¢˜ä¸Šçš„å¬åŠ›é¢˜ å‰ä¸¤ä¸ªæœˆå¯ ä¸€å¤©å¬1~2ç¯‡ æ ¹æ®è‡ªå·±æƒ…å†µ å¬åŠ›å¯ä»¥åœ¨ æ¯æ—¥è‹±è¯­å¬åŠ› è½¯ä»¶ä¸Šæ‰¾åˆ°å¯¹åº”çš„å½•éŸ³ å…ˆä¸çœ‹ script ç›´æ¥å¬ åšä¸€é ç„¶åè‹¥å¬ä¸æ‡‚ å†å¬ä¸€é(æ ¹æ®è‡ªå·±æƒ…å†µ) ç„¶åè¿›è¡Œç²¾å¬ å³ çœ‹ç€ script ä¸€å¥ä¸€å¥çš„å¬ å¬ä¸æ‡‚çš„ çœ‹çœ‹script çœ‹çœ‹å“ªä¸ªå•è¯æ²¡å¬æ‡‚, æ˜¯å› ä¸ºè¿è¯»æ²¡å¬æ‡‚è¿˜æ˜¯å› ä¸ºä¸è®¤è¯†é‚£ä¸ªå•è¯? è¿™ä¸ªè¿‡ç¨‹å°±è¦å§ä¸è®¤è¯†çš„å•è¯å‘éŸ³ ä»¥åŠ ç‰¹æ®Šçš„è¿è¯» ç»™è®°ä¸‹æ¥, è¿™ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ ç„¶åå†ä¸çœ‹ script å¬ä¸€é ç›´åˆ°ä¸çœ‹ script ä¹Ÿå¯ä»¥å®Œå…¨å¬æ‡‚ å¯ä»¥åœ¨æ²¹ç®¡ä¸Šæ‰¾é›…æ€(IELTS) ç›¸å…³çš„è‹±è¯­ä¸»æ’­ çœ‹ä»–ä»¬çš„è§†é¢‘ ç»ƒä¹ å¬åŠ› ä¸Šé¢æåˆ°äº†è¿è¯», è½»å¬è‹±è¯­ è½¯ä»¶ä¸Š æœ‰ä¸ªèŠ‚ç›®å« ç¬é—´ç§’æ€è‹±è¯­å¬åŠ› å¯ä»¥æ¯å¤©å¬ä¸€èŠ‚ ç„¶åè®°ä¸‹æ¥ æ…¢æ…¢çš„ç»ƒä¹ , å¾ˆå¥½çš„ä¸€ä¸ªèŠ‚ç›®\n# å£è¯­ å¤‡è€ƒ\nåœ¨æ²¹ç®¡ä¸Šæ‰¾ä¸€äº›é›…æ€ç›¸å…³çš„å¤–å›½äººå¼€çš„é¢‘é“ çœ‹ä»–ä»¬çš„è§†é¢‘ æ•™ä½ è¿è¯»ä»€ä¹ˆçš„(ä¸è¦çœ‹ä¸­æ–‡è€å¸ˆæ•™çš„) ETJ English (è¿™ä¸ªæ˜¯è‹±éŸ³ å‘éŸ³å¾ˆå¥½å¬, ä½ è¦æ˜¯å–œæ¬¢ç¾éŸ³ ä¹Ÿå¯ä»¥æ‰¾ç¾éŸ³ç›¸å…³çš„ä¸»æ’­) English Speaking Success (æ²¡äº‹çš„æ—¶å€™å¤šçœ‹çœ‹è¿™ä¸ªé¢‘é“çš„è§†é¢‘ æ¶¨çŸ¥è¯† ä¹Ÿå¯ä»¥ç»ƒä¹ å¬åŠ›äº† ä½ ä¹Ÿå¯ä»¥æ‰¾è‡ªå·±å–œæ¬¢çš„ä¸»æ’­) ç»ƒä¹ \nèƒŒé¢˜åº“ èƒŒåˆ°è‡ªå·±æ„Ÿè§‰å·®ä¸å¤šå (æƒ³è±¡ç€å¯¹é¢æ˜¯å¤–å›½äººè¿™ä¹ˆé—®ä½  ä½ æ€ä¹ˆå›ç­”), è¦å›ç­”çš„éšæ„ä¸€ç‚¹, åˆ«é‚£ä¹ˆç´§å¼ , å°±åƒæ˜¯æ­£å¸¸è¯´è¯, å› ä¸ºè¿™ä¸ªè€ƒè¯•å…¶å®æµ‹è¯•çš„å°±æ˜¯ä½ çš„è¯­è¨€èƒ½åŠ›, æ²¡æœ‰æ‰€è°“çš„æ­£ç¡®é”™è¯¯ç­”æ¡ˆ, ä½ åªè¦è¡¨è¾¾å‡ºä½ çš„è§‚ç‚¹, å°±åƒæ˜¯åœ¨å’Œæœ‹å‹èŠå¤©, è¶Šè‡ªç„¶è¶Šå¥½ å£è¯­é¢˜åº“ç½‘ä¸Šæœ‰å¾ˆå¤š, å¯ä»¥è‡ªå·±æœ, æ¯ä¸‰å››ä¸ªæœˆé¢˜åº“å°±ä¼šæ›´æ–°ä¸€æ¬¡, è¿™é‡Œç»™ä½ ä¸€ä¸ª: 2023å¹´é›…æ€å£è¯­é¢˜åº“5æœˆ-8æœˆå®Œæ•´ç‰ˆï¼ˆå«ç­”æ¡ˆï¼‰æ±‡æ€»_é›…æ€_æ–°ä¸œæ–¹åœ¨çº¿\n# é˜…è¯» è‡³äºé˜…è¯»æ²¡å•¥å¥½è¯´çš„, ä½†ä¹Ÿæœ‰åšé¢˜æŠ€å·§, æ¯”å¦‚ä¸€èˆ¬é˜…è¯»ææ–™ä¼šå¾ˆé•¿, è€ƒè¯•çš„æ—¶å€™ä¸ä¼šå…¨éƒ¨è¯»å®Œ, ä¸€èˆ¬çš„åšæ³•æ˜¯å…ˆçœ‹é—®é¢˜, ç„¶åè¿…é€Ÿåœ¨åŸæ–‡ä¸­å®šä½é—®é¢˜çš„ä½ç½®, é˜…è¯»å¯¹åº”çš„ä½ç½®, ä½†æ˜¯ä½ ç»ƒä¹ çš„æ—¶å€™è‚¯å®šè¦æ¯ä¸ªå¥å­éƒ½è¯», é‡åˆ°ä¸ä¼šçš„å•è¯éƒ½è¦è®°ä¸‹æ¥, åšé”™çš„é¢˜å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾å¯¹åº”çš„è§£æ, çœ‹çœ‹è‡ªå·±ä¸ºå•¥é”™äº†, æƒ³æƒ³å‡ºé¢˜äººçš„æ€è·¯, ç„¶åä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜è¦æ€ä¹ˆåš, åæ€æ˜¯æœ€é‡è¦çš„,\nå…³äºé¢˜çš„åˆ†æ, ä½ å¯ä»¥ä¸‹è½½ä¸ª é›…æ€å“¥ , ä¸Šé¢æœ‰é˜…è¯»å¯¹åº”çš„ç­”æ¡ˆè§£æ, å½“ç„¶ä½ ä¹Ÿå¯ä»¥å»æŸ¥æŸ¥å…¶å®ƒçš„åœ¨ç½‘ä¸Š, å­¦ä¼šåˆ©ç”¨ç½‘ç»œæŸ¥ä¸œè¥¿\u0026hellip;\nå¦‚: é›…æ€é˜…è¯»éƒ¨åˆ†å¦‚ä½•æé«˜ï¼Ÿ - çŸ¥ä¹ è¿™ä¸‹é¢çš„å›ç­”å¯ä»¥å¤šçœ‹å‡ ä¸ª, æœ‰æ—¶å€™å¹¶ä¸æ˜¯ç‚¹èµæœ€å¤šçš„å†™çš„å°±æ˜¯æœ€å¥½çš„\næ—¢ç„¶æœ‰äº†å–œæ¬¢çš„ä¸œè¥¿å°±è¦åŠªåŠ›å»è¿½, ä¸‰åˆ†é’Ÿçƒ­åº¦, æœ€ååªèƒ½æ˜¯ä»€ä¹ˆéƒ½åšä¸åˆ° sow nothing, reap nothing.\nåŠ æ²¹!\n","date":"2023-07-02T20:40:25Z","permalink":"https://blog.yorforger.cc/p/%E5%A4%87%E8%80%83%E9%9B%85%E6%80%9D/","title":"å¤‡è€ƒé›…æ€"},{"content":"ä½¿ç”¨ npm install xxx, ç„¶åæ€»æ˜¯å®‰è£…åˆ° ~/node_modules/, æŸ¥äº†å¥½å¤š, æœ‰çš„è¯´ç”¨ npm config list æŸ¥çœ‹ global çš„å€¼, æ”¹ä¸º false ä»€ä¹ˆ, éƒ½æ²¡æœ‰ç”¨,\nå¸è½½ node å’Œ npm é‡è£…ä¾æ—§ä¸èƒ½è§£å†³,\næœ€ååˆ é™¤äº† ~/node_modules/ æ–‡ä»¶å¤¹å’Œ ~/ ä¸‹çš„æ‰€æœ‰ npm ç›¸å…³æ–‡ä»¶å¤¹, ç„¶åè¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹, é‡æ–°è¿è¡Œ npm install xxx åæœ¬åœ°æ–‡ä»¶å¤¹è‡ªåŠ¨åˆ›å»º node_modules, å®‰è£…æˆåŠŸ.\n1 2 3 4 5 6 7 8 9 $ mkdir jslearn \u0026amp;\u0026amp; cd jslearn $ npm install cors added 3 packages in 466ms $ ls node_modules package-lock.json package.json # ä½ çœ‹ä¸ç”¨ npm init åœ¨çŸ¥ä¹çœ‹åˆ°çš„å›ç­”:\nnpmçš„åŸç†å¤§æ¦‚å°±æ˜¯ä»å½“å‰ç›®å½•å¾€ä¸Šæ‰¾ï¼Œæ‰¾åˆ°å“ªä¸ªç›®å½•æœ‰node_moduleså°±è®¤ä¸ºè¿™æ‰æ˜¯çœŸæ­£çš„é¡¹ç›®ç›®å½•ï¼Œæ‰€ä»¥ä¸œè¥¿å…¨ç»™è£…é‚£é‡Œé¢å», æ‰€ä»¥ä¸ä»…ä»…æ˜¯Useræ ¹ç›®å½•çš„é—®é¢˜ï¼Œä½ å¾—ä¿è¯ä»ä½ å½“å‰çš„ç›®å½•å¼€å§‹ä¸€ç›´åˆ°æ ¹ç›®å½•éƒ½æ²¡æœ‰node_modulesï¼Œnpmæ‰ä¼šâ€œæ­£å¸¸â€åœ°æŠŠä¸œè¥¿æ”¾åˆ°å½“å‰ç›®å½•ä¸‹çš„node_modulesé‡Œ åŸæ–‡\nå¦å¤–:\n-S is shorthand for --save, and it adds the package you\u0026rsquo;re installing to the dependencies in your package.json file (which can be created with npm init). However, --save or -S is totally unnecessary if you\u0026rsquo;re using npm 5 or above since it\u0026rsquo;s done by default. https://stackoverflow.com/a/58475949/16317008\n","date":"2023-06-27T11:24:35Z","permalink":"https://blog.yorforger.cc/p/npm%E6%80%BB%E6%98%AF%E5%AE%89%E8%A3%85package%E5%88%B0%E5%85%A8%E5%B1%80%E9%97%AE%E9%A2%98-%E5%B7%B2%E8%A7%A3%E5%86%B3/","title":"npmæ€»æ˜¯å®‰è£…packageåˆ°å…¨å±€é—®é¢˜ (å·²è§£å†³)"},{"content":" # 1. Objects are values in Javascript {} å°±æ˜¯ä¸ªç©ºå¯¹è±¡, {} åœ¨ Python é‡Œæ˜¯ä¸ª dictionary, å½“ç„¶ dictionary ä¹Ÿæ˜¯ä¸ªå¯¹è±¡,\nåœ¨è¯´ç»§æ‰¿ä¹‹å‰è¿˜è¦æä¸€ä¸‹ JS å¯¹è±¡ä¸å…¶å®ƒè¯­è¨€ä¸åŒçš„åœ°æ–¹, ä¸¾ä¸ªä¾‹å­,\n1 2 3 4 5 6 7 8 9 10 const student = { name: \u0026#39;John\u0026#39;, study: function () { return \u0026#39;study\u0026#39; } } console.log(student) // { name: \u0026#39;John\u0026#39;, study: [Function: study] } student.age = 99 // è¿™é‡Œæ²¡æœ‰å‡ºé”™ç«Ÿç„¶! console.log(student) // { name: \u0026#39;John\u0026#39;, study: [Function: study], age: 99 } åœ¨å…¶å®ƒé¢å‘å¯¹è±¡è¯­è¨€é‡Œ, å¦‚æœæˆ‘ä»¬å°è¯•èµ‹å€¼æˆ–è€…è®¿é—®å¯¹è±¡ä¸å­˜åœ¨çš„ fieldå°±ä¼šæŠ¥é”™, åœ¨ JS é‡Œå¹¶ä¸ä¼š, å½“ä½ å°è¯•è¯»å–ä¸å­˜åœ¨çš„ feild çš„æ—¶å€™ (åŒ…æ‹¬ prototype chain, ä¸‹é¢ä¼šè®¨è®º) æ‰ä¼šæŠ¥é”™,\nåŸå› æ˜¯, JS çš„å¯¹è±¡ä¸å…¶å®ƒè¯­è¨€å¦‚ Java, Pythonä¸åŒ, Javaé‡Œå¯¹è±¡çš„ fields æ˜¯æœ‰ç±»å†³å®šçš„, ç±»ä¼¼æ‰€æœ‰å¯¹è±¡çš„è“å›¾, JSå¹¶ä¸æ˜¯, JSé‡Œçš„å¯¹è±¡ä¸æ˜¯ç”±ç±»åˆ›å»ºçš„, æ›´åƒä¸€ä¸ª map,\næˆ‘ä»¬çŸ¥é“ JS çš„å€¼åˆ†ä¸ºä¸¤ç±», Primitive values: immutable, object values: mutable, è¿™é‡Œçš„ mutable å…¶å®å°±æ˜¯æŒ‡ ä½ å¯ä»¥éšæ„ç»™å¯¹è±¡å¢åŠ å±æ€§, ä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªvalue,\nå½“å°è¯•è¯»å–å¯¹è±¡çš„å±æ€§æ—¶, ä¼šè§¦å‘ prototype chain, çœ‹ä¸‹é¢ä»£ç :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 const person = { name: \u0026#39;Jack\u0026#39;, sayHello: function () { console.log(\u0026#39;hello from \u0026#39; + this.name) }, } // æ³¨æ„: é€šè¿‡å¯¹è±¡å±æ€§ __proto__ è®¿é—®å¯¹è±¡ prototype const student = { age: 13, __proto__: person } console.log(student.name) // studentæ²¡æœ‰nameå±æ€§, é€šè¿‡prototype chainè®¿é—®å…¶ä»–å¯¹è±¡çš„nameå±æ€§ console.log(student) // { age: 13 } student.name = \u0026#39;John\u0026#39; // ä¸º student åˆ›å»ºæ–°å±æ€§ name console.log(student.name) // student æ­¤æ—¶å·²æœ‰nameå±æ€§ ç›´æ¥è®¿é—®å…¶nameå±æ€§ console.log(student) // { age: 13, name: \u0026#39;John\u0026#39; } student.sayHello() // å› studentæ— sayHelloå‡½æ•°, é€šè¿‡prototype chainæŸ¥æ‰¾sayHelloå‡½æ•°, æ‰¾åˆ°å, sayHelloä¸­çš„thisè¢«æ›¿æ¢ä¸ºstudent # 2. Prototype # 2.1. Ways to access prototype Every object value in JavaScript has a built-in property, which is called its prototype. The prototype is itself an object value, so the prototype will have its own prototype, making what\u0026rsquo;s called a prototype chain. The chain ends when we reach a prototype that has null for its own prototype.\nå…³äºprototypeæœ‰ä¸€ä¸ªè¿·æƒ‘çš„åœ°æ–¹, é€šè¿‡obj.prototypeè®¿é—®åˆ°çš„å¹¶ä¸æ˜¯ä¸Šé¢æˆ‘ä»¬è®¨è®ºçš„prototype, åªèƒ½é€šè¿‡obj.__proto__å’Œå…¨å±€å‡½æ•°Object.getPrototypeOf()æ¥è·å–ä¸€ä¸ªå¯¹è±¡çš„prototypeå±æ€§:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 const person = { name: \u0026#39;Jack\u0026#39;, greet: function () { return \u0026#39;Hi, I am\u0026#39; + this.name; } } console.log(person.prototype) console.log(person.__proto__) console.log(Object.getPrototypeOf(person)) // undefined // [Object: null prototype] {} // [Object: null prototype] {} æ ¹æ®æ‰“å°å¯ä»¥çœ‹å‡º person.prototypeè·Ÿperson.__proto__å‹æ ¹å°±ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿,\n# 2.2. Prototype çš„è·å–ä¸èµ‹å€¼ obj.__proto__ ä¸æ˜¯è®¿é—®å¯¹è±¡ prototype å±æ€§çš„æ ‡å‡†æ–¹æ³•, å› ä¸ºæœ‰çš„browserå¯èƒ½æ²¡å®ç°, æ‰€ä»¥è®¿é—®(åªè¯»)ä¸€èˆ¬ç”¨Object.getPrototypeOf(student), é€šè¿‡åˆ›å»ºè¯¥å¯¹è±¡çš„æ—¶å€™ä¸ºå…¶ __proto__ å±æ€§èµ‹å€¼çš„æ–¹æ³•ç»™ä¸€ä¸ªå¯¹è±¡çš„ prototype èµ‹å€¼, å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 const person = { name: \u0026#39;Jack\u0026#39;, sayHello: function () { console.log(\u0026#39;hello from \u0026#39; + this.name) }, } const student = { age: 13, // Check the assignment here: __proto__: person } console.log(Object.getPrototypeOf(student)) // { name: \u0026#39;Jack\u0026#39;, sayHello: [Function: sayHello] } // æˆ–è€…åˆ›å»ºå¯¹è±¡åèµ‹å€¼, student.__proto__ = person // æ³¨æ„è‹¥studentæ²¡æœ‰__proto__å±æ€§åˆ™è¿™é‡Œè‡ªåŠ¨ä¸ºstudentåˆ›å»º__proto__å¹¶èµ‹å€¼, èµ‹å€¼åæˆ‘ä»¬å°±å¯ä»¥è®¿é—®äº† // æ‰€ä»¥è¿™å’Œä¸Šé¢æˆ‘ä»¬è¯´çš„ä¸è¦é€šè¿‡ `obj.__proto__` è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„ prototype å¹¶ä¸çŸ›ç›¾ # 3. Prototype Chain çš„æ„ä¹‰ Javascript is an object-based language, not a class-based language.\nIf you know Java or C++, you should be familiar with the inheritance concept. In this programming paradigm, a class is a blueprint for creating objects. If you want a new class to reuse the functionality of an existing class, you can create a new class that extends the existing class. This is called classical inheritance.\nJavaScript doesnâ€™t use classical inheritance. Instead, it uses prototypal inheritance. In prototypal inheritance, an object â€œinheritsâ€ properties from another object via the prototype linkage.\nPrototype chain çš„æ„ä¹‰æ­£æ˜¯ä»£æ›¿äº†ä¼ ç»Ÿè¯­è¨€ä¸­çš„ç»§æ‰¿æœºåˆ¶, åªä¸è¿‡æ˜¯å¯¹è±¡ä¹‹é—´çš„ç»§æ‰¿, è€Œä¸æ˜¯ç±»ä¹‹é—´,\n# 4. Javascript ä¸å­˜åœ¨çœŸæ­£çš„ç±» JS ä¸å­˜åœ¨çœŸæ­£çš„ç±», å³ä½¿æ˜¯ES6ä¹‹åçš„ç±»ä¹Ÿä¸è¿‡æ˜¯ä¸ªè¯­æ³•ç³– (syntactic sugar) è€Œå·²,\n1 2 3 4 5 6 7 8 9 10 class Person { constructor(name) { this.name = name; } getName() { return this.name; } } console.log(typeof Person); //function Unlike other programming languages such as Java and C#, JavaScript classes are syntactic sugar over the prototypal inheritance. In other words, ES6 classes are just special functions. But class declarations are not hoisted like function declarations.\nä¸Šé¢æåˆ° obj.prototype å’Œ obj.__proto__ ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿, å½“åˆ›å»ºå¯¹è±¡å (é™¤å‡½æ•°å¯¹è±¡) å®ƒä»¬çš„ obj.prototype æ˜¯ undefined, è€Œåˆ›å»ºå‡½æ•°å¯¹è±¡å, è¿™ä¸ªå‡½æ•°çš„func.prototypeä¼šè¢«è‡ªåŠ¨åˆ›å»º, å¹¶ä¸”å€¼ä¸ºä¸€ä¸ªç©ºå¯¹è±¡{}:\n1 2 3 4 5 6 7 8 9 10 const func = function () { this.name = \u0026#39;John\u0026#39;; } const cap = { size: 36, price: \u0026#39;30CAD\u0026#39;, } console.log(func.prototype); //{} console.log(cap.prototype); //undefined æ€è€ƒä¸‹é¢ä»£ç å‘ç”Ÿäº†ä»€ä¹ˆ:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 function Person(name) { this.name = name; } Person.prototype.getName = function () { return this.name; }; console.log(Person.prototype); // { getName: [Function (anonymous)] } const john = new Person(\u0026#34;John Doe\u0026#34;); console.log(Object.getPrototypeOf(john)); // { getName: [Function (anonymous)] } console.log(john); // Person { name: \u0026#39;John Doe\u0026#39; } console.log(john.getName()); // John Doe ç¬¬ä¸€æ­¥å‘ç”Ÿåœ¨å®šä¹‰å‡½æ•°Personæ—¶:\nPerson.prototype è¢«åˆ›å»º, å¹¶è¢«èµ‹å€¼ä¸ºä¸€ä¸ªç©ºå¯¹è±¡{}\nPerson.prototype å¯¹è±¡å¢åŠ ä¸€ä¸ªå‡½æ•° getName()\næ­¤æ—¶ Person.prototype ä¸å†æ˜¯ä¸ªç©ºå¯¹è±¡, è€Œæ˜¯æœ‰ä¸€ä¸ªåä¸ºgetNameå‡½æ•°çš„å¯¹è±¡{ getName: [Function (anonymous)] }\nä¹‹åä¸‰æ­¥å‘ç”Ÿåœ¨è°ƒç”¨new Person(\u0026quot;John Doe\u0026quot;)æ—¶:\næ–°åˆ›å»ºç©ºå¯¹è±¡{}å¹¶èµ‹å€¼ç»™john æ‰§è¡Œjohn.__proto__ = Person.prototype æ‰§è¡Œå‡½æ•°Person, å‡½æ•°ä½“é‡Œçš„ this.name = nameå˜ä¸º john.name = name ç»¼ä¸Š: The john object is an instance of the Person through prototypal inheritance.\nå‚è€ƒ:\nhttps://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_prototypes https://stackoverflow.com/a/34948211/16317008 https://www.javascripttutorial.net/es6/javascript-class/ ","date":"2023-06-21T11:08:32Z","permalink":"https://blog.yorforger.cc/p/js-%E7%BB%A7%E6%89%BF%E4%B9%8B-prototype-chain-%E7%9A%84%E6%84%8F%E4%B9%89/","title":"JS ç»§æ‰¿ä¹‹ Prototype Chain çš„æ„ä¹‰"},{"content":" # 1. Javascript objects åœ¨å…¶ä»–è¯­è¨€, å¦‚C++,Java, å¯¹è±¡æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹(instance), å¯¹è±¡å¿…é¡»ç”±å¯¹åº”ç±»çš„constructorç”Ÿæˆ.\nå¯æ˜¯åœ¨JSé‡Œé¢, ç±»çš„æ¦‚å¿µå˜å¾—æ¨¡ç³Šäº†, æˆ‘å¾ˆå°‘ç”¨åˆ° new, ä½†åˆæœ‰äººè¯´ â€œJavaScript is designed on a simple object-based paradigmâ€, Iâ€˜m confused now.\nä»€ä¹ˆæ˜¯variable, type, type å’Œ object çš„å…³ç³»æ˜¯ä»€ä¹ˆ? ä»€ä¹ˆåˆæ˜¯value? æˆ‘å°è¯•åœ¨è¿·æƒ‘ä¸­æ‰¾å‡ºç­”æ¡ˆ:\nJavascript is dynamic language, which means values have types, not variables.\nValues can have two main types: primitives (immutable), object.\næ‰€ä»¥ object æ˜¯ data types ä¸­çš„ä¸€ç§, æ˜¾ç„¶è¿™å’Œå…¶ä»–è¯­è¨€ä¸ä¸€æ ·, é‚£ object type å…·ä½“æ˜¯ä»€ä¹ˆå‘¢?\nAn object is a collection of properties, and a property is an association between a name (or key) and a value. A cup is an object, with properties. A cup has a color, a design, weight, a material it is made of, etc. The same way, JavaScript objects can have properties, which define their characteristics.\næ¯å­æœ‰é¢œè‰², å®¹é‡ç­‰å±æ€§, é¢œè‰²æ¯”å¦‚è“è‰², å®¹é‡1000ml, è“è‰², 1000mlå°±æ˜¯æ‰€è°“çš„ value, è¿™ä¸ª value æœ‰ type (type å¯ä»¥æ˜¯ object æˆ– primitives), å‰è€…è“è‰²æ˜¯string, åè€…1000æ˜¯numberç±»å‹. color=\u0026quot;bule\u0026quot; è¿™å°±æ˜¯å¯¹è±¡çš„ä¸€ä¸ªå±æ€§. çªç„¶æ„Ÿè§‰JSé‡Œçš„å¯¹è±¡æ›´åƒæ˜¯å…¶ä»–è¯­è¨€é‡Œçš„ç±», åªæ˜¯jsçš„å¯¹è±¡æ²¡æœ‰æ„é€ å‡½æ•°, ä¸èƒ½å®ä¾‹åŒ–.\næ‰€ä»¥ç°åœ¨ææ¸…æ¥šäº†ä»€ä¹ˆæ˜¯ object type, é‚£å°±çœ‹çœ‹å¦å¤–çš„ä¸€ä¸ª primitives type,\n# 2. Data types in JS ç±»å‹å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±» primitive values and objects (Java çš„æ˜¯ primitive types å’Œ reference type)\n1. Primitive values (immutable datum represented directly at the lowest level of the language)\nBoolean type Null type Undefined type Number type: æ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­, æ¯å­çš„property: å®¹é‡çš„value: 1000, çš„typeå°±æ˜¯ Number type String type: æ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­, æ¯å­çš„property: é¢œè‰²çš„value: blue, çš„typeå°±æ˜¯ String type 2. Objects (collections of properties)\nè¯´ç™½äº† JS ä¸­çš„å¯¹è±¡å°±æ˜¯ä¸ªå€¼, åªä¸è¿‡è¿™ä¸ªå€¼çš„ç±»å‹æ˜¯å¯¹è±¡, åˆ°è¿™ä¹Ÿç®—æ˜¯å¼„æ¸…äº†å…¶ä¸­çš„å…³ç³», object, value, type, variable. è¿™ä¸€åˆ‡ä»æ¯å­å¼€å§‹ä¸¾ä¾‹, ä¾¿å¯ä»¥æ‹æ¸…å…³ç³». å˜é‡æœ‰ç±»å‹å—? ä¸¥æ ¼æ¥è¯´æ²¡æœ‰type, æ˜¯å˜é‡çš„å€¼æ‰æœ‰ç±»å‹. å¯¹è±¡å’Œå˜é‡çš„å…³ç³»å‘¢? å˜é‡çš„å€¼çš„ç±»å‹å¯ä»¥æ˜¯å¯¹è±¡.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 let person = { firstName:\u0026#34;John\u0026#34;, lastName:\u0026#34;Doe\u0026#34;, age:50, eyeColor:\u0026#34;blue\u0026#34;, eat: (food)=\u0026gt;{} }; // or let person = new Object(); person.firstName = \u0026#34;John\u0026#34;; person.lastName = \u0026#34;Doe\u0026#34;; person.age = 50; person.eyeColor = \u0026#34;blue\u0026#34;; JS çš„å¯¹è±¡é•¿å¾—å¾ˆåƒ json, æ‰€ä»¥åœ¨ä»¥åçš„å­¦ä¹ ä¸­ä¸è¦ä¸jsonå¼„æ··.\n# 3. \u0026ldquo;everything is an object in Javascript\u0026rdquo;, Really? No, not everything is an object in JavaScript. Many things that you interact with regularly (strings, numbers, booleans) are primitives, not objects. Unlike objects, primitive values are immutable. The situation is complicated by the fact that these primitives do have object wrappers (String, Number and Boolean); these objects have methods and properties while the primitives do not, but the primitives appear to have methods because JavaScript silently creates a wrapper object when code attempts to access any property of a primitive.\nFor example, consider the following code:\n1 2 var s = \u0026#34;foo\u0026#34;; var sub = s.substring(1, 2); // sub is now the string \u0026#34;o\u0026#34; Behind the scenes, s.substring(1, 2) behaves as if it is performing the following (approximate) steps:\nCreate a wrapper String object from s, equivalent to using new String(s) Call the substring() method with the appropriate parameters on the String object returned by step 1 Dispose of the String object Return the string (primitive) from step 2. A consequence of this is that while it looks as though you can assign properties to primitives, it is pointless because you cannot retrieve them:\n1 2 3 var s = \u0026#34;foo\u0026#34;; s.bar = \u0026#34;cheese\u0026#34;; alert(s.bar); // undefined This happens because the property is effectively defined on a String object that is immediately discarded.'\nNumbers and Booleans also behave this way. Functions, however, are fully-fledged objects, and inherit from Object (actually Object.prototype, but that\u0026rsquo;s another topic). Functions therefore can do anything objects can, including having properties:\n1 2 3 function foo() {} foo.bar = \u0026#34;tea\u0026#34;; alert(foo.bar); // tea Original post: https://stackoverflow.com/a/9110389/16317008\n# 4. JS Collections The key difference is that Objects only support string and Symbol keys where as Maps support more or less any key type. https://stackoverflow.com/a/37994079/16317008\nThe keys of an Object are Strings or Symbols, where they can be of any value for a Map. You can get the size of a Map easily, while you have to manually keep track of size for an Object. These three tips can help you to decide whether to use a Map or an Object:\nUse maps over objects when keys are unknown until run time, and when all keys are the same type and all values are the same type. Use maps if there is a need to store primitive values as keys because object treats each key as a string whether it\u0026rsquo;s a number value, boolean value or any other primitive value. Use objects when there is logic that operates on individual elements. It is useful to remember which operations on arrays mutate them, and which donâ€™t. For example, push, pop, reverse, and sort will mutate the original array, but slice, filter, and map will create a new one.\nReferences: Keyed collections - JavaScript | MDN\n","date":"2023-06-20T20:51:31Z","permalink":"https://blog.yorforger.cc/p/objects-collections-in-javascript/","title":"Objects \u0026 Collections in Javascript"},{"content":" # 1. List # 1.1. Indexing right to left, use negative number, start from -1\nleft to right, use positive number, start form 0\n1 2 3 4 5 arr = [1, 2, 3] print(arr[-1]) # 3 print(arr[0]) # 1 print(arr[:-2]) # [1] print(arr[-4]) # error: out of range # 1.2. Reslice makes shallow copy 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 cat = { \u0026#34;name\u0026#34;: \u0026#34;Coco\u0026#34;, \u0026#34;age\u0026#34;: 3.5, } original_list = [cat, 2, 3, 4, 5] copied_list = original_list[:3] print(\u0026#34;Original list:\u0026#34;, original_list) print(\u0026#34;Copied list:\u0026#34;, copied_list) copied_list[1] = 999 copied_list[0][\u0026#34;name\u0026#34;] = \u0026#34;Bella\u0026#34; print(\u0026#34;Original list (after modification):\u0026#34;, original_list) print(\u0026#34;Copied list (after modification):\u0026#34;, copied_list) Output:\n1 2 3 4 Original list: [{\u0026#39;name\u0026#39;: \u0026#39;Coco\u0026#39;, \u0026#39;age\u0026#39;: 3.5}, 2, 3, 4, 5] Copied list: [{\u0026#39;name\u0026#39;: \u0026#39;Coco\u0026#39;, \u0026#39;age\u0026#39;: 3.5}, 2, 3] Original list (after modification): [{\u0026#39;name\u0026#39;: \u0026#39;Bella\u0026#39;, \u0026#39;age\u0026#39;: 3.5}, 2, 3, 4, 5] Copied list (after modification): [{\u0026#39;name\u0026#39;: \u0026#39;Bella\u0026#39;, \u0026#39;age\u0026#39;: 3.5}, 999, 3] The [:] makes a shallow copy of the array, hence allowing you to modify your copy without damaging the original. The reason this also works for strings is that in Python, Strings are arrays of bytes representing Unicode characters. What does [:] mean in Python?\nThis is similar to reslicing in Golang, but not same, in Gloang the new slice shares a same underlying array with it resliced from, whereas Python will create a new list object directly.\n# 1.3. Reslicing in Golang and Python Python: When you new_list = old_list[start:end], a new list object is created and the elements from the specified slice are copied over (shallow copy) to this new list. This means the original list and the new list are completely independent of each other â€“ changing one will not affect the other.\n1 2 3 4 5 6 7 8 9 10 11 12 # Python Example original_list = [1, 2, 3, 4, 5] sliced_list = original_list[:3] original_list[0] = 99 sliced_list[1] = 101 print(\u0026#34;Original list:\u0026#34;, original_list) print(\u0026#34;Sliced list:\u0026#34;, sliced_list) # output Original list: [99, 2, 3, 4, 5] Sliced list: [1, 101, 3] Go: the new slice created from reslicing does not copy the elements. Instead, it refers to the same underlying array as the original slice.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func main() { originalSlice := []int{1, 2, 3, 4, 5} newSlice := originalSlice[:3] originalSlice[0] = 99 // This also changes newSlice[0] newSlice[1] = 101 // This also changes originalSlice[1] fmt.Println(\u0026#34;Original slice:\u0026#34;, originalSlice) fmt.Println(\u0026#34;New slice:\u0026#34;, newSlice) } // ouput Original slice: [99 101 3 4 5] New slice: [99 101 3] # 2. Dictionary 1 2 3 dict = {\u0026#39;a\u0026#39;: 1} print(dict[\u0026#39;b\u0026#39;]) # Raise a KeyError print(dict.get(\u0026#39;b\u0026#39;, 0)) # Print 0, with a default value e.g.,\n1 2 3 4 5 6 7 8 9 10 11 12 # calculate the frequency of the words def count_words(word_list): word_count = {} for word in word_list: if word in word_count: word_count[word] += 1 else: word_count[word] = 1 return word_count words = [\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;cherry\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;apple\u0026#34;] total, count = count_words(words) # 3. Set Duplicates Not Allowed\nSet items are unordered, unchangeable, and do not allow duplicate values. Unordered\nSet items can appear in a different order every time you use them, and cannot be referred to by index or key. Unchangeable\nOnce a set is created, you cannot change its items, but you can remove items and add new items. 1 2 3 4 5 6 # because duplicates not allowed, we can use this nature to remove duplicated words def find_missing_words(word_list_1, word_list_2): set1 = set(word_list_1) set2 = set(word_list_2) mis_words = set1 - set2 return mis_words ","date":"2023-06-17T22:51:31Z","permalink":"https://blog.yorforger.cc/p/collections-in-python/","title":"Collections in Python"},{"content":" # 1. ECMAScript vs JavaScript ECMAScript = ES:\nECMAScript is a Standard for scripting languages. Languages like Javascript are based on the ECMAScript standard. JavaScript = JS:\nJavaScript is the most popular implementation of the ECMAScript Standard. The core features of Javascript are based on the ECMAScript standard, but Javascript also has other additional features that are not in the ECMA specifications/standard. Every browser has a JavaScript interpreter. ES5 = ECMAScript 5:\nES5 is a version of the ECMAScript. ES5 does not require a build step (transpilers) to transform it into something that will run in today\u0026rsquo;s browsers. ECMAScript version 5 was finished in December 2009, the latest versions of all major browsers (Chrome, Safari, Firefox, and IE) have implemented version 5. ES6 = ES2015:\nES2015 is a version of the ECMAScript (new/future one). Officially the name ES2015 should be used instead of ES6. There are quite a few transpilers that will export ES5 for running in browsers. TypeScript and CoffeeScript:\nBoth provides syntactic sugar on top of ES5 and then are transcompiled into ES5 compliant JavaScript. You write TypeScript or CoffeeScript then the transpiler transforms it into ES5 JavaScript. Source: https://stackoverflow.com/a/33748400/16317008\n# 2. CommonJS vs ES Modules CommonJS is an older module system for JavaScript that was designed for server-side JavaScript development with Node.js.\n1 2 3 4 5 6 7 8 9 // my-module.js module.exports cat = { age: 2, name: \u0026#34;Coco\u0026#34; }; // main.js const cat = require(\u0026#39;./my-module.js\u0026#39;); console.log(cat.name); // 42 ES modules are a standardized module system for JavaScript that was introduced in ES6. It provides a way to organize and reuse code in a modular and maintainable manner.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // foo.js function sayHello() { console.log(\u0026#39;hello\u0026#39;) } let a = 100 export {a, sayHello} // main.js import {a, sayHello} from \u0026#34;./foo\u0026#34;; console.log(a) sayHello() As of right now ES6 import, export is always compiled to CommonJS, so there is no benefit using one or other. Although usage of ES6 is recommended since it should be advantageous when native support from browsers released. The reason being, you can import partials from one file while with CommonJS you have to require all of the file. Source\nNote that you need to add \u0026quot;type\u0026quot;: \u0026quot;module\u0026quot; in package.json file if you want use ES modules syntax.\n# 3. ES2015 New Features ECMAScript 2015 introduces two new ways of declaring variables: let and const.\nArrow Functions and Lexical this\nJavaScript Classes\nECMAScript 2015 Promises\nLearn more: A Rundown of JavaScript 2015 features\n","date":"2023-06-13T10:36:28Z","permalink":"https://blog.yorforger.cc/p/ecmascript-vs-javascript-commonjs-vs-es-modules/","title":"ECMAScript vs JavaScript \u0026 CommonJS vs ES Modules"},{"content":" # 1. SSH åº”å¯¹ä¸­é—´äººæ”»å‡»çš„æ–¹æ³• SSH é‡‡ç”¨äº†å…¬é’¥åŠ å¯†, è¿‡ç¨‹å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰Remote Host æ”¶åˆ°ç”¨æˆ·çš„ç™»å½•è¯·æ±‚, æŠŠè‡ªå·±çš„å…¬é’¥å‘ç»™ç”¨æˆ·\nï¼ˆ2ï¼‰ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªå…¬é’¥, å°†ç™»å½•å¯†ç åŠ å¯†å, å‘é€è¿‡å»\nï¼ˆ3ï¼‰Remote Host ç”¨è‡ªå·±çš„ç§é’¥, è§£å¯†ä¿¡æ¯, éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®\nè¿™ä¸ªè¿‡ç¨‹å­˜åœ¨ä¸€ä¸ªæ¼æ´ï¼šå¦‚æœæœ‰äººæˆªè·äº†ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ï¼Œç„¶åå†’å…… Remote Hostï¼Œå°†ä¼ªé€ çš„å…¬é’¥å‘ç»™ç”¨æˆ·ï¼Œé‚£ä¹ˆç”¨æˆ·å¾ˆéš¾è¾¨åˆ«çœŸä¼ªã€‚è¿™å°±æ˜¯ Man-in-the-middle attack, åº”å¯¹æ–¹æ³•æœ‰ä¸¤ç§:\nåˆ©ç”¨å…¬é’¥æŒ‡çº¹äººå·¥è¿›è¡Œå¯¹æ¯”éªŒè¯, ä¸Šä¼ å…¬é’¥å®ç°å…å¯†ç™»å½• æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸€ä»‹ç»è¿™ä¸¤ç§æ–¹æ³•,\n# 2. åˆ©ç”¨å…¬é’¥æŒ‡çº¹äººå·¥è¿›è¡Œå¯¹æ¯”éªŒè¯ çœ‹æ¥é¢çš„ä¾‹å­, åœ¨Macä¸Šé€šè¿‡sshè¿æ¥è¿œç¨‹çš„æœåŠ¡å™¨, ç¬¬ä¸€æ¬¡è¿æ¥çš„æ—¶å€™ä¼šé—®ä¸‹é¢æç¤º:\n1 2 3 4 5 6 ssh root@144.202.16.29 The authenticity of host \u0026#39;144.202.16.29 (144.202.16.29)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:sa5vDYS0yhdMRXO6CgMrp9AcQoVQRiDw6TnzTKesnzQ. This key is not known by any other names Are you sure you want to continue connecting (yes/no/[fingerprint])? yes .... è¿™æ˜¯ ssh åœ¨æé†’å®ƒæ— æ³•ç¡®è®¤ remost host æ˜¯ä¸æ˜¯å°±æ˜¯ä½ è¦è¿æ¥çš„é‚£ä¸ªä¸»æœº, å› ä¸ºå¯èƒ½ä¼šå‘ç”Ÿä¸­é—´äººæ”»å‡»å˜›, ä½†çŸ¥é“å®ƒçš„å…¬é’¥æŒ‡çº¹æ˜¯sa5vDYS0..., é—®æˆ‘ä»¬è¿˜è¦ç»§ç»­è¿æ¥å— (æ³¨æ„å•è¯ establish åœ¨è¿™æ˜¯ â€œè®¤è¯ç¡®è®¤â€ çš„æ„æ€),\né‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“è¿œç¨‹ä¸»æœºçš„å…¬é’¥æŒ‡çº¹åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿå½“ç„¶æ˜¯å»ä½ çš„æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹å…¬é’¥æŒ‡çº¹:\n1 2 [root@vultr ssh]# ssh-keygen -lf /etc/ssh/ssh_host_ed25519_key.pub 256 SHA256:sa5vDYS0yhdMRXO6CgMrp9AcQoVQRiDw6TnzTKesnzQ root@vultr.guest (ED25519) æ³¨æ„å¦‚æœä½ çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯å…¶ä»–hash functionç”Ÿæˆçš„å…¬é’¥æŒ‡çº¹, é‚£ä½ å°±è¦æŸ¥çœ‹å…¶ä»–æ–‡ä»¶äº†:\n1 ssh-keygen -E md5 -lf /etc/ssh/ssh_host_ed25519_key.pub å¯ä»¥å‘ç°è¾“å‡ºå†…å®¹ä¸ä¸Šé¢ ssh è­¦å‘Šçš„æŒ‡çº¹ç›¸åŒ, æ‰€ä»¥æˆ‘ä»¬è¦æ¥æ¥çš„è¿™ä¸ªæ˜¯æˆ‘ä»¬çš„çœŸæ­£ä¸»æœº,\nå¯èƒ½æœ‰äººä¼šè¯´, é‚£æˆ‘ä»¬ä¹°çš„æœåŠ¡å™¨ç‰©ç†ä¸»æœºåœ¨è°·æ­Œé˜¿é‡Œ, æ€ä¹ˆå»ç›´æ¥éªŒè¯? ä½ å¯ä»¥åœ¨ä½ è´­ä¹°VPSçš„ç½‘ç«™ä¸Šè¿æ¥è‡ªå·±æœåŠ¡å™¨ä¿è¯ä½ è¿æ¥çš„ä¸€å®šæ˜¯ä½ çš„ä¸»æœº, ä½†æˆ‘ä»¬åªæ˜¯æµ‹è¯•, æ‰€ä»¥ä½ ç›´æ¥å¿½ç•¥ ssh çš„æç¤ºè­¦å‘Š, è¾“å…¥yes, è¿ä¸ŠæœåŠ¡å™¨åå»éªŒè¯ä¸€ä¸‹å°±å¥½äº†, å› ä¸ºè‚¯å®šä¸ä¼šæœ‰ä¸­é—´äººé—²çš„è›‹ç–¼æ¥æ”»å‡»æˆ‘ä»¬çš„è¿æ¥å§? å‡ å—é’±ä¸€ä¸ªæœˆçš„æœåŠ¡å™¨, è°æ¥æ”»å‡»ä½ ,\næœ‰äººå¯èƒ½åˆä¼šç–‘é—®, é‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å»è¿œç¨‹ä¸»æœºæŸ¥çœ‹ä»–çš„å…¬é’¥å•Š, ä¸ºå•¥è¿˜è¦ç”¨ä¸ªhashå‡½æ•°æ¥ç”Ÿæˆå®ƒçš„æŒ‡çº¹, å†å»æ¯”å¯¹, ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—? é¦–å…ˆä½ æ²¡å‘ç°å…¬é’¥çš„æŒ‡çº¹å¾ˆçŸ­å—? æˆ‘ä»¬å»è¿œç¨‹ä¸»æœºéªŒè¯ä¸€èˆ¬æ˜¯ç”¨è‚‰çœ¼æ¥æ¯”å¯¹å§, é‚£å…¬é’¥é‚£ä¹ˆé•¿, å‡ ç™¾ä¸ªå­—ç¬¦, å¾ˆå®¹æ˜“æ¯”å¯¹é”™, è€Œå…¬é’¥æŒ‡çº¹çš„ä¸»è¦ç›®çš„å°±åœ¨äºå®ƒå¾ˆçŸ­, æ–¹ä¾¿æˆ‘ä»¬æ¯”å¯¹,\næœ€åå…³äº ssh è¾“å‡ºçš„ä¿¡æ¯, è¿˜æœ‰å…¶å®ƒæƒ³è¯´çš„, æ ¹æ®è¾“å‡º:\n1 2 3 4 ssh root@144.202.16.29 The authenticity of host \u0026#39;144.202.16.29 (144.202.16.29)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:sa5vDYS0yhdMRXO6CgMrp9AcQoVQRiDw6TnzTKesnzQ. ... è¯¥ remote host ä¸Šçš„ ssh ä½¿ç”¨çš„å…¬ç§é’¥æ˜¯ç”± ED25519 ç®—æ³•ç”Ÿæˆçš„, ED25519 æ˜¯éå¯¹ç§°åŠ å¯†ç®—æ³•, å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•è¿˜æœ‰ RSA, æ‰€ä»¥ RSA å’Œ ED25519 æ˜¯å¹¶åˆ—çš„: Today, the RSA is the most widely used public-key algorithm for SSH key. But compared to Ed25519, it\u0026rsquo;s slower and even considered not safe if it\u0026rsquo;s generated with the key smaller than 2048-bit length. EdDSA is a digital signature scheme, Ed25519 is the EdDSA signature scheme using SHA-512 (SHA-2) and Curve25519. \u0026ndash;Wiki\nå¦å¤–, è¯¥å…¬é’¥æŒ‡çº¹æ˜¯ç”± SHA256 hash function ç”Ÿæˆçš„, å¦å¤–å¸¸è§çš„ hash function è¿˜æœ‰md5,\n# 2.1. éªŒè¯å…¬ç§é’¥ä½ç½® è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨ç”µè„‘ç»ˆç«¯è¾“å…¥yes, ç„¶åå°±ä¼šæç¤ºè¾“å…¥å¯†ç  (æ¯”å¦‚rootç”¨æˆ·å¯¹åº”çš„å¯†ç ), ç„¶åç³»ç»Ÿä¼šæç¤ºå¦‚ä¸‹:\n1 2 3 4 Warning: Permanently added \u0026#39;144.202.16.29\u0026#39; (ED25519) to the list of known hosts. root@144.202.16.29\u0026#39;s password: Last login: Fri Apr 7 20:36:06 2023 [root@vultr ~]# ls å½“è¿œç¨‹ä¸»æœºçš„å…¬é’¥è¢«æ¥å—ä»¥å, å®ƒä¼šè¢«ä¿å­˜åœ¨æ–‡ä»¶~/.ssh/known_hostsä¹‹ä¸­, ä¸‹æ¬¡å†è¿æ¥è¿™å°ä¸»æœº, ç³»ç»Ÿå°±ä¼šè®¤å‡ºå®ƒçš„å…¬é’¥å·²ç»ä¿å­˜åœ¨æœ¬åœ°äº†, ä»è€Œè·³è¿‡è­¦å‘Šéƒ¨åˆ†, ç›´æ¥æç¤ºè¾“å…¥å¯†ç , æˆ‘ä»¬æ¥æŸ¥çœ‹Macä¸Šçš„è¾“å‡º:\n1 2 3 4 5 6 7 8 9 10 ls ~/.ssh id_rsa id_rsa.pub known_hosts known_hosts.old cat ~/.ssh/known_hosts github.com ssh-ed25519 AAAAC3NzaC1lZDI1N... github.com ecdsa-sha2-nistp256 AAAAE2VjZH.... github.com ssh-rsa AAAAB3NzaC1yc2EAAAADA.... 144.202.16.29 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOpG35RMxOKeeLbTfdWlPgToThzrm00sRpMRQs+pdYig 144.202.16.29 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHP5xEl1122X1Vtc5LzqMp6vlvd4cHRD151ag61xXThvT7KM9vuUK23ol4LKoXMoivUH1SAcWandumVKG37zZfA= å†çœ‹çœ‹æœåŠ¡å™¨ä¸Šçš„è¾“å‡º,\n1 2 3 4 5 6 7 8 9 10 11 [root@vultr ssh]# ls /etc/ssh moduli ssh_host_dsa_key.pub ssh_host_ed25519_key.pub ssh_config ssh_host_ecdsa_key ssh_host_rsa_key sshd_config ssh_host_ecdsa_key.pub ssh_host_rsa_key.pub ssh_host_dsa_key ssh_host_ed25519_key [root@vultr ssh]# cat ssh_host_ed25519_key.pub ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOpG35RMxOKeeLbTfdWlPgToThzrm00sRpMRQs+pdYig root@vultr.guest [root@vultr ssh]# cat ssh_host_ecdsa_key.pub ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHP5xEl1122X1Vtc5LzqMp6vlvd4cHRD151ag61xXThvT7KM9vuUK23ol4LKoXMoivUH1SAcWandumVKG37zZfA= root@vultr.guest è¿™ä¸¤ä¸ªä¸€ä¸ªæ˜¯å…¬é’¥, ä¸€ä¸ªæ˜¯å…¬é’¥çš„æŒ‡çº¹, å¯ä»¥çœ‹å‡ºå’Œä¸Šé¢Macçš„å­˜å‚¨çš„å†…å®¹æ˜¯ä¸€æ ·, ç„¶åä¸Šé¢åœ¨æœåŠ¡å™¨ ls /etc/ssh çš„è¾“å‡º, æœ‰ ssh_host_rsa_key.pub, ssh_host_ecdsa_key.pub è¿™å°±æ˜¯ä½¿ç”¨ä¸åŒçš„ç®—æ³•äº§ç”Ÿçš„ä¸åŒçš„key,\næœ€å Mac ä¸Š ~/.ssh/known_hosts çš„è¾“å‡º github é‚£éƒ¨åˆ†æœ‰ ssh-ed25519, ecdsa-sha2-nistp256, è¿™æ˜¯ä»€ä¹ˆå‘¢?\nFor ssh-ed25519 and ecdsa-sha2-nistp256 which one is used for a given connection depends on the capabilities and preferences of the client, namely your ssh program. If you are using OpenSSH versions 6.5 to 8.1, then it prefers ecdsa then ed25519, and only 8.2 up prefers ed25519 first. Why does GitHub recommend ed25519 SSH key encryption scheme, but itself uses ECDSA? - Super User\necdsa-sha2-nistp256: Specifies the ECDSA algorithm with 256-bit key strength rsa: Specifies the public key algorithm rsa # 3. Public Key Authentication (ä¸Šä¼ å…¬é’¥å®ç°å…å¯†ç™»é™†) # 3.1. è¿‡ç¨‹åˆ†æ ä½¿ç”¨å¯†ç ç™»å½•, æ¯æ¬¡éƒ½å¿…é¡»è¾“å…¥å¯†ç , éå¸¸éº»çƒ¦, å¥½åœ¨SSHè¿˜æä¾›äº†å…¬é’¥ç™»å½•, å¯ä»¥çœå»è¾“å…¥å¯†ç çš„æ­¥éª¤, å…·ä½“éªŒè¯è¿‡ç¨‹å¦‚ä¸‹:\nThe client generates a public/private key pair, typically with RSA or ECC. The client keeps the private key secret and registers the public key with the SSH server. When the client connects to the server, the server authenticates the client by checking if it has the corresponding public key registered for that client. The server will send a challenge message to the client, requesting authentication. The client will take the challenge message and use its private key to generate a digital signature. This proves that the client has the correct private key without revealing the key itself. The client sends the digital signature back to the server as a response to the challenge. The server verifies the signature using the client\u0026rsquo;s registered public key. If the signature is validated, the server knows the client has proven possession of the corresponding private key and grants it access. æ³¨æ„å…³äºéªŒè¯è¿‡ç¨‹, ä¸åŒ ssh ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰ä¸åŒçš„å®ç°, ä½ å¯èƒ½ä¼šçœ‹åˆ°æœ‰äººè¯´è¿œç¨‹ä¸»æœºç”¨ ç”¨æˆ·çš„å…¬é’¥è¿›è¡Œè§£å¯†éªŒè¯, å…¶å®å…¬é’¥å¹¶ä¸å¯ä»¥ç”¨æ¥è§£å¯†, åˆ«äººæŒ‡çš„åº”è¯¥æ˜¯å…¬é’¥å¯ä»¥ç”¨æ¥éªŒè¯æ•°å­—ç­¾å, å³è¿™ç§æƒ…å†µä¸‹ç§é’¥åŠ å¯†å…¶å®åº”è¯¥æ˜¯ç§é’¥ç­¾åã€‚ ç§é’¥ â€œåŠ å¯†â€ ä»¥åï¼Œè°ç”¨å…¬é’¥éƒ½å¯ä»¥æ‰“å¼€ï¼Œå°±å·²ç»å¤±å»äº†åŠ å¯†çš„æ„ä¹‰ï¼Œæ‰€ä»¥å®ƒåªèƒ½èµ·åˆ°ä¸€ä¸ªâ€œç­¾åâ€çš„æ•ˆæœï¼Œæ¥è¾¾åˆ°-å¤§å®¶çŸ¥é“è¿™æ¡ä¿¡æ¯æ˜¯æˆ‘ï¼Œè€Œä¸”åªæœ‰æˆ‘å‘å‡ºçš„ã€‚\nè®°ä½å…¬é’¥åªèƒ½ç”¨æ¥åŠ å¯†, ä¸å¯ä»¥ç”¨æ¥è§£å¯†, ä¸ç„¶å°±ä¸å«å…¬é’¥äº†, æ‰€ä»¥æ˜¯è¿œç¨‹ä¸»æœºç”¨ ç”¨æˆ·çš„å…¬é’¥è¿›è¡Œç”¨æˆ·çš„éªŒè¯æ•°å­—ç­¾å, æ€»ç»“å…¬é’¥æœ‰ä¿©åŠŸèƒ½:\nåŠ å¯† éªŒè¯æ•°å­—ç­¾å # 3.2. å…·ä½“æ“ä½œ è¿œç¨‹ä¸»æœºéœ€è¦ä½¿ç”¨ç”¨æˆ·çš„å…¬é’¥æ¥éªŒè¯ç”¨æˆ·çš„èº«ä»½, æ‰€ä»¥æœ¬åœ°æœºå™¨è¦ç”Ÿæˆå…¬ç§é’¥:\n1 2 # generate ssh keys $ ssh-keygen ä¸€è·¯å›è½¦ä¹‹ååœ¨~/.ssh/ä¼šæ–°ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šid_rsa.pubå’Œid_rsa, å‰è€…æ˜¯ä½ çš„å…¬é’¥, åè€…æ˜¯ä½ çš„ç§é’¥, è¿™æ—¶å†è¾“å…¥ä¸‹é¢çš„å‘½ä»¤, å°†å…¬é’¥ä¼ é€åˆ°è¿œç¨‹ä¸»æœºhostä¸Šé¢:\n1 $ ssh-copy-id root@144.202.16.29 å®Œæˆ, ä¹‹åå†ç™»å½•å°±ä¸éœ€è¦è¾“å…¥å¯†ç äº†:\n1 $ ssh root@144.202.16.29 å…¶å®ä½ ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘è¿œç¨‹ä¸»æœº ~/.ssh/authorized_keys æ–‡ä»¶, æŠŠä½ æœ¬åœ°ä¸»æœºçš„å…¬é’¥çš„å†…å®¹æ·»åŠ è¿›å»å°±è¡Œäº†, ssh-copy-id root@144.202.16.29 åšçš„å°±æ˜¯è¿™ä»¶äº‹. ä¸‹é¢æˆ‘ä»¬ä¼šéªŒè¯.\n# 4. authorized_keys file ä¸Šé¢ ssh-copy-id root@144.202.16.29 æ‰§è¡Œå, æœ¬æœºå…¬é’¥å­˜å‚¨åœ¨äº†è¿œç¨‹ä¸»æœº~/.ssh/authorized_keys:\n1 2 3 4 5 6 [root@vultr ~]# ls -a . .bash_history .bash_profile .cache .pki .tcshrc .. .bash_logout .bashrc .cshrc .ssh [root@vultr ~]# cat .ssh/authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDvbHLCIxxUDDqktbqdrICPa+JDd3kEyowKpy9igugi7R+f/94UDBDJLmeu+K8wi90pjwq+mTM6bSPXBkjmYGibCPbUKk7RtrVx5FdR488PR7/ptMqQXJeQeMOIXvK2Lfnzay+rH5Fg/8z1+pd7cuHPq0bWm5LroGq+bYXVTIYgjKC5NDxPbQCY7zd4c0L+SvxlwqrJFvRBZKY41UBLywtuM8geluLWaGcbikX1K2hFVcZ7ETogG7eqdRBtbfx+JxhyRY1Od+snM88CSfuQkOgs4xQli3GrGttgY0f8BA65/pbixG9gAPkacEkexS997iuTP9BmwLmwWq1pw91c0yEQO1JnsbGHj/YfRhBV6s4FL8n5uVC0My64tisqA+8eZTeld8Zwem4XQGjoqwt2HYy1YXv0kOU8NyI0EGDz3fmqER3ex0cL+MqvWf/cnWQ6MRvGI3w/gL3+V8ueZv5qXpnY+ZH2UcrqEv7Xl74fkdqPYo53ySLQ9ZCiCitHgMjl3bk= shwezu@qq.com åœ¨Macä¸ŠæŸ¥çœ‹æˆ‘è‡ªå·±çš„å…¬é’¥, æ˜¯ä¸€æ ·çš„:\n1 2 # cat id_rsa.pub ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDvbHLCIxxUDDqktbqdrICPa+JDd3kEyowKpy9igugi7R+f/94UDBDJLmeu+K8wi90pjwq+mTM6bSPXBkjmYGibCPbUKk7RtrVx5FdR488PR7/ptMqQXJeQeMOIXvK2Lfnzay+rH5Fg/8z1+pd7cuHPq0bWm5LroGq+bYXVTIYgjKC5NDxPbQCY7zd4c0L+SvxlwqrJFvRBZKY41UBLywtuM8geluLWaGcbikX1K2hFVcZ7ETogG7eqdRBtbfx+JxhyRY1Od+snM88CSfuQkOgs4xQli3GrGttgY0f8BA65/pbixG9gAPkacEkexS997iuTP9BmwLmwWq1pw91c0yEQO1JnsbGHj/YfRhBV6s4FL8n5uVC0My64tisqA+8eZTeld8Zwem4XQGjoqwt2HYy1YXv0kOU8NyI0EGDz3fmqER3ex0cL+MqvWf/cnWQ6MRvGI3w/gL3+V8ueZv5qXpnY+ZH2UcrqEv7Xl74fkdqPYo53ySLQ9ZCiCitHgMjl3bk= shwezu@qq.com # 5. ssh_config vs sshd_config file I would like to change my SSH port running Linux CentOS 6. I also noticed there\u0026rsquo;s an /etc/ssh_config file along with /etc/sshd_config. What\u0026rsquo;s the difference between the two? Should I change both?\nThe sshd_config is the ssh daemon (or ssh server process) configuration file. As you\u0026rsquo;ve already stated, this is the file you\u0026rsquo;ll need to modify to change the server port.\nWhereas, the ssh_config file is the ssh client configuration file. The client configuration file only has bearing on when you use the ssh command to connect to another ssh host. So, in this case, you don\u0026rsquo;t need to modify it. It will be other client machines connecting to your server.\nSource: Should I modify only sshd_config, or also ssh_config?\nReferences:\nhttps://en.wikipedia.org/wiki/EdDSA https://en.wikipedia.org/wiki/Digital_signature https://superuser.com/a/1688126 https://security.stackexchange.com/questions/230708/should-i-be-using-ecdsa-keys-instead-of-rsa Man-in-the-middle attack How to check your SSH key fingerprint (verify the authenticity of the remote host) ","date":"2023-06-03T17:14:27Z","permalink":"https://blog.yorforger.cc/p/%E5%AE%9E%E7%8E%B0ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86-ssh%E5%A6%82%E4%BD%95%E9%AA%8C%E8%AF%81%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E7%9C%9F%E5%AE%9E%E6%80%A7/","title":"å®ç°sshå…å¯†ç™»é™† sshå¦‚ä½•éªŒè¯è¿œç¨‹ä¸»æœºçœŸå®æ€§"},{"content":"ç¼–ç é—®é¢˜å¾ˆå¸¸è§, æœ‰æ—¶å€™è¯»æ–‡ä»¶æ‰“å¼€æ˜¯ä¹±ç , æœ‰çš„è¯­è¨€è¯´è‡ªå·±å­—ç¬¦ä¸²é‡‡ç”¨unicodeè¡¨ç¤ºå­—ç¬¦, å¯åˆæ¥utf-8ç¼–ç , è¿™éƒ½æ˜¯ä»€ä¹ˆ?\n# 1. ç¼–ç å’Œä¹±ç  (unicode vs ascii) ç”µè„‘åªèƒ½çœ‹æ‡‚äºŒè¿›åˆ¶æ•°, æ‰€ä»¥å¾—æƒ³åŠæ³•æŠŠäººç±»è¯­è¨€ç”¨äºŒè¿›åˆ¶è¡¨ç¤º, è¿™å°±æ˜¯ç¼–ç çš„ç›®çš„. ASCII è§„å®šæ•°å­—65ä»£è¡¨å­—ç¬¦A, 66ä»£è¡¨å­—ç¬¦Bä¾æ¬¡ç±»æ¨, æ‰€ä»¥ASCIIè¡¨å°±æ˜¯ä¸€ä¸ªmap, æ¯ä¸ªå­—ç¬¦å¯¹åº”ä¸€ä¸ªæ•°, æŠŠå­—ç¬¦æŒ‰ç…§é¢„å®šè§„åˆ™å¯¹åº”åˆ°æ•°å­—çš„è¿‡ç¨‹å°±å«ç¼–ç .\nåˆ°åæ¥è®¡ç®—æœºæ™®åŠ, å…¨ä¸–ç•Œéƒ½ä½¿ç”¨ä¸åŒè¯­è¨€, å‡ºç°äº†é—®é¢˜, æ¯”å¦‚æˆ‘ä»¬ç”¨36ä»£è¡¨æ±‰å­—ç‰›, éŸ©å›½è¯´ç”¨36ä»£è¡¨å­—ç¬¦\u0026amp;, å½“æˆ‘è¾“å…¥ç‰›, è½¯ä»¶å°±æŠŠ0010 0100å­˜å…¥ç£ç›˜, ç„¶åæˆ‘æŠŠæ–‡ä»¶ä¼ ç»™éŸ©å›½çš„æœ‹å‹, ä»–ä»¬çš„ç¨‹åºè®¤ä¸º36å³0010 0100ä»£è¡¨\u0026amp;, è¿™å°±äº§ç”Ÿäº†ä¹±ç : è½¯ä»¶å°è¯•ä½¿ç”¨ä¸æ–‡ä»¶ç¼–ç ä¸åŒçš„ç¼–ç æ–¹å¼æ¥è§£ç æ–‡ä»¶,\næ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„æ ‡å‡†, å¯ä»¥æ¶µç›–å…¨ä¸–ç•Œå­—ç¬¦çš„é‚£ç§, ç„¶åæ‰€æœ‰è½¯ä»¶éƒ½éµå®ˆè¿™ä¸ªæ ‡å‡†, è¿™æ ·æ‰èƒ½æ— å·®é”™æ²Ÿé€š, æˆ‘å‘é€ä¸€ä¸²äºŒè¿›åˆ¶åœ¨æˆ‘è¿™ä»£è¡¨å­—ç¬¦A, ä½ çš„è½¯ä»¶æ”¶åˆ°è¿™ä¸²äºŒè¿›åˆ¶åç¿»è¯‘å‡ºçš„ä¹Ÿæ˜¯å­—ç¬¦A, è€Œä¸æ˜¯Bæˆ–C,\nè¿™æ—¶å€™ Unicode å°±å‡ºæ¥äº†, å®ƒå°±æ˜¯ä½¿ç”¨0~0x10FFFFçš„æ•°å­—æ¥è¡¨ç¤ºä¸–ç•Œä¸Šæ‰€æœ‰çš„å­—ç¬¦, å¦‚æ±‰å­— åœ¨ çš„Unicodeå€¼æ˜¯ 0x5728, æ³¨æ„0xä»£è¡¨å€¼5728æ˜¯åå…­è¿›åˆ¶, åˆå¦‚å­—ç¬¦ A çš„Unicodeå€¼æ˜¯0x41, è¿™é‡Œè¯´ä¸€ä¸‹, Unicodeè¡¨ç¤ºçš„å­—ç¬¦é‡Œè‹±æ–‡å­—ç¬¦çš„å€¼å’ŒASCIIè¡¨æ˜¯ç›¸åŒçš„,\nUnicode å’Œ ASCII éƒ½æ˜¯å­—ç¬¦é›†, ä½†æ˜¯ ASCII åªåŒ…å« 128 ä¸ªå­—ç¬¦, è€Œ Unicode åŒ…å«å¾ˆå¤šå¾ˆå¤šä¸ªå­—ç¬¦.\n# 2. Unicode vs UTF-8 vs UTF-16 # Unicode å®šä¹‰å’Œç›®çš„ï¼š Unicode æ˜¯ä¸€ä¸ªå›½é™…æ ‡å‡†ï¼Œç”¨äºä¸åŒç³»ç»Ÿå’Œç¨‹åºé—´ç»Ÿä¸€è¡¨ç¤ºæ–‡æœ¬æ•°æ®ã€‚ å®ƒä¸ºä¸–ç•Œä¸Šå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦å’Œæ–‡æœ¬ç¬¦å·åˆ†é…äº†å”¯ä¸€çš„ code pointã€‚ Unicode standard describes how characters are represented by code points. A code point value is an integer in the range 0 to 0x10FFFF. In the standard and in this document, a code point is written using the notation U+265E to mean the character with value 0x265e (9,822 in decimal).\nCode point èŒƒå›´ï¼š\nä» U+0000 åˆ° U+10FFFFï¼ŒåŒ…æ‹¬äº†è¶…è¿‡ 100,000 ä¸ªå­—ç¬¦ã€‚ é‡ç‚¹ï¼š\nUnicode æ˜¯å­—ç¬¦é›†ï¼ˆcharacter setï¼‰ï¼Œå®šä¹‰äº†å­—ç¬¦å’Œ code point ä¹‹é—´çš„æ˜ å°„ï¼Œä½†ä¸è§„å®šå…·ä½“å¦‚ä½•åœ¨è®¡ç®—æœºä¸­å­˜å‚¨è¿™äº›code pointã€‚ # UTF-8 å®šä¹‰å’Œç‰¹ç‚¹ï¼š\nUTF-8ï¼ˆ8-bit Unicode Transformation Formatï¼‰æ˜¯ä¸€ç§å¯¹ Unicode code point è¿›è¡Œç¼–ç çš„æ–¹å¼ã€‚ å®ƒæ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„å­—ç¬¦ç¼–ç æ–¹æ³•ï¼Œä½¿ç”¨ 1 åˆ° 4 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ª Unicode code pointã€‚ ä¼˜åŠ¿ï¼š\nå…¼å®¹æ€§å¥½ï¼ŒASCII ç¼–ç çš„å­—ç¬¦åœ¨ UTF-8 ä¸­ä¿æŒå•å­—èŠ‚å½¢å¼ï¼Œä¸ä¼ ç»Ÿ ASCII ç¼–ç å…¼å®¹ã€‚ åœ¨å­˜å‚¨è‹±æ–‡æ–‡æœ¬æ—¶ç©ºé—´æ•ˆç‡é«˜ã€‚å› ä¸ºè‹±æ–‡å­—ç¬¦åœ¨ UTF-8 ä¸­åªå ç”¨ 1 ä¸ªå­—èŠ‚ã€‚ # UTF-16 å®šä¹‰å’Œç‰¹ç‚¹ï¼š\nUTF-16ï¼ˆ16-bit Unicode Transformation Formatï¼‰æ˜¯å¦ä¸€ç§å¯¹ Unicode code pointè¿›è¡Œç¼–ç çš„æ ¼å¼ã€‚ ä½¿ç”¨ 2 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ª Unicode code pointã€‚ åœ¨UTF-16ä¸­ï¼Œå­—ç¬¦å¯ä»¥ç”¨ä¸€ä¸ªæˆ–ä¸¤ä¸ª16ä½çš„ code units æ¥è¡¨ç¤º. ç‰¹æ€§ï¼š\nåœ¨å¤„ç†æŸäº›è¯­è¨€ï¼ˆå¦‚ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ï¼‰æ—¶å¯èƒ½æ¯” UTF-8 æ›´åŠ ç©ºé—´é«˜æ•ˆã€‚ å› ä¸ºå¤šæ•°æ±‰å­—åœ¨ UTF-16 ä¸­åªå ç”¨ 2 ä¸ªå­—èŠ‚ã€‚ # ä¸»è¦åŒºåˆ« ç¼–ç é•¿åº¦ï¼š UTF-8 æ˜¯å¯å˜é•¿åº¦çš„ï¼Œä» 1 åˆ° 4 ä¸ªå­—èŠ‚ä¸ç­‰ã€‚ UTF-16 é€šå¸¸ä½¿ç”¨ 2 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚ã€‚ å…¼å®¹æ€§ï¼š UTF-8 ä¸ä¼ ç»Ÿ ASCII ç¼–ç å®Œå…¨å…¼å®¹ã€‚ UTF-16 ä¸ ASCII ä¸å…¼å®¹ã€‚ ç©ºé—´æ•ˆç‡ï¼š å¯¹äºä¸»è¦åŒ…å« ASCII å­—ç¬¦çš„æ–‡æœ¬ï¼ŒUTF-8 æ›´åŠ é«˜æ•ˆã€‚ å¯¹äºåŒ…å«å¤§é‡éè¥¿æ–¹å­—ç¬¦çš„æ–‡æœ¬ï¼ŒUTF-16 å¯èƒ½æ›´åŠ é«˜æ•ˆã€‚ æ€»çš„æ¥è¯´ï¼ŒUnicode æ˜¯ä¸€ä¸ªå¹¿æ³›çš„å­—ç¬¦é›†ï¼Œå®šä¹‰äº†å…¨çƒå„ç§å­—ç¬¦çš„ code pointã€‚è€Œ UTF-8 å’Œ UTF-16 æ˜¯è¿™äº›code pointåœ¨è®¡ç®—æœºå­˜å‚¨å’Œä¼ è¾“ä¸­çš„å…·ä½“ç¼–ç å®ç°æ–¹å¼ã€‚é€‰æ‹©å“ªç§ç¼–ç æ–¹å¼å–å†³äºç‰¹å®šçš„åº”ç”¨åœºæ™¯å’Œç©ºé—´æ•ˆç‡éœ€æ±‚ã€‚\nå…³äº utf-8 è¿™é‡Œä¸¾ä¸ªä¾‹å­, æ±‰å­—æ±‰çš„Unicodeå€¼æ˜¯ä¸¤å­—èŠ‚å³ 6C49, äºŒè¿›åˆ¶ä¸º: 0110 1100 0100 1001, å› ä¸º utf-8 è§„å®šæ±‰å­—å  3 å­—èŠ‚, å› æ­¤é€‰æ‹©ç¬¬ä¸‰è¡Œè¿›è¡Œç¼–ç , æ ¹æ®ä¸Šæ ‡ç»è¿‡utf-8ç¼–ç å˜æˆ 11100110 10110001 10001001, å› æ­¤æœ€ç»ˆå†™å…¥æ–‡ä»¶çš„æ˜¯å…¶ä¸‰å­—èŠ‚çš„ utf-8 encoding 11100110 10110001 10001001, è€Œä¸æ˜¯å…¶Unicode 0110 1100 0100 1001 , å¯ä»¥ä½¿ç”¨ xxd æŸ¥çœ‹æ–‡ä»¶çš„16è¿›åˆ¶å†…å®¹,\n1 2 3 4 $ xxd text.md 00000000: e6b1 89 $ file text.md text.md: Unicode text, UTF-8 text e6b1 89 = 11100110 10110001 10001001\n1 2 3 4 5 6 Binary format of bytes in sequence 1st Byte 2nd Byte 3rd Byte 4th Byte Number of Free Bits Maximum Expressible Unicode Value 0xxxxxxx 7 007F hex (127) 110xxxxx 10xxxxxx (5+6)=11 07FF hex (2047) 1110xxxx 10xxxxxx 10xxxxxx (4+6+6)=16 FFFF hex (65535) 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx (3+6+6+6)=21 10FFFF hex (1,114,111) è¯»åˆ°ä¸€ç¯‡æ–‡ç« æ€»ç»“çš„å¾ˆå¥½ åˆ†äº«ç‰‡æ®µ:\nåœ¨Unicodeå‡ºç°ä¹‹å‰ï¼Œæ‰€æœ‰çš„å­—ç¬¦é›†éƒ½æ˜¯å’Œå…·ä½“ç¼–ç æ–¹æ¡ˆç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œéƒ½æ˜¯ç›´æ¥å°†å­—ç¬¦å’Œæœ€ç»ˆå­—èŠ‚æµç»‘å®šæ­»äº†ï¼Œä¾‹å¦‚ASCIIç¼–ç ç³»ç»Ÿè§„å®šä½¿ç”¨7æ¯”ç‰¹æ¥ç¼–ç ASCIIå­—ç¬¦é›†ï¼›GB2312ä»¥åŠGBKå­—ç¬¦é›†ï¼Œé™å®šäº†ä½¿ç”¨æœ€å¤š2ä¸ªå­—èŠ‚æ¥ç¼–ç æ‰€æœ‰å­—ç¬¦ï¼Œå¹¶ä¸”è§„å®šäº†å­—èŠ‚åºã€‚è¿™æ ·çš„ç¼–ç ç³»ç»Ÿé€šå¸¸ç”¨ç®€å•çš„æŸ¥è¡¨ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä»£ç é¡µå°±å¯ä»¥ç›´æ¥å°†å­—ç¬¦æ˜ å°„ä¸ºå­˜å‚¨è®¾å¤‡ä¸Šçš„å­—èŠ‚æµäº†ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\nè¿™ç§æ–¹å¼çš„ç¼ºç‚¹åœ¨äºï¼Œå­—ç¬¦å’Œå­—èŠ‚æµä¹‹é—´è€¦åˆå¾—å¤ªç´§å¯†äº†ï¼Œä»è€Œé™å®šäº†å­—ç¬¦é›†çš„æ‰©å±•èƒ½åŠ›ã€‚å‡è®¾ä»¥åç«æ˜Ÿäººå…¥ä½åœ°çƒäº†ï¼Œè¦å¾€ç°æœ‰å­—ç¬¦é›†ä¸­åŠ å…¥ç«æ˜Ÿæ–‡å°±å˜å¾—å¾ˆéš¾ç”šè‡³ä¸å¯èƒ½äº†ï¼Œè€Œä¸”å¾ˆå®¹æ˜“ç ´åç°æœ‰çš„ç¼–ç è§„åˆ™ã€‚\nå› æ­¤Unicodeåœ¨è®¾è®¡ä¸Šè€ƒè™‘åˆ°äº†è¿™ä¸€ç‚¹ï¼Œå°†å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç æ–¹æ¡ˆåˆ†ç¦»å¼€:\nä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶æ¯ä¸ªå­—ç¬¦åœ¨Unicodeå­—ç¬¦é›†ä¸­éƒ½èƒ½æ‰¾åˆ°å”¯ä¸€ç¡®å®šçš„ç¼–å·ï¼ˆå­—ç¬¦ç ï¼Œåˆç§°Unicodeç ï¼‰ï¼Œä½†æ˜¯å†³å®šæœ€ç»ˆå­—èŠ‚æµçš„å´æ˜¯å…·ä½“çš„å­—ç¬¦ç¼–ç ã€‚ä¾‹å¦‚åŒæ ·æ˜¯å¯¹Unicodeå­—ç¬¦â€œAâ€è¿›è¡Œç¼–ç ï¼ŒUTF-8å­—ç¬¦ç¼–ç å¾—åˆ°çš„å­—èŠ‚æµæ˜¯0x41ï¼Œè€ŒUTF-16ï¼ˆå¤§ç«¯æ¨¡å¼ï¼‰å¾—åˆ°çš„æ˜¯0x00 0x41ã€‚\n# 3. ä¿®æ”¹æ–‡ä»¶ç¼–ç æ–¹å¼ å¦‚æœä½ ç›´æ¥æŠŠutf-8ç¼–ç çš„æ–‡ä»¶è½¬ä¸ºå…¶å®ƒç¼–ç æ¯”å¦‚gbk, é‚£è½¬æ¢ä¹‹åä½ çš„æ–‡ä»¶è‚¯å®šæ˜¯ä¹±ç , å› ä¸ºåœ¨ä½ å†™å…¥ä¸€äº›å†…å®¹æ¯”å¦‚æ±‰åˆ°ä½ çš„æ–‡æœ¬æ–‡ä»¶, æ­¤æ—¶è¿™ä¸ªæ–‡ä»¶çš„ç¼–ç æ–¹å¼ä¸ºutf-8, é‚£ä½ ä¿å­˜æ­¤æ–‡ä»¶å, æ­¤æ–‡ä»¶çš„å†…å®¹å·²ç»æ˜¯ç»è¿‡utf-8ç¼–ç äºŒè¿›åˆ¶æ•°, å³:11100110 10110001 10001001ä¹Ÿå°±æ˜¯e6b1 89å°±æ˜¯ä¸Šé¢çš„æ±‰å­—æ±‰, æ­¤æ—¶ä½ ç¡¬è¦æŠŠæ–‡ä»¶çš„ç¼–ç æ–¹å¼æ”¹ä¸ºgbk, è€Œgbké‡‡ç”¨å®Œå…¨ä¸utf-8ä¸åŒçš„ç¼–ç æ–¹å¼(2å­—èŠ‚1ä¸ªå­—ç¬¦), æ­¤æ—¶å½“å…¶ä»–è½¯ä»¶æ˜¯å›¾æ‰“å¼€ä½ è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶æ—¶, å°±ä¼šæŸ¥çœ‹ä½ æ–‡ä»¶çš„ç¼–ç ä¿¡æ¯, ä»–ä»¬çœ‹åˆ°æ˜¯gbkç¼–ç , é‚£å°±ä¼šæŠŠ11100110 10110001 10001001å³e6b1 89ä¸­çš„å‰ä¸¤ä¸ªå­—èŠ‚è§£é‡Šä¸ºä¸€ä¸ªå­—ç¬¦, ç„¶åä»–ä»¬æŸ¥æ‰¾11100110 10110001å³e6b1, é‚£è‚¯å®šåŒ¹é…ä¸åˆ°æ±‰, å°±ä¼šæŠŠ11100110 10110001è§£é‡Šä¸ºä¸å¯æ‰“å°å­—ç¬¦æˆ–è€…è‹±æ–‡æˆ–è€…å…¶å®ƒè¯­è¨€,,,\nä½†ä¹Ÿå¯ä»¥å®ç°ä¸åŒç¼–ç çš„å®‰å…¨è½¬æ¢, ä¸€ä¸ªæ€è·¯æ˜¯, å‡å¦‚çŸ¥é“æ–‡ä»¶æ˜¯ç”¨çš„utf-8ç¼–ç , æ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠè¯¥æ–‡ä»¶çš„å­—ç¬¦è½¬æ¢ä¸ºunicode code point, ç„¶åå†åˆ©ç”¨gbkè¿›è¡Œç¼–ç è¿™äº›unicode code, å…·ä½“åšæ³•å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 import sys file_path = \u0026#39;article_1.md\u0026#39; with open(file_path, encoding=\u0026#34;utf-8\u0026#34;) as f: utf_8_str = f.read() if utf_8_str is None: print(\u0026#34;Contents of Text cannot be None!\u0026#34;) sys.exit() else: gbk_str = utf_8_str.encode(\u0026#34;gbk\u0026#34;) with open(\u0026#34;article_2.md\u0026#34;, \u0026#34;wb\u0026#34;) as f: f.write(gbk_str) f.encoding = \u0026#34;gbk\u0026#34; æ³¨æ„, ä¸Šé¢ä»£ç utf_8_str = f.read(), æ­¤æ—¶utf_8_strå·²ç»æ˜¯unicode code, ç¬¬äºŒæˆ‘ä»¬å†™å¦‚æ–‡ä»¶æ—¶, è¦ä»¥äºŒè¿›åˆ¶å†™å…¥, ä¸ç„¶ä½ å†™å…¥çš„å°±æ˜¯é•¿å¾—åƒ16è¿›åˆ¶æ•°çš„å­—ç¬¦ä¸², è€Œä¸æ˜¯çœŸæ­£çš„å†™å…¥äºŒè¿›åˆ¶æ•°æ®,\n# 4. Python ä¸­çš„ç¼–ç  ç”µè„‘åªèƒ½å­˜å‚¨äºŒè¿›åˆ¶æ•°, è€Œpythonä¹Ÿæœ‰ä¸ªbytesç±»ç”¨æ¥ä»£è¡¨äºŒè¿›åˆ¶å­—ç¬¦ä¸²,\næ‰€ä»¥è¿™é‡Œæœ‰ä¸¤ä¸ªæ¦‚å¿µ, stringå’Œbytes string, ä»–ä»¬æ˜¯ä¸åŒçš„ç±», æ‹¥æœ‰çš„å‡½æ•°ä¸åŒ, å¯¹äºä¸€ä¸ªæ™®é€šçš„string, å®ƒæœ‰ä¸ªå‡½æ•°å«encode(), è¯¥å‡½æ•°çš„è¿”å›ç±»å‹æ˜¯bytes, å¦‚ä¸‹:\n1 2 3 4 5 6 bytes_str = \u0026#39;AB\u0026#39;.encode(\u0026#39;ascii\u0026#39;) print(type(bytes_str)) print(bytes_str.hex()) \u0026lt;class \u0026#39;bytes\u0026#39;\u0026gt; 4142 ç„¶åå¯¹äºbytesç±», æœ‰ä¸ªå‡½æ•°å«decode(), è¯¥å‡½æ•°çš„è¿”å›ç±»å‹ä¸ºstr:\n1 2 3 4 5 bytes_str = \u0026#39;AB\u0026#39;.encode(\u0026#39;ascii\u0026#39;) a = bytes_str.decode(\u0026#39;ascii\u0026#39;) print(type(a)) \u0026lt;class \u0026#39;str\u0026#39;\u0026gt; æ‰€ä»¥åœ¨å¾€ä¸€ä¸ªæ–‡ä»¶å†™å…¥çš„æ—¶å€™æƒ³å¥½æ˜¯ç›´æ¥å†™å…¥äºŒè¿›åˆ¶è¿˜æ˜¯å†™å…¥ç¼–ç åçš„å­—ç¬¦ä¸², å³æ³¨æ„æ–‡ä»¶çš„æ‰“å¼€æ–¹å¼:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æ–‡ä»¶çš„å†…å®¹: æ±‰åœ¨ # æ–‡ä»¶çš„ç¼–ç æ–¹å¼: gbk, æ¯ä¸ªæ±‰å­—2å­—èŠ‚ with open(\u0026#34;article_2.md\u0026#34;, \u0026#34;rb\u0026#34;) as f: bin_str = f.read() print(type(bin_str)) print(bin_str) \u0026lt;class \u0026#39;bytes\u0026#39;\u0026gt; b\u0026#39;\\xba\\xba\\xd4\\xda\u0026#39; with open(\u0026#34;article_2.md\u0026#34;, \u0026#34;r\u0026#34;, encoding=\u0026#39;gbk\u0026#39;) as f: text_str = f.read() print(type(text_str)) print(text_str) \u0026lt;class \u0026#39;str\u0026#39;\u0026gt; æ±‰åœ¨ å› ä¸ºarticle_2.mdé‡‡ç”¨gbkç¼–ç æ–¹å¼, è€Œpythoné»˜è®¤æ˜¯utf-8è§£ç , æ‰€ä»¥è¿™é‡Œéœ€è¦æŒ‡å®šç¼–ç æ–¹å¼, å¦åˆ™è‚¯å®šä¹±ç æˆ–è€…å‡ºé”™,\nå†™å…¥ä¹Ÿè¦æ³¨æ„æ‰“å¼€æ–‡ä»¶çš„æ–¹å¼:\n1 2 3 4 bin_str = \u0026#39;AB\u0026#39;.encode(\u0026#39;utf-8\u0026#39;) with open(\u0026#34;text.md\u0026#34;, \u0026#34;wb\u0026#34;) as f: f.write(bin_str) f.encoding = \u0026#34;utf-8\u0026#34; æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹:\n1 2 $ xxd text.md 00000000: 4142 AB å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šä»¥äºŒè¿›åˆ¶å†™å…¥, åˆ™ä¼šæŠ¥é”™:\n1 2 3 4 5 6 bin_str = \u0026#39;AB\u0026#39;.encode(\u0026#39;utf-8\u0026#39;) with open(\u0026#34;text.md\u0026#34;, \u0026#34;w\u0026#34;) as f: f.write(bin_str) f.encoding = \u0026#34;utf-8\u0026#34; # error: TypeError: write() argument must be str, not bytes æ³¨æ„, pythonæŒºå¥½æœ‰æŠ¥é”™, ä½†æ˜¯æœ‰çš„è¯­è¨€æ¯”å¦‚Cçš„æ¥å£, å°±ä¸ä¼šæé†’, ä½ å†™å…¥ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆ, å¦‚æœä½ æ‰“å¼€æ–¹å¼ä¸æ˜¯äºŒè¿›åˆ¶, ç„¶åå†™å…¥äº†äºŒè¿›åˆ¶çš„å­—ç¬¦ä¸², é‚£ç»“æœå°±æ˜¯, è¿™äº›äºŒè¿›åˆ¶çš„å­—ç¬¦ä¸²è¢«å½“ä½œæ™®é€šå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶\u0026hellip;\n","date":"2023-06-01T22:13:25Z","permalink":"https://blog.yorforger.cc/p/%E8%AF%B4%E8%AF%B4%E7%BC%96%E7%A0%81-encoding/","title":"è¯´è¯´ç¼–ç  - encoding"},{"content":"å¼ºè¿«ç—‡, è¯»åšå®¢çš„æ—¶å€™ä¸­è‹±å­—ç¬¦æˆ–è€…æ ‡ç‚¹ç¬¦å·åæ²¡æœ‰ç©ºæ ¼ç´§ç´§çš„è´´åœ¨ä¸€å—çœ‹ç€å¾ˆä¸èˆ’æœ, äºæ˜¯æƒ³ç€èƒ½ä¸èƒ½å†™ä¸ªè„šæœ¬æ¥å¤„ç†ä¸€ä¸‹æ–‡ç« , bashå¤ªéš¾ç”¨äº†(æ˜¯æˆ‘å¤ªèœ), äºæ˜¯ç”¨Pythonç®€å•å®ç°äº†ä¸€ä¸‹,\nä¸€äº›èŠå£«åœ¨è¿™è¯´ä¸€ä¸‹,\n# 1. Immutable Object in Python Javaè™½ç„¶stringæ˜¯å¯¹è±¡ä½†primitiveç±»å‹è¿˜ä¸æ˜¯å¯¹è±¡, ä¸Javaä¸åŒPythoné‡Œå¦‚integers, floats, and stringséƒ½æ˜¯å¯¹è±¡, å¹¶ä¸”ä¸integers, floatsä¸€æ ·, pythoné‡Œstringå¯¹è±¡ä¹Ÿæ˜¯immutable, æ‰€ä»¥ç›´æ¥â€œä¿®æ”¹â€stringä¼šå¯¼è‡´pythoné‡æ–°åˆ›å»ºæ–°çš„stringå¯¹è±¡ é”€æ¯æ—§çš„:\n1 2 3 4 5 6 a = \u0026#39;hello\u0026#39; print(id(a)) # 4378912048 a += \u0026#39; world\u0026#39; print(id(a)) # 4380683504 å› æ­¤æ¯æ¬¡ä¿®æ”¹(æ·»åŠ ç©ºæ ¼)éƒ½ä¼šé‡æ–°é‡å»ºä¸€ä¸ªæ–°çš„string, è€ƒè™‘åˆ°æ–‡ç« æœ‰çš„å†…å®¹ä¹Ÿä¸çŸ­, é‚£å¼€é”€ä¼šä¸å°, å…·ä½“åšæ³•åˆ†æå‚è€ƒ: https://stackoverflow.com/q/1228299/16317008\n# 2. ç¼–ç  å¦å¤–æ˜¯å…³äºç¼–ç çš„é—®é¢˜, Unicodeå’Œutf-8,\nPythonçš„stringä½¿ç”¨unicodeæ¥è¡¨ç¤ºå­—ç¬¦,\nPythonâ€™s string type uses the Unicode Standard for representing characters, which lets Python programs work with all these different possible characters.\nUnicodeå°±æ˜¯èµ‹äºˆå­—ç¬¦ä¸€ä¸ªå”¯ä¸€çš„value, å¦‚ \u0026lsquo;a\u0026rsquo;çš„unicode valueæ˜¯ 0061, \u0026lsquo;æ±‰\u0026rsquo;çš„unicode valueæ˜¯6C49,\nUnicode (https://www.unicode.org/) is a specification that aims to list every character used by human languages and give each character its own unique code.\nè€Œutf-8å°±æ˜¯ä¸€ä¸ªç¼–ç è§£ç è§„èŒƒ, ç»™æˆ‘ä»¬ä¸€ä¸ªunicode valueå¦‚6C49, æˆ‘ä»¬æŠŠè¿™ä¸ªunicode valueç¿»è¯‘æˆå“ªä¸ªå­—ç¬¦å‘¢? æ ¹æ®ä¸åŒçš„ç¼–ç è§„åˆ™, 6C49å¯ä»¥è¢«ç¿»è¯‘æˆä¸åŒçš„å­—ç¬¦, ç”šè‡³ä¸¤ä¸ª, å› ä¸ºæœ‰çš„ç¼–ç æ¯”å¦‚asciiå°±æ˜¯é‡‡ç”¨å›ºå®š1å­èŠ‚ç¼–ç , é€šè¿‡æŸ¥asciiè¡¨å¯çŸ¥6Cä¼šè¢«è§£é‡Šæˆå­—æ¯l, 49ä¼šè¢«è§£é‡Šæˆæ•°å­—1, ä½†è‹¥é‡‡å–utf-8è¿›è¡Œè§£ç , 6C49å°±ä¼šè¢«è§£é‡Šæˆæ±‰å­—æ±‰, utf-8æ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„ç¼–ç ,\nå¦‚æœè¿˜ä¸ç†è§£ascii, utf-8, unicodeçš„å…³ç³», çœ‹ä¸‹é¢\nUTF-8 is an encoding scheme. Other encoding schemes include UTF-16 and UTF-32. In modern times, ASCII is now a subset of UTF-8. UTF-8 is backwards compatible with ASCII.\næˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„æ—¶å€™éœ€è¦æŒ‡å®šå…¶ç¼–ç , æ–‡æœ¬æ–‡ä»¶å¯¹ä½ çš„ç”µè„‘æ¥è¯´å°±æ˜¯ä¸€ä¸²äºŒè¿›åˆ¶æ•°, å¦‚æœä½ ä¸å‘Šè¯‰ä»–è®©ä»–ä½¿ç”¨å“ªç§ç¼–ç æ–¹æ³•æ¥ç¿»è¯‘è¿™æ®µå­—ç¬¦, é‚£pythonç¨‹åºæ€ä¹ˆçŸ¥é“æŠŠè¿™æ®µäºŒè¿›åˆ¶ç¿»è¯‘æˆä»€ä¹ˆå‘¢?\næˆ‘ä»¬linuxä¸‹å¯ä»¥ä½¿ç”¨xxdä»¥16è¿›åˆ¶è¾“å‡ºæŒ‡å®šæ–‡ä»¶å†…å®¹, åŠ å…¥æˆ‘ä»¬æœ‰ä¸ªmdæ–‡ä»¶å†…å®¹ä¸º\n1 æ±‰ ä½¿ç”¨xxdæŸ¥çœ‹å…¶äºŒè¿›åˆ¶æ•°æ®,\n1 2 $ xxd add_whitespace/article.md 00000000: e6b1 89 çœŸå¥‡æ€ª, ä¸ºä»€ä¹ˆä¸€ä¸ªæ±‰å­—æ˜¯3å­—èŠ‚? æˆ‘ä»¬åœ¨pythonä¸­æ˜æ˜ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ±‰å‘€:\n1 2 \u0026gt;\u0026gt;\u0026gt; print(\u0026#39;\\u6C49\u0026#39;) æ±‰ æˆ‘æŸ¥äº†ä¸€ä¸ªgbkç¼–ç ä¸€ä¸ªæ±‰å­—æ˜¯2å­—èŠ‚, è‹¥ä½¿ç”¨utf-8ç¼–ç ä¸€ä¸ªæ±‰å­—åˆ™æ˜¯3å­—èŠ‚, ä¹Ÿå°±æ˜¯è¯´text.mdå¯èƒ½ä½¿ç”¨çš„æ˜¯utf-8ç¼–ç , éªŒè¯ä¸€ä¸‹:\n1 2 $ file text.md text.md: Unicode text, UTF-8 text æœç„¶, é‚£ä¸ºä»€ä¹ˆä¸Šé¢æˆ‘ä»¬ç”¨ä¸¤å­—èŠ‚\\u6C49å°±è¡¨ç¤ºå‡ºæ±‰äº†å‘¢? è¿™å°±åˆè¯´åˆ°äº†ä¸Šé¢çš„ç¼–ç æ–¹å¼utf-8, \\u6C49åªæ˜¯Unicode code point, å¹¶ä¸æ˜¯æ–‡ä»¶å®é™…å­˜çš„ä¸œè¥¿, æˆ‘ä»¬è¦å­˜å‚¨è¿™ä¸ªæ±‰å­—, è¿˜éœ€è¦ä½¿ç”¨ç¼–ç æ–¹å¼, æ¯”å¦‚utf-8, æˆ‘ä»¬çœ‹çœ‹utf-8ç¼–ç unicode codeçš„è¿‡ç¨‹,\n1 2 3 4 5 6 7 Binary format of bytes in sequence 1st Byte 2nd Byte 3rd Byte 4th Byte Number of Free Bits Maximum Expressible Unicode Value 0xxxxxxx 7 007F hex (127) 110xxxxx 10xxxxxx (5+6)=11 07FF hex (2047) 1110xxxx 10xxxxxx 10xxxxxx (4+6+6)=16 FFFF hex (65535) 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx (3+6+6+6)=21 10FFFF hex (1,114,111) æ‰€ä»¥, ä¸Šé¢çš„6C49ç»è¿‡utf-8ç¼–ç å˜æˆ:\n1 2 # 6C49çš„äºŒè¿›åˆ¶:0110 1100 0100 1001 11100110 10110001 10001001 æŠŠè¿™ä¸ªä¸²äºŒè¿›åˆ¶æ•°è½¬ä¸º16è¿›åˆ¶: e6b1 89ä¸ä¸Šé¢xxdè¾“å‡ºä¸€æ ·, è¿™æ ·ä¹ŸéªŒè¯äº†utf-8ç¼–ç unicodeçš„è¿‡ç¨‹,\næœ€åéœ€è¦æ³¨æ„, å¦‚æœä½ ç›´æ¥æŠŠutf-8ç¼–ç çš„æ–‡ä»¶è½¬ä¸ºå…¶å®ƒç¼–ç æ¯”å¦‚gbk, é‚£è½¬æ¢ä¹‹åä½ çš„æ–‡ä»¶è‚¯å®šæ˜¯ä¹±ç , å› ä¸ºåœ¨ä½ å†™å…¥ä¸€äº›å†…å®¹æ¯”å¦‚æ±‰åˆ°ä½ çš„æ–‡æœ¬æ–‡ä»¶, æ­¤æ—¶è¿™ä¸ªæ–‡ä»¶çš„ç¼–ç æ–¹å¼ä¸ºutf-8, é‚£ä½ ä¿å­˜æ­¤æ–‡ä»¶å, æ­¤æ–‡ä»¶çš„å†…å®¹å·²ç»æ˜¯ç»è¿‡utf-8ç¼–ç çš„unicode code, å³:11100110 10110001 10001001ä¹Ÿå°±æ˜¯e6b1 89å°±æ˜¯ä¸Šé¢çš„æ±‰å­—æ±‰, æ­¤æ—¶ä½ ç¡¬è¦æŠŠæ–‡ä»¶çš„ç¼–ç æ–¹å¼æ”¹ä¸ºgbk, è€Œgbké‡‡ç”¨å®Œå…¨ä¸utf-8ä¸åŒçš„ç¼–ç æ–¹å¼(2å­—èŠ‚1ä¸ªå­—ç¬¦), æ­¤æ—¶å½“å…¶ä»–è½¯ä»¶æ˜¯å›¾æ‰“å¼€ä½ è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶æ—¶, å°±ä¼šæŸ¥çœ‹ä½ æ–‡ä»¶çš„ç¼–ç ä¿¡æ¯, ä»–ä»¬çœ‹åˆ°æ˜¯gbkç¼–ç , é‚£å°±ä¼šæŠŠ11100110 10110001 10001001å³e6b1 89ä¸­çš„å‰ä¸¤ä¸ªå­—èŠ‚è§£é‡Šä¸ºä¸€ä¸ªå­—ç¬¦, ç„¶åä»–ä»¬æŸ¥æ‰¾11100110 10110001å³e6b1, é‚£è‚¯å®šåŒ¹é…ä¸åˆ°æ±‰, å°±ä¼šæŠŠ11100110 10110001è§£é‡Šä¸ºä¸å¯æ‰“å°å­—ç¬¦æˆ–è€…è‹±æ–‡æˆ–è€…å…¶å®ƒè¯­è¨€,,,\nä¸€äº›å·¥å…·å¯ä»¥å®ç°ä¸åŒç¼–ç çš„å®‰å…¨è½¬æ¢, ä¸€ä¸ªæ€è·¯æ˜¯, æˆ‘ä»¬çŸ¥é“è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨çš„utf-8ç¼–ç , æ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠè¯¥æ–‡ä»¶çš„å­—ç¬¦è½¬æ¢ä¸ºunicode code, ç„¶åå†åˆ©ç”¨gbkè¿›è¡Œç¼–ç è¿™äº›unicode code, å…·ä½“åšæ³•å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 import sys file_path = \u0026#39;article_1.md\u0026#39; with open(file_path, encoding=\u0026#34;utf-8\u0026#34;) as f: utf_8_str = f.read() if utf_8_str is None: print(\u0026#34;Contents of Text cannot be None!\u0026#34;) sys.exit() else: gbk_str = utf_8_str.encode(\u0026#34;gbk\u0026#34;) with open(\u0026#34;article_2.md\u0026#34;, \u0026#34;wb\u0026#34;) as f: f.write(gbk_str) f.encoding = \u0026#34;gbk\u0026#34; æ³¨æ„, ä¸Šé¢ä»£ç utf_8_str = f.read(), æ­¤æ—¶utf_8_strå·²ç»æ˜¯unicode code, ç¬¬äºŒæˆ‘ä»¬å†™å¦‚æ–‡ä»¶æ—¶, è¦ä»¥äºŒè¿›åˆ¶å†™å…¥, ä¸ç„¶ä½ å†™å…¥çš„å°±æ˜¯é•¿å¾—åƒ16è¿›åˆ¶æ•°çš„å­—ç¬¦ä¸², è€Œä¸æ˜¯çœŸæ­£çš„å†™å…¥äºŒè¿›åˆ¶æ•°æ®,\n# 3. å®ç° æœ€å, pythonæ˜¯å€¼ä¼ é€’, å³æˆ‘ä»¬æ— æ³•ä¼ é€’ä¸€ä¸ªå˜é‡ç»™å‡½æ•°, ç„¶åè®©å‡½æ•°ä¿®æ”¹å®ƒçš„å€¼, æ‰€ä»¥åªèƒ½ä½¿ç”¨å…¨å±€å˜é‡å’Œç±»åŒ…è£…çš„å½¢å¼æ¥ä¿®æ”¹ä¸€ä¸ªå˜é‡çš„å€¼, å‡†ç¡®æ¥è¯´ä¿®æ”¹çš„åªæ˜¯å˜é‡çš„æŒ‡å‘, åˆ«å¿˜äº†integeræ˜¯ä¸å¯å˜çš„, æ‰€ä»¥æˆ‘ä»¬æ‰§è¡Œa+=1çš„æ—¶å€™å…¶å®æ˜¯pythonåˆ›å»ºäº†ä¸ªæ–°çš„integerå¯¹è±¡ç„¶åè®©å˜é‡aæŒ‡å‘äº†ä¸€ä¸ªæ–°çš„integer value, æ³¨æ„pythoné‡Œçš„å˜é‡éƒ½å¯ä»¥ç†è§£ä¸ºreference, è¿™ä¸ªreferenceä¸æ˜¯c++é‡Œçš„reference, è€Œæ˜¯Javaé‡Œçš„referenceç±»å‹, åˆ«å¿˜äº†å“¦, Javaçš„å˜é‡åˆ†ä¸ºä¸¤ç§, primitiveå’Œreference, ä¸çŸ¥é“å¯ä»¥å‚è€ƒ: C Go Java Pythonå†…å­˜ç»“æ„åŠå¯¹æ¯” | æ©˜çŒ«å°å…«çš„é±¼\nä¸Šé¢è¯´é“ä½¿ç”¨å…¨å±€å˜é‡å’Œç±»åŒ…è£…çš„å½¢å¼æ¥ä¿®æ”¹ä¸€ä¸ªå˜é‡çš„æŒ‡å‘, å¯æ˜¯pythonæœ‰é‡‡ç”¨å±€éƒ¨å˜é‡å¤§äºå…¨å±€å˜é‡çš„çº¦å®š, å³è¦æ˜¯æƒ³åœ¨å‡½æ•°é‡Œä¿®æ”¹å…¨å±€å˜é‡, æˆ‘ä»¬å¿…é¡»åœ¨å‡½æ•°å‰å£°æ˜global xxx, è¿™è‹¥æ˜¯ä¿®æ”¹å¤šä¸ªå°±å¾ˆä¸ç¾è§‚, æ‰€ä»¥æœ€ç»ˆé‡‡ç”¨ä½¿ç”¨åŒ…è£…ç±»çš„æ–¹å¼æ¥ä¿®æ”¹â€œå…¨å±€â€å˜é‡,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 class Text: ch_flag = False en_flag = False back_quote_flag = False i = 0 text = None def add_space(before=True): if before: Text.text = Text.text[:Text.i] + \u0026#39; \u0026#39; + Text.text[Text.i:] else: Text.text = Text.text[:Text.i + 1] + \u0026#39; \u0026#39; + Text.text[Text.i + 1:] Text.en_flag = False Text.ch_flag = False Text.i += 1 è‹¥ä½¿ç”¨å…¨å±€å˜é‡:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ch_flag = False en_flag = False back_quote_flag = False i = 0 text = None def add_space(before=True): global text global i global en_flag global ch_flag if before: text = text[:i] + \u0026#39; \u0026#39; + text[i:] else: text = text[:i + 1] + \u0026#39; \u0026#39; + text[i + 1:] en_flag = True ch_flag = True i += 1 å¤ªä¸‘äº†,\n# 4. ç¨‹åºå…¥å£ __name__==\u0026quot;__main__\u0026quot; if __name__==\u0026quot;__main__\u0026quot;: å°±ç›¸å½“äºPython æ¨¡æ‹Ÿçš„ç¨‹åºå…¥å£, ç”±äºæ¨¡å—ä¹‹é—´ç›¸äº’å¼•ç”¨, ä¸åŒæ¨¡å—å¯èƒ½éƒ½æœ‰è¿™æ ·çš„å®šä¹‰, è€Œå…¥å£ç¨‹åºåªèƒ½æœ‰ä¸€ä¸ª, é€‰ä¸­å“ªä¸ªå…¥å£ç¨‹åºå–å†³äº __name__çš„å€¼:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import sys def main(): # Check that exactly 1 command line argument was passed if len(sys.argv) != 2: print(\u0026#34;Error: Incorrect number of arguments.\u0026#34;) print(\u0026#34;Usage: python file_path.py path/to/file.txt\u0026#34;) exit(1) file_path = sys.argv[1] print(f\u0026#34;The file path is: {file_path}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: main() Python sets the global __name__ of a module equal to \u0026quot;__main__\u0026quot; if the Python interpreter runs your code in the top-level code environment:\nâ€œTop-level codeâ€ is the first user-specified Python module that starts running. Itâ€™s â€œtop-levelâ€ because it imports all other modules that the program needs. (Source)\n1 2 3 4 5 6 7 8 9 10 print(\u0026#34;look here\u0026#34;) print(__name__) if __name__ == \u0026#39;__main__\u0026#39;: print(\u0026#34;I\u0026#39;m test.py\u0026#34;) # print: look here __main__ I\u0026#39;m test.py # 5. å¼‚å¸¸å¤„ç† 1 2 3 4 5 6 7 8 9 10 file_path = sys.argv[1] try: with open(file_path, encoding=\u0026#34;utf-8\u0026#34;) as f: Text.text = f.read() if Text.text is None: print(\u0026#34;Contents of Text cannot be None!\u0026#34;) else: formatting() except OSError as e: print(f\u0026#34;{type(e)}: {e}\u0026#34;) æºç : https://github.com/shwezhu/PythonLearn/blob/main/add_whitespace/whitespace.py\nå‚è€ƒ:\nUnicode HOWTO â€” Python 3.11.3 documentation encoding - What is the difference between UTF-8 and Unicode? - Stack Overflow utf 8 - ASCII vs Unicode + UTF-8 - Stack Overflow å†™ Python è„šæœ¬ï¼Œä¸€å®šè¦åŠ ä¸Šè¿™ä¸ªï¼-pythonå†™è„šæœ¬ What Does if name == \u0026ldquo;main\u0026rdquo; Do in Python? â€“ Real Python What is a good way to handle exceptions when trying to read a file in python? - Stack Overflow ","date":"2023-06-01T10:41:24Z","permalink":"https://blog.yorforger.cc/p/%E7%94%A8python%E8%84%9A%E6%9C%AC%E7%BB%99%E6%96%87%E7%AB%A0%E4%B8%AD%E8%8B%B1%E5%AD%97%E7%AC%A6%E4%BB%A5%E5%8F%8A%E7%AC%A6%E5%8F%B7%E9%97%B4%E5%8A%A0%E7%A9%BA%E6%A0%BC/","title":"ç”¨Pythonè„šæœ¬ç»™æ–‡ç« ä¸­è‹±å­—ç¬¦ä»¥åŠç¬¦å·é—´åŠ ç©ºæ ¼"},{"content":" # 0. Parrallelism is not concurrency Parallelism is about multiple tasks or subtasks of the same task that literally run at the same time on a hardware with multiple computing resources like multi-core processor, while concurrency is about multiple tasks which start, run, and complete in overlapping time periods, in no specific order.\n# 1. Your program starts When your Go program starts up, itâ€™s given a Logical Processor (P) for every virtual core that is identified on the host machine. If you have a processor with multiple hardware threads per physical core (Hyper-Threading), each hardware thread will be presented to your Go program as a virtual core. To better understand this, take a look at the system report for my MacBook Pro.\nHyper-Threading: one physical core corresponds to two virtual cores. And one virtual core can run one hadware thread at a same time.\nYou can see I have a single processor with 4 physical cores. What this report is not exposing is the number of hardware threads I have per physical core. The Intel Core i7 processor has Hyper-Threading, which means there are 2 hardware threads per physical core. This will report to the Go program that 8 virtual cores are available for executing OS Threads in parallel.\nTo test this, consider the following program:\n1 2 3 4 5 func main() { // NumCPU returns the number of logical // CPUs usable by the current process. fmt.Println(runtime.NumCPU()) } When I run this program on my local machine, the result of the NumCPU() function call will be the value of 8. Any Go program I run on my machine will be given 8 Pâ€™s.\nEvery P is assigned an OS Thread (â€œMâ€). The â€˜Mâ€™ stands for machine. This Thread is still managed by the OS and the OS is still responsible for placing the Thread on a Core for execution, as explained in the last post. This means when I run a Go program on my machine, I have 8 threads available to execute my work, each individually attached to a P.\nEvery Go program is also given an initial Goroutine (â€œGâ€), which is the path of execution for a Go program. A Goroutine is essentially a Coroutine but this is Go, so we replace the letter â€œCâ€ with a â€œGâ€ and we get the word Goroutine. You can think of Goroutines as application-level threads and they are similar to OS Threads in many ways. Just as OS Threads are context-switched on and off a core, Goroutines are context-switched on and off an M.\nThe last piece of the puzzle is the run queues. There are two different run queues in the Go scheduler: the Global Run Queue (GRQ) and the Local Run Queue (LRQ). Each P is given a LRQ that manages the Goroutines assigned to be executed within the context of a P. (è¿™å¥è¯ä¹Ÿå°±è¯´æ˜äº† å¤šä¸ªgoroutineæ˜ å°„åˆ°ä¸€ä¸ªkernel thread, å‡å°‘kernel threadä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°.) These Goroutines take turns being context-switched on and off the M assigned to that P. The GRQ is for Goroutines that have not been assigned to a P yet. There is a process to move Goroutines from the GRQ to a LRQ that we will discuss later.\nMå’ŒPæ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³», Mæœºå™¨å³ç”¨æ¥è¿è¡ŒGoroutineçš„, è€ŒPæ‹¥æœ‰ä¸€ä¸ªrunqueue, è¿™ä¸ªrunqueueé‡Œé¢æœ‰å¤šä¸ªç­‰å¾…è¢«Mæ‰§è¡Œçš„goroutine, åœ¨Mä¸Šåªèƒ½åŒæ—¶è¿è¡Œä¸€ä¸ªgoroutine, æ‰€ä»¥å½“go schedulerè¦switch ä¸€ä¸ªgoroutineçš„æ—¶å€™, è¿™æ—¶å€™è¿›è¡Œgoroutineä¸Šä¸‹æ–‡åˆ‡æ¢, æ³¨æ„è¿™é‡Œä¸æ˜¯å¯¹kernel thread, å³Mè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢,\næ ¹æ®å›¾å¯ä»¥çœ‹å‡º, ä¸€ä¸ªkernel threadç»´æŠ¤ä¸€ä¸ªrunqueue, è¯·å‚è€ƒ: https://youtu.be/YHRO5WQGh0k\nå¦å¤–çš„æˆ‘ç”µè„‘æ˜¯èŠ¯ç‰‡æ˜¯M1, ä¿¡æ¯å¦‚ä¸‹:\n1 Total Number of Cores: 8 (4 performance and 4 efficiency) æ‰§è¡Œä¸Šé¢Goç¨‹åº, ä»ä¸º8, æ¨æ–­M1æ²¡æœ‰åˆ©ç”¨Hyper-ThreadingæŠ€æœ¯, è¿™ä¸ªæŠ€æœ¯æ˜¯Intelçš„, å½“ç„¶å…¶ä»–åˆ¶é€ å•†ä¹Ÿæœ‰ç±»ä¼¼æŠ€æœ¯,\n# 2. Cooperating scheduler As we discussed in the first post, the OS scheduler is a preemptive scheduler. Essentially that means you canâ€™t predict what the scheduler is going to do at any given time. The kernel is making decisions and everything is non-deterministic. Applications that run on top of the OS have no control over what is happening inside the kernel with scheduling unless they leverage synchronization primitives like atomic instructions and mutex calls.\nThe Go scheduler is part of the Go runtime, and the Go runtime is built into your application. This means the Go scheduler runs in user space, above the kernel. The current implementation of the Go scheduler is not a preemptive scheduler but a cooperating scheduler. Being a cooperating scheduler means the scheduler needs well-defined user space events that happen at safe points in the code to make scheduling decisions.\nWhatâ€™s brilliant about the Go cooperating scheduler is that it looks and feels preemptive. You canâ€™t predict what the Go scheduler is going to do. This is because decision making for this cooperating scheduler doesnâ€™t rest in the hands of developers, but in the Go runtime. Itâ€™s important to think of the Go scheduler as a preemptive scheduler and since the scheduler is non-deterministic, this is not much of a stretch.\n# 3. Goroutine states Just like Threads, Goroutines have the same three high-level states. These dictate the role the Go scheduler takes with any given Goroutine. A Goroutine can be in one of three states: Waiting, Runnable or Executing.\nWaiting: This means the Goroutine is stopped and waiting for something in order to continue. This could be for reasons like waiting for the operating system (system calls) or synchronization calls (atomic and mutex operations). These types of latencies are a root cause for bad performance.\nRunnable: This means the Goroutine wants time on an M so it can execute its assigned instructions. If you have a lot of Goroutines that want time, then Goroutines have to wait longer to get time. Also, the individual amount of time any given Goroutine gets is shortened as more Goroutines compete for time. This type of scheduling latency can also be a cause of bad performance.\nExecuting: This means the Goroutine has been placed on an M and is executing its instructions. The work related to the application is getting done. This is what everyone wants.\n# 4. Context switching The Go scheduler requires well-defined user-space events that occur at safe points in the code to context-switch from. These events and safe points manifest themselves within function calls. Function calls are critical to the health of the Go scheduler. Today (with Go 1.11 or less), if you run any tight loops that are not making function calls, you will cause latencies within the scheduler and garbage collection. Itâ€™s critically important that function calls happen within reasonable timeframes.\nNote: There is a proposal for 1.12 that was accepted to apply non-cooperative preemption techniques inside the Go scheduler to allow for the preemption of tight loops.\nThere are four classes of events that occur in your Go programs that allow the scheduler to make scheduling decisions. This doesnâ€™t mean it will always happen on one of these events. It means the scheduler gets the opportunity.\nThe use of the keyword go Garbage collection System calls Synchronization and Orchestration System calls\nIf a Goroutine makes a system call that will cause the Goroutine to block the M, sometimes the scheduler is capable of context-switching the Goroutine off the M and context-switch a new Goroutine onto that same M. However, sometimes a new M is required to keep executing Goroutines that are queued up in the P. How this works will be explained in more detail in the next section.\nSynchronization and Orchestration\nIf an atomic, mutex, or channel operation call will cause the Goroutine to block, the scheduler can context-switch a new Goroutine to run. Once the Goroutine can run again, it can be re-queued and eventually context-switched back on an M.\n# 5. Asynchronous system calls When the OS you are running on has the ability to handle a system call asynchronously, something called the network poller can be used to process the system call more efficiently. This is accomplished by using kqueue (MacOS), epoll (Linux) or iocp (Windows) within these respective OSâ€™s.\nNetworking-based system calls can be processed asynchronously by many of the OSs we use today. This is where the network poller gets its name, since its primary use is handling networking operations. By using the network poller for networking system calls, the scheduler can prevent Goroutines from blocking the M when those system calls are made. This helps to keep the M available to execute other Goroutines in the Pâ€™s LRQ without the need to create new Ms. This helps to reduce scheduling load on the OS.\nThe best way to see how this works is to run through an example.\nFigure 3 shows our base scheduling diagram. Goroutine-1 is executing on the M and there are 3 more Goroutines waiting in the LRQ to get their time on the M. The network poller is idle with nothing to do.\nIn figure 4, Goroutine-1 wants to make a network system call, so Goroutine-1 is moved to the network poller and the asynchronous network system call is processed. Once Goroutine-1 is moved to the network poller, the M is now available to execute a different Goroutine from the LRQ. In this case, Goroutine-2 is context-switched on the M.\nIn figure 5, the asynchronous network system call is completed by the network poller and Goroutine-1 is moved back into the LRQ for the P. Once Goroutine-1 can be context-switched back on the M, the Go related code itâ€™s responsible for can execute again. The big win here is that, to execute network system calls, no extra Ms are needed. The network poller has an OS Thread and it is handling an efficient event loop.\n# 6. Synchronous system calls What happens when the Goroutine wants to make a system call that canâ€™t be done asynchronously? In this case, the network poller canâ€™t be used and the Goroutine making the system call is going to block the M. This is unfortunate but thereâ€™s no way to prevent this from happening. One example of a system call that canâ€™t be made asynchronously is file-based system calls. If you are using CGO, there may be other situations where calling C functions will block the M as well.\nNote: The Windows OS does have the capability of making file-based system calls asynchronously. Technically when running on Windows, the network poller can be used.\nLetâ€™s walk through what happens with a synchronous system call (like file I/O) that will cause the M to block.\nFigure 6 is showing our basic scheduling diagram again but this time Goroutine-1 is going to make a synchronous system call that will block M1.\nIn figure 7, the scheduler is able to identify that Goroutine-1 has caused the M to block. At this point, the scheduler detaches M1 from the P with the blocking Goroutine-1 still attached. Then the scheduler brings in a new M2 to service the P. At that point, Goroutine-2 can be selected from the LRQ and context-switched on M2. If an M already exists because of a previous swap, this transition is quicker than having to create a new M.\nIn figure 8, the blocking system call that was made by Goroutine-1 finishes. At this point, Goroutine-1 can move back into the LRQ and be serviced by the P again. M1 is then placed on the side for future use if this scenario needs to happen again.\nåˆ°è¿™æˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£ä¸ºä»€ä¹ˆè¯´Pæ˜¯è¿æ¥Må’ŒGçš„æ¡¥æ¢, Pç»´æŠ¤ä¸€ä¸ªrunqueue, é‡Œé¢å­˜çš„æ˜¯ç­‰å¾…è¢«Mæ‰§è¡ŒG, Mæ‰§è¡ŒGæ—¶ä»å’Œä»–è¿æ¥çš„é‚£ä¸ªPçš„runqueueé‡Œæ‹¿G, è‡³äºè°æ›´æ–°Pçš„runqueue, è°è´Ÿè´£æŠŠG context switch onto Mæˆ–è€…off M, æ˜¯Pè‡ªå·±å‘¢?è¿˜æ˜¯Go Schedulerè´Ÿè´£å‘¢?\nè¿™é‡Œä¹Ÿæ³¨æ„ä¸€ä¸‹, M å¯ä»¥è¢« (OS) contex-switched M off/onto the Core, Gå¯ä»¥è¢« contex-switched M off/onto the M, è‡³äºè¢«è°, é‚£è‚¯å®šæ˜¯Go Scheduleräº†, ä¸Šé¢æåˆ°äº†: The Go scheduler requires well-defined user-space events that occur at safe points in the code to context-switch from. context-switchè°? å½“ç„¶æ˜¯ context-switch G onto/off from M äº†,\nSource:\nScheduling In Go : Part II - Go Scheduler GopherCon 2018: Kavya Joshi - The Scheduler Saga ","date":"2023-05-28T18:06:20Z","permalink":"https://blog.yorforger.cc/p/go-scheduler-2/","title":"Go Scheduler (2)"},{"content":"Source: Scheduling In Go : Part I - OS Scheduler\n# 1. OS scheduler Your program is just a series of machine instructions that need to be executed one after the other sequentially. To make that happen, the operating system uses the concept of a Thread. Itâ€™s the job of the Thread to account for and sequentially execute the set of instructions itâ€™s assigned. Execution continues until there are no more instructions for the Thread to execute. This is why I call a Thread, â€œa path of executionâ€.\nEvery program you run creates a Process and each Process is given an initial Thread. Threads have the ability to create more Threads. All these different Threads run independently of each other and scheduling decisions are made at the Thread level, not at the Process level. Threads can run concurrently (each taking a turn on an individual core), or in parallel (each running at the same time on different cores). Threads also maintain their own state to allow for the safe, local, and independent execution of their instructions.\nThe OS scheduler is responsible for making sure cores are not idle if there are Threads that can be executing. It must also create the illusion that all the Threads (that can execute) are executing at the same time. In the process of creating this illusion, the scheduler needs to run Threads with a higher priority over lower priority Threads. However, Threads with a lower priority canâ€™t be starved of execution time. The scheduler also needs to minimize scheduling latencies as much as possible by making quick and smart decisions.\nTo understand all of this better, itâ€™s good to describe and define a few concepts that are important.\n# 2. Program counter - PC The program counter (PC), which is sometimes called the instruction pointer (IP), is what allows the Thread to keep track of the next instruction to execute. In most processors, the PC points to the next instruction and not the current instruction.\n# 3. Thread states Another important concept is Thread state, which dictates the role the scheduler takes with the Thread. A Thread can be in one of three states: Waiting, Runnable or Executing.\nWaiting: This means the Thread is stopped and waiting for something in order to continue. This could be for reasons like, waiting for the hardware (disk, network), the operating system (system calls) or synchronization calls (atomic, mutexes). These types of latencies are a root cause for bad performance.\nRunnable: This means the Thread wants time on a core so it can execute its assigned machine instructions.\nExecuting: \u0026hellip;\n# 4. Types of work There are two types of work a Thread can do. The first is called CPU-Bound and the second is called IO-Bound.\nCPU-Bound: This is work that never creates a situation where the Thread may be placed in Waiting states. This is work that is constantly making calculations. A Thread calculating Pi to the Nth digit would be CPU-Bound.\nIO-Bound: This is work that causes Threads to enter into Waiting states. This is work that consists in requesting access to a resource over the network or making system calls into the operating system. A Thread that needs to access a database would be IO-Bound. I would include synchronization events (mutexes, atomic), that cause the Thread to wait as part of this category.\nThe term CPU-bound describes a scenario where the execution of a task or program is highly dependent on the CPU. In contrast, a task or program is I/O bound if its execution is dependent on the input-output system and its resources, such as disk drives and peripheral devices.\n# 5. Context switching If you are running on Linux, Mac or Windows, you are running on an OS that has a preemptive scheduler. This means a few important things. First, it means the scheduler is unpredictable when it comes to what Threads will be chosen to run at any given time. Thread priorities together with events, (like receiving data on the network) make it impossible to determine what the scheduler will choose to do and when. Second, it means you must never write code based on some perceived behavior that you have been lucky to experience but is not guaranteed to take place every time. It is easy to allow yourself to think, because Iâ€™ve seen this happen the same way 1000 times, this is guaranteed behavior. You must control the synchronization and orchestration of Threads if you need determinism in your application.\nThe physical act of swapping Threads on a core is called a context switch. A context switch happens when the scheduler pulls an Executing thread off a core and replaces it with a Runnable Thread. The Thread that was selected from the run queue moves into an Executing state. The Thread that was pulled can move back into a Runnable state (if it still has the ability to run), or into a Waiting state (if was replaced because of an IO-Bound type of request).\nContext switches are considered to be expensive because it takes times to swap Threads on and off a core. The amount of latency incurrent during a context switch depends on different factors but itâ€™s not unreasonable for it to take between ~1000 and ~1500 nanoseconds. Considering the hardware should be able to reasonably execute (on average) 12 instructions per nanosecond per core, a context switch can cost you ~12k to ~18k instructions of latency. In essence, your program is losing the ability to execute a large number of instructions during a context switch.\nIf you have a program that is focused on IO-Bound work, then context switches are going to be an advantage. Once a Thread moves into a Waiting state, another Thread in a Runnable state is there to take its place.** This allows the core to always be doing work. This is one of the most important aspects of scheduling. Donâ€™t allow a core to go idle if there is work (Threads in a Runnable state) to be done. è¿˜è®°å¾—æ–‡ç« ç¬¬ä¸€ä¸ªåŠ ç²—çš„é‚£æ®µè¯å—, OS Schedulerçš„ä½œç”¨, ç„¶åå†çœ‹çœ‹æ®µå¥è¯,\nIf your program is focused on CPU-Bound work, then context switches are going to be a performance nightmare. Since the Thead always has work to do, the context switch is stopping that work from progressing. This situation is in stark contrast with what happens with an IO-Bound workload\n# 6. Less is more In the early days when processors had only one core, scheduling wasnâ€™t overly complicated. Because you had a single processor with a single core, only one Thread could execute at any given time. The idea was to define a scheduler period and attempt to execute all the Runnable Threads within that period of time. No problem: take the scheduling period and divide it by the number of Threads that need to execute.\nAs an example, if you define your scheduler period to be 1000ms (1 second) and you have 10 Threads, then each thread gets 100ms. If you have 100 Threads, each Thread gets 10ms. However, what happens when you have 1000 Threads? Giving each Thread a time slice of 1ms doesnâ€™t work because the percentage of time youâ€™re spending in context switches will be significant related to the amount of time youâ€™re spending on application work.\nWhat you need is to set a limit on how small a given time slice can be. In the last scenario, if the minimum time slice was 10ms and you have 1000 Threads, the scheduler period needs to increase to 10000ms (10 seconds). What if there were 10,000 Threads, now you are looking at a scheduler period of 100000ms (100 seconds). At 10,000 threads, with a minimal time slice of 10ms, it takes 100 seconds for all the Threads to run once in this simple example if each Thread uses its full time slice.\nBe aware this is a very simple view of the world. There are more things that need to be considered and handled by the scheduler when making scheduling decisions. You control the number of Threads you use in your application. When there are more Threads to consider, and IO-Bound work happening, there is more chaos and nondeterministic behavior. Things take longer to schedule and execute.\nThis is why the rule of the game is â€œLess is Moreâ€. Less Threads in a Runnable state means less scheduling overhead and more time each Thread gets over time. More Threads in a Runnable state mean less time each Thread gets over time. That means less of your work is getting done over time as well.\n# 7. Find the balance There is a balance you need to find between the number of cores you have and the number of Threads you need to get the best throughput for your application. When it comes to managing this balance, Thread pools were a great answer. I will show you in part II that this is no longer necessary with Go. I think this is one of the nice things Go did to make multithreaded application development easier.\nPrior to coding in Go, I wrote code in C++ and C# on NT. On that operating system, the use of IOCP (IO Completion Ports) thread pools were critical to writing multithreaded software. As an engineer, you needed to figure out how many Thread pools you needed and the max number of Threads for any given pool to maximize throughput for the number of cores that you were given.\nWhen writing web services that talked to a database, the magic number of 3 Threads per core seemed to always give the best throughput on NT. In other words, 3 Threads per core minimized the latency costs of context switching while maximizing execution time on the cores. When creating an IOCP Thread pool, I knew to start with a minimum of 1 Thread and a maximum of 3 Threads for every core I identified on the host machine.\nIf I used 2 Threads per core, it took longer to get all the work done, because I had idle time when I could have been getting work done. If I used 4 Threads per core, it also took longer, because I had more latency in context switches. The balance of 3 Threads per core, for whatever reason, always seemed to be the magic number on NT.\nWhat if your service is doing a lot of different types of work? That could create different and inconsistent latencies. Maybe it also creates a lot of different system-level events that need to be handled. It might not be possible to find a magic number that works all the time for all the different work loads. When it comes to using Thread pools to tune the performance of a service, it can get very complicated to find the right consistent configuration.\n# 8. Cache lines Accessing data from main memory has such a high latency cost (100~300 clock cycles) that processors and cores have local caches to keep data close to the hardware threads that need it. Accessing data from caches have a much lower cost (3~40 clock cycles) depending on the cache being accessed. Today, one aspect of performance is about how efficiently you can get data into the processor to reduce these data-access latencies. Writing multithreaded applications that mutate state need to consider the mechanics of the caching system.\nData is exchanged between the processor and main memory using cache lines. A cache line is a 64-byte chunk of memory that is exchanged between main memory and the caching system. Each core is given its own copy of any cache line it needs, which means the hardware uses value semantics. This is why mutations to memory in multithreaded applications can create performance nightmares.\nReferences:\nScheduling In Go : Part I - OS Scheduler\nGuide to the â€œCpu-Boundâ€ and â€œI/O Boundâ€ Terms | Baeldung on Computer Science\nRelated articles:\nå¤šæ ¸ CPU ä¹‹ Hyper Threading | æ©˜çŒ«å°å…«çš„é±¼\nå¹¶å‘å­¦ä¹ ä¹‹ Context Switching | æ©˜çŒ«å°å…«çš„é±¼\nå¹¶å‘å­¦ä¹ ä¹‹çº¿ç¨‹è¿›ç¨‹åŠHyper-Threading | æ©˜çŒ«å°å…«çš„é±¼\n","date":"2023-05-28T17:48:19Z","permalink":"https://blog.yorforger.cc/p/go-scheduler-1/","title":"Go Scheduler (1)"},{"content":" # 1. CPU structure Single core CPU:\nThe CPU core consists of three parts: ALU, CU and Memory (Register + Cache), The multiple cores CPU has more than one core (ALU, CU, Memory (Register + Cache)) to execute instructions:\n# 2. Hyper-threading A single physical core with hyper-threading or simultaneous multithreading technology appears as two logical cores to an operating system. The CPU is still a single CPU, so itâ€™s a little bit of a cheat. This can speed things up somewhat â€” if one virtual CPU is stalled and waiting, the other virtual CPU can borrow its execution resources.\nMost processors can use a process called simultaneous multithreading or, if itâ€™s an Intel processor, Hyper-threading (the two terms mean the same thing) to split a core into virtual cores, which are called threads. For example, AMD CPUs with four cores use simultaneous multithreading to provide eight threads, and most Intel CPUs with two cores use Hyper-threading to provide four threads.\nSome apps take better advantage of multiple threads than others. Lightly-threaded apps, like games, don\u0026rsquo;t benefit from a lot of cores, while most video editing and animation programs can run much faster with extra threads.\nNote: Strictly speaking, only Intel processors have hyper-threading, however, the term is sometimes used colloquially to refer to any kind of simultaneous multithreading.\nThe Windows Task Manager shows this fairly well. Here, for example, you can see that this system has one actual CPU (socket) and 8 cores. Simultaneous multithreading makes each core look like two CPUs to the operating system, so it shows 16 logical processors.\n# Logical core vs OS thread OS Threadï¼ˆæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼‰ï¼š\nçº¿ç¨‹ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†ï¼Œå®ƒå¯ä»¥è°ƒåº¦çº¿ç¨‹åœ¨ä¸åŒçš„ CPU æ ¸å¿ƒæˆ–é€»è¾‘å¤„ç†å™¨ä¸Šè¿è¡Œã€‚ çº¿ç¨‹çš„è°ƒåº¦å’Œç®¡ç†æ¶‰åŠ context switching, priority scheduling Hyper-threadingï¼ˆè¶…çº¿ç¨‹ï¼‰ï¼š\nHyper-threading æ˜¯ Intel æä¾›çš„ä¸€ç§ç¡¬ä»¶çº§åˆ«çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸å•ä¸ªç‰©ç† CPU æ ¸å¿ƒæ¨¡æ‹Ÿå‡ºä¸¤ä¸ªé€»è¾‘å¤„ç†å™¨ã€‚ å½“å¯ç”¨ Hyper-threading æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šçœ‹åˆ°æ¯”å®é™…ç‰©ç†æ ¸å¿ƒæ•°æ›´å¤šçš„å¤„ç†å™¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ‹¥æœ‰ 4 ä¸ªç‰©ç†æ ¸å¿ƒçš„ CPU å¯èƒ½ä¼šæ˜¾ç¤ºä¸º 8 ä¸ªé€»è¾‘å¤„ç†å™¨ã€‚ åœ¨æ“ä½œç³»ç»Ÿç®¡ç†çº¿ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šå°†å¤šä¸ª OS thread åˆ†é…ç»™å¯ç”¨çš„ CPU æ ¸å¿ƒï¼ŒåŒ…æ‹¬é€šè¿‡ Hyper-threading æŠ€æœ¯åˆ›å»ºçš„é€»è¾‘å¤„ç†å™¨ã€‚è¿™ä¸ªåˆ†é…è¿‡ç¨‹è€ƒè™‘äº†å¤šä¸ªå› ç´ ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€CPU äº²å’Œæ€§ï¼ˆaffinityï¼‰ã€ä»¥åŠæ ¸å¿ƒçš„å½“å‰è´Ÿè½½æƒ…å†µã€‚å› æ­¤ï¼Œæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸ Hyper-threading æ˜¯ååŒå·¥ä½œçš„ä¸¤ä¸ªä¸åŒå±‚é¢çš„æ¦‚å¿µï¼šä¸€ä¸ªå±äºè½¯ä»¶å±‚é¢ï¼ˆæ“ä½œç³»ç»Ÿç®¡ç†ï¼‰ï¼Œå¦ä¸€ä¸ªå±äºç¡¬ä»¶å±‚é¢ï¼ˆCPU æ¶æ„ï¼‰ã€‚\nå‚è€ƒ:\nCPU Basics: What Are Cores, Hyper-Threading, and Multiple CPUs? Differences Between Core and CPU | Baeldung on Computer Science What Is a CPU Core? A Basic Definition | Tom\u0026rsquo;s Hardware ","date":"2023-05-28T15:47:18Z","permalink":"https://blog.yorforger.cc/p/hyper-threading-physical-threads/","title":"Hyper-Threading \u0026 Physical Threads"},{"content":" # 1. Javascript Taken from JavaScript | MDN but this applies for all language with GC:\nLow-level languages like C, have manual memory management primitives such as malloc() and free(). In contrast, JavaScript automatically allocates memory when objects are created and frees it when they are not used anymore (garbage collection). This automaticity is a potential source of confusion: it can give developers the false impression that they don\u0026rsquo;t need to worry about memory management.\nRegardless of the programming language, the memory life cycle is pretty much always the same:\nAllocate the memory you need Use the allocated memory (read, write), each variable exists as long as there are references to it. Release the allocated memory when it is not needed anymore (Usually done by GC) The second part is explicit in all languages. The first and last parts are explicit in low-level languages but are mostly implicit in high-level languages like JavaScript.\n# 1.1. Allocation 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 const n = 123; // allocates memory for a number const s = \u0026#34;azerty\u0026#34;; // allocates memory for a string const o = { a: 1, b: null, }; // allocates memory for an object and contained values // (like object) allocates memory for the array and // contained values const a = [1, null, \u0026#34;abra\u0026#34;]; function f(a) { return a + 2; } // allocates a function (which is a callable object) // function expressions also allocate an object someElement.addEventListener( \u0026#34;click\u0026#34;, () =\u0026gt; { someElement.style.backgroundColor = \u0026#34;blue\u0026#34;; }, false, ); # 1.2. Using values Using values basically means reading and writing in allocated memory. This can be done by reading or writing the value of a variable or an object property or even passing an argument to a function.\n# 1.3. Release when the memory is not needed anymore The majority of memory management issues occur at this phase. The most difficult aspect of this stage is determining when the allocated memory is no longer needed.\nLow-level languages require the developer to manually determine at which point in the program the allocated memory is no longer needed and to release it.\nSome high-level languages, such as JavaScript, utilize a form of automatic memory management known as garbage collection (GC). The purpose of a garbage collector is to monitor memory allocation and determine when a block of allocated memory is no longer needed and reclaim it.\nLearn more: Memory management - JavaScript | MDN\n# 2. Python Memory management in Python involves a private heap containing all Python objects and data structures. The management of this private heap is ensured internally by the Python memory manager. The Python memory manager has different components which deal with various dynamic storage management aspects, like sharing, segmentation, preallocation or caching.\nEverything is an object in Python, even types such as int and str.\nLearn more: Memory Management â€” Python 3.12.0 documentation\n# 3. Golang From a correctness standpoint, you don\u0026rsquo;t need to know. Each variable in Go exists as long as there are references to it. The storage location chosen by the implementation is irrelevant to the semantics of the language.\nThe storage location does have an effect on writing efficient programs. When possible, the Go compilers will allocate variables that are local to a function in that function\u0026rsquo;s stack frame. However, if the compiler cannot prove that the variable is not referenced after the function returns, then the compiler must allocate the variable on the garbage-collected heap to avoid dangling pointer errors. Also, if a local variable is very large, it might make more sense to store it on the heap rather than the stack.\nIn the current compilers, if a variable has its address taken, that variable is a candidate for allocation on the heap. However, a basic escape analysis recognizes some cases when such variables will not live past the return from the function and can reside on the stack.\n# 4. Java Learn more: https://davidzhu.xyz/post/java/basics/005-memory-structure/\n# 5. C/C++ C has three different pools of memory:\nstatic: global variable storage, permanent for the entire run of the program. stack: local variable storage (automatic, continuous memory). heap: dynamic storage (large pool of memory, not allocated in contiguous order). # 5.1. Static memory Static memory persists throughout the entire life of the program, and is usually used to store things like global variables, or variables created with the static clause. If a variable is declared outside of a function, it is considered global, meaning it is accessible anywhere in the program. Global variables are static, and there is only one copy for the entire program. Inside a function the variable is allocated on the stack. It is also possible to force a variable to be static using the static clause. For example, the same variable created inside a function using the static clause would allow it to be stored in static memory.\n1 static int theforce; # 5.2. Stack memory The stack is used to store variables used on the inside of a function (including the main() function). Itâ€™s a LIFO, â€œLast-In,-First-Outâ€, structure. Every time a function declares a new variable it is â€œpushedâ€ onto the stack. Then when a function finishes running, all the variables associated with that function on the stack are deleted, and the memory they use is freed up. This leads to the â€œlocalâ€ scope of function variables.\nNote that there is generally a limit on the size of the stack â€“ which can vary with the operating system (for example OSX currently has a default stack size of 8MB). If a program tries to put too much information on the stack, stack overflow will occur. Stack overflow happens when all the memory in the stack has been allocated, and further allocations begin overflowing into other sections of memory. Stack overflow also occurs in situations where recursion is incorrectly used.\nthe stack grows and shrinks as variables are created and destroyed stack variables only exist whilst the function that created them exists # 5.3. Heap Memory The heap is the diametrical opposite of the stack. The heap is a large pool of memory that can be used dynamically â€“ it is also known as the â€œfree storeâ€. This is memory that is not automatically managed in C/C++ â€“ you have to explicitly allocate (using functions such as malloc), and deallocate (e.g. free) the memory. Failure to free the memory when you are finished with it will result in what is known as a memory leak â€“ memory that is still â€œbeing usedâ€, and not available to other processes. Unlike the stack, there are generally no restrictions on the size of the heap (or the variables it creates), other than the physical size of memory in the machine. Variables created on the heap are accessible anywhere in the program.\n# 6. Conclusion Most of languages are designed with stack and heap, the concept of stack and heap are not mentioned in Javascript, but some concepts like the function stack frame, heap are shared among the modern languages designs. Our goal is to grab the lifetime of objects so that can write good and robust codes, not stack and heap.\nReferences:\nMemory in C â€“ the stack, the heap, and static â€“ The Craft of Coding When will a string be garbage collected in java - Stack Overflow Choosing a GC Algorithm in Java | Baeldung Golang Memory Management: Allocation Efficiency in Go Services Memory Management â€” Python 3.11.3 documentation Memory Management in Python - Honeybadger Developer Blog CPython ğŸš€ Visualizing memory management in Golang | Technorage methods - Is Java \u0026ldquo;pass-by-reference\u0026rdquo; or \u0026ldquo;pass-by-value\u0026rdquo;? - Stack Overflow Stack vs heap allocation of structs in Go, and how they relate to garbage collection - Stack Overflow python - How do I pass a variable by reference? - Stack Overflow Garbage Collector Design ğŸš€ Demystifying memory management in modern programming languages | Technorage ","date":"2023-05-27T19:59:17Z","permalink":"https://blog.yorforger.cc/p/c-go-java-python%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AF%B9%E6%AF%94/","title":"C Go Java Pythonå†…å­˜ç»“æ„åŠå¯¹æ¯”"},{"content":" # 1. Thread A thread is a segment or part of a process that executes some tasks of the process. A process can have multiple threads which can run concurrently within the process. Each thread has its own thread stack but multiple threads of a process share a common heap area of that process.\n# 1.1. Thread stack Each thread has its own call stack, \u0026ldquo;call stack\u0026rdquo; and \u0026ldquo;thread stack\u0026rdquo; are the same thing. Calling it a \u0026ldquo;thread stack\u0026rdquo; just emphasizes that the call stack is specific to the thread.\nThe stack is used to store variables used on the inside of a function (including the main() function). Itâ€™s a LIFO, â€œLast-In,-First-Outâ€, structure. Every time a function declares a new variable it is â€œpushedâ€ onto the stack. Then when a function finishes running, all the variables associated with that function on the stack are deleted, and the memory they use is freed up. This leads to the â€œlocalâ€ scope of function variables. The stack is a special region of memory, and automatically managed by the CPU â€“ so you donâ€™t have to allocate or deallocate memory. Stack memory is divided into successive frames where each time a function is called, it allocates itself a fresh stack frame.\nNote that there is generally a limit on the size of the stack â€“ which can vary with the operating system (for example OSX currently has a default stack size of 8MB). If a program tries to put too much information on the stack, stack overflow will occur. Stack overflow happens when all the memory in the stack has been allocated, and further allocations begin overflowing into other sections of memory. Stack overflow also occurs in situations where recursion is incorrectly used.\n# 2. Process A program is a set of instructions. It is stored on a disk of a computer and hence it is Passive. When the same program is loaded into the main memory and the OS assigns some heap memory to this program(application) is under execution is called a Process. Hence a process is a program under execution. So we can say it is Active. A process can create child processes by using the fork system calls.\n# 3. Relationship between a thread and a CPU core A CPU core is a physical processing unit in a computerâ€™s central processing unit (CPU) that can execute instructions independently. A thread, on the other hand, is a unit of execution within a process, which represents a sequence of instructions that can be executed independently by a CPU.\nIn general, the number of threads that can be executed simultaneously on a CPU is limited by the number of cores available in the CPU. Each core can execute one thread at a time, so having multiple cores allows for multiple threads to be executed in parallel, potentially leading to improved performance.\nHowever, the relationship between threads and CPU cores is more complex than just one-to-one mapping.\nIn modern computer systems, threads can be scheduled dynamically on different cores by the operating system, and a single core can switch between multiple threads in order to maximize the utilization of available resources and CPU cores.\nAdditionally, some systems may also use techniques such as hyper-threading, where a single physical core is treated as multiple virtual cores, potentially allowing for even more threads to be executed simultaneously.\nNote that **simultaneous not equals to parallel. **\nFrom this can also see the importance of those basic undergraduate courses, the principles of computer composition of a lot of content, including the CPU architecture, registers, buses, memory structure, how the CPU reads commands from the registers, which provides the basis for future operating system courses. For example, now we are learning about threads, processes, which are all part of the operating system curriculum, and hyper-threading, if you don\u0026rsquo;t know how the CPU handles instructions and how it waits for the bus to send data, how can you understand the interrupt system very well? Golang is very popular now, it is very good at concurrency, Goroutine is very lightweight, but why is goroutine lightweight? You\u0026rsquo;re probably going to get asked that in an interview, right? These are context switches, and you can\u0026rsquo;t understand why goroutines are so powerful without learning the above, but that\u0026rsquo;s just one example. This is just one example. Just one concurrency problem, and that\u0026rsquo;s a lot of knowledge and lessons. The rest of the course such as the network, compilation principles, are very important, may not have an immediate effect, but they will be the future to support you the most solid foundation of the building.\nRelated article:\nContext Switching - David\u0026rsquo;s Blog\nHyper-Threading \u0026amp; Physical Threads - David\u0026rsquo;s Blog\nReferences:\nProcess and Thread Context Switching, Do You Know the Difference? java - Difference between \u0026ldquo;call stack\u0026rdquo; and \u0026ldquo;thread stack\u0026rdquo; - Stack Overflow Memory in C â€“ the stack, the heap, and static â€“ The Craft of Coding ","date":"2023-05-27T18:05:16Z","permalink":"https://blog.yorforger.cc/p/thread-stack-and-cpu-cores/","title":"Thread Stack and CPU Cores"},{"content":" # 1. Context switch In a CPU, the term \u0026ldquo;context\u0026rdquo; refers to the data in the registers and program counter (PC) at a specific moment in time. A register holds the current CPU instruction. A program counter, also known as an instruction address register, is a small amount of fast memory that holds the address of the instruction to be executed immediately after the current one.\nIn computing, a context switch is the process of storing the state of a process or thread, so that it can be restored and resume execution at a later point, and then restoring a different, previously saved, state. Two steps, the first step is to store the state of the thread and then restore the state of another.\n# 2. Two data structure: PCB \u0026amp; TCB The \u0026lsquo;state\u0026rsquo; mentioned above is thread or process related information, stored in PCB (Process) and TCB (Thread) respectively.\n# 2.1 Process control block (PCB) A process control block (PCB) contains information about the process, i.e. registers, PID, priority, etc. The process table is an array of PCBs, that means logically contains a PCB for all of the current processes in the system.\nProcess State â€“ new, ready, running, waiting, dead; Process Number (PID) â€“ unique identification number for each process (also known as Process ID); Program Counter (PC) â€“ a pointer to the address of the next instruction to be executed for this process; CPU Registers â€“ register set where process needs to be stored for execution for running state; # 2.2 Thread control block (TCB) An example of information contained within a TCB is:\nThread Identifier: Unique id (tid) is assigned to every new thread Stack pointer: Points to thread\u0026rsquo;s stack in the process Program counter (PC): Points to the current program instruction of the thread State of the thread (running, ready, waiting, start, done) Thread\u0026rsquo;s register values Pointer to the Process control block (PCB) of the process that the thread lives on # 3. Cost of context switch Switching from one process to another requires a certain amount of time for doing the administration â€“ saving and loading registers and memory maps, updating various tables and lists, etc.\nFor example, in the Linux kernel, context switching involves loading the corresponding process control block (PCB) stored in the PCB table in the kernel stack to retrieve information about the state of the new process. CPU state information including the registers, stack pointer, and program counter as well as memory management information like segmentation tables and page tables (unless the old process shares the memory with the new) are loaded from the PCB for the new process. To avoid incorrect address translation in the case of the previous and current processes using different memory, the translation lookaside buffer (TLB) must be flushed. This negatively affects performance because every memory reference to the TLB will be a miss because it is empty after most context switches.\nFurthermore, analogous context switching happens between user threads, notably green threads, and is often very lightweight, saving and restoring minimal context. In extreme cases, such as switching between goroutines in Go, a context switch is equivalent to a coroutine yield, which is only marginally more expensive than a subroutine call.\n# 4. When context switch happens System calls: when a process makes any system calls, the OS switches the mode of the kernel and saves that process in context, and executes the system call.\nInterrupt handling: Modern architectures are interrupt driven. This means that if the CPU requests data from a disk, for example, it does not need to busy-wait until the read is over; it can issue the request (to the I/O device) and continue with some other task. When the read is over, the CPU can be interrupted (by a hardware in this case, which sends interrupt request to PIC) and presented with the read. For interrupts, a program called an interrupt handler is installed, and it is the interrupt handler that handles the interrupt from the disk.\nUser and Kernel Mode switching: this trigger is used when the OS needed to switch between the user mode and kernel mode.\n# 5. Performance Context switching itself has a cost in performance, due to running the task scheduler, TLB flushes, and indirectly due to sharing the CPU cache between multiple tasks. Switching between threads of a single process can be faster than between two separate processes, because threads share the same virtual memory maps, so a TLB flush is not necessary.\n# 6. Conclusion program counter (PC): processor register, stores the address of next instruction to be executed. context switch: store state, restore state causes of context siwtch system call interrupt handling: CPU requests data from a disk References:\nContext switch Process control block Thread control block Program counter Context Switch in Operating System - GeeksforGeeks Scheduling In Go : Part I - OS Scheduler ","date":"2023-05-27T16:29:15Z","permalink":"https://blog.yorforger.cc/p/context-switching/","title":"Context Switching"},{"content":"æœ€è¿‘çœ‹çº¿ç¨‹æ€»æ˜¯çœ‹åˆ° goroutine managed by go runtime, \u0026hellip; runtime, ä¹Ÿçœ‹åˆ°é—®é¢˜ Does Go has a runtime? åˆšå¥½Goåœ¨å®˜æ–¹FAQsæœ‰å›ç­”, å°±åœ¨è¿™è®°å½•ä¸€ä¸‹,\nDoes Go have a runtime?\nGo does have an extensive library, called the runtime, that is part of every Go program. The runtime library implements garbage collection, concurrency, stack management, and other critical features of the Go language. Although it is more central to the language, Go\u0026rsquo;s runtime is analogous to libc, the C library.\nIt is important to understand, however, that Go\u0026rsquo;s runtime does not include a virtual machine, such as is provided by the Java runtime. Go programs are compiled ahead of time to native machine code (or JavaScript or WebAssembly, for some variant implementations). Thus, although the term is often used to describe the virtual environment in which a program runs, in Go the word â€œruntimeâ€ is just the name given to the library providing critical language services.\næ‰€ä»¥, runtimeåœ¨goé‡ŒæŒ‡çš„å°±æ˜¯å®ƒçš„æ ‡å‡†åº“,\nå¦å¤–è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯runtime library, it\u0026rsquo;s a collection of functions, å®ƒæ˜¯static libå’Œdynamic libçš„é›†åˆ, è¿è¡Œæ—¶æ˜¯ä»€ä¹ˆ? å³ç¨‹åºè¿è¡Œçš„æ—¶å€™, æ‰€ä»¥ä¸è¦è§‰å¾—ç¼–è¯‘çš„é“¾æ¥é˜¶æ®µå°±æŠŠé™æ€åº“å’Œæˆ‘ä»¬çš„ä»£ç é“¾æ¥åˆ°ä¸€èµ·äº†, å°±è®¤ä¸ºé™æ€åº“ä¸å±äºruntime library, éš¾é“ä½ è¿è¡Œçš„æ—¶å€™ä¸ç”¨é™æ€åº“é‡Œçš„printfå‡½æ•°å—? é™æ€åŠ¨æ€åº“åªæ˜¯å’Œç¨‹åºç»“åˆçš„æ—¶é—´ä¸ä¸€æ ·, ä½†è¿è¡Œçš„æ—¶å€™éƒ½ä¼šç”¨åˆ°,\næ‰€ä»¥C Runtime Libraryé‡Œçš„å‡½æ•°å°±å¾ˆå¤šäº†, å°±æ˜¯æˆ‘ä»¬èƒ½ç”¨åˆ°çš„é‚£äº›Cçš„å¤´æ–‡ä»¶é‡Œçš„å‡½æ•°å‘—, ä½ å¦‚: printf, malloc, abs, min, assert, å¯ä»¥å»å¾®è½¯çœ‹çœ‹ä»–ä»¬çš„C Libraryçš„å®ç°, æ„Ÿå—ä¸‹å¾®è½¯å®ç°çš„Runtime Libraryçš„å‡½æ•°éƒ½æ˜¯å“ªäº›: C runtime library reference | Microsoft Learn\né‚£libcæ˜¯ä»€ä¹ˆ? å°±æ˜¯Cçš„æ ‡å‡†åº“, æˆ–è€…è¯´Cçš„è¿è¡Œæ—¶åº“, å…¶å®è¿™ä½ éƒ½å¯ä»¥è®¤ä¸ºæ˜¯åŒä¹‰è¯, ä¸ç”¨å¤ªå¤šçº ç»“, å…³é”®æ˜¯çŸ¥é“ç¼–è¯‘çš„è¿‡ç¨‹åšäº†ä»€ä¹ˆ, æ²¡äººéè¦ä½ åŒºåˆ†å“ªä¸ªåº“å…·ä½“åŒ…å«å•¥, é‡è¦çš„æ˜¯åˆ†æ¸…æ¥šé™æ€åº“.a, lib, åŠ¨æ€åº“.so, .dllå‚ä¸äº†ç¼–è¯‘å’Œè¿è¡Œæ—¶çš„å“ªä¸ªé˜¶æ®µ.\nMacOSä¸‹Cæ ‡å‡†åº“ä½ç½®: /Library/Developer/CommandLineTools/SDKs/MacOSX12.3.sdk/usr/include\nå‚è€ƒ:\nGo FAQs C runtime library reference | Microsoft Learn æƒ³åˆ°ä¹‹å‰è¯»çš„çŸ³æ²³å­çš„ä¸€æœ¬ä¹¦, ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…», ä¸ä»…æ„Ÿå¹å†™çš„çœŸçš„å¾ˆå¥½, åªæ˜¯é‚£æ—¶å€™æ‰å¤§ä¸€, çœ‹ä¸æ‡‚, åœ¨è¿™å†è¯´ä¸€ä¸‹:\nç¨‹åºå¦‚ä½•ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„API(system call)? åœ¨ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œä¸€ç§è¯­è¨€çš„å¼€å‘ç¯å¢ƒå¾€å¾€ä¼šé™„å¸¦æœ‰è¯­è¨€åº“ï¼ˆLanguage Libraryä¹Ÿå¯ä»¥è¯´æ˜¯æ ‡å‡†åº“,è¿è¡Œæ—¶åº“ï¼‰ã€‚è¿™äº›åº“å°±æ˜¯å¯¹æ“ä½œç³»ç»Ÿçš„APIçš„åŒ…è£…ï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å…¸çš„Cè¯­è¨€ç‰ˆâ€œHello Worldâ€ç¨‹åºï¼Œå®ƒä½¿ç”¨Cè¯­è¨€æ ‡å‡†åº“çš„â€œprintfâ€å‡½æ•°æ¥è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œâ€œprintfâ€å‡½æ•°å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¸€äº›å¿…è¦çš„å¤„ç†ä»¥åï¼Œæœ€åä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„APIã€‚å„ä¸ªæ“ä½œç³»ç»Ÿä¸‹ï¼Œå¾€ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²çš„APIéƒ½ä¸ä¸€æ ·ï¼Œåœ¨Linuxä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œwriteâ€çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œåœ¨Windowsä¸‹å®ƒæ˜¯â€œWriteConsoleâ€ç³»ç»ŸAPIã€‚æ ‡å‡†åº“å‡½æ•°(è¿è¡Œåº“)ä¾èµ–çš„æ˜¯system callã€‚åº“é‡Œé¢è¿˜å¸¦æœ‰é‚£äº›å¾ˆå¸¸ç”¨çš„å‡½æ•°ï¼Œæ¯”å¦‚Cè¯­è¨€æ ‡å‡†åº“é‡Œé¢æœ‰å¾ˆå¸¸ç”¨ä¸€ä¸ªå‡½æ•°å–å¾—ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦å«strlen()ï¼Œè¯¥å‡½æ•°å³éå†æ•´ä¸ªå­—ç¬¦ä¸²åè¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼Œè¿™ä¸ªå‡½æ•°å¹¶æ²¡æœ‰è°ƒç”¨ä»»ä½•æ“ä½œç³»ç»Ÿçš„APIï¼Œä¹Ÿæ²¡æœ‰åšä»»ä½•è¾“å…¥è¾“å‡ºã€‚ä½†æ˜¯å¾ˆå¤§ä¸€éƒ¨åˆ†åº“å‡½æ•°(è¿è¡Œåº“)éƒ½æ˜¯è¦è°ƒç”¨æ“ä½œç³»ç»Ÿçš„APIçš„.\nâ€œAny problem in computer science can be solved by another layer of indirection.â€\næ¯ä¸ªå±‚æ¬¡ä¹‹é—´éƒ½é¡»è¦ç›¸äº’é€šä¿¡ï¼Œæ—¢ç„¶é¡»è¦é€šä¿¡å°±å¿…é¡»æœ‰ä¸€ä¸ªé€šä¿¡çš„åè®®ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†å…¶ç§°ä¸ºæ¥å£ï¼ˆInterfaceï¼‰ï¼Œæ¥å£çš„ä¸‹é¢é‚£å±‚æ˜¯æ¥å£çš„æä¾›è€…ï¼Œç”±å®ƒå®šä¹‰æ¥å£ï¼›æ¥å£çš„ä¸Šé¢é‚£å±‚æ˜¯æ¥å£çš„ä½¿ç”¨è€…ï¼Œå®ƒä½¿ç”¨è¯¥æ¥å£æ¥å®ç°æ‰€éœ€è¦çš„åŠŸèƒ½.\nè¿è¡Œæ—¶åº“(æ ‡å‡†åº“, static library, dynamic library) ä¾èµ– system call, å®ƒæä¾›å¤´æ–‡ä»¶(stdio.h, math.h)ä¾›æˆ‘ä»¬ä½¿ç”¨. æ‰€ä»¥å®ƒå¾ˆé‡è¦, å®ƒåœ¨åº”ç”¨å±‚å’Œæ“ä½œç³»ç»Ÿä¸­é—´. æˆ‘ä»¬ä½¿ç”¨å®ƒæä¾›çš„æ¥å£(printf())å’Œæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤æµ(é€šè¿‡system call).\næˆ‘ä»¬çš„è½¯ä»¶ä½“ç³»ä¸­ï¼Œä½äºæœ€ä¸Šå±‚çš„æ˜¯åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚æˆ‘ä»¬å¹³æ—¶ç”¨åˆ°çš„ç½‘ç»œæµè§ˆå™¨ã€Emailå®¢æˆ·ç«¯ã€å¤šåª’ä½“æ’­æ”¾å™¨ã€å›¾ç‰‡æµè§ˆå™¨ç­‰ã€‚ä»æ•´ä¸ªå±‚æ¬¡ç»“æ„ä¸Šæ¥çœ‹ï¼Œå¼€å‘å·¥å…·ä¸åº”ç”¨ç¨‹åºæ˜¯å±äºåŒä¸€ä¸ªå±‚æ¬¡çš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½ä½¿ç”¨ä¸€ä¸ªæ¥å£ï¼Œé‚£å°±æ˜¯æ“ä½œç³»ç»Ÿåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆApplication Programming Interface, å°±æ˜¯æ ‡å‡†åº“çš„å¤´æ–‡ä»¶ï¼‰ã€‚åº”ç”¨ç¨‹åºæ¥å£(å¤´æ–‡ä»¶)çš„æä¾›è€…æ˜¯è¿è¡Œåº“ï¼Œä»€ä¹ˆæ ·çš„è¿è¡Œåº“æä¾›ä»€ä¹ˆæ ·çš„APIï¼Œæ¯”å¦‚Linuxä¸‹çš„Glibcåº“æä¾›POSIXçš„APIï¼›Windowsçš„è¿è¡Œåº“æä¾›Windows APIï¼Œæœ€å¸¸è§çš„32ä½Windowsæä¾›çš„APIåˆè¢«ç§°ä¸ºWin32ã€‚\nè¿è¡Œåº“ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼ˆSystem call Interfaceï¼‰ï¼Œç³»ç»Ÿè°ƒç”¨æ¥å£åœ¨å®ç°ä¸­å¾€å¾€ä»¥è½¯ä»¶ä¸­æ–­ï¼ˆSoftware Interruptï¼‰çš„æ–¹å¼æä¾›ï¼Œæ¯”å¦‚Linuxä½¿ç”¨0x80å·ä¸­æ–­ä½œä¸ºç³»ç»Ÿè°ƒç”¨æ¥å£ï¼ŒWindowsä½¿ç”¨0x2Eå·ä¸­æ–­ä½œä¸ºç³»ç»Ÿè°ƒç”¨æ¥å£ï¼ˆä»Windows XP Sp2å¼€å§‹ï¼ŒWindowså¼€å§‹é‡‡ç”¨ä¸€ç§æ–°çš„ç³»ç»Ÿè°ƒç”¨æ–¹å¼ï¼‰ã€‚\næ“ä½œç³»ç»Ÿå†…æ ¸å±‚å¯¹äºç¡¬ä»¶å±‚æ¥è¯´æ˜¯ç¡¬ä»¶æ¥å£çš„ä½¿ç”¨è€…ï¼Œè€Œç¡¬ä»¶æ˜¯æ¥å£çš„å®šä¹‰è€…ï¼Œç¡¬ä»¶çš„æ¥å£å®šä¹‰å†³å®šäº†æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå…·ä½“æ¥è®²å°±æ˜¯é©±åŠ¨ç¨‹åºå¦‚ä½•æ“ä½œç¡¬ä»¶ï¼Œå¦‚ä½•ä¸ç¡¬ä»¶è¿›è¡Œé€šä¿¡ã€‚è¿™ç§æ¥å£å¾€å¾€è¢«å«åšç¡¬ä»¶è§„æ ¼ï¼ˆHardware Specificationï¼‰ï¼Œç¡¬ä»¶çš„ç”Ÿäº§å‚å•†è´Ÿè´£æä¾›ç¡¬ä»¶è§„æ ¼ï¼Œæ“ä½œç³»ç»Ÿå’Œé©±åŠ¨ç¨‹åºçš„å¼€å‘è€…é€šè¿‡é˜…è¯»ç¡¬ä»¶è§„æ ¼æ–‡æ¡£æ‰€è§„å®šçš„å„ç§ç¡¬ä»¶ç¼–ç¨‹æ¥å£æ ‡å‡†æ¥ç¼–å†™æ“ä½œç³»ç»Ÿå’Œé©±åŠ¨ç¨‹åºã€‚\nISO and Standards\nå…ˆæ¥çœ‹çœ‹ISO: The International Organization for Standardization, ISOæ¯å¹´discussç„¶åå¾—å‡ºè¯­è¨€çš„standards, C99, C11 standardsä¹Ÿå°±æ˜¯è¿™ä¹ˆæ¥çš„, standardsä¸»è¦ä»‹ç»äº†ä¸¤éƒ¨åˆ†å†…å®¹, è¯­è¨€æœ¬èº«åŠŸèƒ½å’Œè¯¥è¯­è¨€çš„standard library. å¯¹, åªæ˜¯ä»‹ç», å‰©ä¸‹çš„å®ç°ç”±å…¶ä»–äººå®Œæˆ(glibc, MSVCRTæ˜¯c standard libraryçš„å®ç°). å³ISOå‡ºç‰ˆstandards, standardåŒ…æ‹¬standard library,\næ¯”å¦‚99å¹´ä»–ä»¬è®¨è®ºçš„ç»“æœå°±æ˜¯è¿™ä¸ªC99 standard: ISO/IEC 9899:1999(E) \u0026ndash; Programming Languages \u0026ndash; C), C99 standardå†…å®¹åŒ…æ‹¬ä¸¤éƒ¨åˆ†:\nthe C/C++ features and functionalities;\nthe C/C++ API â€” a collection of classes, functions and macros that developers use in their C/C++ programs. It is called the Standard Library.\nStatic Library and Dynamic Library\nShared libraries(dynamic library) are.so (or in Windows .dll, or in OS X .dylib) files. All the code relating to the library is in this file, and it is referenced by programs using it at run-time. A program using a shared library only makes reference to the code that it uses in the shared library.\nStatic libraries are .a (or in Windows .lib) files. All the code relating to the library is in this file, and it is directly linked into the program at compile time. A program using a static library takes copies of the code that it uses from the static library and makes it part of the program.\nåœ¨è¿™è¯´ä¸€ä¸‹libc.aæ–‡ä»¶:\næºä»£ç ç»è¿‡é¢„å¤„ç†, ç¼–è¯‘, æ±‡ç¼–åç¼–ç¨‹ä¸€ä¸ª.oç›®æ ‡æ–‡ä»¶, è¿™ä¸ªç›®æ ‡æ–‡ä»¶éœ€è¦å’Œå…¶ä»–libraries(libc.aæ˜¯ç”±å¤šä¸ª.oç›®æ ‡æ–‡ä»¶å‹ç¼©å¾—åˆ°çš„)è¿›è¡Œæœ€åä¸€æ­¥ é“¾æ¥ æ‰èƒ½å¾—åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶.\nLinuxä¸‹, äººä»¬ç”¨arç¨‹åºæŠŠå¾ˆå¤šç›®æ ‡æ–‡ä»¶å‹ç¼©åˆ°äº†é™æ€åº“libc.a(glibcçš„cæ ‡å‡†åº“), æ¯”å¦‚è¾“å…¥è¾“å‡ºæœ‰printf.oï¼Œscanf.oï¼›æ–‡ä»¶æ“ä½œæœ‰fread.oï¼Œfwrite.oï¼›æ—¶é—´æ—¥æœŸæœ‰date.oï¼Œtime.oï¼›å†…å­˜ç®¡ç†æœ‰malloc.oç­‰ã€‚\nä¸ºä»€ä¹ˆé™æ€è¿è¡Œåº“é‡Œé¢ä¸€ä¸ªç›®æ ‡æ–‡ä»¶åªåŒ…å«ä¸€ä¸ªå‡½æ•°ï¼Ÿæ¯”å¦‚libc.aé‡Œé¢printf.oåªæœ‰printf()å‡½æ•°ã€strlen.oåªæœ‰strlen()å‡½æ•°ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·ç»„ç»‡ï¼Ÿ\né“¾æ¥å™¨åœ¨é“¾æ¥é™æ€åº“çš„æ—¶å€™æ˜¯ä»¥ç›®æ ‡æ–‡ä»¶ä¸ºå•ä½çš„ã€‚æ¯”å¦‚æˆ‘ä»¬å¼•ç”¨äº†é™æ€åº“ä¸­çš„printf()å‡½æ•°ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å°±åªä¼šæŠŠåº“ä¸­åŒ…å«printf()å‡½æ•°çš„é‚£ä¸ªç›®æ ‡æ–‡ä»¶é“¾æ¥è¿›æ¥ï¼Œç”±äºè¿è¡Œåº“æœ‰æˆç™¾ä¸Šåƒä¸ªå‡½æ•°ï¼Œå¦‚æœæŠŠè¿™äº›å‡½æ•°éƒ½æ”¾åœ¨ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ä¸­\u0026hellip;\nå¦‚æœæŠŠæ•´ä¸ªé“¾æ¥è¿‡ç¨‹æ¯”ä½œä¸€å°è®¡ç®—æœºï¼Œé‚£ä¹ˆldé“¾æ¥å™¨å°±æ˜¯è®¡ç®—æœºçš„CPUï¼Œæ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶ã€åº“æ–‡ä»¶å°±æ˜¯è¾“å…¥ï¼Œé“¾æ¥ç»“æœè¾“å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶å°±æ˜¯è¾“å‡ºï¼Œè€Œé“¾æ¥æ§åˆ¶è„šæœ¬æ­£æ˜¯è¿™å°è®¡ç®—æœºçš„â€œç¨‹åºâ€ï¼Œå®ƒæ§åˆ¶CPUçš„è¿è¡Œï¼Œä»¥â€œç¨‹åºâ€è¦æ±‚çš„æ–¹å¼å°†è¾“å…¥åŠ å·¥æˆæ‰€é¡»è¦çš„è¾“å‡ºç»“æœ.\nå‚è€ƒ:\nDifference between static and shared libraries? C Static libraries, How they work; Why and how we use them and how to create one Implementation of Standard Library\næˆ‘ä»¬çŸ¥é“Cæœ‰ä¸ªåˆ†é…å†…å­˜çš„å‡½æ•°, è¿˜æœ‰åˆ›å»ºçº¿ç¨‹, è¾“å…¥è¾“å‡º(stdio.h), è¿™äº›éƒ½å¿…é¡»ä¾èµ–system call. æ‰€ä»¥ç¬¬ä¸‰æ–¹å‚å•†å®ç°standard libraryçš„æ—¶å€™, è¦æ ¹æ®ä¸åŒçš„OSæ¥å®ç°ä¸åŒç‰ˆæœ¬, å› ä¸ºå®ƒä»¬æœ‰ä¸åŒçš„system call.\nGNU/Linux implementation\nThe GNU C Libraryå’Œglibcæ˜¯åŒä¹‰è¯, æ˜¯Cçš„runtime libraryä¹Ÿæ˜¯standard library.\nå…¶å®è¿™ä¸ªæ¦‚å¿µæœ‰å¿…è¦æ¾„æ¸…ä¸€ä¸‹: runtime libraryåŒ…æ‹¬static library, daynamic library. runtime libraryæ›´åƒæ˜¯ä¸ªæ³›æŒ‡.\nprintf()å’Œmalloc()ç­‰å‡½æ•°çš„å£°æ˜åœ¨å¤´æ–‡ä»¶stdio.h, stdlib.hä¸­, è€Œå®ƒä»¬çš„å…·ä½“å®ç°å°±åœ¨é™æ€åº“.aä¸­ (libc.aæ˜¯ç”±å¤šä¸ª.oç›®æ ‡æ–‡ä»¶å‹ç¼©å¾—åˆ°çš„), å³å¤´æ–‡ä»¶ + å¯¹åº”å®ç° = standard library.\nä¸¥æ ¼æ¥è¯´libraryå’Œheaderä¸æ˜¯ä¸€ä¸ªä¸œè¥¿, libraryæ˜¯ç›®æ ‡æ–‡ä»¶, headerå°±æ˜¯.hæ–‡ä»¶. ä½†æ˜¯æˆ‘ä»¬éƒ½è¯´standard libraryåŒ…æ‹¬åŒ…æ‹¬printfç­‰å‡½æ•°, ç„¶åè¿™äº›å‡½æ•°åˆè¢«å£°æ˜åœ¨è¿™äº›æ ‡å‡†å¤´æ–‡ä»¶ä¸­. æ‰€ä»¥è¿™ä¸ªlibrary,\næ ‡å‡†åº“ä¸ºä½ å†™ä»£ç æä¾›ä¸€äº›ç°æˆçš„æ–¹æ³•ã€å®ç­‰ä½¿ç”¨ï¼Œè¿™äº›æ–¹æ³•è¢«å°è£…åœ¨åŠ¨æ€é“¾æ¥åº“æˆ–é™æ€é“¾æ¥åº“æˆ–ç›´æ¥åœ¨å¤´æ–‡ä»¶é‡Œï¼Œç„¶åç”±å¤´æ–‡ä»¶å£°æ˜ä¾›ç¨‹åºå‘˜ä½¿ç”¨ã€‚\nMacOSä¸‹cçš„å¤´æ–‡ä»¶ä½ç½®: /Library/Developer/CommandLineTools/SDKs/MacOSX12.3.sdk/usr/include\nMac and iOS Implementation\nOn Mac and iOS the C Standard Library implementation is part of libSystem, a core library located in /usr/lib/libSystem.dylib. LibSystem includes other components such as the math library, the thread library and other low-level utilities. æ³¨æ„æˆ‘æŸ¥äº†ä¸€ä¸‹, macä¸Šçš„Cæ ‡å‡†åº“å¥½åƒä¸åœ¨è¯´çš„è¿™ä¸ªæ–‡ä»¶å¤¹äº†, æœ‰äººè¯´åœ¨/usr/lib/system/æˆ‘çœ‹äº†ä¸‹, ä½†ä¸çŸ¥é“æ˜¯ä¸æ˜¯ä»–ä»¬å®ç°çš„Cæ ‡å‡†åº“.\nWindows Implementation\nOn Windows the implementation of the Standard Libraries has always been strictly bound to Visual Studio, the official Microsoft compiler. They use to call it C/C++ Run-time Library (CRT) and it covers both implementations.\nå‚è€ƒ: https://www.internalpointers.com/post/c-c-standard-library\n","date":"2023-05-25T18:50:14Z","permalink":"https://blog.yorforger.cc/p/%E8%AF%B4%E8%AF%B4c%E7%9A%84%E7%BC%96%E8%AF%91%E5%8A%A8%E6%80%81%E9%9D%99%E6%80%81%E5%BA%93%E5%8F%8Ago%E7%9A%84runtime/","title":"è¯´è¯´Cçš„ç¼–è¯‘åŠ¨æ€é™æ€åº“åŠGoçš„Runtime"},{"content":"æœ‰äººè®¤ä¸ºWorker Poolåœ¨goé‡Œæ˜¯anti-pattern, ä¸ç®¡æ€æ ·, å…ˆå®ç°ä¸€ä¸ªç®€å•ç‰ˆæœ¬æ¥å¸®åŠ©ç†è§£Worker Poolçš„æ¦‚å¿µ, å®ç°ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹çœ‹ä¼ ç»Ÿçš„çº¿ç¨‹æ± ç›¸å…³çš„:\nçº¿ç¨‹æ± çš„æ¦‚å¿µ: é¢„å…ˆåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹ç­‰å¾…å¤„ç†æ–°æ¥çš„ä»»åŠ¡ï¼Œå¤„ç†å®Œä¹‹åçº¿ç¨‹å¹¶ä¸ä¼šè¢«é”€æ¯è€Œæ˜¯ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ ä½¿ç”¨çº¿ç¨‹æ± çš„åŸå› : åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹éƒ½æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œå¦‚æœä½ çš„ç¨‹åºéœ€è¦é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹é‚£è¿™æ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨çº¿ç¨‹æ± æ¥æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚ æ³¨æ„ä»¥ä¸Šè¿™ä¸¤ç‚¹é’ˆå¯¹æ˜¯OSçº§çº¿ç¨‹çš„åˆ›å»ºé”€æ¯, goroutineæ¨¡å‹å¹¶ä¸æ˜¯è¿™æ ·, å¾ˆè½»é‡, è¿™ä¹Ÿæ˜¯ä¸éœ€è¦ wroker poll çš„åŸå› ,\nå¦å¤–çº¿ç¨‹æ±  thread pool æ˜¯ä¸æ˜¯ worker pool çœ‹æ³•ä¸ä¸€, ä¸‹é¢è¿™ä¸ªæè¿°æ„Ÿè§‰æœ€è´´åˆ‡:\nThe worker pool pattern is a design in which a fixed number of workers are given a stream of tasks to process in a queue. Go Worker Pools\nè‡³äºthread pool, æ™®éçœ‹æ³•æ˜¯:\nA thread pool reuses previously created threads to execute current tasks and offers a solution to the problem of thread cycle overhead and resource thrashing. Thread Pools Java\næ‰€ä»¥è¿™ä¹ˆçœ‹, worker poolä¹Ÿç®—æ˜¯ä¸€ä¸ªbasic thread pool, å³reuses previously created threads to execute current tasks,\nç”¨Goå®ç°Worker Poolåˆ©ç”¨çš„æ˜¯buffered channelçš„ä¸¤ä¸ªç‰¹æ€§:å³æ»¡çš„æ—¶å€™å†™å…¥æ“ä½œé˜»å¡, ç©ºçš„æ—¶å€™è¯»å–æ“ä½œé˜»å¡,\nå…·ä½“æ–¹æ³•æ˜¯æå‰åˆ›å»ºå¤šä¸ªgoroutines, ç„¶åè¿™äº›çº¿ç¨‹æŒç»­ç›‘å¬åŒä¸€ä¸ªbuffered channel, å¦‚æœè¯¥channelæ˜¯ç©ºçš„, é‚£ä»–ä»¬å°±é˜»å¡ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡çš„åˆ°æ¥:\n1 2 3 4 // var keysChannel = make(chan int, 6) for key := range keysChannel { resultsChannel \u0026lt;- doResearch(key) } ä¸Šé¢è¿™ä¸ªç¨‹åºå°±æ˜¯éå†ä¸€ä¸ªbuffered channel, å¦‚æœè¯¥channelæ˜¯ç©ºçš„, é‚£è¯¥æ®µä»£ç å°±ä¼šé˜»å¡, ç›´åˆ°æ–°çš„æ•°æ®å†™å…¥keysChannel ,\n1 2 3 4 5 6 key := 0 for { time.Sleep(time.Second) keysChannel \u0026lt;- key key++ } ä¸Šé¢è¿™æ®µç¨‹åºå³æ¨¡æ‹ŸæŒç»­äº§ç”Ÿæ•°æ®å†™å…¥åˆ°buffered channel: keysChannel, è‹¥keysChannelæ»¡äº†, é‚£keysChannel \u0026lt;- keyå°±ä¼šé˜»å¡,\nä¹‹å‰çœ‹åˆ°ä¸€å¥è¯æè¿°çº¿ç¨‹æ± è¯´ once the threads finish the task assigned, they make themselves available again for the next task, è¿™å¥è¯åœ¨è¿™å°±å¾ˆæœ‰è¿·æƒ‘æ€§, å…¶å®ƒè¯­è¨€ä¸çŸ¥é“çº¿ç¨‹æ± å…·ä½“æ€ä¹ˆå®ç°, ä½†æ˜¯åœ¨goé‡Œæ ¹æ®ä¸Šé¢æˆ‘ä»¬è®¨è®ºçš„, æ ¹æœ¬æ²¡æœ‰æ‰€è°“çš„make themselves (threads) available again for the next task, å³çº¿ç¨‹ä¸€ç›´éƒ½åœ¨ç›‘å¬, åªæ˜¯ä»–ä»¬å®Œæˆä¸€ä¸ªä»»åŠ¡åå°±ä¼šæ¥ç€å®Œæˆä¸‹ä¸€ä¸ª, ç›´åˆ°ä»–ä»¬ç›‘å¬çš„é‚£ä¸ªbuffered channelä¸ºç©º, è¿™æ—¶å€™ä»–ä»¬æ˜¯é˜»å¡çŠ¶æ€,\nå¦å¤–å®ç°çº¿ç¨‹æ± è¿˜ç”¨åˆ°äº†ä¸€ä¸ªstruct, sync.WaitGroup , ä¸»è¦éœ€è¦äº†è§£å®ƒçš„ä¸‰ä¸ªå‡½æ•°, wg.Add(), wg.Done(), wg.Wait(), å…¶ä¸­wg.Add(1)çš„æ„æ€ä½¿wgçš„counteråŠ 1, wg.Done()ä½¿counterå‡1, æœ€åwg.Wait()é˜»å¡ç›´åˆ°counterä¸º0, æˆ‘ä»¬ä¸€èˆ¬çš„é€»è¾‘æ˜¯åˆ›å»ºå¤šä¸ªçº¿ç¨‹çš„æ—¶å€™, æ¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å°±è°ƒç”¨wg.Add(1)ä½¿counter++, å½“çº¿ç¨‹è¦è¢«é”€æ¯çš„æ—¶å€™è°ƒç”¨wg.Done()æ˜¯counter\u0026ndash;, ç„¶ååœ¨mainçº¿ç¨‹é‡Œçš„æœ€åè°ƒç”¨wg.Wait(), å³ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ç¨‹åºç»“æŸ,\næ³¨æ„è¯¥å®ç°å¹¶ä¸æ˜¯ooçš„å®ç°,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; ) var keysChannel = make(chan int, 6) var resultsChannel = make(chan string, 3) func doResearch(key int) string{ // assume this research operation consumes a lot of time time.Sleep(time.Second * 2) return fmt.Sprintf(\u0026#34;One research finished, original key is: %v\u0026#34;, key) } func createWorkerPool(numOfWorker int) { var wg sync.WaitGroup // create numOfWorker of workers for i := 0; i \u0026lt; numOfWorker; i++ { wg.Add(1) // create a goroutine that looks like can be \u0026#34;reused\u0026#34; by listening keysChannel until keysChannel is closed go func(wg *sync.WaitGroup) { // run forever until keysChannel is closed // because when keysChannel is empty, this code get blocked not break loop for key := range keysChannel { resultsChannel \u0026lt;- doResearch(key) } // worker() is a function represents a goroutine, before return, we should make wg-- wg.Done() }(\u0026amp;wg) } wg.Wait() close(resultsChannel) } // when use channel, you have to figure out if you need to remind of other goroutines, // if yes, figure out when to close // when use sync.WaitGroup three operations you need to do: wg--, wg.Add(1), wg.wait() // and don\u0026#39;t forget to do wg--, otherwise the wg.wait() will never return func main() { // 1. keep listening the resultChannel until resultsChannel is closed done := make(chan bool) go func(done chan bool) { for result := range resultsChannel { fmt.Printf(\u0026#34;%v\\n\u0026#34;, result) } done \u0026lt;- true }(done) // 2. keep generating key every 1 sec // Imagine this function can continuously generate a request from a client every sec // And this request will be sent to keysChannel and will be processed by // our one of our workers that keep listening the keysChannel go func() { key := 0 for { time.Sleep(time.Second) keysChannel \u0026lt;- key key++ } }() // 3. create worker pool, and until wg.Wait() in the last line of this function returns createWorkerPool(3) \u0026lt;-done // It\u0026#39;s OK to leave a Go channel open forever and never close it. // When the channel is no longer used, it will be garbage collected. // Close a channel only when it is essential to // inform the receiving goroutines that all data has been transmitted. // close(done) } å‚è€ƒ:\nBuffered Channels and Worker Pools in Go - golangbot.com ","date":"2023-05-25T14:13:13Z","permalink":"https://blog.yorforger.cc/p/go%E5%B9%B6%E5%8F%91%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAworker-pool/","title":"Goå¹¶å‘å­¦ä¹ ä¹‹å®ç°ä¸€ä¸ªWorker Pool"},{"content":" # 1. Operators as functions Consider the following example:\n1 2 3 int x { 2 }; int y { 3 }; std::cout \u0026lt;\u0026lt; x + y \u0026lt;\u0026lt; \u0026#39;\\n\u0026#39;; When you see the expression x + y, you can translate this in your head to the function call operator+(x, y) (where operator+ is the name of the function).\nNow consider what happens if we try to add two objects of a program-defined class:\n1 2 3 Mystring string1 { \u0026#34;Hello, \u0026#34; }; Mystring string2 { \u0026#34;World!\u0026#34; }; std::cout \u0026lt;\u0026lt; string1 + string2 \u0026lt;\u0026lt; \u0026#39;\\n\u0026#39;; What would you expect to happen in this case? The intuitive expected result is â€œHello, World!â€ . However, because Mystring is a program-defined type, the compiler does not have a built-in version of the plus operator that it can use for Mystring operands. So in this case, it will give us an error. In order to make it work like we want, weâ€™d need to write an overloaded function to tell the compiler how the + operator should work with two operands of type Mystring.\n# 2. Overloading the arithmetic operators using friend functions ä½¿ç”¨ friend function çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜, å¦å¤–æ³¨æ„ friend function å¹¶ä¸æ˜¯ç±»çš„æˆå‘˜å‡½æ•°,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #include \u0026lt;iostream\u0026gt; class Cents { private: int m_cents {}; public: Cents(int cents) : m_cents{ cents } { } // add Cents + Cents using a friend function // å¦å¤–friend functionå¹¶ä¸æ˜¯ç±»çš„æˆå‘˜å‡½æ•°, ä½†ä½ ä»å¯ä»¥åœ¨ç±»é‡Œé¢å®ç°å®ƒ è€Œä¸æ˜¯åƒæˆ‘ä»¬è¿™æ ·åœ¨å¤–é¢å®ç° // å¦‚æœæ˜¯æˆå‘˜å‡½æ•°é‡è½½, è¿™é‡Œåªç”¨ä¸€ä¸ªå‚æ•°å°±è¡Œäº†, å› ä¸º*thisä¼šé»˜è®¤ä¸ºå·¦æ“ä½œæ•°, å…·ä½“æ–‡ç« ä¸‹é¢éƒ¨åˆ†ä¼šè®² friend Cents operator+(const Cents\u0026amp; c1, const Cents\u0026amp; c2); int getCents() const { return m_cents; } }; // note: this function is not a member function! // å¯ä»¥çœ‹åˆ°, åœ¨ç±»é‡Œå·²ç»å£°æ˜çš„æ€§è´¨(friend, static, virtual) ä¸ç”¨å†åœ¨å¤–é¢å£°æ˜äº† Cents operator+(const Cents\u0026amp; c1, const Cents\u0026amp; c2) { // use the Cents constructor and operator+(int, int) // we can access m_cents directly because this is a friend function return c1.m_cents + c2.m_cents; } int main() { Cents cents1{ 6 }; Cents cents2{ 2 }; Cents centsSum{ cents1 + cents2 }; std::cout \u0026lt;\u0026lt; \u0026#34;I have \u0026#34; \u0026lt;\u0026lt; centsSum.getCents() \u0026lt;\u0026lt; \u0026#34; cents.\\n\u0026#34;; return 0; } # Not everything can be overloaded as a friend function The assignment (=), subscript ([]), function call (()), and member selection (-\u0026gt;) operators must be overloaded as member functions, because the language requires them to be.\n# 3. Overloading operators using normal functions Using a friend function to overload an operator is convenient because it gives you direct access to the internal members of the classes youâ€™re operating on. However, if you donâ€™t need that access, you can write your overloaded operators as normal functions. è¿™ä¸ªnormal functionæ—¢ä¸æ˜¯friend function, ä¹Ÿä¸æ˜¯member function.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #include \u0026lt;iostream\u0026gt; class Cents { private: int m_cents{}; public: Cents(int cents) : m_cents{ cents } {} int getCents() const { return m_cents; } }; // note: this function is not a member function nor a friend function! // æ³¨æ„å“¦, è¿™ä¸ªå‡½æ•°æ—¢ä¸æ˜¯friend function, ä¹Ÿä¸æ˜¯æˆå‘˜å‡½æ•° Cents operator+(const Cents\u0026amp; c1, const Cents\u0026amp; c2) { // use the Cents constructor and operator+(int, int) // we don\u0026#39;t need direct access to private members here return Cents{ c1.getCents() + c2.getCents() }; } int main() { Cents cents1{ 6 }; Cents cents2{ 8 }; Cents centsSum{ cents1 + cents2 }; std::cout \u0026lt;\u0026lt; \u0026#34;I have \u0026#34; \u0026lt;\u0026lt; centsSum.getCents() \u0026lt;\u0026lt; \u0026#34; cents.\\n\u0026#34;; return 0; } Because the normal and friend functions work almost identically (they just have different levels of access to private members), we generally wonâ€™t differentiate them. The one difference is that the friend function declaration inside the class serves as a prototype as well. With the normal function version, youâ€™ll have to provide your own function prototype:\nCents.h:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #ifndef CENTS_H #define CENTS_H class Cents { private: int m_cents{}; public: Cents(int cents) : m_cents{ cents } {} int getCents() const { return m_cents; } }; // Need to explicitly provide prototype for operator+ so uses of operator+ in other files know this overload exists Cents operator+(const Cents\u0026amp; c1, const Cents\u0026amp; c2); #endif # 4. Overloading operators using member functions You learned how to overload the arithmetic operators using friend functions. You also learned you can overload operators as normal functions. Many operators can be overloaded in a different way: as a member function.\nOverloading operators using a member function is very similar to overloading operators using a friend function. When overloading an operator using a member function:\nThe overloaded operator must be added as a member function of the left operand. The left operand becomes the implicit *this object. (æ¯”å¦‚+éœ€è¦å·¦å³ä¸¤ä¸ªæ“ä½œæ•°, å¦‚æœä½ ç”¨æˆå‘˜å‡½æ•°æ¥é‡è½½å®ƒ, é‚£é‡è½½å‡½æ•°operator+åªéœ€è¦ä¸€ä¸ªå‚æ•°å³+å³è¾¹çš„æ“ä½œæ•°, å·¦è¾¹çš„é»˜è®¤ä¸º*this, å¯ä»¥çœ‹ä¸‹é¢çš„å®ç°, æ³¨æ„ä¸ä¸Šé¢friend functionå¯¹æ¯”) All other operands become function parameters. æ³¨æ„ä¸ä¸Šé¢friend functionçš„å®ç°åšå¯¹æ¯”:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #include \u0026lt;iostream\u0026gt; class Cents { private: int m_cents {}; public: Cents(int cents) : m_cents { cents } { } // Overload Cents + int Cents operator+ (int value); int getCents() const { return m_cents; } }; // note: this function is a member function! // the cents parameter in the friend version is now the implicit *this parameter // åªæœ‰ä¸€ä¸ªå‚æ•°~, å’Œfriend functionä¸€æ ·, å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜, å› ä¸ºäººå®¶æ˜¯æˆå‘˜å‡½æ•°å•Š, è‚¯å®šå¯ä»¥è®¿é—® Cents Cents::operator+ (int value) { return Cents { m_cents + value }; } int main() { Cents cents1 { 6 }; Cents cents2 { cents1 + 2 }; std::cout \u0026lt;\u0026lt; \u0026#34;I have \u0026#34; \u0026lt;\u0026lt; cents2.getCents() \u0026lt;\u0026lt; \u0026#34; cents.\\n\u0026#34;; return 0; } ","date":"2023-05-22T23:03:12Z","permalink":"https://blog.yorforger.cc/p/c-operator-overloading/","title":"C++ Operator Overloading"},{"content":"åœ°å›¾\nåœ°å›¾å°±æ˜¯ä¸ªäºŒç»´æ•°ç»„board, åœ¨Goé‡Œé¢å«Slice of slices, è¯¥åœ°å›¾(äºŒç»´æ•°ç»„)å­˜å‚¨boolç±»å‹, å®šä¹‰å¦‚ä¸‹å’Œç»“æ„å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // height = 4, width = 3 func main() { // Definition board := make([][]bool, height) for i := range board { board[i] = make([]bool, width) } // Test board[2][1] = true for y := range board{ for _, v := range board[y] { fmt.Printf(\u0026#34;%v \u0026#34;, v) } println() } } false false false false false false false true false false false false æ‰“å°è›‡ğŸèº«ä½“\nè›‡çš„èº«ä½“ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆ, èŠ‚ç‚¹æ˜¯ä¸ªstructç±»å‹, å¦‚ä¸‹:\n1 2 3 4 type node struct { x int y int } æŠŠåœ°å›¾è®¾è®¡æˆå­˜å‚¨å¸ƒå°”ç±»å‹çš„æ•°ç»„çš„ç›®çš„å°±æ˜¯æ–¹ä¾¿æ‰“å°è›‡çš„èº«ä½“, ä¹Ÿæ˜¯å®ç°çš„å…³é”®, å³æ¯æ¬¡å¾ªç¯board(ä»£è¡¨åœ°å›¾çš„äºŒç»´æ•°ç»„), é‡åˆ°falseå°±æ‰“å°ç©ºç™½, é‡åˆ°trueå°±æ‰“å°ä¸€ä¸ªé»‘è‰²æ–¹å—â–ªï¸ä»£è¡¨è›‡çš„èº«ä½“:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 func draw() { fmt.Print(\u0026#34;\\033[H\\033[2J\u0026#34;) // original: \u0026#39;for y, _ := range board { ... }\u0026#39; for y := range board { for i, v := range board[y] { if !v \u0026amp;\u0026amp; (food.x != i || food.y != y) { fmt.Print(\u0026#34;â–¡ \u0026#34;) } else if !v \u0026amp;\u0026amp; food.x == i \u0026amp;\u0026amp; food.y == y { fmt.Print(\u0026#34;â˜… \u0026#34;) } else { fmt.Print(\u0026#34;â–  \u0026#34;) } } fmt.Println() } } è¿™æ ·æˆ‘ä»¬åªéœ€è¦å†™ä¸ªå‡½æ•°æ ¹æ®è›‡çš„èº«ä½“(å¤šä¸ªèŠ‚ç‚¹)æ¥ä¿®æ”¹(æ›´æ–°)boardé‡Œé¢æ¯ä¸ªå…ƒç´ çš„å€¼, ç„¶åå†å†™ä¸ªå‡½æ•°(ä¹Ÿå°±æ˜¯ä¸Šé¢çš„draw())æ ¹æ®boardæ¥ç”»åœ°å›¾å°±å¥½äº†, æ³¨æ„ç”»åœ°å›¾çš„æ—¶å€™ä¹Ÿç”»äº†è›‡çš„èº«ä½“:\n1 2 3 4 5 6 7 8 9 10 func update() { // è¿™é‡Œè®¿é—®äºŒç»´æ•°ç»„çš„æ—¶å€™ç¬¬ä¸€ä¸ªæ˜¯é«˜åº¦, ç¬¬äºŒä¸ªæ˜¯å®½åº¦ // å³board[0][2]ä»£è¡¨ç¬¬1ä¸ªæ•°ç»„çš„ç¬¬3ä¸ªå…ƒç´ , æ‰€ä»¥æˆ‘ä»¬å†™æˆ board[v.y][v.x] = true // è€Œä¸æ˜¯board[v.x][v.y] = true for _, v := range snake{ board[v.y][v.x] = true } // draw map and snake and food draw() } è®©è›‡åŠ¨èµ·æ¥\nè®©è›‡åŠ¨èµ·æ¥çš„æ–¹æ³•æœ‰å¤šç§, åœ¨è¿™é‡Œæ¯”å¦‚æ¯æ¬¡resetåœ°å›¾boardçš„æ•°æ®ä¸ºfalse, ç„¶åå†æ ¹æ®è›‡çš„èº«ä½“snakeæ›´æ–°board, ä½†è¿™æ ·æ•ˆç‡ç¨ä½, å› ä¸ºæ¯æ¬¡æˆ‘ä»¬éƒ½éœ€è¦éå†boardå»reset, ä»”ç»†æƒ³ä¸€ä¸‹è›‡æ¯æ¬¡ç§»åŠ¨, å…¶å®å°±æ˜¯æœ€å‰é¢çš„å¤´å¾€å‰ç§»åŠ¨ä¸€æ ¼, å°¾å·´å¾€å‰ç§»åŠ¨ä¸€æ ¼, ä¸­é—´çš„èº«ä½“çœ‹ç€æ˜¯ä¸å˜çš„, æ‰€ä»¥æˆ‘ä»¬åœ¨å®ç°çš„æ—¶å€™ä¹Ÿæ˜¯æœ‰ä¸‰æ­¥:\n1 æ ¹æ®å½“å‰æ–¹å‘directionä¿®æ”¹snakeç¬¬ä¸€ä¸ªå…ƒç´ çš„åæ ‡, å®ç°è›‡å¤´å‰è¿›ä¸€æ ¼ 1 2 3 4 5 6 7 8 9 10 11 // change the head position switch direction { case right: snake[0].x++ case left: snake[0].x-- case up: snake[0].y-- case down: snake[0].y++ } 2 éå†snake, ä½¿ç¬¬iä¸ªå…ƒç´ çš„åæ ‡ç­‰äºç¬¬i-1ä¸ªå…ƒç´ çš„åæ ‡(i\u0026gt;=1),ä¸­é—´çš„èº«ä½“çœ‹ç€æ˜¯ä¸åŠ¨çš„, å…¶å®æ¯ä¸ªèŠ‚ç‚¹éƒ½å‰è¿›äº† 1 2 3 4 5 6 7 8 length := len(snake) // \u0026#34;move\u0026#34; all node of snake except the head if length \u0026gt; 1 { // make the value of each (i)th element equal to the (i-1)th value for i := len(snake) - 1; i \u0026gt;= 1; i-- { snake[i] = snake[i-1] } } 3 è®¾ç½®ä½ç½®åœ¨è›‡çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹å³å°¾å·´(snake[len - 1].x, snake[len - 1].y)çš„boardå…ƒç´ ä¸ºfalse, å› ä¸ºåœ¨ç¬¬2æ­¥å°¾å·´å·²ç»å˜æˆå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ çš„åæ ‡äº†, æ‰€ä»¥æˆ‘ä»¬è¦æŠŠæ—§çš„å°¾å·´åæ ‡ä½ç½®è®¾ç½®ä¸ºfalse å³è¿™æ ·åªéå†äº†snake(ä¸€ç»´æ•°ç»„)æ¥å®ç°æ›´æ–°åœ°å›¾.\næ€»ç»“\nè¿™æ¬¡çš„å°åº”ç”¨, ç†Ÿæ‚‰äº†sliceçš„ç”¨æ³•, ä¹Ÿç†Ÿæ‚‰äº†å¾ˆå¤šè¯­æ³•æ¯”å¦‚:=å’Œvar, å°¤å…¶æ˜¯éå†sliceä»¥åŠloopçš„å†™æ³•, æ¯”å¦‚æ— é™å¾ªç¯å¯å†™æˆ:\n1 2 3 for { ... } å…¶æ¬¡æ˜¯å¯¼å…¥ç¬¬ä¸‰æ–¹æ¨¡å—, å¦‚è¿™é‡Œè¯»å–é”®ç›˜æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹åº“, å®‰è£…æ–¹æ³•å¾ˆç®€å•, å³åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ:\n1 $ go get github.com/eiannone/keyboard æºç : https://gist.github.com/shwezhu/3def0433eb5656deebf07dc32e6eecc1\n","date":"2023-05-20T19:59:09Z","permalink":"https://blog.yorforger.cc/p/%E7%94%A8go%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%B4%AA%E5%90%83%E8%9B%87/","title":"ç”¨Goå®ç°ä¸€ä¸ªç®€å•çš„è´ªåƒè›‡"},{"content":"ç»å¸¸çœ‹åˆ°å·¦å€¼å³å€¼, åˆšå¥½æœ‰è®²åˆ°, æ‘˜å–ä¸€äº›è®°å½•åœ¨è¿™, åŸæ–‡: 9.2 â€” Value categories (lvalues and rvalues) â€“ Learn C++\n# 1. Rvalue expression vs Lvalue expression # 1.1. The properties of an expression To help determine how expressions should evaluate and where they can be used, all expressions in C++ have two properties: a type and a value category.\n# 1.2. The type of an expression The type of an expression is equivalent to the type of the value, object, or function that results from the evaluated expression. For example:\n1 2 3 4 int main() { auto v1 { 12 / 4 }; // int / int =\u0026gt; int auto v2 { 12.0 / 4 }; // double / int =\u0026gt; double } Note that the type of an expression must be determinable at compile time (otherwise type checking and type deduction wouldnâ€™t work) \u0026ndash; however, the value of an expression may be determined at either compile time (if the expression is constexpr) or runtime (if the expression is not constexpr).\n# 1.3. The value category of an expression Now consider the following program:\n1 2 3 4 5 int main() { int x{}; x = 5; // valid: we can assign 5 to x 5 = x; // error: can not assign value of x to literal value 5 } How does the compiler know which expressions can legally appear on either side of an assignment statement?\nThe answer lies in the second property of expressions: the value category. The value category of an expression (or subexpression) indicates whether an expression resolves to a value, a function, or an object of some kind.\nPrior to C++11, there were only two possible value categories: lvalue and rvalue.\nIn C++11, three additional value categories (glvalue, prvalue, and xvalue) were added to support a new feature called move semantics.\n# 1.4. Lvalue and rvalue expressions An lvalue (pronounced â€œell-valueâ€) is an expression that evaluates to an identifiable object or function (or bit-field).\nEntities (such as an object or function) with identities can be accessed via an identifier, reference, or pointer, and typically have a lifetime longer than a single expression or statement. è¿™é‡Œçš„identifierå°±æ˜¯å˜é‡åå’Œreference, pointerå¹¶åˆ—. æ¯”å¦‚int x = 3; , xå°±æ˜¯identifier, 3å°±æ˜¯object.\nAn rvalue (pronounced â€œarr-valueâ€) is an expression that is not an l-value. Commonly seen rvalues include literals (except C-style string literals, which are lvalues) and the return value of functions and operators. Rvalues arenâ€™t identifiable (meaning they have to be used immediately), and only exist within the scope of the expression in which they are used.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include \u0026lt;iostream\u0026gt; int return5() { return 5; } int main() { int x{ 5 }; // 5 is an rvalue expression const double d{ 1.2 }; // 1.2 is an rvalue expression int y { x }; // x is a modifiable lvalue expression const double e { d }; // d is a non-modifiable lvalue expression int z { return5() }; // return5() is an rvalue expression (since the result is returned by value) int w { x + 1 }; // x + 1 is an rvalue expression int q { static_cast\u0026lt;int\u0026gt;(d) }; // the result of static casting d to an int is an rvalue expression return 0; } You may be wondering why return5(), x + 1, and static_cast\u0026lt;int\u0026gt;(d) are rvalues: the answer is these expressions produce temporary values that are not identifiable objects.\nNow we can answer the question about why x = 5 is valid but 5 = x is not: an assignment operation requires the left operand of the assignment to be a modifiable lvalue expression, and the right operand to be an rvalue expression. The latter assignment (5 = x) fails because the left operand expression 5 isnâ€™t an lvalue. è¿™é‡Œè¯´ä¸€ä¸‹, åŸæ–‡ä¸­æåˆ°lvalue expressionåˆåˆ†ä¸ºmodifiableå’Œnon-modifiable, åè€…å°±æ˜¯åŠ ä¸Šconstä¿®é¥°çš„, æ„Ÿå…´è¶£å¯ä»¥å»åŸæ–‡æŸ¥çœ‹,\n1 2 3 4 5 6 int main() { int x{}; // Assignment requires the left operand to be a modifiable lvalue expression and the right operand to be an rvalue expression x = 5; // valid: x is a modifiable lvalue expression and 5 is an rvalue expression 5 = x; // error: 5 is an rvalue expression and x is a modifiable lvalue expression } # 1.5. l-value to r-value conversion We said above that the assignment operator expects the right operand to be an rvalue expression, so why does code like this work?\n1 2 3 4 5 int main() { int x{ 1 }; int y{ 2 }; x = y; // y is a modifiable lvalue, not an rvalue, but this is legal } The answer is because lvalues will implicitly convert to rvalues, so an lvalue can be used wherever an rvalue is required.\n# 2. Lvalue reference variables Modern C++ contains two types of references: lvalue references, and rvalue references. Rvalue references are covered in the chapter on move semantics (chapter M).\nAn lvalue reference (commonly just called a reference since prior to C++11 there was only one type of reference) acts as an alias for an existing lvalue (such as a variable). è¯´ç™½äº†æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„å¼•ç”¨éƒ½æ˜¯lvalue reference,\n1 2 3 4 5 6 int // a normal int type int\u0026amp; // an lvalue reference to an int object double\u0026amp; // an lvalue reference to a double object int x { 5 }; // x is a normal integer variable int\u0026amp; ref { x }; // ref is an lvalue reference variable that can now be used as an alias for variable x # 2.1. Dangling references When an object being referenced is destroyed before a reference to it, the reference is left referencing an object that no longer exists. Such a reference is called a dangling reference. Accessing a dangling reference leads to undefined behavior.\n# 3. æ€»ç»“ assignment operation, left operand, right operand rvalue expression, lvalue expression, modifiable lvalue expression, non-modifiable lvalue expression value category of an expression, type of an expression lvalue references, and rvalue references dangling reference ","date":"2023-05-17T11:27:07Z","permalink":"https://blog.yorforger.cc/p/%E5%B7%A6%E5%80%BC%E5%92%8C%E5%8F%B3%E5%80%BC/","title":"å·¦å€¼å’Œå³å€¼"},{"content":" Make any member function that does not modify the state of the class object const, so that it can be called by const objects. Default parameters for member functions should be declared in the class definition (in the header file), where they can be seen by whomever #includes the header. For classes used in only one file that arenâ€™t generally reusable, define them directly in the single .cpp file theyâ€™re used in. For classes used in multiple files, or intended for general reuse, define them in a .h file that has the same name as the class. Trivial member functions (trivial constructors or destructors, access functions, etcâ€¦) can be defined inside the class. Non-trivial member functions should be defined in a .cpp file that has the same name as the class. Member functions defined inside the class definition are implicitly inline. Inline functions are exempt from the one definition per program part of the one-definition rule. So why not put everything in a header file? First, as mentioned above, defining members inside the class definition clutters up your class definition. Second, if you change any of the code in the header, then youâ€™ll need to recompile every file that includes that header. This can have a ripple effect, where one minor change causes the entire program to need to recompile (which can be slow). If you change the code in a .cpp file, only that .cpp file needs to be recompiled! There are a few cases where it might make sense to violate the best practice of putting the class definition in a header and non-trivial member functions in a code file.\nSeparating the class definition and class implementation is very common for libraries that you can use to extend your program. Throughout your programs, youâ€™ve #included headers that belong to the standard library, such as iostream, string, vector, array, and other. Notice that you havenâ€™t needed to add iostream.cpp, string.cpp, vector.cpp, or array.cpp into your projects. Your program needs the declarations from the header files in order for the compiler to validate youâ€™re writing programs that are syntactically correct. However, the implementations for the classes that belong to the C++ standard library are contained in a precompiled file that is linked in at the link stage. You never see the code.\nOutside of some open source software (where both .h and .cpp files are provided), most 3rd party libraries provide only header files, along with a precompiled library file. There are several reasons for this: 1) Itâ€™s faster to link a precompiled library than to recompile it every time you need it, 2) a single copy of a precompiled library can be shared by many applications, whereas compiled code gets compiled into every executable that uses it (inflating file sizes), and 3) intellectual property reasons (you donâ€™t want people stealing your code).\nHaving your own files separated into declaration (header) and implementation (code file) is not only good form, it also makes creating your own custom libraries easier. Creating your own libraries is beyond the scope of these tutorials, but separating your declaration and implementation is a prerequisite to doing so.\nReferences: 13.11 â€” Class code and header files â€“ Learn C++\n","date":"2023-05-16T22:36:06Z","permalink":"https://blog.yorforger.cc/p/c-class-definition-rules/","title":"C++ Class Definition Rules"},{"content":"RAII (Resource Acquisition Is Initialization) is a programming technique whereby resource use is tied to the lifetime of objects with automatic duration (e.g. non-dynamically allocated objects). In C++, RAII is implemented via classes with constructors and destructors. A resource (such as memory, a file or database handle, etcâ€¦) is typically acquired in the objectâ€™s constructor (though it can be acquired after the object is created if that makes sense). That resource can then be used while the object is alive. The resource is released in the destructor, when the object is destroyed. The primary advantage of RAII is that it helps prevent resource leaks (e.g. memory not being deallocated) as all resource-holding objects are cleaned up automatically.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 class IntArray { private: int* m_array{}; int m_length{}; public: IntArray(int length) { assert(length \u0026gt; 0); m_array = new int[static_cast\u0026lt;std::size_t\u0026gt;(length)]{}; m_length = length; } ~IntArray() { // Dynamically delete the array we allocated earlier delete[] m_array; } ... }; The IntArray class above is an example of a class that implements RAII \u0026ndash; allocation in the constructor, deallocation in the destructor. std::string and std::vector are examples of classes in the standard library that follow RAII \u0026ndash; dynamic memory is acquired on initialization, and cleaned up automatically on destruction.\nReferences:\n13.8 â€” Overlapping and delegating constructors â€“ Learn C++\n13.9 â€” Destructors â€“ Learn C++\n","date":"2023-05-16T20:32:04Z","permalink":"https://blog.yorforger.cc/p/c-raii-resource-acquisition-is-initialization/","title":"C++ RAII (Resource Acquisition Is Initialization)"},{"content":" # Returns a address of local variable Find codes below:\n1 2 3 4 func f() *int { v := 1 return \u0026amp;v } New to golang from cpp so don\u0026rsquo;t understand why can do this, this is returning a local variable\u0026rsquo;s address ğŸ˜±. And find a doc talks about this:\nHow do I know whether a variable is allocated on the heap or the stack?\nFrom a correctness standpoint, you don\u0026rsquo;t need to know. Each variable in Go exists as long as there are references to it. The storage location chosen by the implementation is irrelevant to the semantics of the language.\nThe storage location does have an effect on writing efficient programs. When possible, the Go compilers will allocate variables that are local to a function in that function\u0026rsquo;s stack frame. However, if the compiler cannot prove that the variable is not referenced after the function returns, then the compiler must allocate the variable on the garbage-collected heap to avoid dangling pointer errors. Also, if a local variable is very large, it might make more sense to store it on the heap rather than the stack.\nIn the current compilers, if a variable has its address taken, that variable is a candidate for allocation on the heap. However, a basic escape analysis recognizes some cases when such variables will not live past the return from the function and can reside on the stack.\nYou probably think this quite like java\u0026rsquo;s reference type ( java variable has two type: primitive and reference type), but you are wrong, a avriable actually another name of a address in golang. We say that each variable in Go exists as long as there are references to it, means we can reach to the value stored in the address which variable point to. Variable has value, its just a address.\nFor a mental model, you can treat variable names as references, which exists till their scope exists.\nFor implementation, Go\u0026rsquo;s variables are NOT references - for reference, use a pointer.\nThese variables can be allocated on the stack, or on the heap. Both have pros and cons, the compiler decides. For correctness, it does not make any difference. \u0026ldquo;You don\u0026rsquo;t have to know\u0026rdquo;.\nSource: https://www.reddit.com/r/golang/comments/s0m2h9/comment/hs2kvyo/?utm_source=share\u0026utm_medium=web2x\u0026context=3\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 func foo1() *int { a := 3 fmt.Println(\u0026amp;a) return \u0026amp;a } func foo2() int { b := 3 fmt.Println(\u0026amp;b) return b } func main() { pa := foo1() fmt.Println(pa) fmt.Println(\u0026#34;------------------\u0026#34;) b := foo2() fmt.Println(\u0026amp;b) } 0x1400011a018 0x1400011a018 ------------------ 0x1400011a038 0x1400011a030 ","date":"2023-05-15T22:52:03Z","permalink":"https://blog.yorforger.cc/p/lifetime-of-a-local-variable-go/","title":"Lifetime of a Local Variable - Go"},{"content":" # 1. Member initialization list A member initialization list can also be used to initialize members that are classes:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #include \u0026lt;iostream\u0026gt; class A { public: explicit A(int x = 0) { std::cout \u0026lt;\u0026lt; \u0026#34;A \u0026#34; \u0026lt;\u0026lt; x \u0026lt;\u0026lt; \u0026#39;\\n\u0026#39;; } }; class B { private: A m_a{}; public: // call A(int) constructor to initialize member m_a explicit B(int y) : m_a{ y - 1 } { std::cout \u0026lt;\u0026lt; \u0026#34;B \u0026#34; \u0026lt;\u0026lt; y \u0026lt;\u0026lt; \u0026#39;\\n\u0026#39;; } }; int main() { B b{ 5 }; return 0; } A 4 B 5 When variable b is constructed, the B(int) constructor is called with value 5. Before the body of the constructor executes, m_a is initialized, calling the A(int) constructor with value 4. This prints â€œA 4â€. Then control returns back to the B constructor, and the body of the B constructor executes, printing â€œB 5â€.\nè¿™é‡Œæ³¨æ„, å¦‚æœä½ ä¸ä½¿ç”¨member initializer listså¯¹å˜é‡è¿›è¡Œåˆå§‹åŒ–çš„è¯, é‚£ä½ åœ¨æ„é€ å‡½æ•°ä½“å†…åªèƒ½å¯¹ä»–ä»¬è¿›è¡Œèµ‹å€¼, è€Œä¸æ˜¯åˆå§‹åŒ–, è¿™å°±æ„å‘³ç€, äººå®¶çš„æ„é€ å‡½æ•°å·²ç»è°ƒç”¨äº†, ä½ åˆè¿›è¡Œäº†ä¸€æ¬¡èµ‹å€¼, è¿™å°±æ¶‰åŠåˆ°äº†æ‹·è´, ææ„. ä»€ä¹ˆ? ä½ ä¸ç›¸ä¿¡, è¦éªŒè¯ä¸€ä¸‹?\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // Cat.h #pragma once #include \u0026lt;string\u0026gt; #include \u0026lt;iostream\u0026gt; #include \u0026lt;utility\u0026gt; class Cat { private: int age{}; std::string name{}; public: Cat() : age(0){ std::cout \u0026lt;\u0026lt; \u0026#34;Cat: Default constructor is called\u0026#34; \u0026lt;\u0026lt; std::endl; }; Cat(int age, std::string name) : age(age), name(std::move(name)) { std::cout \u0026lt;\u0026lt; \u0026#34;Cat: Constructor with two parameter is called\u0026#34; \u0026lt;\u0026lt; std::endl; } Cat(const Cat\u0026amp; other) { std::cout \u0026lt;\u0026lt; \u0026#34;Cat: Copy Constructor called\u0026#34; \u0026lt;\u0026lt; std::endl; } Cat\u0026amp; operator=(const Cat\u0026amp; other) { std::cout \u0026lt;\u0026lt; \u0026#34;Cat: Assignment Operator called\u0026#34; \u0026lt;\u0026lt; std::endl; return *this; } ~Cat() { std::cout \u0026lt;\u0026lt; \u0026#34;Cat: Destructor is called\u0026#34; \u0026lt;\u0026lt; std::endl; } }; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // main.cpp #include \u0026lt;iostream\u0026gt; #include \u0026lt;utility\u0026gt; #include \u0026#34;Cat.h\u0026#34; class B { private: Cat cat_2{}; public: // call A(int) constructor to initialize member m_a explicit B(int age, const std::string\u0026amp; name){ cat_2 = Cat(age, name); std::cout \u0026lt;\u0026lt; \u0026#34;B: Default constructor is called\u0026#34; \u0026lt;\u0026lt; std::endl; } }; int main() { B b{ 1, \u0026#34;kitty\u0026#34; }; return 0; } Cat: Default constructor is called Cat: Constructor with two parameter is called Cat: Assignment Operator called Cat: Destructor is called B: Default constructor is called Cat: Destructor is called å¦‚æœæ”¹æˆä¸‹é¢è¿™æ ·, å…¶å®ƒä¸å˜:\n1 2 3 4 5 6 7 explicit B(int age, const std::string\u0026amp; name) : cat{age, name}{ std::cout \u0026lt;\u0026lt; \u0026#34;B: Default constructor is called\u0026#34; \u0026lt;\u0026lt; std::endl; } Cat: Constructor with two parameter is called B: Default constructor is called Cat: Destructor with parameter is called Member initializer lists allow us to initialize our members rather than assign values to them. This is the only way to initialize members that require values upon initialization, such as const or reference members, and it can be more performant than assigning values in the body of the constructor. Member initializer lists work both with fundamental types and members that are classes themselves.\n# 2. Initializer list order Perhaps surprisingly, variables in the initializer list are not initialized in the order that they are specified in the initializer list. Instead, they are initialized in the order in which they are declared in the class.\nFor best results, the following recommendations should be observed:\nDonâ€™t initialize member variables in such a way that they are dependent upon other member variables being initialized first (in other words, ensure your member variables will properly initialize even if the initialization ordering is different). Initialize variables in the initializer list in the same order in which they are declared in your class. This isnâ€™t strictly required so long as the prior recommendation has been followed, but your compiler may give you a warning if you donâ€™t do so and you have all warnings turned on. References:\n13.5 â€” Constructors â€“ Learn C++ 13.2 â€” Classes and class members â€“ Learn C++ ","date":"2023-05-15T18:56:01Z","permalink":"https://blog.yorforger.cc/p/c-constructors/","title":"C++ Constructors"},{"content":" # 1. Uninitialized variables Uninitialized variableså°±æ˜¯ä½ å®šä¹‰å®ƒäº†ä½†æ˜¯å´æ²¡æœ‰ç»™å®ƒèµ‹è¿‡å€¼(å³é€šè¿‡assignmentæ“ä½œæˆ–è€…initializationæ“ä½œ), å¦‚ä¸‹aå°±æ˜¯ä¸ªuninitialized variable:\n1 int a; ä¸ºä»€ä¹ˆè¦è¯´è¿™ä¸ªå‘¢, C++ç¼–è¯‘å™¨åœ¨è¿™æœ‰ç‚¹ç‹—, å¦‚æœä½ å®šä¹‰å±€éƒ¨å˜é‡çš„æ—¶å€™æ²¡æœ‰ç»™å®ƒå€¼, å¦‚ä¸Šé¢çš„å˜é‡a, é‚£ç¼–è¯‘å™¨ä¹Ÿå¹¶ä¸ä¼šç»™aä¸€ä¸ªç‰¹å®šçš„åˆå§‹å€¼, ç„¶åä½ è¿è¡Œç¨‹åºç¼–è¯‘å™¨ä¹Ÿä¸ä¼šæŠ¥é”™:\n1 2 3 4 5 6 7 int b; int main() { int a; cout \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; // æ‰“å°72433004 cout \u0026lt;\u0026lt; b \u0026lt;\u0026lt; endl; // æ‰“å°0 return 0; } Javaçš„è¯æ˜¯ç›´æ¥ä¸å…è®¸ä½ ä½¿ç”¨æœªå®šä¹‰çš„å±€éƒ¨å˜é‡, ä¼šæŠ¥é”™, å¦‚ä¸‹:\n1 2 3 4 5 public static void main(String []args) { int a; System.out.println(a); } // error: java: variable a might not have been initialized golangå°±ä¼šçœäº‹ä¸€äº›, ä¸è®ºå±€éƒ¨å…¨å±€, ä½ è‹¥å®šä¹‰çš„æ—¶å€™æ²¡æœ‰ç»™å€¼, ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç»™ä¸ªåˆå§‹å€¼, Golangæ˜ç¡®è¯´æ˜:\nVariables declared without an explicit initial value are given their zero value.\nå¯¹æ¯”å®Œä¸åŒçš„è¯­è¨€, é‚£æˆ‘ä»¬ç»§ç»­ä¸Šé¢çš„è¯´C++, ä¸ºä»€ä¹ˆè¿™ä¹ˆé—®é¢˜å¾ˆä¸¥é‡, è¿™ä¹Ÿæ˜¯æ‰€è°“çš„é‡æŒ‡é’ˆ(wild pointer)é—®é¢˜,\nå‡å¦‚è¿™æ—¶å€™ä½ å®šä¹‰çš„æ˜¯ä¸ªæŒ‡é’ˆ, ç„¶åæ²¡æœ‰åˆå§‹åŒ–, è¿™ä¸ªæ—¶å€™è¯¥æŒ‡é’ˆçš„å€¼æ˜¯â€éšæœºâ€œçš„(å…¶å®é¡µå¹¶ä¸æ˜¯éšæœº, å³ç¼–è¯‘å™¨ä¸ºè¯¥æŒ‡é’ˆå˜é‡åˆ†çš„é‚£å—å†…å­˜é‡ŒåŸæœ¬æœ‰ä»€ä¹ˆ, é‚£æŒ‡é’ˆçš„å€¼å°±æ˜¯ä»€ä¹ˆ), å¦‚æœä½ æ­¤æ—¶å°è¯•è®¿é—®è¿™ä¸ªæŒ‡é’ˆå°±å¯èƒ½ä¼šé€ æˆæœªå®šä¹‰è¡Œä¸º(undefined behavior), å› ä¸ºä½ ä¸çŸ¥é“è¯¥æŒ‡é’ˆçš„â€œéšæœºâ€æŒ‡å‘å“ªå—å†…å­˜, ä½ ä¿®æ”¹äº†è¯¥å—å†…å­˜çš„å†…å®¹å°±æœ‰å¯èƒ½è®©ä½ çš„çš„ç¨‹åºå´©æºƒcrush, å¦‚ä¸‹:\n1 2 3 int* p; *p = 6; // æœ‰æ—¶å€™ç¨‹åºä¼šå´©æºƒ, æœ‰æ—¶å€™ç¨‹åºä¼šæ­£å¸¸è¿è¡Œ, å–å†³äºpæŒ‡å‘çš„å“ªå—å†…å­˜åœ°å€ Unlike some programming languages, C/C++ does not initialize most variables to a given value (such as zero) automatically. Thus when a variable is given a memory address to use to store data, the default value of that variable is whatever (garbage) value happens to already be in that memory address! A variable that has not been given a known value (usually through initialization or assignment) is called an uninitialized.\næœ€åå¯¹äºä¸Šé¢æœªåˆå§‹åŒ–çš„å˜é‡aæ‰“å°äº†ä¸€ä¸ªâ€œéšæœºâ€çš„å€¼, å¯èƒ½ä¼šæœ‰ç–‘é—®, çœ‹åˆ°ä¸€ç¯‡æ–‡ç« è§£é‡Šçš„ä¸é”™, åˆ†äº«ä¸€ä¸‹:\n1 2 3 4 5 6 7 8 #include \u0026lt;iostream\u0026gt; int main() { // define an integer variable named x int x; // this variable is uninitialized because we haven\u0026#39;t given it a value // print the value of x to the screen std::cout \u0026lt;\u0026lt; x \u0026lt;\u0026lt; \u0026#39;\\n\u0026#39;; // who knows what we\u0026#39;ll get, because x is uninitialized } In this case, the computer will assign some unused memory to x. It will then send the value residing in that memory location to std::cout, which will print the value (interpreted as an integer). But what value will it print? The answer is â€œwho knows!â€, and the answer may (or may not) change every time you run the program. When the author ran this program in Visual Studio, std::cout printed the value 7177728 one time, and 5277592 the next. Feel free to compile and run the program yourself (your computer wonâ€™t explode).\n# 2. Undefined behavior Using the value from an uninitialized variable is our first example of undefined behavior. Undefined behavior is the result of executing code whose behavior is not well-defined by the C++ language. In this case, the C++ language doesnâ€™t have any rules determining what happens if you use the value of a variable that has not been given a known value. Consequently, if you actually do this, undefined behavior will result.\nCode implementing undefined behavior may exhibit any of the following symptoms:\nYour program produces different results every time it is run. Your program consistently produces the same incorrect result. Your program behaves inconsistently (sometimes produces the correct result, sometimes not). Your program seems like itâ€™s working but produces incorrect results later in the program. Your program crashes, either immediately or later. Your program works on some compilers but not others. Your program works until you change some other seemingly unrelated code. References:\n1.6 â€” Uninitialized variables and undefined behavior â€“ Learn C++ ","date":"2023-05-15T09:57:02Z","permalink":"https://blog.yorforger.cc/p/%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E5%8F%98%E9%87%8F%E5%92%8C%E6%9C%AA%E5%AE%9A%E4%B9%89%E8%A1%8C%E4%B8%BA/","title":"æœªåˆå§‹åŒ–çš„å˜é‡å’Œæœªå®šä¹‰è¡Œä¸º"},{"content":"è¯·å…ˆé˜…è¯»(è‹¥é“¾æ¥æ— æ•ˆå¯ä»¥æœç´¢ç«™å†…æ–‡ç« ): Javaä¸­å˜é‡(Variables)å’Œå¼•ç”¨(References)çš„åŒºåˆ« - David\u0026rsquo;s Blog\n# 1. JVM Run-Time Data Areas JVNå†…å­˜ç»“æ„è¯´çš„å°±æ˜¯Run-Time Data Areas. The Run-Time Data Areas of JVM is vary from different JVM specifications. ä¸åŒç‰ˆæœ¬çš„JVMä»‹ç»: https://docs.oracle.com/javase/specs/index.html\nè¯´è¿™ä¸ªä¹‹å‰ç¼•æ¸…JVMçš„å†…å­˜ç»“æ„: JVM memory is divided into multiple parts: Heap Memory, Non-Heap Memory.\n# 1.1. Heap The Java Virtual Machine has a heap that is shared among all Java Virtual Machine threads. The heap is the run-time data area from which memory for all class instances and arrays is allocated.\n# 1.2. Method Area The Java Virtual Machine has a method area that is shared among all Java Virtual Machine threads. The method area is analogous to the storage area for compiled code of a conventional language or analogous to the \u0026ldquo;text\u0026rdquo; segment in an operating system process. It stores per-class structures such as the run-time constant pool, field and method data, and the code for methods and constructors.\nAlthough the method area is logically part of the heap, simple implementations may choose not to either garbage collect or compact it. Method Areaå±äºheap, ä½†æœ‰çš„JVMå®ç°å¯èƒ½å¹¶ä¸ä¼šç”¨gcæ¸…ç†è¿™å—åŒºåŸŸ.\nä¸‰ç‚¹:\nMethos Area å±äºheap, å½“ç„¶æ˜¯çº¿ç¨‹å…±äº« run-time constant poolå±äºMethod Area run-time constant pool -\u0026gt; Method Area -\u0026gt; Heap # 1.3. Run-Time Constant Pool A run-time constant pool is a per-class or per-interface run-time representation of the constant_pool table in a class file. Run-time constant poolå°±æ˜¯class fileé‡Œçš„constant_pool table.\næ€»ç»“: run-time constant pool -\u0026gt; Method Area -\u0026gt; Heap, Each instance of the Java virtual machine has one method area and one heap. These areas are shared by all threads running inside the virtual machine. When the virtual machine loads a class file, it parses information about a type from the binary data contained in the class file. It places this type information into the method area. As the program runs, the virtual machine places all objects the program instantiates onto the heap. ä¸‹å›¾æè¿°äº†ä¸€ä¸ªclass fileæœ‰ä¸€ä¸ªconstant pool, ç„¶åè¢«å­˜æ”¾åœ¨Method Area, ä½†è¯¥å›¾å¹¶ä¸å‡†ç¡®, å› ä¸ºMethod Areaå…¶å®æ˜¯å±äºHeapçš„.\n# 1.4. Java Virtual Machine Stacks ä»¥ä¸Šä¸‰ä¸ªéƒ½æ˜¯heapé‡Œé¢çš„ä¸œè¥¿, ç°åœ¨æ˜¯stack\nEach Java Virtual Machine thread has a private Java Virtual Machine stack, created at the same time as the thread. A Java Virtual Machine stack stores frames. A Java Virtual Machine stack is analogous to the stack of a conventional language such as C: it holds local variables and partial results, and plays a part in method invocation and return.\n# 1.5. The pc Register Each Java Virtual Machine thread has its own pc (program counter) register. At any point, each Java Virtual Machine thread is executing the code of a single method, namely the current method for that thread.\nä»¥ä¸Šå†…å®¹å‚è€ƒè‡ª: The Java Virtual Machine Specification, Java SE 19 Edition\nKeep in mind that the Java virtual machine contains a separate runtime constant pool for each class and interface it loads:\n# 1.6. è¡¥å…… ä¸Šé¢æåˆ°äº†frameå’Œdynamic linking, ä¸‹é¢åšä¸ªè¡¥å……:\nFrame: A frame is used to store data and partial results, as well as to perform dynamic linking, return values for methods, and dispatch exceptions. A new frame is created each time a method is invoked. A frame is destroyed when its method invocation completes, whether that completion is normal or abrupt (it throws an uncaught exception). Frames are allocated from the Java Virtual Machine stack of the thread creating the frame. Each frame has its own array of local variables, its own operand stack, and a reference to the run-time constant pool of the class of the current method.\nDynamic Linking: When you compile a Java program, you get a separate class file for each class or interface in your program. Although the individual class files may appear to be independent, they actually harbor symbolic connections to one another and to the class files of the Java API. When you run your program, the Java virtual machine loads your program\u0026rsquo;s classes and interfaces and hooks them together in a process of dynamic linking. As your program runs, the Java virtual machine builds an internal web of interconnected classes and interfaces.\nA class file keeps all its symbolic references in one place, the constant pool. Each class file has a constant pool, and each class or interface loaded by the Java virtual machine has an internal version of its constant pool called the runtime constant pool(å¯ä»¥çœ‹å‡ºruntime constant poolå’Œclass fileé‡Œçš„constant pool tableæ˜¯å¯¹åº”çš„). The runtime constant pool is an implementation-specific data structure that maps to the constant pool in the class file. Thus, after a type is initially loaded, all the symbolic references from the type reside in the type\u0026rsquo;s runtime constant pool.\nä»¥ä¸Šå†…å®¹å‚è€ƒè‡ª: https://www.artima.com/insidejvm/ed2/linkmod.html\n# 2. String Pool åœ¨å“ª? åˆ°åº•å­˜ä¸å­˜åœ¨String Pool? çœ‹äº†ä¸€ä¸‹Java SE 18çš„JVMå®ç°æ ‡å‡†é‡Œçš„Runtime Data Area, é‡Œé¢å¹¶æ²¡æœ‰æåˆ°String Poolè¿™ä¸ªåè¯, ä½†æ˜¯æåˆ°äº†Method Areaä¸­çš„Runtime Constant Pool, æ„Ÿè§‰Stringåº”è¯¥åœ¨è¿™é‡Œ. è‡³äºStringåœ¨å“ª, æ¯«æ— å› ä¸ºåœ¨heapä¸Š, æˆ‘ä»¬è¦æ¢ç©¶çš„æ˜¯stringçš„å¯¹è±¡å…·ä½“åœ¨heapçš„å“ªä¸ªéƒ¨åˆ†(è²Œä¼¼æ¢ç©¶è¿™ä¸ªæ²¡ä»€ä¹ˆæ„ä¹‰ ummmm) å†µä¸”, æ‰€æœ‰å¯¹è±¡éƒ½åœ¨heapä¸Š,è¿™å¥è¯æ˜¯ä¸å˜çš„çœŸç†.\nWhenever we declare a variable or create an object, it is stored in the memory. At a high level, Java divides the memory into two blocks: stack and heap. https://www.baeldung.com/java-string-constant-pool-heap-stack\nRuntime Constant Pool(runtime constant pool)åœ¨Method Area, ç„¶åMethod Areaåœ¨heapä¸Š, é‚£ä¹ˆRuntime Constant Poolçš„å†…å®¹æ˜¯ä»€ä¹ˆå‘¢? ä¸Šé¢æˆ‘ä»¬æåˆ°Runtime Constant Poolå°±æ˜¯class fileé‡Œçš„constant pool table, æƒ³çŸ¥é“runtime constant poolé‡Œæœ‰ä»€ä¹ˆ, å°±è¦çŸ¥é“class fileé‡Œconstant pool tableçš„æ ¼å¼å†…å®¹, å»Java SE 18æ ‡å‡†çœ‹çœ‹:\næ‰¾åˆ°äº†, è¿™å¥è¯ä¸çŸ¥é“è¯´çš„å•¥æ„æ€, ä½†æ„Ÿè§‰constant poolæŒºé‡è¦, Java Virtual Machine instructions do not rely on the run-time layout of classes, interfaces, class instances, or arrays. Instead, instructions refer to symbolic information in the constant_pool table:\nEach entry in the constant_pool table must begin with a 1-byte tag indicating the kind of constant denoted by the entry, å¦‚ä¸‹å›¾, æˆ‘ä»¬å»4.4.3çœ‹çœ‹å“ªä¸ªCONSTANT_Stringæ˜¯ä»€ä¹ˆ:\nThe CONSTANT_String_info structure is used to represent constant objects of the type String:\næ‰€ä»¥, Stringå¯¹è±¡å°±åœ¨è¿™â€”â€”runtime constant pool.\n# 3. GC and String Before Java 7, the JVM placed the Java String Pool in the PermGen space, which has a fixed size â€” it can\u0026rsquo;t be expanded at runtime and is not eligible for garbage collection.\nThe risk of interning Strings in the PermGen (instead of the Heap) is that we can get an OutOfMemory error from the JVM if we intern too many Strings.\nFrom Java 7 onwards, the Java String Pool is stored in the Heap space, which is garbage collected by the JVM. The advantage of this approach is the reduced risk of OutOfMemory error because unreferenced Strings will be removed from the pool, thereby releasing memory.\næ‰€ä»¥Stringå¯¹è±¡ä¼šè¢«GCæ¸…ç†, å´Stringå­˜å‚¨åœ¨heapä¸Š, å¯èƒ½è¯´çš„æœ‰ç‚¹åŒºåˆ«, æ¯”å¦‚stringå­˜å‚¨åœ¨string pool, ä¸ä¼šç›´æ¥è¯´å­˜å‚¨åœ¨heapä¸Š.\n","date":"2023-05-14T21:50:26Z","permalink":"https://blog.yorforger.cc/p/java%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/","title":"Javaå†…å­˜ç»“æ„"},{"content":" # 1. Define 1 2 int x; // define an integer variable named x int y, z; // define two integer variables, named y and z # 2. Variable Assignment After a variable has been defined, you can give it a value (in a separate statement) using the = operator. This process is called copy assignment (or just assignment) for short:\n1 2 int width; // define an integer variable named width width = 5; // copy assignment of value 5 into variable width # 3. Initialization Initialization in C++ is surprisingly complex, so weâ€™ll present a simplified view here.\nThere are 6 basic ways to initialize variables in C++:\n1 2 3 4 5 6 7 8 int a; // no initializer (default initialization) int b = 5; // initializer after equals sign (copy initialization) int c(6); // initializer in parenthesis (direct initialization) // List initialization methods (C++11) (preferred) int d{7}; // initializer in braces (direct list initialization) int e = {8}; // initializer in braces after equals sign (copy list initialization) int f {}; // initializer is empty braces (value initialization) # 3.1. Default Initialization When no initialization value is provided (such as for variable a above), this is called default initialization. In most cases, default initialization leaves a variable with an indeterminate value.\n1 int a; // no initializer (default initialization) # 3.2. Copy Initialization 1 int width = 5; // copy initialization of value 5 into variable width Copy initialization is also used whenever values are implicitly copied or converted, such as when passing arguments to a function by value, returning from a function by value, or catching exceptions by value.\n# 3.3. List Initialization The modern way to initialize objects in C++ is to use a form of initialization that makes use of curly braces: list initialization (also called uniform initialization or brace initialization). List initialization comes in three forms:\n1 2 3 int width {5}; // direct list initialization of value 5 into variable width int height = {6}; // copy list initialization of value 6 into variable height int depth {}; // value initialization (see next section) List initialization has an added benefit: it disallows â€œnarrowing conversionsâ€. This means that if you try to brace initialize a variable using a value that the variable can not safely hold, the compiler will produce an error. For example:\n1 int width { 4.5 }; // error: a number with a fractional value can\u0026#39;t fit into an int References:\n1.4 â€” Variable assignment and initialization â€“ Learn C++\n","date":"2023-05-14T18:29:32Z","permalink":"https://blog.yorforger.cc/p/c-variable-assignment-and-initialization/","title":"C++ Variable Assignment and Initialization"},{"content":" # 1. Status Switch Remember that each file in your working directory can be in one of two states: tracked or untracked. Tracked files are files that were in the last snapshot, as well as any newly staged files; they can be unmodified, modified, or staged. In short, tracked files are files that Git knows about. As you edit files, Git sees them as modified, because youâ€™ve changed them since your last commit. As you work, you selectively stage these modified files and then commit all those staged changes, and the cycle repeats.\nSome commands are used frequently, the commands below will make a diffference on Git repository but won\u0026rsquo;t change the wok place (file system):\n1 2 3 4 # just untrack file git rm --cached file-name # just unstatge file git restore --staged file-name The commands below will change both work place and Git repository:\n1 2 3 4 # untrack file \u0026amp; rm file git rm file-name # unstatge file \u0026amp; discard uncommitted local changes git restore file-name # 2. Untrack File 1 2 git rm file-name git rm --cached file-name The \u0026ldquo;rm\u0026rdquo; command helps you to remove files from a Git repository. It allows you to not only delete a file from the repository, but also - if you wish - from the filesystem.\nDeleting a file from the filesystem can of course easily be done in many other applications, e.g. a text editor, IDE or file browser. But deleting the file from the actual Git repository is a separate task, for which git rm was made.\n--cached\nRemoves the file only from the Git repository, but not from the filesystem. By default, the git rm command deletes files both from the Git repository as well as the filesystem. Using the --cached flag, the actual file on disk will not be deleted. -r\nRecursively removes folders. When a path to a directory is specified, the -r flag allows Git to remove that folder including all its contents. # 3. Unstage File 1 2 git restore file-name git restore --staged file-name The \u0026ldquo;restore\u0026rdquo; command helps to unstage or even discard uncommitted local changes. On the one hand, the command can be used to undo the effects of git add and unstage changes you have previously added to the Staging Area.\n--staged\nRemoves the file from the Staging Area, but leaves its actual modifications untouched. By default, the git restore command will discard any local, uncommitted changes in the corresponding files and thereby restore their last committed state. With the --staged option, however, the file will only be removed from the Staging Area - but its actual modifications will remain untouched. --source \u0026lt;ref\u0026gt;\nRestores a specific revision of the file. By default, the file will be restored to its last committed state (or simply be unstaged). The --source option, however, allows you to restore the file at a specific revision. 1 2 $ git restore --source 7173808e index.html $ git restore --source master~2 index.html The first example will restore the file as it was in commit #7173808e, while the second one will restore it as it was \u0026ldquo;two commits before the current tip of the master branch\u0026rdquo;.\n# 3. Stage File 1 git add file-name It adds changes to Git\u0026rsquo;s Staging Area (index), the contents of which can then be wrapped up in a new revision with the git commit command.\n# 4. Conclusion Git repository, Work place (Filesystem, Working tree), Staging Area (Index), Stage the file: git add \u0026lt;filename\u0026gt; Unstage: git restore --staged \u0026lt;filename\u0026gt;, git restore \u0026lt;filename\u0026gt; Untrack: git rm --cached \u0026lt;filename\u0026gt;, git rm \u0026lt;filname\u0026gt; References:\nhttps://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository https://www.git-tower.com/learn/git/commands/git-rm https://www.git-tower.com/learn/git/commands/git-restore ","date":"2023-05-05T09:31:30Z","permalink":"https://blog.yorforger.cc/p/git-rm-git-restore/","title":"git rm \u0026 git restore"},{"content":" # 1. Some Commands You can use xxx --help , man xxx, tldr you-command to check the usage of the command.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 $ nohup ./server -p 8080 \u0026amp; $ zip -r root.zip root $ git log --all --decorate --oneline --graph # \u0026#34;A Dog\u0026#34; $ ls -lh xxx $ file server $ uname -a $ otool # mac only for xxd $ xxd a.class $ du -sh * # h: human-readable, *: all, s: sort $ df -lh # disk usage, h: human-readable, l: local file system $ chmod +x test.sh $ ipconfig getifaddr en0 # check your ip on Mac $ find themes/source/css -name \u0026#34;*header*\u0026#34; -type f $ grep -nr \u0026#39;ul$\u0026#39; themes/source/css # n: line number, r: recursive # 1.1. netstat The basic netstat command without any options will list all active TCP connections and listening ports. Alternatively, you can use lsof -i on Mac.\nWith the -a option, netstat can show all listening and non-listening sockets.\nWith -p option, netstat can display the process ID (PID) and the program name associated with each network connection, on Linux \u0026amp; Windows.\n1 2 3 4 5 6 7 8 9 # lsof -i on Mac $ netstat -anp | grep 127.0.0.53 â¯ lsof -n -i COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME Raycast 688 David 42u IPv6 0x91b82f8c4899 0t0 TCP *:7265 (LISTEN) redis-ser 726 David 6u IPv4 0x918862f10b09 0t0 TCP 127.0.0.1:6379 (LISTEN) WeChat 1137 David 161u IPv4 0x91bbc886151b1 0t0 TCP 192.168.2.15:51295-\u0026gt;43.130.30.247:http (ESTABLISHED) Arc\\x20He 1269 David 21u IPv4 0x91c91fd81e559 0t0 UDP 192.168.2.15:50307-\u0026gt;142.251.35.174:https e.g., you can use netstat -anp | grep 8080 to find the PID of the process, so that you can kill it by kill PID.\nYou can also use ps aux to find a specific process by name, then use netstat to find the ip and port of the process.\n# 1.2. ps The ps command, short for Process Status, is used to view information related to the processes running in a Linux system.\nps aux: a: show processes for all users, u: display the process\u0026rsquo;s user/owner, x: also show processes not attached to a terminal.\nThe key info listed by ps are:\n1 2 3 4 5 â¯ ps aux USER PID COMMAND PID: Process ID. COMMAND: The command that started this process. e.g., you can use ps aux | grep ./server to find the PID of ./server process, so that you can kill it by kill PID.\n# 1.3. brew services list 1 2 3 4 5 6 7 8 9 10 11 12 13 14 â¯ brew services list Name Status User File mongodb-community none David mysql started David ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist redis started David ~/Library/LaunchAgents/homebrew.mxcl.redis.plist unbound none â¯ brew services start mongodb-community ==\u0026gt; Successfully started `mongodb-community` (label: homebrew.mxcl.mongodb-community) â¯ brew services list Name Status User File mongodb-community started David ~/Library/LaunchAgents/homebrew.mxcl.mongodb-community.plist ... # 1.4. systemctl The systemctl command is used to manage systemd services and units, such as starting, stopping, and checking the status of units.\nStarting a Service: To start a service, you can use systemctl start \u0026lt;service-name\u0026gt;. Stopping a Service: To stop a service, you can use systemctl stop \u0026lt;service-name\u0026gt;. Checking the Status of a Service: To check the status of a service, you can use systemctl status \u0026lt;service-name\u0026gt;. The systemd is a service manager for Linux operating systems. It is responsible for initializing and managing system services, daemons, and other processes during the boot process and while the system is running.\n# 2. wget 1 2 3 4 5 6 7 8 # -O write documents to FILE: download the file and save it into install.sh wget -O install.sh https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh # -q quiet, same as above but output nothing wget -qO install.sh https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh # just output the content to stdout, no file saving wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh sh -c \u0026#34;$(wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34; ","date":"2023-05-03T12:40:56Z","permalink":"https://blog.yorforger.cc/p/commands-commonly-used-in-linux/","title":"Commands Commonly Used in Linux"},{"content":"æœ€åˆæƒ³ç­›é€‰ä»¥shç»“å°¾ä½†å‰é¢æ²¡æœ‰.çš„æ–‡ä»¶, å¯¹åº”çš„Regexä¸º(?\u0026lt;!\\.)sh$, ä½†æ˜¯! åˆšå¼€å§‹ä¸çŸ¥é“(?!),(?=),(?\u0026lt;!)è¿™ç§å†™æ³•è§„åˆ™, å°±åœ¨æƒ³ç”¨é€»è¾‘ä¸å†™å‡ºä»¥shç»“å°¾çš„å­—ç¬¦ä½†ä¸ä»¥.shç»“å°¾, ä½†è¿™æœ¬èº«å°±çŸ›ç›¾å•Š, ä»¥.shç»“å°¾æœ¬èº«å°±æ˜¯ä»¥shç»“å°¾å•Š,,, ç ”ç©¶äº†ä¿©å°æ—¶, å¤ªèœäº†,,,, åˆå¿«å‡Œæ™¨ä¸€ç‚¹äº†,\nåœ¨StackOverflowçœ‹åˆ°ä¸€ä¸ªå¥½çš„å›ç­”,\nGiven the string foobarbarfoo:\n1 2 3 4 bar(?=bar) finds the 1st bar (\u0026#34;bar\u0026#34; which has \u0026#34;bar\u0026#34; after it) bar(?!bar) finds the 2nd bar (\u0026#34;bar\u0026#34; which does not have \u0026#34;bar\u0026#34; after it) (?\u0026lt;=foo)bar finds the 1st bar (\u0026#34;bar\u0026#34; which has \u0026#34;foo\u0026#34; before it) (?\u0026lt;!foo)bar finds the 2nd bar (\u0026#34;bar\u0026#34; which does not have \u0026#34;foo\u0026#34; before it) You can also combine them:\n1 (?\u0026lt;=foo)bar(?=bar) finds the 1st bar (\u0026#34;bar\u0026#34; with \u0026#34;foo\u0026#34; before it and \u0026#34;bar\u0026#34; after it) ä½¿ç”¨è¿™ç§ lookaround å¥å‹çš„æ—¶å€™è¦æ³¨æ„ä¸Šé¢çš„å†™æ³•, å³ (?!bar) å°±æ˜¯ç”¨æ¥æŒ‡å®šæŸä¸ªå•è¯åä¸å«æœ‰ä»€ä¹ˆçš„, è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹å¦‚ä¸‹:\nIn the meantime, if there is one thing you should remember, it is this: a lookahead or a lookbehind does not \u0026ldquo;consume\u0026rdquo; any characters on the string. This means that after the lookahead or lookbehind\u0026rsquo;s closing parenthesis, the regex engine is left standing on the very same spot in the string from which it started looking: it hasn\u0026rsquo;t moved. From that position, then engine can start matching characters again.\nå³è¿™äº›Lookaroundåªæ˜¯ç”¨æ¥æ£€æŸ¥checkçš„, æ˜¯ä¸ªé™„åŠ æ¡ä»¶:\n1 $ printf \u0026#34;handle_test.go\u0026#34; | grep -P \u0026#39;test(?=.)go\u0026#39; å‡­ç›´è§‰ 'test(?=.)go' åŒ¹é…çš„æ˜¯å«æœ‰ test ä¸”å…¶åç´§è·Ÿç€ .go, å¯æ˜¯ \u0026quot;handle_test.go\u0026quot; å¹¶ä¸æ»¡è¶³ 'test(?=.)go', å› ä¸º(?=.) åŒ¹é…åˆ°äº† . å¹¶æ²¡æœ‰æ¶ˆè€—æ‰å®ƒ, è¦è¿™ä¹ˆå†™æ‰è¡Œ: 'test(?=.).go' ,ä½†è¿™æ ·çœ‹ç€å¾ˆå¥‡æ€ª å¹¶ä¸æ˜¯è¿™ä¹ˆç”¨çš„, å…¶å®ç›´æ¥å†™ 'test(?=.go)' å°±å¥½äº†,\nå‚è€ƒ:\nAdvanced Regex Tutorialâ€”Regex Syntax\nlookaround - Regex lookahead, lookbehind and atomic groups - Stack Overflow\n","date":"2023-05-02T23:30:28Z","permalink":"https://blog.yorforger.cc/p/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B9%8B%E5%85%B3%E4%BA%8E-%E7%9A%84%E5%9B%B0%E6%83%91/","title":"æ­£åˆ™è¡¨è¾¾å¼ä¹‹å…³äº'(? â€¦ )'çš„å›°æƒ‘"},{"content":"åˆšå¼€å§‹ä½¿ç”¨printf \u0026quot;123\\n24567\\n8930\\n234\\n\u0026quot; | egrep '(?\u0026lt;!2)3'æç¤ºegrep: repetition-operator operand invalid, ç„¶åæŸ¥åˆ°å¯ä»¥ä½¿ç”¨å‚æ•°-P, å¦‚ä¸‹:\n1 $ printf \u0026#34;123\\n24567\\n8930\\n234\\n\u0026#34; | grep -P \u0026#39;(?\u0026lt;!2)3\u0026#39; ä½†æ˜¯ä»ç„¶æŠ¥é”™å’Œä¸Šé¢æŠ¥é”™ç›¸åŒ, ç„¶åå°±è€ƒè™‘æ˜¯ä¸æ˜¯ç‰ˆæœ¬é—®é¢˜,\n1 2 $ grep --v grep (BSD grep, GNU compatible) 2.6.0-FreeBSD å°è¯•æ›´æ–°,\n1 2 $ brew upgrade grep Error: grep not installed ç„¶åå°è¯•å®‰è£…,\n1 2 3 4 5 6 $ brew install grep ... All commands have been installed with the prefix \u0026#34;g\u0026#34;. If you need to use these commands with their normal names, you can add a \u0026#34;gnubin\u0026#34; directory to your PATH from your bashrc like: PATH=\u0026#34;/opt/homebrew/opt/grep/libexec/gnubin:$PATH\u0026#34; å®‰è£…æˆåŠŸ, ç„¶åæ ¹æ®æç¤ºå¾€.zshrcæ·»åŠ å¯¹åº”ç¯å¢ƒå˜é‡PATH, æ³¨æ„$:PATHçš„å«ä¹‰(è¿½åŠ ),\næŸ¥çœ‹ç‰ˆæœ¬,\n1 2 3 4 grep --v grep (GNU grep) 3.10 Packaged by Homebrew Copyright (C) 2023 Free Software Foundation, Inc. ç°åœ¨æ”¯æŒä¸Šé¢è¯­æ³•grep -P '(?\u0026lt;!2)3' , é—®é¢˜è§£å†³~\n","date":"2023-05-02T22:29:30Z","permalink":"https://blog.yorforger.cc/p/grep%E4%B8%8D%E6%94%AF%E6%8C%81negative-lookahead%E9%97%AE%E9%A2%98/","title":"grepä¸æ”¯æŒNegative Lookaheadé—®é¢˜"},{"content":" # 1. ?, *, ., + + one occurrences of the preceding element * zero occurrence of the preceding element ? zero or one occurrences of the preceding element . matches any single character (exclude newlines) # 2. \\b To match \u0026ldquo;port\u0026rdquo; and \u0026ldquo;ports\u0026rdquo; but not match \u0026ldquo;export\u0026rdquo;, \u0026ldquo;portable\u0026rdquo;, \u0026ldquo;important\u0026rdquo;, use \\bports?\\b. Here, \\b indicates a boundary, where there cannot be other word characters on either side. Word characters refer to English letters, numbers and underscore \u0026ldquo;_\u0026rdquo;. So \\bports?\\b will match \u0026ldquo;port\u0026rdquo; or \u0026ldquo;ports\u0026rdquo; only if they appear as a full word by themselves, not as part of another word.\n1 2 3 $ printf \u0026#34;The port is...\\nTo export it...\\nThere are many ports...\\nportable\u0026#34; | egrep \u0026#39;\\bports?\\b\u0026#39; The port is... There are many ports... Please note that Bash generally uses \u0026ldquo;double quotes\u0026rdquo; to quote strings, in order to avoid potential misparsing, we should use \u0026lsquo;single quotes\u0026rsquo; when quoting any regular expressions.\nYou should always quote regular expressions for grep\u0026ndash;and single quotes are usually best. https://askubuntu.com/a/957504/1690738\n# 3. [] A string of characters enclosed in square brackets ([]) matches any one character in that string. If the first character in the brackets is a caret (^), it matches any character except those in the string. For example, [abc] matches a, b, or c, but not x, y, or z. However, [^abc] matches x, y, or z, but not a, b, or c.\nA minus sign (-) within square brackets indicates a range of consecutive ASCII characters. For example, [0-9] is the same as [0123456789].\nIf any special character, such as backslash (\\), asterisk (*), or plus sign (+), is immediately after the left square bracket, it doesn\u0026rsquo;t have its special meaning and is considered to be one of the characters to match.\nMatch Not match [0-9] 1, 2, 3 12, 01, 22 [a-zA-Z0-9_] a, E, 2, _ ab, 56 END[.] END. END; END DO [ \\t\\n], \u0026ldquo;ä»»ä½•ä¸€ä¸ªç©ºç™½ç±»å­—ç¬¦\u0026rdquo;, æ³¨æ„[ \\t\\n]æ˜¯å‰é¢æ•…æ„æœ‰ä¸ªç©ºæ ¼, [^ \\t\\n], \u0026ldquo;ä»»ä½•ä¸€ä¸ªéç©ºç™½ç±»å­—ç¬¦\u0026rdquo; è®¡æ•°ç”¨, è¡¨è¾¾ ã€Œå‰é¢çš„æ ·ç‰ˆé‡å¤å‡ºç°å¤šå°‘æ¬¡ã€ çš„ quantifier:\n{5} é‡å¤ 5 æ¬¡ {3,7} é‡å¤ 3 åˆ° 7 æ¬¡ {3,} é‡å¤è‡³å°‘ 3 æ¬¡ {0,}é‡å¤å‡ºç°ä»»æ„æ¬¡, åŒ…å« 0 æ¬¡ {1,} é‡å¤å‡ºç°ä»»æ„æ¬¡, è‡³å°‘ 1 æ¬¡ å›½å†…çš„æ‰‹æœºå·æ˜¯11ä½, æ‰€ä»¥è¦æŸ¥æ‰‹æœºå·, æˆ‘ä»¬å¯ä»¥ç®€å•çš„æŸ¥æ‰¾å¤§äºç­‰äº11ä½æ•°å­—çš„å­—ç¬¦ä¸², ä¸‹é¢ç”¨7ä½çš„ä¸¾ä¾‹å­,\n1 2 3 $ printf \u0026#34;12345\\n12345678\\n123\\n234567\\n1234567\u0026#34; | egrep \u0026#39;[0-9]{7}\u0026#39; 12345678 1234567 å¦‚æœæƒ³è¦æŸ¥æ‰¾å°±æ˜¯å‡†ç¡®çš„7ä½çš„æ•°å­—å‘¢?\n1 2 $ printf \u0026#34;12345\\n12345678\\n123\\n234567\\n1234567\u0026#34; | ggrep -E \u0026#39;\\b[0-9]{7}\\b\u0026#39; 1234567 # 4. $ \u0026amp; ^ $ The pattern hello$ will match the word \u0026ldquo;hello\u0026rdquo; only if it appears at the end of a line.\n1 2 3 $ printf \u0026#34;My name is Jack\\nHi Jack, this is John\\nYou and Jack will come..\\ndfHelloJack\u0026#34; | egrep \u0026#39;Jack$\u0026#39; My name is Jack dfHelloJack ^ Can be used to match the start of a line. For instance, the pattern ^Hello will match any line that begins with \u0026ldquo;Hello.\u0026rdquo;\nFor example, the pattern ^hello$ will only match the exact string \u0026ldquo;hello\u0026rdquo; and not \u0026ldquo;hello world\u0026rdquo; or \u0026ldquo;say hello.\u0026rdquo;\n1 2 3 4 5 6 7 8 9 10 11 12 $ printf \u0026#34;Hell 123\\n123456\\n123\\n123 hello\u0026#34; | egrep \u0026#39;^\\d+$\u0026#39; 123456 123 $ printf \u0026#34;Hell 123\\n123456\\n123\\n123 hello\u0026#34; | egrep \u0026#39;\\d{3}\u0026#39; Hell 123 123456 123 123 hello $ printf \u0026#34;Hell 123\\n123456\\n123\\n123 hello\u0026#34; | egrep \u0026#39;\\b\\d{3}\\b\u0026#39; Hell 123 123 123 hello # 5. e.g. åœ¨ä¸€ç¯‡æ–‡ç« å½“ä¸­, æŠ“å‡ºæ‰€æœ‰ ã€Œçœ‹èµ·æ¥åƒæ˜¯æœºåœºä»£ç çš„å­—ç¬¦ä¸²ã€ (ä¾‹å¦‚ TPE å°åŒ—, KHH é«˜é›„, LAX æ´›æ‰çŸ¶, \u0026hellip; ç­‰ç­‰): \\b[A-Z][A-Z][A-Z]\\bã€‚ è¿™é‡Œçš„ [A-Z] æ˜¯ [ABCDEFGHIJKLMNOPQRSTUVWXYZ] çš„ç®€å†™, æ„æ€æ˜¯ ã€Œä»»ä½•ä¸€ä¸ªå¤§å†™å­—æ¯ã€\nå¦‚ä½•åœ¨ä¸€å¤§ç‰‡æ–‡æœ¬, é“¶è¡Œè´¦å·, ä¿¡ç”¨å¡å·\u0026hellip; å½“ä¸­, æ‰¾å‡ºçœ‹æ¥åƒæ˜¯ç§»åŠ¨ç”µè¯å·ç çš„å­—ç¬¦ä¸², ä¾‹å¦‚ 0912345678 æˆ–æ˜¯ 0912-345678 æˆ–æ˜¯ 0912-345-678 ä¹‹ç±»çš„? 09\\d\\d-?\\d\\d\\d-?\\d\\d\\d è¿™é‡Œçš„ \\d æ˜¯ [0-9] çš„ç®€å†™, è¿™åˆæ˜¯ [0123456789] çš„ç®€å†™, æ„æ€æ˜¯ ã€Œä»»ä½•ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€\næƒ³è¦æ‰¾ä¸€ç»„æ•°å­— ip (ä¾‹å¦‚ 168.95.1.1 æˆ– 163.17.9.176 ä¹‹ç±»çš„) å°è±¡ä¸­åœ¨æŸä¸ªæ–‡ä»¶å†…æ›¾çœ‹è¿‡, ä½†æ—¢ä¸è®°å¾—ç²¾ç¡®çš„æ•°å­—, ä¹Ÿä¸è®°å¾—åœ¨é‚£ä¸ªæ–‡ä»¶çœ‹è¿‡, è¯¥æ€ä¹ˆåŠ? å¯ä»¥æœç´¢ \\d+\\.\\d+\\.\\d+\\.\\d+ æŠ“å‡ºæ‰€æœ‰æ•°å­— ipã€‚ è¿™é‡Œçš„ + è¡¨ç¤º ã€Œå‰é¢çš„ä¸œè¥¿, å¯ä»¥é‡å¤å‡ºç° 1 æ¬¡, 2 æ¬¡, 3 æ¬¡, \u0026hellip; ä»»æ„æ¬¡ã€ã€‚ å› ä¸º . åœ¨ regexp å½“ä¸­æœ‰ç‰¹æ®Šçš„æ„ä¹‰: ã€Œä»»ä½•ä¸€ä¸ªå­—ç¬¦ã€; ä½†åœ¨è¿™é‡Œæˆ‘ä»¬å°±æ˜¯è¦æ‰¾ \u0026ldquo;.\u0026rdquo; äºæ˜¯åœ¨å‰é¢åŠ ä¸Š \\ ä»¥å–æ¶ˆå®ƒçš„ç‰¹æ®Šæ„ä¹‰ã€‚\nå¯ä»¥æŠŠä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶é‡Œé¢çš„æ‰€æœ‰ç©ºç™½åˆ—éƒ½åˆ æ‰å—? è¿™ä¸ª regexp å¯ä»¥æŠ“å‡ºæ‰€æœ‰ç©ºç™½åˆ—: ^\\s*$ã€‚ åœ¨ regexp æœ€å‰é¢æ”¾ä¸€ä¸ª ^ è¡¨ç¤ºæ‚¨åªå¯¹ ã€Œå‡ºç°åœ¨ä¸€åˆ—ä¹‹é¦–ã€ çš„æ ·ç‰ˆæœ‰å…´è¶£; åœ¨ regexp çš„æœ€åé¢æ”¾ä¸€ä¸ª $ è¡¨ç¤ºæ‚¨åªå¯¹ ã€Œå‡ºç°åœ¨ä¸€åˆ—ä¹‹å°¾ã€ çš„æ ·ç‰ˆæœ‰å…´è¶£ã€‚ \\s æ˜¯ [\\t\\n] çš„ç®€å†™, æ„æ€æ˜¯ ã€Œä»»ä½•ä¸€ä¸ªç©ºç™½å­—ç¬¦ã€ (åŒ…å«ç©ºæ ¼, tab, ç­‰ç­‰)ã€‚ * è¡¨ç¤º ã€Œå‰é¢çš„ä¸œè¥¿, å¯ä»¥é‡å¤å‡ºç° 0 æ¬¡, 1 æ¬¡, 2 æ¬¡, \u0026hellip; ä»»æ„æ¬¡ã€ã€‚ è¿™ä¸ªæ ·ç‰ˆç¿»è¯‘æˆä¸­æ–‡, å°±æ˜¯ ã€Œä»å¤´åˆ°å°¾éƒ½æ˜¯ä¸€ç‰‡ç©ºç™½çš„é‚£ç§åˆ—ã€ã€‚\n\\ \\ is used to escape special chars: \\*matches * [abc] any of a, b, or c [^abc] not a, b, or c [a-g] character between a \u0026amp; g [^adgf] ä»£è¡¨ä¸æ˜¯a, d, gæˆ–fçš„å­—ç¬¦ 1 2 3 4 5 6 # å¿½ç•¥å¤§å°å†™ $ printf \u0026#34;Hello\\nHeal\\ntold\\nhello\u0026#34; | egrep \u0026#39;(?i)LL\u0026#39; Hello hello # æ‰¾å‡ºå¸¦åç¼€çš„æ–‡ä»¶ $ ls /etc/ | egrep \u0026#39;\\.\\w+$\u0026#39; References:\nRegexp æ˜¯ä»€ä¹ˆä¸œä¸œ?\nTop 15 Commonly Used Regex - Digital Fortress\nPerl å¸¸ç”¨çš„ regexp è§„åˆ™åˆ—è¡¨\n","date":"2023-05-01T23:14:22Z","permalink":"https://blog.yorforger.cc/p/regex-basics/","title":"Regex Basics"},{"content":"ä¸€ç›´å¬è¯´Spring Bootå†…åµŒäº†Tomcat, ç„¶åSpring Booté»˜è®¤æŠŠåº”ç”¨æ‰“åŒ…ä¸ºJar, è¿™åˆ°åº•æ„å‘³ç€ä»€ä¹ˆå‘¢, ä¸ºå•¥ä¸ç›´æ¥ç”¨WaråŒ…éƒ¨ç½²åˆ°å¤–éƒ¨æœåŠ¡å™¨å‘¢(å¤–éƒ¨çš„Tomcat)? ä¸äº†è§£Warå¯ä»¥çœ‹çœ‹æˆ‘çš„å…¶å®ƒWarç›¸å…³çš„æ–‡ç« æˆ–è€…ç«™å†…æœWarç­‰å…³é”®å­—.\nåœ¨StackOverflowä¸Šçœ‹åˆ°ä¸€ä¸ªå…³äºä»€ä¹ˆæ˜¯å†…åµŒTomcatå›ç­”, çœ‹çœ‹å’‹è¯´çš„\n\u0026ldquo;Embedded\u0026rdquo; means that you program ships with the server within it as opposed to a web application being deployed to external server. With embedded server your application is packaged with the server of choice and responsible for server start-up and management.\nFrom the user standpoint the difference is:\nApplication with embedded server looks like a regular java program. You just launch it and that\u0026rsquo;s it. Regular web application is usually a war archive which needs to be deployed to some server Embedding a server is very useful for testing purposes where you can start or stop server at will during the test.\nç°åœ¨è²Œä¼¼æ‡‚ç‚¹äº†, å°±æ˜¯Tomcatè¢«è¢«é›†æˆåˆ°äº†æˆ‘ä»¬çš„é¡¹ç›®é‡Œå‘—(Tomcatæœ¬è´¨ä¹Ÿå°±æ˜¯ä¸ªå®ç°äº†Servletå’ŒJSPæ ‡å‡†çš„ç¨‹åº), é‚£æˆ‘ä»¬å»çœ‹çœ‹æˆ‘ä»¬æ‰“åŒ…å¥½çš„Spring Booté¡¹ç›®(ä¸€ä¸ªJaræ–‡ä»¶)é‡Œæ˜¯ä¸æ˜¯æœ‰Tomcat,\n1 2 3 4 5 6 7 $ pwd Downloads/SpringDemo-0.0.1-SNAPSHOT/BOOT-INF/lib/ $ ls | grep tomcat tomcat-embed-core-10.1.7.jar tomcat-embed-el-10.1.7.jar tomcat-embed-websocket-10.1.7.jar å¥½å®¶ä¼™, æœç„¶åœ¨é‡Œé¢,\nç„¶ååˆçœ‹åˆ°ä¸€ç¯‡æ–‡ç« , è¯´çš„å¾ˆæ¸…æ™°, è¿™é‡Œç²˜è´´éƒ¨åˆ†, åˆ†äº«ä¸€ä¸‹,\nThink about what you would need to be able to deploy your application (typically) on a virtual machine.\nStep 1 : Install Java Step 2 : Install the Web/Application Server (Tomcat/Websphere/Weblogic etc) Step 3 : Deploy the application war What if we want to simplify this?\nHow about making the server a part of the application?\nYou would just need a virtual machine with Java installed and you would be able to directly deploy the application on the virtual machine. Isnâ€™t it cool?\nThis idea is the genesis for Embedded Servers. When we create an application deployable, we would embed the server (for example, tomcat) inside the deployable.\nFor example, for a Spring Boot Application, you can generate an application jar which contains Embedded Tomcat. You can run a web application as a normal Java application!\nEmbedded server implies that our deployable unit contains the binaries for the server (example, tomcat.jar). è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„é‚£å‡ ä¸ªæ–‡ä»¶tomcat-embed-core-10.1.7.jarç­‰, äº†è§£æ›´å¤šSpring Boot and Embedded Servers - Tomcat\næ‰“å¼€é¡¹ç›®pom.xmlå¯ä»¥çœ‹åˆ°ä¾èµ–é‡Œå¹¶æ²¡tomcatç›¸å…³çš„ä¸œè¥¿, ä½†æ˜¯æˆ‘ä»¬é¡¹ç›®é‡Œå´æœ‰tomcaté‚£å‡ ä¸ªjaråŒ…, è¿™æ˜¯ä¸ºå•¥å“©, å…¶å®æ˜¯å› ä¸ºä¸‹é¢çš„spring-boot-starter-webä¾èµ–tomcat, è‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ ç±»ä¼¼spring-boot-starter-tomcatè¿™ç§äº†,\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-jpa\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; çœ‹ä¸€ä¸‹åˆ«äººæ€ä¹ˆè¯´,\nThe single spring-boot-starter-web dependency can pull in all dependencies related to web development. It also reduces the count of build dependency. The spring-boot-starter-web mainly depends on the following:\n1 2 3 4 5 6 - org.springframework.boot:spring-boot-starter - org.springframework.boot:spring-boot-starter-tomcat - org.springframework.boot:spring-boot-starter-validation - com.fasterxml.jackson.core:jackson-databind - org.springframework:spring-web - org.springframework:spring-webmvc By default, the spring-boot-starter-web contains the below tomcat server dependency given:\n1 2 3 4 5 6 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-tomcat\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.0.RELEASE\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;compile\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; The spring-boot-starter-web auto-configures the below things required for the web development:\nDispatcher Servlet Error Page Embedded servlet container Web JARs for managing the static dependencies Difference Between Spring Boot Starter Web and Spring Boot Starter Tomcat - GeeksforGeeks\nè¯´äº†é‚£ä¹ˆå¤š, æ—¢ç„¶æ˜¯ç”Ÿæˆçš„é¡¹ç›®jaråŒ…å†…åµŒæœåŠ¡å™¨, ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªè¦å®‰è£…äº†Java(æ¯”å¦‚Java8ä»¥ä¸Š), é‚£æˆ‘ä»¬å°±å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„Spring Booté¡¹ç›®äº†, ä¸ç”¨é¢å¤–å®‰è£…Tomcatäº†,\né¦–å…ˆå¾—å…ˆæ‰“åŒ…æˆ‘ä»¬çš„é¡¹ç›®å§, åœ¨Spring Bootæ ¹ç›®å½•è¿è¡Œmvn clean install\nç„¶åæŠ¥é”™ (ä¸å‡ºä¸€ç‚¹å²”å­å°±ä¸æ­£å¸¸äº†, å†™ä»£ç å˜›),\n1 [ERROR] Failed to execute goal org.springframework.boot:spring-boot-maven-plugin:2.3.5.RELEASE:repackage (repackage) on project SpringDemo: Execution repackage of goal org.springframework.boot:spring-boot-maven-plugin:2.3.5.RELEASE:repackage failed: Unsupported class file major version 61 -\u0026gt; [Help 1] ç„¶åä»”ç»†çœ‹äº†ä¸€ä¸‹å‘ç°ä¸Šé¢è¯´org.springframework.boot:spring-boot-maven-plugin:2.3.5.RELEASE:repackage failed, å¥½ç†Ÿæ‚‰, å¥½åƒæ˜¯ä¹‹å‰åˆšå¼€å§‹åˆå§‹åŒ–Spring Booté¡¹ç›®çš„æ—¶å€™IDEAæç¤ºpom.xmlæœ‰é”™è¯¯(å‡ºç°æ›²çº¿ä¸‹åˆ’çº¿é‚£ç§é”™, ä¸æ˜¯è¿è¡ŒæŠ¥é”™), å‡ºå»å¼ºè¿«ç—‡æƒ³è§£å†³å®ƒ,ç„¶ååœ¨StackOverflowåœ¨å“ªæŸ¥åˆ°æ·»åŠ ä¸Šç‰ˆæœ¬ä¿¡æ¯å°±ä¸ä¼šæç¤ºé”™è¯¯äº†, äºæ˜¯æˆ‘åŠ äº†ä¸€è¡Œ\u0026lt;version\u0026gt;2.3.5.RELEASE\u0026lt;/version\u0026gt;, å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.5.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; åŠ äº†ç‰ˆæœ¬ä¿¡æ¯åç¡®å®é‚£ä¸ªçº¢è‰²æ›²çº¿æ¶ˆå¤±, ä¹Ÿæ²¡å½±å“æˆ‘ç¨‹åºçš„æ­£å¸¸è¿è¡Œ(å³åœ¨IDEAç‚¹å‡»è¿è¡ŒæŒ‰é’®é‚£ä¸ªæ–œä¸‰è§’æŒ‰é’®), ä½†æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œmvn clean installå°±å‡ºç°äº†åˆšåˆšçš„é”™è¯¯, æ‰€ä»¥æˆ‘æŠŠç‰ˆæœ¬ä¿¡æ¯å»æ‰äº†ç„¶åæ›´æ–°pom.xml, ç„¶åmvn clean installæ­£å¸¸è¿è¡Œ,\n1 2 3 4 5 6 7 8 ..... [INFO] Installing /Users/David/Codes/IDEA/SpringDemo/target/SpringDemo-0.0.1-SNAPSHOT.jar to /Users/David/.m2/repository/com/choo/SpringDemo/0.0.1-SNAPSHOT/SpringDemo-0.0.1-SNAPSHOT.jar [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 4.091 s [INFO] Finished at: 2023-04-29T16:22:17-03:00 [INFO] ------------------------------------------------------------------------ æ³¨æ„ä¸Šé¢jaråŒ…è¾“å‡ºè·¯å¾„, ç„¶åè¿›å…¥åˆ°ç”Ÿæˆçš„jaråŒ…çš„è·¯å¾„é‡Œ, è¿è¡ŒjaråŒ…(è¿è¡Œä¹‹å‰ç¡®ä¿ä½ çš„æ•°æ®åº“æœåŠ¡å·²ç»æ­£ç¡®å¼€å¯, å¯ä»¥æ­£å¸¸è¿æ¥, å¦‚ä½ ä½¿ç”¨äº†MySQLæœåŠ¡),\n1 java -jar SpringDemo-0.0.1-SNAPSHOT.jar å–å†³äºä½ é¡¹ç›®çš„REST APIæ€ä¹ˆè®¾è®¡çš„, ç„¶åå»æµè§ˆå™¨è®¿é—®http://localhost:8080/find/temperature?from=2023-04-01\u0026amp;to=2023-04-02, å¾—åˆ°å¦‚ä¸‹æ•°æ®, è®¿é—®æˆåŠŸ:\n1 [{\u0026#34;id\u0026#34;:1,\u0026#34;value\u0026#34;:27.5,\u0026#34;createdDate\u0026#34;:\u0026#34;2023-04-01T14:54:26\u0026#34;},{\u0026#34;id\u0026#34;:2,\u0026#34;value\u0026#34;:28.5,\u0026#34;createdDate\u0026#34;:\u0026#34;2023-04-01T20:42:50\u0026#34;},{\u0026#34;id\u0026#34;:3,\u0026#34;value\u0026#34;:20.6,\u0026#34;createdDate\u0026#34;:\u0026#34;2023-04-02T11:09:26\u0026#34;},{\u0026#34;id\u0026#34;:4,\u0026#34;value\u0026#34;:30.6,\u0026#34;createdDate\u0026#34;:\u0026#34;2023-04-02T15:32:39\u0026#34;}] ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨wgetå‘é€GETè¯·æ±‚,\n1 wget \u0026#34;http://localhost:8080/find/temperature?from=2023-04-01\u0026amp;to=2023-04-02\u0026#34; æ€»ç»“ä¸‹, è¿™æ¬¡è®¨è®ºæˆ‘ä»¬ç†è§£äº†Jaræ˜¯ä»€ä¹ˆ, ä¹ŸçŸ¥é“äº†ä»€ä¹ˆæ˜¯æ‰€è°“çš„å†…åµŒTomcat, å¯ä»¥çœ‹åˆ°è¿è¡ŒJaråŒ…å¹¶ä¸æ˜¯åƒä¹‹å‰è®¨è®ºWaré‚£æ ·, è¿˜å¾—æŠŠWaréƒ¨ç½²åˆ°Tomcatçš„webappsç›®å½•ä¸‹, ç„¶åå¯åŠ¨Tomcat, å†å»è®¿é—®å¯¹åº”url, æˆ‘ä»¬ç›´æ¥ä¸€ä¸ªjava -jarä¾¿å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„Java Webé¡¹ç›®, å¯è°“æ˜¯å¾ˆæ–¹ä¾¿, ä½†æ˜¯éœ€è¦æ³¨æ„å¦‚æœä½ çš„åº”ç”¨ç”¨åˆ°äº†æ•°æ®åº“, é‚£ä½ ä»éœ€è¦åœ¨ä½ æ‰§è¡Œè¯¥åº”ç”¨çš„æœºå™¨ä¸Šå¼€å¯å¯¹åº”çš„æ•°æ®åº“æœåŠ¡ä»¥åŠåˆ›å»ºå¯¹åº”çš„è¡¨, è¿™è·Ÿtomcatæ²¡å…³ç³», SpringBootåªæ˜¯å†…åµŒäº†Tomcatå¹¶ä¸æ˜¯å†…åµŒäº†ä½ çš„æ•°æ®åº“å•¥çš„,\nç„¶åæˆ‘ä»¬ä¹Ÿå°±çŸ¥é“åˆ«äººæ‰€è¯´çš„é‚£ç§, Spring Bootå†…åµŒTomcat, ç„¶åé»˜è®¤é¡¹ç›®æ‰“åŒ…æˆJarè€Œä¸æ˜¯Waråˆ°åº•æ˜¯ä¸ªä»€ä¹ˆç©æ„, å³å°±æ˜¯æŠŠæ‰€æœ‰ä¾èµ–å’Œæ‰€æœ‰æˆ‘ä»¬ç¼–å†™çš„æºä»£ç çš„å­—èŠ‚ç .classæ–‡ä»¶é€šè¿‡çº¦å®šå¥½çš„ç›®å½•ç»“æ„æ”¾åˆ°ä¸€èµ·, ç„¶åæ‰“åŒ…æˆä¸€ä¸ªjar, ä¸Šé¢è¯´åˆ°çš„ä¾èµ–æ¯”å¦‚pom.xmlä¸­çš„å„ç§ä¾èµ–ä»¥jaræ–‡ä»¶æ ¼å¼æ”¾åˆ°SpringDemo-0.0.1-SNAPSHOT/BOOT-INF/libç›®å½•ä¸‹, ç„¶å.classæ–‡ä»¶éƒ½åœ¨SpringDemo-0.0.1-SNAPSHOT/BOOT-INF/classesä¸‹, å½“ç„¶å¯èƒ½è¿˜åŒ…å«å…¶ä»–çš„æ–‡ä»¶, è¿™ä½ è‡ªå·±å»æ¢ç´¢å§,\næœ€åçœ‹ä¸€ä¸‹é¡¹ç›®ç”Ÿæˆçš„Jarçš„ç»“æ„(ä¾èµ–å¤ªå¤šäº†, åˆ é™¤äº†ä¸€éƒ¨åˆ†):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 . â”œâ”€â”€ BOOT-INF â”‚ â”œâ”€â”€ classes â”‚ â”‚ â”œâ”€â”€ application.properties â”‚ â”‚ â”œâ”€â”€ com â”‚ â”‚ â”‚ â””â”€â”€ choo â”‚ â”‚ â”‚ â””â”€â”€ springdemo â”‚ â”‚ â”‚ â”œâ”€â”€ SpringDemoApplication.class â”‚ â”‚ â”‚ â”œâ”€â”€ Temperature.class â”‚ â”‚ â”‚ â””â”€â”€ TemperatureRepository.class â”‚ â”‚ â””â”€â”€ static â”‚ â”‚ â””â”€â”€ index.html â”‚ â”œâ”€â”€ classpath.idx â”‚ â”œâ”€â”€ layers.idx â”‚ â””â”€â”€ lib â”‚ â”œâ”€â”€ HikariCP-5.0.1.jar â”‚ â”œâ”€â”€ angus-activation-2.0.0.jar â”‚ â”œâ”€â”€ antlr4-runtime-4.10.1.jar â”‚ â”œâ”€â”€ spring-jcl-6.0.7.jar â”‚ â”œâ”€â”€ spring-jdbc-6.0.7.jar â”‚ â”œâ”€â”€ spring-orm-6.0.7.jar â”‚ â”œâ”€â”€ spring-tx-6.0.7.jar â”‚ â”œâ”€â”€ spring-web-6.0.7.jar â”‚ â”œâ”€â”€ spring-webmvc-6.0.7.jar â”‚ â”œâ”€â”€ tomcat-embed-core-10.1.7.jar â”‚ â”œâ”€â”€ tomcat-embed-el-10.1.7.jar â”‚ â”œâ”€â”€ tomcat-embed-websocket-10.1.7.jar å…¶å®æœ‰æ—¶å€™å¯¹äºä¸€äº›æ¦‚å¿µåŒºåˆ«, è¯»å¾ˆå¤šæ–‡ç« åšå®¢ä¸å¦‚å»è‡ªå·±å®æ“ä¸€é, è¯»å¤šäº†å¯èƒ½è§‰å¾—è‡ªå·±ä¼šäº†ç†è§£äº†, ä½†è¿˜æ˜¯ä¼šäº‘é‡Œé›¾é‡Œ, å› ä¸ºæœ‰çš„è¯´çš„å¾ˆæ³›, æ€»ä¹‹åˆ«å«Œéº»çƒ¦, å¤šåŠ¨æ‰‹,\n","date":"2023-04-28T15:02:55Z","permalink":"https://blog.yorforger.cc/p/spring-boot%E4%B9%8B%E4%BD%95%E4%B8%BA%E5%86%85%E5%B5%8Ctomcat/","title":"Spring Bootä¹‹ä½•ä¸ºå†…åµŒTomcat"},{"content":"Web application resources or web application archives are commonly called WAR files. A WAR file is used to deploy a Java EE web application in an application server. Inside a WAR file, all the web components are packed into one single unit. These include JAR files, JavaServer Pages, Java servlets, Java class files, XML files, HTML files, and other resource files that we need for web applications. We can use the Maven WAR plugin to build our project as a WAR file.\n# Step 1: Add a new user with deployment rights to Tomcat To perform a Maven Tomcat deploy of a WAR file you must first set up a user in Tomcat with the appropriate rights. You can do this with an edit of the tomcat-users.xml file, which can be found in Tomcat\u0026rsquo;s conf sub-directory. Add the following entry inside the tomcat-users tag:\n1 \u0026lt;user username=\u0026#34;war-deployer\u0026#34; password=\u0026#34;maven-tomcat-plugin\u0026#34; roles=\u0026#34;manager-gui, manager-script, manager-jmx\u0026#34; /\u0026gt; Save the tomcat-users.xml file and restart the server to have the changes take effect.\né‡å¯Tomcatå°±æ˜¯è¿›åˆ°Tomcatçš„binç›®å½•ä¸‹, æ‰§è¡Œstartup.sh, ./shutdown.sh, å…¶å®ä½ ç›´æ¥ä½¿ç”¨startup.shå‘½ä»¤å¼€å¯TomcatæœåŠ¡å°±ä¼šåŠ è½½é…ç½®æ–‡ä»¶äº†, ä¸Šé¢è¯´çš„é‡å¯æ˜¯é»˜è®¤ä½ çš„Tomcatä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€. ç°åœ¨ä½ ä¹Ÿåº”è¯¥å¯åŠ¨TomcatæœåŠ¡äº†, å¯åŠ¨åå°è¯•è®¿é—®http://localhost:8080/,\nç‚¹å‡»åè¾“å…¥ä¸Šé¢çš„usernameå’Œå¯¹åº”çš„password, å³å¯è¿›å…¥ç®¡ç†é¡µé¢å¦‚ä¸‹:\n# æ— æ³•è®¿é—® tomcat ä¸»é¡µé—®é¢˜ æˆ‘åœ¨è®¿é—®Tomcatä¸»é¡µå‡ºç°äº†é—®é¢˜, è®¿é—®çš„æ€»æ˜¯æˆ‘ä»¥å‰çš„JSPåº”ç”¨, æˆ‘ç”¨IDEAå¼€å‘çš„, ä½†æˆ‘éƒ½æ²¡æ‰“å¼€IDEA, ä»ç„¶å¯ä»¥è®¿é—®åˆ°, çœŸæ˜¯å¥‡äº†æ€ªäº†, å¦‚ä¸‹:\nç„¶åæˆ‘å°±æŸ¥åˆ°äº†ä¸€ä¸ªåšå®¢è¯´éœ€è¦å°†Tomcatçš„é¦–é¡µçš„å·¥ç¨‹éƒ¨ç½²åˆ°TomcatæœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡IDEAæ¥æ“ä½œ, éƒ¨ç½²æ­¥éª¤å¦‚ä¸‹ï¼š\né€‰æ‹©èœå•æ â€œRun\u0026ndash;\u0026gt;Edit Configuration\u0026hellip;\u0026ndash;\u0026gt;Deploymentâ€, é€‰æ‹©å³ä¸Šè§’ç»¿è‰²â€œ+â€ï¼Œé€‰æ‹©â€œExternal Source\u0026hellip;â€ï¼Œå°†Apache-tomcatçš„webappsç›®å½•ä¸‹çš„ROOTæ–‡ä»¶å¤¹æ·»åŠ è¿›æ¥, ä¸‹é¢çš„Application Context ç©ºç€, åˆ é™¤ ROOT ä¸‹é¢çš„é‚£ä¸ªServletDemo:war exploded, å¦‚ä¸‹å›¾:\nç„¶åæˆ‘IDEAä¸Šé€‰æ‹©çš„TomcatæœåŠ¡å™¨ä¸æ˜¯æˆ‘ç°åœ¨ç”¨çš„, æˆ‘æœ‰ä¸ªæ—§çš„TomcatæœåŠ¡å™¨, æˆ‘ä¸çŸ¥é“, ç„¶åIDEAç”¨çš„ä¸€ç›´æ˜¯é‚£ä¸ªæ—§çš„(ä½†æˆ‘åœ¨ä¸Šé¢éƒ¨ç½²ä½ç½®çš„ROOTæ–‡ä»¶å¤¹é€‰æ‹©çš„æ˜¯æ–°çš„Tomcatä¸‹çš„æ–‡ä»¶), æ‰€ä»¥å°±å¯¼è‡´å°±ç®—éƒ¨ç½²é¡¹ç›®å, æˆ‘ä¾ç„¶æ— æ³•è®¿é—®Tomcatçš„ä¸»é¡µ. æ‰€ä»¥æ£€æŸ¥ä¸€ä¸‹ä½ æ˜¯å¦é€‰æ‹©äº†æ­£ç¡®çš„TomcatæœåŠ¡å™¨,\nè¿™æ ·é…ç½®å¥½åå†åœ¨IDEAç‚¹å‡»è¿è¡Œ, å°±å¯ä»¥é€šè¿‡http://localhost:8080/è®¿é—® Tomcat ä¸»é¡µäº†, ä¹‹åä½ å…³é—­IDEA, ç›´æ¥è¿›å…¥Tomcatæ ¹ç›®å½•çš„binä¸‹é€šè¿‡æ‰§è¡Œstartup.shæ¥å¯åŠ¨Tomcat.\næœ‰æ—¶å€™ä½ ä¼šé‡åˆ°å…¶ä»–æƒ…å†µ, æ¯”å¦‚8080ç«¯å£è¢«å ç”¨, è¿™æ—¶å€™è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•\n1 2 3 4 # æŸ¥çœ‹PID lsof -n -i4TCP:8080 # åˆ é™¤8080ç«¯å£å¯¹åº”çš„PID kill -9 PID è¯´äº†é‚£ä¹ˆå¤šç»ˆäºè¦è¿›è¡Œä¸‹ä¸€æ­¥äº†,\n# Step 2: Tell Maven about the Tomcat deploy user After you add the war-deployer user to Tomcat, register that username and password in Maven, along with a named reference to the server. The Maven-Tomcat plugin will use this information when it tries to connect to the application server. Edit the settings.xml file and add the following entry within the \u0026lt;server\u0026gt; tag to create the named reference to the server:\n1 2 3 4 5 6 \u0026lt;!-- Configure the Tomcat Maven plugin user --\u0026gt; \u0026lt;server\u0026gt; \u0026lt;id\u0026gt;maven-tomcat-war-deployment-server\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;username\u0026gt;war-deployer\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;maven-tomcat-plugin\u0026lt;/password\u0026gt; \u0026lt;/server\u0026gt; æ³¨æ„, ä¸Šé¢æåˆ°çš„settings.xmlæ–‡ä»¶åœ¨Downloads/apache-maven-3.9.1/confä¸‹, æ ¹æ®ä½ çš„mavenå®‰è£…ç›®å½•æŸ¥æ‰¾,\nå¦å¤–è¿™é‡ŒåŠ çš„è´¦å·å¯†ç å°±æ˜¯ä¸Šé¢åœ¨Tomcatæ·»åŠ ç”¨æˆ·æ—¶å€™çš„è´¦å·å¯†ç , è¿™æ˜¯å› ä¸ºä½ è¿›å…¥Tomcatç®¡ç†é¡µé¢çš„æ—¶å€™éœ€è¦,å¦‚æœä½ ä¸æä¾›(ä¸‹é¢é…ç½®pom.xmlä¹Ÿä¼šè¯´åˆ°), é‚£ç”Ÿæˆwaræ–‡ä»¶çš„æ—¶å€™mavenå°±ä¼šæŠ¥é”™,\n# Step 3: Register the tomcat7-maven-plugin in the POM æŠŠæ‰“åŒ…æ ¼å¼æ”¹æˆwar, å³åœ¨pom.xmlä¸­æ‰¾åˆ°\u0026lt;packaging\u0026gt;æ ‡ç­¾, æ²¡æœ‰çš„è¯æ·»åŠ ä¸€ä¸ª, ä¸\u0026lt;dependencies\u0026gt;æ ‡ç­¾å¹¶åˆ—:\n1 2 3 4 5 \u0026lt;groupId\u0026gt;com.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ServletDemo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;ServletDemo\u0026lt;/name\u0026gt; \u0026lt;packaging\u0026gt;war\u0026lt;/packaging\u0026gt; Now that Maven and Tomcat are configured, the next step is to edit the Java web application\u0026rsquo;s POM file to reference the Tomcat Maven plugin.\n1 2 3 4 5 6 7 8 9 \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.tomcat.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;tomcat7-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;url\u0026gt;http://localhost:8080/manager/text\u0026lt;/url\u0026gt; \u0026lt;path\u0026gt;/rps\u0026lt;/path\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; è¿è¡Œmvn install tomcat7:deployç”Ÿæˆwarçš„æ—¶å€™æ€»æ˜¯æŠ¥é”™(å¦‚æœä½ ä¹‹å‰å·²ç»ç”Ÿæˆäº†Waræ–‡ä»¶, è¯·è®°å¾—å»Tomcatæ ¹ç›®å½•ä¸‹çš„webappç›®å½•ä¸‹åˆ é™¤ä¸€ç”Ÿæˆçš„waræ–‡ä»¶, å¦åˆ™ä¹Ÿä¼šæŠ¥é”™, å’Œä¸‹é¢ä¸€æ ·):\n1 2 3 4 5 6 7 [ERROR] Failed to execute goal org.apache.tomcat.maven:tomcat7-maven-plugin:2.0:deploy (default-cli) on project ServletDemo: Cannot invoke Tomcat manager: Broken pipe -\u0026gt; [Help 1] [ERROR] [ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch. [ERROR] Re-run Maven using the -X switch to enable full debug logging. [ERROR] [ERROR] For more information about the errors and possible solutions, please read the following articles: [ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException åŠ å…¥æˆ‘ä»¬åœ¨Tomcat Usersé‡Œé…ç½®çš„è´¦å·å¯†ç :\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.tomcat.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;tomcat7-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;url\u0026gt;http://localhost:8080/manager/text\u0026lt;/url\u0026gt; \u0026lt;path\u0026gt;/rps\u0026lt;/path\u0026gt; \u0026lt;username\u0026gt;war-deployer\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;maven-tomcat-plugin\u0026lt;/password\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; æ³¨æ„: ä¿®æ”¹pom.xmlåéœ€è¦æ›´æ–°pom.xml\næç¤º: ç‚¹å‡»IDEAè½¯ä»¶çš„å³ä¸Šè§’æœ‰ä¸ªæµ®åŠ¨çš„æ›´æ–°å°æŒ‰é’®å³æ›´æ–°, æˆ–è€…ä½ å¯ä»¥æŸ¥æŸ¥å‘½ä»¤è¡Œmavenæ€ä¹ˆæ›´æ–°pom.xmlæ–‡ä»¶.\nç„¶åé‡æ–°è¿è¡Œmvn install tomcat7:deploy, æˆåŠŸ:\nç„¶åå»Tomcatæ ¹ç›®å½•çš„webappsä¸‹æŸ¥çœ‹ç”Ÿæˆçš„War, å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†åä¸ºrpsçš„webåº”ç”¨, å³è¿™ä¸ªåå­—å–å†³äºä¸Šé¢pom.xmlå¡«çš„å†…å®¹,\nç„¶åæˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ç”Ÿæˆçš„warä¸æˆ‘ä»¬çš„æºä»£ç æ–‡ä»¶ç»“æ„:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 #æºä»£ç  . â”œâ”€â”€ pom.xml â”œâ”€â”€ src â”‚Â â””â”€â”€ main â”‚Â â”œâ”€â”€ java â”‚Â â”‚Â â”œâ”€â”€ database â”‚Â â”‚Â â””â”€â”€ servlet â”‚Â â”œâ”€â”€ resources â”‚Â â”‚Â â””â”€â”€ log4j.properties â”‚Â â””â”€â”€ webapp â”‚Â â”œâ”€â”€ WEB-INF â”‚Â â”œâ”€â”€ hello.jsp â”‚Â â””â”€â”€ index.jsp # War . â”œâ”€â”€ META-INF â”‚Â â”œâ”€â”€ MANIFEST.MF â”‚Â â”œâ”€â”€ maven â”‚Â â”‚Â â””â”€â”€ com.example â”‚Â â”‚Â â””â”€â”€ ServletDemo â”‚Â â””â”€â”€ war-tracker â”œâ”€â”€ WEB-INF â”‚Â â”œâ”€â”€ classes â”‚Â â”‚Â â”œâ”€â”€ database â”‚Â â”‚Â â”‚Â â”œâ”€â”€ Controller.class â”‚Â â”‚Â â”‚Â â”œâ”€â”€ DataEntity.class â”‚Â â”‚Â â”‚Â â”œâ”€â”€ Database.class â”‚Â â”‚Â â”‚Â â””â”€â”€ MysqlDatabase.class â”‚Â â”‚Â â”œâ”€â”€ log4j.properties â”‚Â â”‚Â â”œâ”€â”€ servlet â”‚Â â”‚Â â”‚Â â”œâ”€â”€ GetDataServlet$1.class â”‚Â â”‚Â â”‚Â â””â”€â”€ GetDataServlet.class â”‚Â â”‚Â â””â”€â”€ test â”‚Â â”œâ”€â”€ lib â”‚Â â”‚Â â”œâ”€â”€ gson-2.9.0.jar â”‚Â â”‚Â â”œâ”€â”€ log4j-1.2.17.jar â”‚Â â”‚Â â”œâ”€â”€ mysql-connector-j-8.0.32.jar â”‚Â â”‚Â â””â”€â”€ protobuf-java-3.21.9.jar â”‚Â â””â”€â”€ web.xml â”œâ”€â”€ hello.jsp â””â”€â”€ index.jsp å¯¹äºç”Ÿæˆçš„Waræ–‡ä»¶å¯ä»¥å‘ç°æ‰€æœ‰Javaç›¸å…³çš„æ–‡ä»¶éƒ½åœ¨WEB-INFä¸‹, æ¯”å¦‚æˆ‘ä»¬ç¼–å†™çš„Servletå­—èŠ‚ç æ–‡ä»¶å’Œå’Œæˆ‘ä»¬ç”¨åˆ°çš„ä¾èµ–(gson, mysql connector, log4j). ç„¶åä»”ç»†çœ‹æºä»£ç æ–‡ä»¶ç»“æ„, åœ¨webappä¸‹ä¹Ÿæœ‰ä¸ªWEB-INF, è¿™ä¸‹é¢æ”¾çš„å°±æ˜¯æˆ‘ä»¬é¡¹ç›®çš„web.xml, å†…å®¹å¦‚ä¸‹(æ‰€ä»¥è¿™æœ‰ä»€ä¹ˆè”ç³»å‘¢),\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;web-app xmlns=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\u0026#34; version=\u0026#34;4.0\u0026#34;\u0026gt; \u0026lt;welcome-file-list\u0026gt; \u0026lt;welcome-file\u0026gt;/index.jsp\u0026lt;/welcome-file\u0026gt; \u0026lt;/welcome-file-list\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;get-data\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;servlet.GetDataServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;get-data\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/temperature/*\u0026lt;/url-pattern\u0026gt; \u0026lt;url-pattern\u0026gt;/humidity/*\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;/web-app\u0026gt; # FInal Step: Verify ç¡®ä¿ä½ å·²ç»å¼€å¯TomcatæœåŠ¡(å³ä½¿ä½ å…³é—­äº†IDEA, IDEAå’ŒTomcatæ˜¯ä¸¤ä¸ªä¸œè¥¿, IDEAæ˜¯ä¸ªIDEä¼šç”¨åˆ°Tomcatä½œä¸ºwebæœåŠ¡å™¨æ¥éƒ¨ç½²web app), ç„¶åè®¿é—®é€šè¿‡http://localhost:8080/è®¿é—®åˆ°Tomcatä¸»é¡µ, è¿™æ—¶å€™ä½ å¯ä»¥åœ¨é“¾æ¥ğŸ”—ååŠ ä¸Š/rpså³http://localhost:8080/rps/å°±å¯ä»¥è¿›å…¥åˆ°ä½ çš„é‚£ä¸ªwebç½‘é¡µ, å¦‚ä¸‹:\n# æ€è€ƒæ€»ç»“ è¿™æ—¶å€™å…¶å®æˆ‘ä»¬ä¹Ÿå°±çŸ¥é“äº†ä»€ä¹ˆæ˜¯æ ¹ç›®å½•å’Œurlä¸­ç¥ç§˜çš„è·¯å¾„é—®é¢˜, ä½ çœ‹æˆ‘ä»¬è‹¥æƒ³è®¿é—®manageré¡µé¢, è¿™ä¸ªé¡µé¢çš„urlæ˜¯http://localhost:8080/manager/, æˆ‘ä»¬è®¿é—®æˆ‘ä»¬åˆšéƒ¨ç½²çš„é¡µé¢æ˜¯http://localhost:8080/rps/, ä½ çœ‹æœ€åçš„è¿™ä¸ªè·¯å¾„åŠ/manager, /rpséƒ½æ˜¯tomcatçš„webappsç›®å½•ä¸‹çš„æ–‡ä»¶, å¦‚ä¸‹:\n1 2 3 4 # David @ tc0db in ~/Downloads/Programs/apache-tomcat-9.0.73/webapps $ ls ROOT examples manager rps.war docs host-manager rps æ‰€ä»¥webappå°±æ˜¯æ‰€è°“çš„æ ¹ç›®å½•, æˆ‘ä»¬è®¿é—®ä»€ä¹ˆéƒ½æ˜¯æ ¹æ®å®ƒæ¥çš„, å¯ä»¥çœ‹åˆ°, webappsç›®å½•ä¸‹è¿˜æœ‰examplesç­‰æ–‡ä»¶å¤¹, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡http://localhost:8080/example/è®¿é—®. ä½†æ˜¯åˆæœ‰ä¸ªé—®é¢˜, Tomcatçš„ä¸»é¡µä¹Ÿå°±æ˜¯æ˜¯http://localhost:8080/å…·ä½“åœ¨å“ªå‘¢? æŒ‰ç†è¯´webappsä¸‹åº”è¯¥æœ‰ä¸ªindex.htmlæ–‡ä»¶å‘€, å¯æ˜¯å´ç©ºç©º, è¿™æ˜¯æ€ä¹ˆå›äº‹, æ€ä¹ˆæ²¡æœ‰æŒ‰æˆ‘ä»¬ä¸Šé¢æ¨å¯¼çš„è·¯å¾„æ¥å‘¢?\nè¿˜è®°ä¸è®°å¾—å½“æ—¶å­¦ä¹ servletçš„æ—¶å€™æœ‰ä¸ªweb.xmlæ–‡ä»¶, æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå¯ä»¥é…ç½®ä¸ªwelcomeæ ‡ç­¾, é€šè¿‡è¿™ä¸ªæ ‡ç­¾æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æŒ‡å®šä¸€ä¸ªhtmlæ–‡ä»¶ä½œä¸ºæˆ‘ä»¬çš„ä¸»é¡µè€Œä¸æ˜¯æ ¹ç›®å½•ä¸‹çš„index.tmlæ–‡ä»¶, åŒæ ·, Tomcatå½“ç„¶ä¹Ÿæœ‰è¿™ä¸ªæ–‡ä»¶ TOMCAT_HOME/conf/web.xml, æœç´¢welcomeæ‰¾åˆ°å•¦(åœ¨tomcat/webapps/ROOT/index.jsp):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;!-- ==================== Default Welcome File List ===================== --\u0026gt; \u0026lt;!-- When a request URI refers to a directory, the default servlet looks --\u0026gt; \u0026lt;!-- for a \u0026#34;welcome file\u0026#34; within that directory and, if present, to the --\u0026gt; \u0026lt;!-- corresponding resource URI for display. --\u0026gt; \u0026lt;!-- If no welcome files are present, the default servlet either serves a --\u0026gt; \u0026lt;!-- directory listing (see default servlet configuration on how to --\u0026gt; \u0026lt;!-- customize) or returns a 404 status, depending on the value of the --\u0026gt; \u0026lt;!-- listings setting. --\u0026gt; \u0026lt;!-- --\u0026gt; \u0026lt;!-- If you define welcome files in your own application\u0026#39;s web.xml --\u0026gt; \u0026lt;!-- deployment descriptor, that list *replaces* the list configured --\u0026gt; \u0026lt;!-- here, so be sure to include any of the default values that you wish --\u0026gt; \u0026lt;!-- to use within your application. --\u0026gt; \u0026lt;welcome-file-list\u0026gt; \u0026lt;welcome-file\u0026gt;index.html\u0026lt;/welcome-file\u0026gt; \u0026lt;welcome-file\u0026gt;index.htm\u0026lt;/welcome-file\u0026gt; \u0026lt;welcome-file\u0026gt;index.jsp\u0026lt;/welcome-file\u0026gt; \u0026lt;/welcome-file-list\u0026gt; ç„¶åæ€ä¹ˆè¦†ç›–è¿™ä¸ªhome pageå‘¢? åˆšå¥½çœ‹åˆ°äº†ä¸‹é¢è¿™ä¸ªå›ç­”, çœ‹æ¥å’Œæˆ‘ä»¬çŒœæƒ³çš„ä¸€æ ·, å¦‚ä¸‹:\nIn any web application, there will be a web.xml in the WEB-INF/ folder. (åˆ«å¿˜äº†æˆ‘ä»¬ä¹‹å‰å­¦ä¹ JSPçš„æ—¶å€™å¯æ²¡å°‘åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹èŠ±æ—¶é—´å»é…ç½®servlet nameå’Œå¯¹åº”çš„jsp, æ¯åˆ›å»ºä¸€ä¸ªæ–°çš„servletå°±è¦åœ¨è¿™åˆ›å»ºä¸ªæ–°çš„servlet pattern)\nIf you dont have one in your web app, as it seems to be the case in your folder structure, the default Tomcat web.xml is under TOMCAT_HOME/conf/web.xml\nEither way, the relevant lines of the web.xml are\n1 2 3 4 5 \u0026lt;welcome-file-list\u0026gt; \u0026lt;welcome-file\u0026gt;index.html\u0026lt;/welcome-file\u0026gt; \u0026lt;welcome-file\u0026gt;index.htm\u0026lt;/welcome-file\u0026gt; \u0026lt;welcome-file\u0026gt;index.jsp\u0026lt;/welcome-file\u0026gt; \u0026lt;/welcome-file-list\u0026gt; so any file matching this pattern when found will be shown as the home page.\nIn Tomcat, a web.xml setting within your web app will override the default, if present.\nFurther Reading: How do I override the default home page loaded by Tomcat?\nå‚è€ƒ:\nStep-by-step Maven Tomcat WAR file deploy example | TheServerSide tomcatå¯åŠ¨æˆåŠŸæµè§ˆå™¨å´æ— æ³•è®¿é—® - æ˜é‡‘ web applications - How does Tomcat find the HOME PAGE of my Web App? - Stack Overflow Generate a WAR File in Maven | Baeldung ","date":"2023-04-27T21:30:48Z","permalink":"https://blog.yorforger.cc/p/%E6%89%8B%E5%8A%A8%E9%83%A8%E7%BD%B2war%E5%8C%85%E5%88%B0tomcat%E4%B9%8B%E4%BD%95%E4%B8%BAwar/","title":"æ‰‹åŠ¨éƒ¨ç½²WaråŒ…åˆ°Tomcatä¹‹ä½•ä¸ºWar"},{"content":" # é—®é¢˜æè¿°: è¿™å‡ å¤©å¼„æœåŠ¡å™¨, ç”¨sshé€šè¿‡åŸŸåè¿æ¥çš„æ—¶å€™æ€»æ˜¯å‡ºç°è¶…æ—¶(åŸŸååªæœ‰ä¸€ä¸ªAè®°å½•å³æœåŠ¡å™¨IP), é—®é¢˜ä¸‹é¢æ˜¯åˆ†ææ€è·¯,\nI\u0026rsquo;m trying to use ssh to connect my server with my domain name ssh root@www.davidzhu.xyz, but I always get timeout. However I can connect my server when use my server ip directly ssh root@144.202.12.32, so I use dig to check the ip address of my domain on DNS, the output is:\n1 2 3 4 5 6 7 dig davidzhu.xyz +short 172.67.210.8 104.21.50.195 dig www.davidzhu.xyz +short 172.67.210.8 104.21.50.195 But I only have one A record on my domain, this is the DNS Record of my domain name (the third one is about the google search console):\næƒŠä¸æƒŠè®¶, digè¿”å›çš„ä¸¤ä¸ªIPåœ°å€ç«Ÿç„¶éƒ½ä¸æˆ‘åŸŸåçš„Aè®°å½•ä¸åŒ!\n# æ›´æ–°: åŸå› æ˜¯æˆ‘çš„åŸŸåå¼€å¯äº† Cloudfalre çš„ reverse proxy, é€šè¿‡åŸŸåè·å–åˆ°çš„æ˜¯ Clouflare çš„IP, æ— æ³•è®¿é—®åˆ°æˆ‘æœåŠ¡å™¨çœŸå®IP:\nWhen you add your application to Cloudflare, we use this network to sit in between requests and your origin server.\nCloudflare does this by serving as a reverse proxy for your web traffic. All requests to and from your origin flow through Cloudflare and â€” as these requests pass through our network â€” we can apply various rules and optimizations to improve security, performance, and reliability.\nå…³é—­ Cloudflare åå‘ä»£ç†å°±å¯ä»¥é€šè¿‡åŸŸåè·å–åˆ°æœåŠ¡å™¨çœŸå®IPäº†:\næ­¤æ—¶å¯ä»¥çœ‹åˆ°ç°å® DNS Only, ä½¿ç”¨ dig xxx.com +short å³å¯æŸ¥åˆ°çœŸå®ç»‘å®š ip, æˆ–è€… ping ä¹Ÿå¯ä»¥.\nå¦å¤–é€šè¿‡Cloudflare åŸŸåæ‰˜ç®¡æœºåˆ¶(å°±æ˜¯ç°åœ¨æˆ‘ä»¬æ“ä½œçš„, ä¸­æ–‡é‡Œéƒ½å«æ‰˜ç®¡æ›´åˆé€‚, å› ä¸ºä»–ä¼šæ¥ç®¡é€šå¾€æˆ‘ä»¬åŸŸåçš„æ‰€æœ‰æµé‡), å°±æ˜¯åŸŸåè¢« Cloudflare æ‰˜ç®¡(Domain Hosting)å, è‹¥æƒ³æ›´æ¢åŸŸåçš„ DNS Record, åªéœ€è¦åœ¨ä¸Šå›¾ä¸­çš„ edit ä¸Šä¿®æ”¹ A record å°±è¡Œäº†, å°±æ˜¯æ”¹æˆä½ çš„æ–°çš„ VPS(æœåŠ¡å™¨) çš„ ipv4 åœ°å€, ä¸ç”¨å»åŸŸåæœåŠ¡å•†é‚£é‡Œä¿®æ”¹ DNS Record äº†, å› ä¸ºåœ¨æŠŠåŸŸåæ‰˜ç®¡ç»™ Cloudflare çš„æ—¶å€™å·²ç»åœ¨åŸŸåæä¾›å•†é‚£é‡ŒæŠŠåŸŸåçš„ DNS æœåŠ¡å™¨è®¾ç½®æˆäº† Cloudflare.\nå¦‚ä½•è®© Cloudfalre æ‰˜ç®¡æˆ‘ä»¬çš„åŸŸå:: Enable Coudflare Reverse Proxy - David\u0026rsquo;s Blog\nå¦å¤–å¦‚æœä½¿ç”¨äº† cloudflare https ä»£ç†, ä¸€èˆ¬éƒ½æ˜¯å…ˆä¿®æ”¹åŸŸåçš„ NS ä¸º cloudfalre æŒ‡å®šçš„ NS, ä½†æ˜¯æœ‰äº›ç”µè„‘å¯èƒ½å› ä¸º DNS cache é—®é¢˜, é€šè¿‡ https è®¿é—®ä½ çš„åŸŸåå¯èƒ½ä¼šå¤±è´¥, æ­¤æ—¶åº”è¯¥å°è¯•ä¿®æ”¹æœ¬åœ° DNS cache, å¯ä»¥æŸ¥ä¸€ä¸‹ flush dns cache çš„å‘½ä»¤,\næ³¨æ„, DNS cache ä¸€èˆ¬ chrome ä¿å­˜äº†ä¸€ä»½, æ“ä½œç³»ç»Ÿä¹Ÿä¼šä¿å­˜ä¸€ä»½, å› æ­¤ä¸¤ä¸ªåœ°æ–¹éƒ½è¦è€ƒè™‘è¿›å»,\nå…³äºDNS: DNS Concepts (NameServer(NS), DNS Records and Caching) - David\u0026rsquo;s Blog\näº†è§£æ›´å¤š: HTTPS Works on some computers but not others? - Website, Application, Performance / Security - Cloudflare Community\nå…¶å®è¿™æ ·æœ‰ä¸ªå¥½å¤„, å°±æ˜¯åˆ«äººæ— æ³•é€šè¿‡ä½ çš„åŸŸåæ¥è§¦åˆ°ä½ çš„æœåŠ¡å™¨, å› ä¸ºæ¯æ¬¡è¯·æ±‚ä½ çš„åŸŸå, éƒ½è¦ç»è¿‡ Cloudfalre ä¸­è½¬æ‰èƒ½åˆ°ä½ çš„æœåŠ¡å™¨, å¦å¤–é€šè¿‡nslookup, digä¹Ÿæ— æ³•æŸ¥åˆ°ä½ æœåŠ¡å™¨çš„çœŸå®IP, è¿”å›çš„éƒ½æ˜¯ Cloudflare çš„IP.\nBecause of how Cloudflare works, all traffic to proxied DNS records pass through Cloudflare before reaching your origin server. This means that your origin server will stop receiving traffic from individual visitor IP addresses and instead receive traffic from Cloudflare IP addresses, which are shared by all proxied hostnames.\nCloudflare IPs Â· Getting started Â· Learning paths\n","date":"2023-04-26T17:30:22Z","permalink":"https://blog.yorforger.cc/p/%E5%90%AF%E5%8A%A8cloudflare%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%87%BAa%E8%AE%B0%E5%BD%95%E4%B8%AD%E7%9A%84ip/","title":"å¯åŠ¨Cloudflareä»£ç†å¯¼è‡´æ— æ³•é€šè¿‡åŸŸåè§£æå‡ºAè®°å½•ä¸­çš„IP"},{"content":" JAR stands for Java ARchive. It\u0026rsquo;s a file format based on the popular ZIP file format and is used for aggregating many files into one. Although JAR can be used as a general archiving tool, the primary motivation for its development was so that Java applets and their requisite components (.class files, images and sounds) can be downloaded to a browser in a single HTTP transaction, rather than opening a new connection for each piece. This greatly improves the speed with which an applet can be loaded onto a web page and begin functioning. JAR File Overview\nä¸Šé¢çš„è¯æ˜¯åœ¨è¯´ä¸€äº›Javaç¨‹åº(æ¯”å¦‚ä¸€äº›åº“)ä¼šæœ‰å¾ˆå¤š.classæ–‡ä»¶(å› ä¸ºæœ‰å¾ˆå¤šæºä»£ç .javaå„ç§ç±»)å’Œå…¶ä»–èµ„æºæ–‡ä»¶å¦‚å›¾ç‰‡, å¦‚æœæˆ‘ä»¬æƒ³ç”¨è¿™ä¸ªåº“, å¾—ä¸€ä¸ªä¸€ä¸ªä¸‹è½½è¿™ä¸ªåº“ç”¨åˆ°çš„æ¯ä¸ª.classæ–‡ä»¶(ä¾èµ–ä¹‹ç±»), è¿™å¾ˆéº»çƒ¦.\næ‰€ä»¥Java ARchiveå‡ºç°äº†, æŒ‰ç…§Java ARchiveè§„å®šçš„æ ¼å¼å‹ç¼©æ–‡ä»¶å(ä¹Ÿå°±æ˜¯jaråŒ…), ä½ å¯ä»¥å°†è¿™ä¸ªjaråŒ…ç›´æ¥æ”¾è¿›é¡¹ç›®ç„¶åä½¿ç”¨jaråŒ…ä¸­çš„ç±» (æ³¨æ„jaråŒ…é‡Œå¯èƒ½è¿˜ä¼šæœ‰jaråŒ…, æ¯”å¦‚æœ‰çš„åº“ä¹Ÿä¼šä¾èµ–å…¶ä»–çš„åº“), ä¾èµ–ä¸€èˆ¬æ”¾åœ¨jaråŒ…çš„BOOT-INFæ–‡ä»¶å¤¹çš„libç›®å½•ä¸‹ã€‚è¿™æ˜¯æˆ‘çš„Spring Boot Webé¡¹ç›®å½¢æˆçš„JaråŒ…å¤§è‡´ç»“æ„(æˆ‘åˆ é™¤äº†ä¸€äº›æ–‡ä»¶, å¤ªå¤šäº†):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 . â”œâ”€â”€ BOOT-INF â”‚Â â”œâ”€â”€ classes â”‚Â â”‚Â â”œâ”€â”€ application.properties â”‚Â â”‚Â â”œâ”€â”€ com â”‚Â â”‚Â â”‚Â â””â”€â”€ choo â”‚Â â”‚Â â”‚Â â””â”€â”€ springdemo â”‚Â â”‚Â â”‚Â â””â”€â”€ SpringDemoApplication.class â”‚Â â”‚Â â””â”€â”€ static â”‚Â â”‚Â â””â”€â”€ index.html â”‚Â â”œâ”€â”€ classpath.idx â”‚Â â””â”€â”€ lib â”‚Â â”œâ”€â”€ jackson-annotations-2.14.2.jar â”‚Â â”œâ”€â”€ spring-web-6.0.7.jar â”‚Â â”œâ”€â”€ spring-webmvc-6.0.7.jar â”‚Â â”œâ”€â”€ tomcat-embed-core-10.1.7.jar â”‚Â â””â”€â”€ tomcat-embed-websocket-10.1.7.jar â”œâ”€â”€ META-INF â”‚Â â”œâ”€â”€ MANIFEST.MF â”‚Â â””â”€â”€ maven â”‚Â â””â”€â”€ com.choo â”‚Â â””â”€â”€ SpringDemo â”‚Â â”œâ”€â”€ pom.properties â”‚Â â””â”€â”€ pom.xml â””â”€â”€ org â””â”€â”€ springframework â””â”€â”€ boot â””â”€â”€ loader â”œâ”€â”€ ClassPathIndexFile.class â”œâ”€â”€ ExecutableArchiveLauncher.class â”œâ”€â”€ JarLauncher.class å¦‚æœæˆ‘ä»¬è¦æ‰§è¡ŒjaråŒ…çš„é‡Œé¢çš„æŸä¸ªclassï¼Œå°±å¯ä»¥æŠŠjaråŒ…æ”¾åˆ°classpathä¸­ï¼š\n1 java -cp ./hello.jar abc.xyz.Hello è¿™æ ·JVMä¼šè‡ªåŠ¨åœ¨hello.jaræ–‡ä»¶é‡Œå»æœç´¢æŸä¸ªç±»ã€‚\nå› ä¸ºjaråŒ…å°±æ˜¯zipåŒ…ï¼Œæ‰€ä»¥ï¼Œç›´æ¥åœ¨èµ„æºç®¡ç†å™¨ä¸­ï¼Œæ‰¾åˆ°æ­£ç¡®çš„ç›®å½•ï¼Œç‚¹å‡»å³é”®ï¼Œåœ¨å¼¹å‡ºçš„å¿«æ·èœå•ä¸­é€‰æ‹©â€œå‘é€åˆ°â€ï¼Œâ€œå‹ç¼©(zipped)æ–‡ä»¶å¤¹â€ï¼Œå°±åˆ¶ä½œäº†ä¸€ä¸ªzipæ–‡ä»¶ã€‚ç„¶åï¼ŒæŠŠåç¼€ä».zipæ”¹ä¸º.jarï¼Œä¸€ä¸ªjaråŒ…å°±åˆ›å»ºæˆåŠŸã€‚\nä¸‹é¢æ˜¯ç®€å•é¡¹ç›®ç¼–è¯‘è¾“å‡ºçš„ç›®å½•ï¼š\n1 2 3 4 5 6 7 8 9 package_sample â””â”€ bin â”œâ”€ hong â”‚ â””â”€ Person.class â”‚ ming â”‚ â””â”€ Person.class â””â”€ mr â””â”€ jun â””â”€ Arrays.class è¿™é‡Œéœ€è¦æ³¨æ„ é‡ä¸Šé¢è¾“å‡ºç›¸æ¯”, å‹ç¼©åçš„jaråŒ…å†…ç¬¬ä¸€å±‚ç›®å½•å¹¶ä¸æ˜¯ bin, è€Œæ˜¯package, åœ¨Windowsçš„èµ„æºç®¡ç†å™¨ä¸­çœ‹ï¼Œåº”è¯¥é•¿è¿™æ ·ï¼š\nå°±è¯´æ˜æ‰“åŒ…æ‰“å¾—æœ‰é—®é¢˜, å› æ­¤JVMæ— æ³•ä»jaråŒ…ä¸­æŸ¥æ‰¾æ­£ç¡®çš„class, åŸå› æ˜¯hong.Personå¿…é¡»æŒ‰hong/Person.classå­˜æ”¾ï¼Œè€Œä¸æ˜¯bin/hong/Person.classã€‚\njaråŒ…è¿˜å¯ä»¥åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„/META-INF/MANIFEST.MFæ–‡ä»¶ï¼ŒMANIFEST.MFæ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥æŒ‡å®šMain-Classå’Œå…¶å®ƒä¿¡æ¯ã€‚JVMä¼šè‡ªåŠ¨è¯»å–è¿™ä¸ªMANIFEST.MFæ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨Main-Classï¼Œæˆ‘ä»¬å°±ä¸å¿…åœ¨å‘½ä»¤è¡ŒæŒ‡å®šå¯åŠ¨çš„ç±»åï¼Œè€Œæ˜¯ç”¨æ›´æ–¹ä¾¿çš„å‘½ä»¤ï¼š\n1 java -jar hello.jar åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½æ‰‹åŠ¨ç¼–å†™MANIFEST.MFæ–‡ä»¶ï¼Œå†æ‰‹åŠ¨åˆ›å»ºzipåŒ…ã€‚Javaç¤¾åŒºæä¾›äº†å¤§é‡çš„å¼€æºæ„å»ºå·¥å…·ï¼Œä¾‹å¦‚Mavenï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ›å»ºjaråŒ…\næ¨èé˜…è¯»: How Classes are Found\nå‚è€ƒ:\nhttps://docs.oracle.com/javase/8/docs/technotes/tools/findingclasses.html https://www.liaoxuefeng.com/wiki/1252599548343744/1260466914339296 ","date":"2023-04-25T15:04:48Z","permalink":"https://blog.yorforger.cc/p/what-is-jar-package-in-java/","title":"What is Jar Package in Java"},{"content":" # PATH You should set the PATH variable if you want to be able to run the executables (javac, java, javadoc, and so on) from any directory without having to type the full path of the command. If you do not set the PATH variable, you need to specify the full path to the executable every time you run it, such as:\n1 /usr/local/jdk1.7.0/bin/javac MyClass.java æ€ä¹ˆè®¾ç½®PATHå‘¢, ä¹Ÿå°±æ˜¯æ€ä¹ˆæ·»åŠ ç¯å¢ƒå˜é‡å‘¢? ç¼–è¾‘~/.bashrcæˆ–è€….zshrc, çœ‹ä½ ç”¨çš„ä»€ä¹ˆshell, é»˜è®¤çš„æ˜¯bash, æˆ‘ç”¨çš„æ˜¯zsh\n1 export PATH=$PATH:/place/with/the/file å…¶å®è¿™ä¸ªå¾ˆå®¹æ˜“çœ‹å‡ºä»€ä¹ˆæ„æ€, PATH = $PATH + /place/with/the/file, å¥å­é‡Œé¢çš„åˆ†å·å°±æ˜¯ä¸ªseparatorè€Œå·². æ¯”å¦‚ä¸‹é¢çš„è¾“å‡º, ä¸€çœ‹å°±æ˜ç™½äº†:\n1 2 echo $PATH /opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin On most systems (Linux, Mac OS, UNIX, etc) the colon character (:) is the classpath separator. In windowsm the separator is the semicolon (;)\nå…¶å®PATHå°±æ˜¯å‘Šè¯‰terminalå¯æ‰§è¡ŒæŒ‡ä»¤çš„ä½ç½®ä¿¡æ¯, è€ŒCLASSPATHæ˜¯ç”¨æ¥å‘Šè¯‰JREç›¸å…³ç¨‹åº ç”¨æˆ·è‡ªå®šä¹‰ç±» çš„ä½ç½®ä¿¡æ¯\n# CLASSPATH é˜…è¯»æ­¤èŠ‚å‰, å¯å…ˆå‚è€ƒ: æ‰‹åŠ¨ç¼–è¯‘è¿è¡ŒJavaç¨‹åºä¹‹JVMåŠ è½½ç±»çš„é¡ºåº\nSimilar to the classic dynamic loading behavior, when executing Java programs, the Java Virtual Machine finds and loads classes lazily (it loads the bytecode of a class only when the class is first used). The classpath tells Java where to look in the filesystem for files defining these classes. - Wiki\næ³¨æ„: ä» Java5 å¼€å§‹ CLASSPATH é»˜è®¤å°±æ˜¯å½“å‰è·¯å¾„, ä¸€èˆ¬æƒ…å†µä¸‹å°±ä¸éœ€è¦å†è®¾å®šäº†,\nä¸‹é¢æˆ‘ä»¬å°±ä»‹ç»ä¸€ä¸‹ CLASSPATH çš„ç”¨, ä»¥ä¾¿å¯¹CLASSPATHæœ‰æ›´åŠ æ·±å…¥çš„ç†è§£: å› ä¸ºJavaæ˜¯ç¼–è¯‘å‹è¯­è¨€ï¼Œæºç æ–‡ä»¶æ˜¯.javaï¼Œè€Œç¼–è¯‘åçš„.classæ–‡ä»¶æ‰æ˜¯çœŸæ­£å¯ä»¥è¢«JVMæ‰§è¡Œçš„å­—èŠ‚ç ã€‚å› æ­¤ï¼Œå¦‚æœè¦åŠ è½½ä¸€ä¸ªabc.xyz.Helloçš„ç±»ï¼ŒJVMéœ€è¦çŸ¥é“åº”è¯¥å»å“ªæœç´¢å¯¹åº”çš„Hello.classæ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œclasspathå°±æ˜¯ä¸€ç»„ç›®å½•çš„é›†åˆï¼Œå®ƒè®¾ç½®çš„æœç´¢è·¯å¾„ä¸æ“ä½œç³»ç»Ÿç›¸å…³ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsç³»ç»Ÿä¸Šï¼Œç”¨;åˆ†éš”ï¼Œå¸¦ç©ºæ ¼çš„ç›®å½•ç”¨\u0026quot;\u0026quot;æ‹¬èµ·æ¥ï¼Œå¯èƒ½é•¿è¿™æ ·ï¼š\n1 C:\\work\\project1\\bin;C:\\shared;\u0026#34;D:\\My Documents\\project1\\bin\u0026#34; åœ¨Linuxç³»ç»Ÿä¸Šï¼Œç”¨:åˆ†éš”ï¼Œå¯èƒ½é•¿è¿™æ ·ï¼š\n1 /usr/shared:/usr/local/bin:/home/liaoxuefeng/bin ç°åœ¨æˆ‘ä»¬å‡è®¾classpathæ˜¯.;C:\\work\\project1\\bin;C:\\sharedï¼Œå½“JVMåœ¨åŠ è½½abc.xyz.Helloè¿™ä¸ªç±»æ—¶ï¼Œä¼šä¾æ¬¡æŸ¥æ‰¾ï¼š\n\u0026lt;å½“å‰ç›®å½•\u0026gt;\\abc\\xyz\\Hello.class C:\\work\\project1\\bin\\abc\\xyz\\Hello.class C:\\shared\\abc\\xyz\\Hello.class æ³¨æ„åˆ°.ä»£è¡¨å½“å‰ç›®å½•ã€‚å¦‚æœJVMåœ¨æŸä¸ªè·¯å¾„ä¸‹æ‰¾åˆ°äº†å¯¹åº”çš„classæ–‡ä»¶ï¼Œå°±ä¸å†å¾€åç»§ç»­æœç´¢ã€‚å¦‚æœæ‰€æœ‰è·¯å¾„ä¸‹éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±æŠ¥é”™ã€‚\næˆ‘ä»¬å¼ºçƒˆä¸æ¨èåœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­è®¾ç½®classpathï¼Œé‚£æ ·ä¼šæ±¡æŸ“æ•´ä¸ªç³»ç»Ÿç¯å¢ƒã€‚åœ¨å¯åŠ¨JVMæ—¶è®¾ç½®classpathæ‰æ˜¯æ¨èçš„åšæ³•ã€‚å®é™…ä¸Šå°±æ˜¯ç»™javaå‘½ä»¤ä¼ å…¥-classpathæˆ–-cpå‚æ•°ï¼š\n1 java -cp .;C:\\work\\project1\\bin;C:\\shared abc.xyz.Hello æ²¡æœ‰è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡classpathä¹Ÿæ²¡æœ‰ä¼ å…¥-cpå‚æ•°æ—¶ï¼Œé‚£ä¹ˆJVMé»˜è®¤çš„classpathä¸º.ï¼Œå³å½“å‰ç›®å½•.\n1 java abc.xyz.Hello ä¸Šè¿°å‘½ä»¤å‘Šè¯‰JVMæœç´¢classæ–‡ä»¶è·¯å¾„ä¸º:./abc/xyz/Hello.class.\nä¾‹å­, æ¯”å¦‚æˆ‘å†™ä¸ªCatç±», åœ¨åŒ…com.zhu.servlet, ç¼–è¯‘è¿è¡ŒæŒ‡ä»¤å¦‚ä¸‹:\n1 2 3 4 5 6 7 package com.zhu.servlet; public class Cat { public static void main(String[] args) { System.out.println(\u0026#34;hello world!\u0026#34;); } } 1 2 3 4 5 6 7 8 javac com/zhu/servlet/Cat.java java Cat Error: Could not find or load main class Cat Caused by: java.lang.ClassNotFoundException: Cat java com.zhu.servlet.Cat hello world! æ‰€ä»¥è¿™ä¹Ÿè¯´æ˜äº†ç±»çš„å…¨ååº”è¯¥æ˜¯åŒ…å+ç±»å, è€Œä¸åªæ˜¯ä¸€ä¸ªç®€å•çš„ç±»å.\nYou can check value of classpath in java inside your application by looking at following system property â€œjava.class.pathâ€:\n1 System.getProperty(\u0026#34;java.class.path\u0026#34;) # Set Classpath 1 export CLASSPATH=$PATH:/home/myaccount/myproject/lib/CoolFramework.jar:/home/myaccount/myproject/output/ è¿™åªæ˜¯ä¸¾ä¸ªä¾‹å­, æ›´å¥½çš„åšæ³•å°±æ˜¯ç”¨ç¬¬äºŒç§æ–¹æ³•, å°±æ˜¯å¯åŠ¨JVMçš„é€šè¿‡-cpæ¥æŒ‡å®šclasspath, ä¸è¦åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®classpathï¼é»˜è®¤çš„å½“å‰ç›®å½•.å¯¹äºç»å¤§å¤šæ•°æƒ…å†µéƒ½å¤Ÿç”¨äº†\n1 C:\\work\u0026gt; java -cp . com.example.Hello å‚è€ƒ:\nclasspathå’Œjar - å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™ ","date":"2023-04-25T14:53:30Z","permalink":"https://blog.yorforger.cc/p/classpath-path/","title":"CLASSPATH \u0026 PATH"},{"content":"åœ¨IDEAæŠŠwebapp deployåˆ°tomcatä¸Šçš„æ—¶å€™ä¼šçœ‹åˆ°ä»¥ä¸‹è®¾ç½®:\nä¸Šå›¾ä¸­é€‰æ‹©waræˆ–è€…war explodedçš„æ—¶å€™, å¦‚æœé€‰æ‹©å‰è€…, on frame deactivation diaglogå°±ä¸ä¼šæœ‰update resourcesé€‰é¡¹:\næœ‰å¾ˆå¤šç–‘é—®æ¯”å¦‚warå’Œwar explodedæ˜¯ä»€ä¹ˆ, update resourceså’Œupdate classes and resourcesçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ, è¿™éƒ½æ˜¯å¹²å•¥çš„?\n# War \u0026amp; War exploded åœ¨ä½¿ç”¨ IDEA å¼€å‘Java Webé¡¹ç›®éƒ¨ç½² Tomcat çš„æ—¶å€™é€šå¸¸ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µ:\næ˜¯é€‰æ‹© war è¿˜æ˜¯ war explodedå‘¢?\nçœ‹ä¸€ä¸‹ä»–ä»¬ä¸¤ä¸ªçš„åŒºåˆ«:\nwarï¼šå°†Web Applicationä»¥åŒ…çš„å½¢å¼ä¸Šä¼ åˆ°æœåŠ¡å™¨ war explodedï¼šå°†Web Applicationä»¥å½“å‰æ–‡ä»¶å¤¹çš„ä½ç½®å…³ç³»ä¸Šä¼ åˆ°æœåŠ¡å™¨, å› æ­¤è¿™ç§æ–¹å¼æ”¯æŒhot deploymentï¼Œä¸€èˆ¬åœ¨å¼€å‘çš„æ—¶å€™ä¹Ÿæ˜¯ç”¨è¿™ç§æ–¹å¼. Hot deployment is the process of adding new components (such as WAR files, EJB Jar files, enterprise Java beans, servlets, and JSP files) to a running server without having to stop the application server process and start it again.\næ‰€ä»¥ç°åœ¨çŸ¥é“ä¸Šé¢ä¸ºå•¥é€‰æ‹©warçš„è¯, åœ¨on frame deactivation diaglogå°±ä¸ä¼šæœ‰update resourcesé€‰é¡¹äº†å§.\n# Update Resources \u0026amp; Update Classes and Resources On Upate Action : update classes and resources æ›´æ–°ä»£ç å’Œèµ„æº On Frame Deactivation : update classes and resourcesåœ¨IDEå¤±å»ç„¦ç‚¹æ—¶(ä½ ç‚¹å¼€æµè§ˆå™¨ç¦»å¼€IDEçš„æ—¶å€™)æ›´æ–°å¹¶å‘å¸ƒä»£ç  å¦‚æœOn Upate Actioné€‰æ‹©äº†update classes and resourcesï¼Œç„¶åOn Frame Deactivation é€‰æ‹©äº†do nothing, é‚£ä½ æ— è®ºæ˜¯ä¿®æ”¹äº†servlet, doGetç­‰åŠ¨æ€ä»£ç è¿˜æ˜¯jspï¼Œh5ç­‰é™æ€èµ„æºä»£ç ï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ–°, å°±æ˜¯ä½ å¾—è‡ªå·±ç‚¹å‡»é‚£ä¸ªæ›´æ–°æŒ‰é’®, ç„¶åå†åˆ·æ–°æµè§ˆå™¨é¡µé¢, ä½ çš„ä¿®æ”¹æ‰èƒ½ç”Ÿæ•ˆ:\nå¦‚æœOn Upate Actionå’ŒOn Frame Deactivationéƒ½é€‰æ‹©äº†update classes and resourcesï¼Œé‚£å°±æ˜¯æ¯æ¬¡ä¿®æ”¹äº†servletä»£ç æˆ–è€…jspç­‰é™æ€ä»£ç åä½ éƒ½ä¸ç”¨ç‚¹å‡»é‚£ä¸ªæ›´æ–°æŒ‰é’®äº†, ç›´æ¥è¿›å…¥æµè§ˆå™¨åˆ·æ–°é¡µé¢å°±è¡Œ,è¿™æ ·æ˜¾ç„¶ä¼šæµªè´¹ç”µè„‘èµ„æº,å¦‚æœä½ ä¸å¿ƒç–¼cpu, é‚£å°±è¿™æ ·æœ€å¥½, æˆ‘æ˜¯å¿ƒç–¼, æ‰€ä»¥æˆ‘é€‰æ‹©çš„å¦‚ä¸‹:\nè¿™æ ·æ¯æ¬¡ä¿®æ”¹äº†servletä¹‹åæˆ‘ç‚¹å‡»æ›´æ–°æŒ‰é’®, ä¿®æ”¹äº†jspä¹‹åæˆ‘å°±ä¸ç”¨ç‚¹å‡»äº†, ç›´æ¥è¿›å…¥æµè§ˆå™¨åˆ·æ–°é¡µé¢å°±å¯ä»¥äº†.\nå‚è€ƒ:\nhttps://blog.csdn.net/u013626215/article/details/103685304 ","date":"2023-04-25T14:27:35Z","permalink":"https://blog.yorforger.cc/p/idea%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84war%E5%92%8Cwar-exploded%E7%9A%84%E5%8C%BA%E5%88%AB/","title":"IDEAé¡¹ç›®ä¸­çš„Warå’ŒWar Explodedçš„åŒºåˆ«"},{"content":" # ä»€ä¹ˆæ˜¯Spring Boot Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications that you can \u0026ldquo;just run\u0026rdquo;. Spring Boot\nSpring Bootæ˜¯ä¸€ä¸ªåŸºäºSpringçš„å¥—ä»¶ï¼Œå®ƒå¸®æˆ‘ä»¬é¢„ç»„è£…äº†Springçš„ä¸€ç³»åˆ—ç»„ä»¶ï¼Œä»¥ä¾¿ä»¥å°½å¯èƒ½å°‘çš„ä»£ç å’Œé…ç½®æ¥å¼€å‘åŸºäºSpringçš„Javaåº”ç”¨ç¨‹åºã€‚åŸæ–‡\nå³ Spring Boot æ˜¯ç”¨æ¥æ–¹ä¾¿ç®¡ç† Spring ç›¸å…³ç»„ä»¶çš„ä¸€ä¸ªä¸œè¥¿, æ‰€ä»¥å¹¶ä¸æ˜¯è¯´å­¦äº†Spring Bootå°±ä¸ç”¨å­¦Spring, Spring Booté‡Œé¢çš„ä¸œè¥¿å°±æ˜¯Springçš„ä¸€ä¸ªä¸ªéƒ¨ä»¶, å­¦Spring Bootçš„æ—¶å€™ä¹Ÿæ˜¯åœ¨å­¦Springã€‚\nå¯ä»¥çœ‹ä¸‹ Spring Boot çš„mavené…ç½®æ–‡ä»¶(pom.xml)çš„å†…å®¹ï¼Œå¯èƒ½ä¼šå¸®åŠ©ç†è§£Spring Bootè´Ÿè´£ç»„è£…éƒ¨ä»¶çš„æœ¬è´¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.5\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.choo\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;SpringDemo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;SpringDemo\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;SpringDemo\u0026lt;/description\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;17\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-jpa\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.32\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.5.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; # åŸºäº Spring Framework çš„ Spring MVC é¡¹ç›®æ­å»º ç”±äº Spring ä¸»è¦åº”ç”¨äº Web å¼€å‘ï¼Œä¸‹é¢çœ‹ä¸‹ Spring Boot å‡ºç°å‰æ˜¯å¦‚ä½•æ­å»º Spring MVC é¡¹ç›®çš„ã€‚\nSpring MVC é¡¹ç›®éœ€è¦å¼•å…¥ spring-webmvc æ¨¡å—çš„ä¾èµ–ï¼Œå› æ­¤é¦–å…ˆè¦æ‰¾çš„å°±æ˜¯ spring-webmvc çš„åæ ‡ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ä¸€èˆ¬å°±æ˜¯åœ¨ç½‘ä¸Šæ‰¾ä¸€äº› Spring MVC çš„å…¥é—¨æ–‡ç« ï¼Œç›´æ¥å¤åˆ¶ spring-webmvc çš„åæ ‡äº†ï¼Œæ­¤å¤–å°±æ˜¯åœ¨ maven ä»“åº“ ä¸­æ ¹æ®å…³é”®å­—æœç´¢ã€‚ä¸ç®¡æ€æ ·æ‰¾åæ ‡å§ï¼Œæœ€ç»ˆæˆ‘ä»¬é…ç½®æœ€ç®€å•çš„ pom.xml å†…å®¹å¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.zzuhkp\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mvc-demo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;war\u0026lt;/packaging\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;project.build.sourceEncoding\u0026gt;UTF-8\u0026lt;/project.build.sourceEncoding\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-webmvc\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.2.6.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.servlet\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.servlet-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.0.1\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; é™¤äº†å¼•å…¥ spring-webmvc çš„ä¾èµ–ï¼Œç”±äºæˆ‘ä»¬è¿˜å¯èƒ½ä¼šä½¿ç”¨åˆ°ä¸€äº› Servlet è§„èŒƒä¸­çš„ä¸€äº›ç±»ï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº† Servlet çš„ä¾èµ–ã€‚è€Œä¾èµ–å¼•å…¥åªæ˜¯ä¸‡é‡Œé•¿å¾çš„ç¬¬ä¸€æ­¥ï¼Œç”±äº Java Web å¼€å‘ä¸­çš„æ¥å£éƒ½æ˜¯ Servlet æä¾›çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½® spring-webmvc æ¨¡å—æä¾›çš„ Servlet æ¥å£çš„å®ç° DispatcherServletã€‚è¿™åˆæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿå½“æ—¶ä½œä¸ºæ–°æ‰‹æˆ‘çš„ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ï¼Œé…ç½®æ—¶æˆ‘è¿˜å¾—æ‰¾åˆ°è¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œè¿™å¯¹äºæ–°æ‰‹æ¥è¯´ä¹Ÿå¤ªä¸å‹å¥½äº†ï¼Œåˆæ˜¯ä¸€æ³¢å¤åˆ¶ç²˜è´´ã€‚æœ€ç»ˆé…ç½®å‡ºæ¥çš„ web.xml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;web-app xmlns=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\u0026#34; version=\u0026#34;4.0\u0026#34;\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;dispatcher\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;org.springframework.web.servlet.DispatcherServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;dispatcher\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;/web-app\u0026gt; åˆ°è¿™é‡Œå°±å®Œäº†å—ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸º Spring é…ç½® beanã€‚å¯¹äº Spring MVC æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ Spring çš„é…ç½®æ–‡ä»¶æ”¾åœ¨ /WEB-INF/${servlet-name}-servlet.xml ä¸­ï¼Œå…¶ä¸­ ${servlet-name} ä¸º Servelt çš„åç§°ï¼Œæˆ‘ä»¬ä¸º DispatcherServlet å–çš„åå­—æ˜¯ dispatcherï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»º /WEB-INF/dispatcher-servlet.xml ä½œä¸ºé…ç½®æ–‡ä»¶ã€‚è¿™å¯¹æ–°æ‰‹åˆæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œè¿˜å¾—è®°ä½å‘½åè§„èŒƒï¼Œé‚£èƒ½ä¸èƒ½è‡ªå·±æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®å‘¢ï¼Ÿå¯ä»¥ï¼Œé…ç½®ä¸€ä¸ª Servlet çš„åˆå§‹åŒ–å‚æ•° configurationLocation æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œå¥½å§ï¼Œè¿˜å¾—è®°ä½å‚æ•°åç§°ã€‚çœŸæ˜¯ä»¤äººå´©æºƒï¼Œæœ€åçœ‹ä¸‹é…ç½®æ–‡ä»¶çš„å†…å®¹å§ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;beans xmlns=\u0026#34;http://www.springframework.org/schema/beans\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:mvc=\u0026#34;http://www.springframework.org/schema/mvc\u0026#34; xmlns:context=\u0026#34;http://www.springframework.org/schema/context\u0026#34; xsi:schemaLocation=\u0026#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\u0026#34;\u0026gt; \u0026lt;bean class=\u0026#34;org.springframework.web.servlet.view.InternalResourceViewResolver\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;prefix\u0026#34; value=\u0026#34;/WEB-INF/page\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;suffix\u0026#34; value=\u0026#34;.jsp\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;context:component-scan base-package=\u0026#34;com.zzuhkp.mvc\u0026#34;/\u0026gt; \u0026lt;/beans\u0026gt; æœ€åˆçš„ Java Web å¼€å‘å¯æ²¡æœ‰å‰åç«¯åˆ†ç¦»ï¼Œä¸ºäº†æ ¹æ®è§†å›¾åç§°æŸ¥æ‰¾åˆ°å¯¹åº”çš„ JSP æ–‡ä»¶ï¼Œæˆ‘ä»¬é…ç½®ä¸€ä¸ª InternalResourceViewResolver ç±»å‹çš„è§†å›¾è§£æå™¨ beanï¼Œè¿™æ˜¯ Spring MVC ç‰¹æœ‰çš„ä¸€ä¸ª beanï¼Œåˆæ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œè§†å›¾è§£æå™¨åˆæ˜¯ä»€ä¹ˆï¼Ÿæ­¤å¤–ï¼Œæˆ‘ä»¬ä¸ºäº†å¯ç”¨æ³¨è§£æ”¯æŒï¼Œæˆ‘ä»¬æ·»åŠ äº† context:compent-scan æ ‡ç­¾æŒ‡å®šäº†è¦ Spring è¦æ‰«æçš„åŒ…ã€‚bean çš„é…ç½®è¿˜å¥½ï¼Œæœ€è¦åçš„æ˜¯ xml é…ç½®çš„å‘½åç©ºé—´ï¼Œå°±æ˜¯æœ€ä¸Šé¢é‚£ä¸€å¨ï¼Œé™¤äº†å¤åˆ¶ç²˜è´´è°èƒ½è‡ªå·±å†™å‡ºæ¥å‘¢ï¼Ÿ\nå†™åˆ°è¿™é‡Œï¼Œæˆ‘å·²ç»è¿‘ä¹å´©æºƒäº†ï¼Œç®€ç›´åˆç»å†äº†ä¸€æ¬¡é‚£æ®µç—›è‹¦çš„å†å²ã€‚æ¥ä¸ª Controller æµ‹è¯•ä¸‹è¯·æ±‚æ˜¯å¦æ­£å¸¸ã€‚\n1 2 3 4 5 6 7 8 @Controller public class HelloController { @GetMapping(\u0026#34;/hello\u0026#34;) public String hello() { return \u0026#34;/hello\u0026#34;; } } Controller æ–¹æ³• String ç±»å‹çš„è¿”å›å€¼å°†ä½œä¸ºè§†å›¾åï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡å®šçš„æ˜¯ /helloï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰ä¸€ä¸ª /hello å¯¹åº”çš„ jsp æ–‡ä»¶ï¼Œå½“è¯·æ±‚ /hello æ—¶æˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹è¿”å›ç»™å‰ç«¯ï¼Œç»“åˆæˆ‘ä»¬å‰é¢é…ç½®çš„ InternalResourceViewResolverï¼Œå®ƒçš„ä½ç½®åº”è¯¥æ˜¯ /WEB-INF/page/hello.jspï¼Œæˆ‘ä»¬å®šä¹‰çš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 \u0026lt;%@ page contentType=\u0026#34;text/html;charset=UTF-8\u0026#34; language=\u0026#34;java\u0026#34; %\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;hello\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; Hello,Spring MVC \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æœ€åæ•´ä¸ªé¡¹ç›®ç»“æ„å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 . â”œâ”€â”€ pom.xml â””â”€â”€ src â””â”€â”€ main â”œâ”€â”€ java â”‚ â””â”€â”€ com â”‚ â””â”€â”€ zzuhkp â”‚ â””â”€â”€ mvc â”‚ â””â”€â”€ HelloController.java â””â”€â”€ webapp â”œâ”€â”€ WEB-INF â”‚ â”œâ”€â”€ dispatcher-servlet.xml â”‚ â””â”€â”€ web.xml â””â”€â”€ page â””â”€â”€ hello.jsp åŸæ–‡:\nhttps://blog.csdn.net/zzuhkp/article/details/123518033 # åŸºäº Spring Boot çš„ Spring MVC é¡¹ç›®æ­å»º æ€»ç»“åŸºäº Spring Framework çš„ Spring MVC é¡¹ç›®æ­å»ºæœ‰å“ªäº›é—®é¢˜å‘¢ï¼Ÿ\né¦–å…ˆæ¦‚å¿µè¿‡å¤šï¼Œæ–°äººéœ€è¦å…³æ³¨ spring-webmvc ä¸­çš„ä¼—å¤šæ¦‚å¿µï¼Œå¦‚ DispatcherServletã€è§†å›¾è§£æå™¨ InternalResourceViewResolverã€‚å…¶æ¬¡é…ç½®è¿‡å¤šï¼Œæ–°äººéœ€è¦å…³æ³¨é…ç½®æ–‡ä»¶å‘½åè§„èŒƒã€xml é…ç½®æ–‡ä»¶å‘½åç©ºé—´ ç­‰ã€‚\nä¸ºäº†è§£å†³è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼ŒSpring Boot éµå¾ªçº¦å®šå¤§äºé…ç½®çš„å¼€å‘åŸåˆ™ï¼Œå¤§å¤§ç®€åŒ–çš„ Spring çš„é…ç½®ã€‚é¦–å…ˆè¿›è¡Œè‡ªåŠ¨åŒ–é…ç½®ï¼Œåªè¦å¼•å…¥ç›¸å…³ä¾èµ–å°±ä¼šè‡ªåŠ¨è¿›è¡Œä¸€äº›é»˜è®¤çš„é…ç½®ï¼Œå…¶æ¬¡å¦‚æœé»˜è®¤çš„é…ç½®ä¸æ»¡è¶³è¦æ±‚è¿˜å¯ä»¥è‡ªå®šä¹‰é…ç½®è¦†ç›–é»˜è®¤çš„é…ç½®ï¼Œå¤§å¤§é™ä½äº† Spring åº”ç”¨ä¸Šæ‰‹çš„é—¨æ§›ã€‚\nå°†ä¸Šè¿°ç¤ºä¾‹æ”¹é€ æˆåŸºäº Spring Boot çš„ Spring MVC é¡¹ç›®ï¼Œé¦–å…ˆçœ‹ä¸‹ pom æ–‡ä»¶å†…å®¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.7.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.zzuhkp\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mvc-demo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;jar\u0026lt;/packaging\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;project.build.sourceEncoding\u0026gt;UTF-8\u0026lt;/project.build.sourceEncoding\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.tomcat.embed\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;tomcat-embed-jasper\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; å’Œä¸Šè¿°åŸºäº Spring Framwork çš„ pom æ–‡ä»¶ç›¸æ¯”ï¼Œä¸»è¦æœ‰4å¤„ä¸åŒã€‚\nå¼•å…¥äº†ä¸€ä¸ªåä¸º spring-boot-starter-parent çš„ parentï¼Œè¿™æ˜¯ Spring Boot ä¸ºç®€åŒ– pom æ–‡ä»¶é…ç½®æä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œå†…éƒ¨ç®¡ç†äº†å¾ˆå¤šä¾èµ–ï¼Œæˆ‘ä»¬çš„ pom ç»§æ‰¿è¿™ä¸ª parent ä¹‹åå¾ˆå¤šä¾èµ–å°±å¯ä»¥çœç•¥ç‰ˆæœ¬å·ï¼Œå¦‚ä¸‹é¢çš„ spring-boot-starter-webã€‚ æ‰“åŒ…æ–¹å¼ç”± war æ”¹æˆ jarï¼ŒSpring Boot å¯å†…åµŒ Servlet å®¹å™¨ï¼Œå¯ç›´æ¥ä½¿ç”¨ jar åŒ…å¯åŠ¨ï¼Œå› æ­¤æ— éœ€æ‰“åŒ…ä¸º war å†éƒ¨ç½²ã€‚ å¼•å…¥äº† spring-boot-starter-web ä¾èµ–ï¼Œè¿™ä¸ªä¾èµ–è¢«ç§°ä¸º starterï¼Œspring-boot-starter ä¼šå¼•å…¥ä¸€äº›æœ¬æ¨¡å—ç›¸å…³çš„ä¾èµ–å’Œè‡ªåŠ¨åŒ–é…ç½®ï¼Œspring-boot-starter-web å°±å†…åµŒäº† Tomcatï¼Œå¹¶è‡ªåŠ¨è¿›è¡Œ Spring MVC çš„é…ç½®ï¼Œå¦‚ DispatcherServletã€‚ å¼•å…¥äº† tomcat-embed-jasper ä¾èµ–ï¼Œè¿™ä¸ªä¾èµ–çš„ä½œç”¨åœ¨äºæ”¯æŒå†…åµŒ Tomcat è§£æ jspã€‚ Spring Boot é¡¹ç›®ç”±äºä½¿ç”¨ jar åŒ…å¯åŠ¨ï¼Œå› æ­¤éœ€è¦æä¾›ä¸€ä¸ªä¸»ç±»ï¼Œæˆ‘ä»¬å®šä¹‰çš„ä¸»ç±»å¦‚ä¸‹ã€‚ jarå’Œwarçš„åŒºåˆ«:\nThese files are simply zipped files using the java jar tool. These files are created for different purposes. Here is the description of these files:\n.jar files: The .jar files contain libraries, resources and accessories files like property files. .war files: The war file contains the web application that can be deployed on any servlet/jsp container. The .war file contains jsp, html, javascript and other files necessary for the development of web applications. https://stackoverflow.com/a/5871102/16317008 Spring Boot é¡¹ç›®ç”±äºä½¿ç”¨ jar åŒ…å¯åŠ¨ï¼Œå› æ­¤éœ€è¦æä¾›ä¸€ä¸ªä¸»ç±»ï¼Œæˆ‘ä»¬å®šä¹‰çš„ä¸»ç±»å¦‚ä¸‹:\n1 2 3 4 5 6 @SpringBootApplication public class MvcApplication { public static void main(String[] args) { SpringApplication.run(MvcApplication.class, args); } } @SpringBootApplication æ³¨è§£ä¸»è¦ç”¨äºå¼€å¯è‡ªåŠ¨åŒ–é…ç½®ï¼Œmain æ–¹æ³•åˆ™ç”¨äºå¯åŠ¨ Spring å®¹å™¨ã€‚è‡³æ­¤ä¸€ä¸ª Spring Boot é¡¹ç›®å…¶å®å·²ç»æ­å»ºå®Œæˆäº†ï¼Œä¸å†éœ€è¦è¿›è¡Œç¹æ‚çš„ web.xml é…ç½®åŠ Spring é…ç½®ã€‚\nè™½ç„¶å¼•å…¥ spring-boot-starter-web ä¹‹åè‡ªåŠ¨è¿›è¡Œäº† Web å¼€å‘ç›¸å…³çš„é…ç½®ï¼Œä¸è¿‡ç”±äºæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ InternalResourceViewResolver çš„ä½¿ç”¨çš„è§†å›¾å‰ç¼€å’Œåç¼€ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥çš„é…ç½®ã€‚Spring Boot æ”¯æŒå°†ç›¸å…³é…ç½®ç›´æ¥æ·»åŠ åˆ° /application.propertiesï¼Œçœ‹ä¸‹æˆ‘ä»¬çš„é…ç½®å†…å®¹ã€‚\n1 2 spring.mvc.view.prefix=/WEB-INF/page spring.mvc.view.suffix=.jsp æ³¨æ„, æˆ‘ä»¬é…ç½®æ•°æ®åº“è¿æ¥ä¹Ÿæ˜¯åœ¨SpringDemo/src/mian/resources/application.propertiesæ–‡ä»¶\n1 2 3 4 spring.datasource.url=jdbc:mysql://${MYSQL_HOST:localhost}:3306/greenhouse spring.datasource.username=root spring.datasource.password=778899 spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼ŒJSP æ–‡ä»¶å’Œ Controller æœªåšå˜åŠ¨ï¼Œä»ä½¿ç”¨å‰é¢ç¤ºä¾‹çš„ä»£ç ã€‚çœ‹ä¸‹ç°åœ¨çš„é¡¹ç›®ç»“æ„:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 . â”œâ”€â”€ pom.xml â””â”€â”€ src â””â”€â”€ main â”œâ”€â”€ java â”‚ â””â”€â”€ com â”‚ â””â”€â”€ zzuhkp â”‚ â””â”€â”€ mvc â”‚ â”œâ”€â”€ HelloController.java â”‚ â””â”€â”€ MvcApplication.java â”œâ”€â”€ resources â”‚ â””â”€â”€ application.properties â””â”€â”€ webapp â””â”€â”€ WEB-INF â””â”€â”€ page â””â”€â”€ hello.jsp æ€»ç»“ Spring Boot ç®€åŒ–åº”ç”¨åˆ›å»ºçš„æ–¹å¼ä¸ºï¼šä½¿ç”¨ spring-boot-starter-parent ç®¡ç†ä¾èµ–ç‰ˆæœ¬ã€ä½¿ç”¨ spring-boot-starter è‡ªåŠ¨åŒ–é…ç½®ã€æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰é…ç½®è¦†ç›–é»˜è®¤é…ç½®ã€‚\n# Spring Boot æ˜¯å¦‚ä½•ç®€åŒ–åº”ç”¨è¿è¡Œçš„ï¼Ÿ å¯¹äºåº”ç”¨è¿è¡Œçš„ç®€åŒ–ï¼Œä¸»è¦æç°åœ¨å†…åµŒ Servlet å®¹å™¨ï¼Œèƒ½å¤Ÿå°†æˆ‘ä»¬çš„åº”ç”¨è‡ªåŠ¨æ‰“æˆ jar åŒ…å¯åŠ¨ã€‚ä¸Šé¢çš„ç¤ºä¾‹æ˜¯æˆ‘ä»¬åœ¨ IDE ä¸­è¿è¡Œçš„ï¼Œä¸ºäº†æ‰“æˆ jar åŒ…ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ª Spring Boot ä¸“æœ‰çš„æ’ä»¶ã€‚\n1 2 3 4 5 6 7 8 \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; è¿™ä¸ªæ’ä»¶å¯ä»¥å°† Spring Boot é¡¹ç›®ä¾èµ–çš„æ‰€æœ‰ jar åŒ…æ‰“åŒ…åˆ°ä¸€ä¸ª jar åŒ…ä¸­ï¼Œè¿™ä¸ª jar ä¹Ÿè¢«ç§°ä¸º fat jarã€‚\n# æ€»ç»“ Spring å®˜ç½‘å°† Spring Boot çš„æ ¸å¿ƒç‰¹æ€§æ€»ç»“ä¸º 6 ç‚¹ï¼Œåœ¨æˆ‘ä»¬ä¸Šè¿°çš„ä¾‹å­ä¸­ä¹ŸåŸºæœ¬æœ‰ä½“ç°ï¼š\nCreate stand-alone Spring applications Embed Tomcat, Jetty or Undertow directly (no need to deploy WAR files) Provide opinionated \u0026lsquo;starter\u0026rsquo; dependencies to simplify your build configuration Automatically configure Spring and 3rd party libraries whenever possible Provide production-ready features such as metrics, health checks, and externalized configuration Absolutely no code generation and no requirement for XML configuration åŸæ–‡:\nhttps://blog.csdn.net/zzuhkp/article/details/123518033 ","date":"2023-04-25T12:30:22Z","permalink":"https://blog.yorforger.cc/p/spring-boot%E4%B8%8Espring%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AF%B9%E6%AF%94-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/","title":"Spring Bootä¸Springæ¡†æ¶çš„å¯¹æ¯”-é˜…è¯»ç¬”è®°"},{"content":" 1 2 ssh root@144.202.12.32 ssh: connect to host 144.202.12.32 port 22: Connection refused æŸ¥çš„ä¸€äº›åšå®¢è¯´ä¿®æ”¹macè®¾ç½®æˆå…è®¸è¿œç¨‹è¿æ¥(è¿™å…¶å®æ˜¯å…è®¸åˆ«äººè¿æ¥ä½ çš„macç”µè„‘æ¯”å¦‚ssh localhost), è¿˜æœ‰ä¿®æ”¹æœåŠ¡å™¨é‡Œçš„é…ç½®æ–‡ä»¶/etc/ssh/ssh_config, 22ç«¯å£å–æ¶ˆæ³¨é‡Š, éƒ½æ²¡ç”¨,\nç›´æ¥å»æœåŠ¡å™¨å¸è½½sshå†é‡è£…å°±å¥½äº†\n1 2 3 4 5 6 7 sudo yum remove openssh-server sudo yum install openssh-server # sudo systemctl stop sshd sudo systemctl start sshd # æŸ¥çœ‹çŠ¶æ€ service sshd status æ³¨æ„ä¸Šé¢æˆ‘ä»¬æ£€æŸ¥sshæœåŠ¡æ˜¯å¦æ‰“å¼€è¾“å…¥çš„æ˜¯ service sshd status, å¹¶ä¸æ˜¯ä¸Šé¢çš„ssh status, åœ¨æˆ‘çš„æœåŠ¡å™¨ä¸Šè¾“å…¥ssh statusä¼šæ˜¾ç¤ºUnit ssh.service could not be found.æ‰€ä»¥æ ¹æ®å®é™…æƒ…å†µè€Œå®š.\n","date":"2023-04-23T20:30:22Z","permalink":"https://blog.yorforger.cc/p/ssh%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E5%87%BA%E7%8E%B0%E7%9A%84connection-refused%E9%97%AE%E9%A2%98/","title":"SSHè¿æ¥è¿œç¨‹ä¸»æœºå‡ºç°çš„Connection Refusedé—®é¢˜"},{"content":" # 1. å®‰è£…Nginxå’Œgit (æœåŠ¡å™¨ç«¯) # 1.1. Installing the Nginx Web Server 1 2 3 4 sudo yum install nginx sudo systemctl enable nginx sudo systemctl start nginx # 1.2. Adjusting Firewall Rules Run the following command to permanently enable HTTP connections on port 80:\n1 sudo firewall-cmd --permanent --add-service=http To verify that the http firewall service was added correctly, you can run:\n1 sudo firewall-cmd --permanent --list-all Youâ€™ll see output like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 public target: default icmp-block-inversion: no interfaces: sources: services: cockpit dhcpv6-client http ssh ports: protocols: masquerade: no forward-ports: source-ports: icmp-blocks: rich rules: To apply the changes, youâ€™ll need to reload the firewall service:\n1 sudo firewall-cmd --reload # 2. åˆ›å»ºæ–°çš„ç”¨æˆ· git (æœåŠ¡ç«¯) 1 2 3 4 5 6 7 8 9 10 useradd git passwd git # ç»™gitç”¨æˆ·é…ç½®sudoæƒé™ chmod 740 /etc/sudoers vim /etc/sudoers # æ‰¾åˆ°root ALL=(ALL) ALLï¼Œåœ¨å®ƒä¸‹æ–¹åŠ å…¥ä¸€è¡Œ git ALL=(ALL) ALL chmod 400 /etc/sudoers # 2.1. æ·»åŠ å…¬é’¥è®¤è¯ 1 2 3 4 5 6 7 8 9 10 su git cd mkdir -p ~/.ssh touch ~/.ssh/authorized_keys chmod 600 ~/.ssh/authorized_keys chmod 700 ~/.ssh #æŠŠæœ¬åœ°ç”µè„‘sshçš„å…¬é’¥åŠ è¿›å» ~/.ssh/id_rsa.pub vim ~/.ssh/authorized_keys # 2.2. git-hooks è‡ªåŠ¨éƒ¨ç½² æ³¨æ„, ç°åœ¨æœåŠ¡å™¨æœ‰ä¸¤ä¸ªç”¨æˆ·gitå’Œroot, ç„¶åä»–ä»¬åªæœ‰è‡ªå·±çš„homeç›®å½•æ˜¯ç‹¬ç«‹çš„, è€Œæ ¹ç›®å½•ä¸‹çš„æ¯”å¦‚/etc/, /usrè¿™éƒ½æ˜¯ä»–ä»¬ä¸¤ä¸ªç”¨æˆ·å…±äº«çš„, çœ‹ä¸‹é¢çš„è¾“å‡ºä½ å°±çŸ¥é“ä»€ä¹ˆæ„æ€äº†,\n1 2 3 4 5 6 7 ls -a /home/git/ . .. .bash_logout .bash_profile .bashrc .ssh .viminfo # å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ç”¨æˆ·gitä¸‹è®¿é—®çš„, æ‰€ä»¥å¾—ç”¨sudoæ‰èƒ½è®¿é—®rootç”¨æˆ·çš„æ–‡ä»¶ sudo ls -a /root/ . .bash_logout .bashrc .cshrc .ssh .viminfo .. .bash_profile .cache .pki .tcshrc å¥½äº†ä¸è§£é‡Šäº†, å¼€å§‹è®¾ç½®git-hookä»¥åŠæœåŠ¡å™¨æ–‡ä»¶ç›¸å…³é…ç½®:\n1 2 3 4 5 6 7 8 9 # æ–°å»ºç›®å½•ï¼Œè¿™æ˜¯gitä»“åº“çš„ä½ç½® sudo mkdir -p /var/repo # è¿™é‡Œæ˜¯æˆ‘ä»¬ç½‘ç«™ç½‘é¡µçš„ä½ç½® sudo mkdir -p /var/www/hexo # åˆ›å»ºä¸ªbare repository cd /var/repo sudo git init --bare blog.git sudo vim /var/repo/blog.git/hooks/post-update post-updateçš„å†…å®¹å¦‚ä¸‹:\n1 2 #!/bin/bash git --work-tree=/var/www/hexo --git-dir=/var/repo/blog.git checkout -f ç»™post-updateæˆæƒ:\n1 2 3 4 5 6 cd /var/repo/blog.git/hooks/ sudo chown -R git:git /var/repo/ sudo chown -R git:git /var/www/hexo # èµ‹äºˆå…¶å¯æ‰§è¡Œæƒé™ sudo chmod +x post-update # 3. é…ç½®Nginx 1 2 cd /etc/nginx/conf.d/ sudo vim blog.conf blog.confçš„å†…å®¹å¦‚ä¸‹(æ³¨æ„å› ä¸ºæˆ‘ä¸ºåŸŸåæ·»åŠ ä¸ªAè®°å½•ç„¶åwwwä½œä¸ºHOSTNAME, å¦‚æœä½ çš„åŸŸååªæœ‰ä¸€ä¸ªAè®°å½•ç„¶åHOSTNAMEè¿˜æ˜¯ç©º, é‚£ä½ å°±å¡«äºŒçº§åŸŸåå°±å¥½äº†davidzhu.xyzè¿™æ ·, ä¸æ‡‚çš„è¯è¯·çœ‹æˆ‘çš„åŸŸååˆ†çº§å’ŒDNSè®°å½•ä¹‹ä½•ä¸ºwwwï¼š\n1 2 3 4 5 6 server { listen 80 default_server; listen [::] default_server; server_name www.davidzhu.xyz; root /var/www/hexo; } 1 2 3 4 5 nginx -t nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful nginx -s reload # 4. åœ¨æœ¬åœ°å®‰è£…Hexo Installing Hexo is quite easy and only requires the following beforehand:\nNode.js (Should be at least Node.js 10.13, recommends 12.0 or higher) Git node -væŸ¥çœ‹æ˜¯å¦å®‰è£…äº†node # 4.1 Install Node.js # 4.1.1. Install nvm 1 2 3 4 5 wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash source ~/.bashrc source ~/.zshrc bash is an sh-compatible command language interpreter that executes commands read from the standard input or from a file.\nWe strongly recommend using a Node version manager like nvm to install Node.js and npm. We do not recommend using a Node installer, since the Node installation process installs npm in a directory with local permissions and can cause permissions errors when you run npm packages globally.\n# 4.1.2. Install node 1 2 3 4 5 6 7 nvm install node # \u0026#34;node\u0026#34; is an alias for the latest version # uninstall, 19.8.1æ˜¯nodeçš„ç‰ˆæœ¬ nvm uninstall 19.8.1 # å°½é‡ä½¿ç”¨16.0.0ç‰ˆæœ¬çš„, ä¸ç„¶ä¼šå‡ºç°é—®é¢˜: node: /lib64/libm.so.6: version `GLIBC_2.27\u0026#39; not found (required by node) nvm install 16.0.0 install nvm Downloading and installing Node.js and npm # 4.2. å®‰è£…Hexo å®‰è£…hexoä»¥åŠç›¸å…³æ’ä»¶,\n1 sudo npm install hexo-cli hexo-server hexo-deployer-git -g # 5. åœ¨æœ¬åœ°é…ç½®hexo # 5.1. åˆå§‹åŒ–hexo 1 hexo init ~/blog # 5.2. é…ç½®hexo # 5.2.1 è®¾ç½®ä¸»é¢˜å’Œdeploy 1 2 3 cd ~/blog git clone https://github.com/next-theme/hexo-theme-next themes/next ç¼–è¾‘_config.yml\n1 vi _config.yml æ‰¾åˆ°theme, æ”¹ä¸ºnext, é¡ºä¾¿ä¹Ÿæ”¹ä¸€ä¸‹deployè®¾ç½®, æ‰¾åˆ°å¯¹åº”å†…å®¹æ”¹ä¸ºå¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 # Extensions ## Plugins: https://hexo.io/plugins/ ## Themes: https://hexo.io/themes/ theme: next # Deployment ## Docs: https://hexo.io/docs/one-command-deployment # å¿…é¡»å¡«ipåœ°å€ deploy: type: git repo: root@144.202.12.32:/var/repo/blog.git branch: master åœ¨deployä¹‹å‰éœ€è¦åœ¨æœåŠ¡å™¨çš„rootç”¨æˆ·åŠ ä¸Šæœ¬åœ°ç”µè„‘çš„å…¬é’¥(~/.ssh/id_rsa.pub), å¦åˆ™ä½ æ²¡æƒé™æäº¤git, å’ŒgithubåŒç†, æˆ‘çŒœçš„,\n1 vi /root/.ssh/authorized_keys 1 2 3 4 5 6 7 8 # æ¸…é™¤ç¼“å­˜ hexo clean # ç”Ÿæˆé™æ€é¡µé¢ hexo generate # æ³¨æ„è¦ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ å¦åˆ™ä½¿ç”¨hexo deployçš„æ—¶å€™ä¼šå‡ºç°æ‰¾ä¸åˆ°gitæŠ¥é”™ npm install hexo-deployer-git --save # å°†æœ¬åœ°é™æ€é¡µé¢ç›®å½•éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ hexo deploy # 6. ä¿®æ”¹gitç”¨æˆ·é»˜è®¤shellç¯å¢ƒ 1 2 3 vim /etc/passwd # ä¿®æ”¹æœ€åä¸€è¡Œ # å°†/bin/bashä¿®æ”¹ä¸º/usr/bin/git-shell # 7. bugæ€»ç»“ é¦–å…ˆ, /Users/shaowen/blog/_config.ymlé‡Œçš„å†…å®¹, delopyé‚£éƒ¨åˆ†, ä¸å¯ä»¥å¡«é”™, masteråˆ†æ”¯æ˜¯master, ä¸æ˜¯main, ä¹Ÿå¯ä»¥æ˜¯mainä½†æ˜¯ç°åœ¨æ²¡ç©ºç ”ç©¶å…·ä½“æ€ä¹ˆæ“ä½œ,\nå…¶æ¬¡æµè§ˆå™¨å‡ºé”™è¯´403 forbidden, è¿™ç§æƒ…å†µå°±å»çœ‹çœ‹ç½‘é¡µç›®å½•ä¸‹æœ‰æ²¡æœ‰æ–‡ä»¶, å³æˆ‘ä»¬åœ¨æœ¬åœ°ç”µè„‘çš„éƒ¨ç½²çš„hexoå¯èƒ½å¹¶æ²¡æœ‰æˆåŠŸçš„éƒ¨ç½²åˆ°æœåŠ¡å™¨, å› ä¸ºæƒé™é—®é¢˜æˆ–è€…æœåŠ¡å™¨çš„é‚£ä¸ªhooksè„šæœ¬æ²¡æœ‰æ‰§è¡Œæƒé™å¯¼è‡´æ— æ³•è‡ªåŠ¨æ›´æ–°,\nä½ å¯ä»¥æŠŠhooksä¹Ÿå°±æ˜¯/var/repo/blog.git/hooks/post-updateé‡Œå‘½ä»¤çš„å¤åˆ¶å‡ºæ¥åœ¨æœåŠ¡å™¨æ‰§è¡Œä¸€ä¸‹,çœ‹çœ‹ä¼šä¸ä¼šæœ‰æ•ˆæœ,\nhttps://blog.kisnows.com/2016/03/10/Hexoéƒ¨ç½²åˆ°VPSå¹¶å¯ç”¨HTTPS/ ","date":"2023-04-23T19:54:52Z","permalink":"https://blog.yorforger.cc/p/%E9%83%A8%E7%BD%B2%E5%8D%9A%E5%AE%A2%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8-hexo/","title":"éƒ¨ç½²åšå®¢åˆ°æœåŠ¡å™¨ - Hexo"},{"content":" # 1. Commands used in branch You can use git branch -h to check these commands\u0026rsquo; explanation.\nList branches:\ngit branch, local, equals to ls ./.git/refs/heads/ git branch -r, remote git branch -a, all you can add -v option, git branch -v -a Check which branch you are on:\ngit status Create branch:\ngit branch \u0026lt;name\u0026gt; Switch branch:\ngit switch \u0026lt;name\u0026gt;, only can switch to the branches on your local repository git checkout \u0026lt;name\u0026gt; Delete branch:\ndelete fully merged branch: git branch -d \u0026lt;name\u0026gt; delete branch (even if not merged): git branch -D \u0026lt;name\u0026gt; delete a fetched branch locally: git branch -r -d \u0026lt;name\u0026gt;, e.g., git branch -r -d origin/master Merge benach issue003 into current branchï¼š\ngit merge \u0026lt;issue003\u0026gt; Rename Current Branch\nmove/rename a branch and its reflog: git branch -m \u0026lt;branch-name\u0026gt; move/rename a branch, even if target exists: git branch -M \u0026lt;branch-name\u0026gt; # 2. åˆ‡æ¢åˆ†æ”¯éœ€è¦æ³¨æ„çš„äº‹ # 2.1. åœ¨æœ¬åœ°ä¿®æ”¹è¿œç¨‹å¯¹åº”åˆ†æ”¯ æƒ³è¦ push åˆ°è¿œç¨‹æŸä¸ªåˆ†æ”¯, å°±å¿…é¡»åœ¨æœ¬åœ°å¯¹åº”çš„åˆ†æ”¯ä¿®æ”¹æ–‡ä»¶, å¦åˆ™ä¼šå¯¼è‡´ push åˆ°é”™è¯¯çš„åˆ†æ”¯,\né”™è¯¯ä¾‹å­: æœ‰ä¸¤ä¸ªåˆ†æ”¯mainå’Œbackup, æˆ‘æƒ³è¦æŠŠæ–‡ä»¶ push åˆ° backup åˆ†æ”¯ä¸Šä»¥ç”¨äºå¤‡ä»½, å¯æ˜¯æˆ‘å´æ¯æ¬¡åœ¨æœ¬åœ°çš„ main åˆ†æ”¯ç¼–è¾‘åšå®¢, å¯¼è‡´å¾€è¿œç¨‹åˆ†æ”¯ origin/backup push çš„æ—¶å€™è¯´ everything is up-to-date. ç„¶ååˆ°githubçœ‹æ˜¯å¦å¤‡ä»½, å‘ç°å¹¶æ²¡æœ‰å¤‡ä»½, å°±å‡ºç°äº†è¿™ç§æ‘¸ä¸æ¸…å¤´ç»ªçš„é—®é¢˜.\n# 2.2. æ–°å»ºåˆ†æ”¯å¿…é¡»åšä¸€æ¬¡ commit åˆ›å»ºçš„åˆ†æ”¯åå¿…é¡»åœ¨è¯¥åˆ†æ”¯ä¸‹åšä¸€æ¬¡commit, åˆ†æ”¯åˆ›å»ºæ‰ä¼šç”Ÿæ•ˆ,\nå¦‚åˆ›å»ºå¹¶è½¬åˆ°åˆ†æ”¯ backup\n1 git switch -c backup è‹¥æ²¡åšä»»ä½• commit å°±è½¬åˆ°åˆ†æ”¯ master, åˆ™åˆ†æ”¯ branch å¹¶æ²¡æœ‰æˆåŠŸåˆ›å»º, æ­¤æ—¶ä» master åˆ†æ”¯è½¬åˆ° backup åˆ†æ”¯, ä¼šæŠ¥é”™fatal: invalid reference: backup,\n# 2.3. åˆ‡æ¢åˆ†æ”¯å‰ç¡®ä¿å·²ç»åšäº† commit æ­£å¸¸æƒ…å†µä¸‹åœ¨ä¸€ä¸ªåˆ†æ”¯ A åšä¸€äº›ä¿®æ”¹æˆ–è€…æ–°å»ºæ–‡ä»¶, commit åå†åˆ‡æ¢åˆ°åˆ†æ”¯B, åœ¨åˆ†æ”¯ B æ— æ³•çœ‹åˆ°åˆšåœ¨åˆ†æ”¯ A åšçš„ä¿®æ”¹,\nå¦‚æœåœ¨åˆ‡æ¢åˆ†ä¹‹å‰æ²¡æœ‰commit, å³ä½¿ä½ åœ¨æŸåˆ†æ”¯æ–°å»ºæ–‡ä»¶æˆ–è€…ä¿®æ”¹(ä½†æ²¡commit), è·³åˆ°å…¶ä»–åˆ†æ”¯åä»å¯ä»¥çœ‹åˆ°ä½ åœ¨é‚£ä¸ªåˆ†æ”¯åšçš„ä¿®æ”¹, æ‰€ä»¥ åœ¨åˆ‡æ¢åˆ†æ”¯å‰ä¸€å®šè¦ç¡®ä¿ä½ å·²ç»åšäº†commit.\nè¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µ, æ¯”å¦‚åœ¨masteråˆ†æ”¯åˆ›å»ºæ–‡ä»¶a.txt, ç„¶åcommit, æ­¤æ—¶è‹¥æ–°å»ºä¸€ä¸ªåˆ†æ”¯ B, åˆ™åœ¨åˆ†æ”¯ B å¯ä»¥çœ‹åˆ° master åˆ†æ”¯æ‰€æœ‰çš„æ–‡ä»¶, è¿™æ˜¯å› ä¸º B åˆ†æ”¯è¿˜æ²¡è¢«åˆ›å»º æ–‡ä»¶ a.txt å°±å·²ç»å­˜åœ¨äº†, å³æ–°å»ºåˆ†æ”¯çš„å†…å®¹æ˜¯åœ¨åŸæœ‰åˆ†æ”¯å†…å®¹çš„åŸºç¡€ä¸Šäº§ç”Ÿçš„, å¦‚æœç°åœ¨ åœ¨masteråˆ†æ”¯åˆ›å»ºæ–‡ä»¶ test.txt, ç„¶åcommit, å†æ–°å»ºä¸ªåˆ† æ”¯dev, è¿™æ—¶å€™ dev å¯ä»¥çœ‹åˆ°masteråˆ†æ”¯æ‰€æœ‰çš„æ–‡ä»¶ a.txt, test.txt, ä½†å·²å­˜åœ¨çš„åˆ†æ”¯ B çœ‹ä¸åˆ° test.txt.\næœ‰æ—¶åˆ‡æ¢åˆ†æ”¯ä¼šå‡ºç°é”™è¯¯:\n1 2 3 4 5 6 7 8 9 10 11 $ git switch main error: Your local changes to the following files would be overwritten by checkout: content/posts/Merge\u0026amp;Rebase.md Please commit your changes or stash them before you switch branches. Aborting #-------------------------# $ git switch master error: The following untracked working tree files would be overwritten by checkout: .DS_Store Please move or remove them before you switch branches. Aborting æ‰€ä»¥ç»“è®ºæ˜¯, åˆ‡æ¢åˆ†æ”¯å‰, ä¸€å®šè¦è®°å¾—commit, åˆ«åœ¨Aåˆ†æ”¯ä¿®æ”¹ä½ æƒ³æäº¤åˆ°Båˆ†æ”¯çš„æ–‡ä»¶.\näº†è§£ stash: git-stash Documentation\n","date":"2023-04-22T00:47:50Z","permalink":"https://blog.yorforger.cc/p/git-branch/","title":"git branch"},{"content":" # 1. git fetch The git fetch command downloads commits, files, and refs from a remote repository into your local repo. Fetching is what you do when you want to see what everybody else has been working on. Git isolates fetched content from existing local content; it has absolutely no effect on your local development work.\nFetch all of the branches from the repository. This also downloads all of the required commits and files from the other repository.\n1 $ git fetch \u0026lt;remote\u0026gt; Same as the above command, but only fetch the specified branch.\n1 2 # e.g., git fetch origin master $ git fetch \u0026lt;remote\u0026gt; \u0026lt;branch\u0026gt; # 2. What is origin \u0026lt;remote\u0026gt; here is the url of the remote repository, we usually set an alias (often set as origin) so that we can refer it conveniently. Check here, we set the alias when specify the remote repository to local:\n1 2 # means: origin=git@github.com:shwezhu/MyProject.git git remote add origin git@github.com:shwezhu/your-repo.git You can set the alias to other name like this:\n1 git remote add my-repo-github git@github.com:shwezhu/your-repo.git But you have to use my-repo-github when you want to refer that url:\n1 2 3 # equals to: git fetch git@github.com:shwezhu/your-repo.git your-branch git push my-repo-github your-branch git fetch my-repo-github your-branch You can change the alias:\n1 git remote rename repo origin # 3. git remote command The git remote command is also a convenience or \u0026lsquo;helper\u0026rsquo; method for modifying a repo\u0026rsquo;s ./.git/config file. The commands presented below let you manage connections with other repositories. The following commands will modify the repo\u0026rsquo;s /.git/config file. The result of the following commands can also be achieved by directly editing the ./.git/config file with a text editor.\n1 git remote add \u0026lt;name\u0026gt; \u0026lt;url\u0026gt; Create a new connection to a remote repository. After adding a remote, youâ€™ll be able to use ï¼œnameï¼ as a convenient shortcut for ï¼œurlï¼ in other Git commands.\nReferences:\nGit Remote | Atlassian Git Tutorial Git Fetch | Atlassian Git Tutorial ","date":"2023-04-21T21:46:44Z","permalink":"https://blog.yorforger.cc/p/git-fetch-the-essence-of-origin/","title":"git fetch - the Essence of \"origin\""}]