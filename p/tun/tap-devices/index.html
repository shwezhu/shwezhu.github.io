<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="# 1. TUN/TAP Devices In computer networking, TUN and TAP are two different kernel virtual network devices. Though both are for tunneling purposes, TUN and TAP can&rsquo;t be used together because they transmit and receive packets at different layers of the network stack. TUN (network TUNnel) devices are used for IP packet-level tunneling, while TAP (network TAP) devices are used for Ethernet frame-level tunneling. A network interface can be a physical device, called network interface controller (NIC), such as an ethernet card or wireless adapter, or a virtual device, such as a TUN or TAP interface.">
<title>TUN/TAP Devices</title>

<link rel='canonical' href='https://blog.yorforger.cc/p/tun/tap-devices/'>

<link rel="stylesheet" href="/scss/style.min.8e60baf4cd3fc55968717a6e39762f4d28ed7ef6007566b6c7970ad0fe907198.css"><meta property='og:title' content="TUN/TAP Devices">
<meta property='og:description' content="# 1. TUN/TAP Devices In computer networking, TUN and TAP are two different kernel virtual network devices. Though both are for tunneling purposes, TUN and TAP can&rsquo;t be used together because they transmit and receive packets at different layers of the network stack. TUN (network TUNnel) devices are used for IP packet-level tunneling, while TAP (network TAP) devices are used for Ethernet frame-level tunneling. A network interface can be a physical device, called network interface controller (NIC), such as an ethernet card or wireless adapter, or a virtual device, such as a TUN or TAP interface.">
<meta property='og:url' content='https://blog.yorforger.cc/p/tun/tap-devices/'>
<meta property='og:site_name' content='David&#39;s Blogs'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='networking' /><meta property='article:published_time' content='2023-09-08T17:54:59&#43;00:00'/><meta property='article:modified_time' content='2023-09-08T17:54:59&#43;00:00'/>
<meta name="twitter:title" content="TUN/TAP Devices">
<meta name="twitter:description" content="# 1. TUN/TAP Devices In computer networking, TUN and TAP are two different kernel virtual network devices. Though both are for tunneling purposes, TUN and TAP can&rsquo;t be used together because they transmit and receive packets at different layers of the network stack. TUN (network TUNnel) devices are used for IP packet-level tunneling, while TAP (network TAP) devices are used for Ethernet frame-level tunneling. A network interface can be a physical device, called network interface controller (NIC), such as an ethernet card or wireless adapter, or a virtual device, such as a TUN or TAP interface.">
    <link rel="shortcut icon" href="/favicon.png" />

  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_huc82d7b839fc53b7a5c86bd3cdfedcac6_167937_300x0_resize_box_3.png" width="300"
                            height="274" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">✨</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">David&#39;s Blogs</a></h1>
            <h2 class="site-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/shwezhu'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/hutumaomao'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#1-tuntap-devices">1. TUN/TAP Devices</a></li>
    <li><a href="#2-tuntap--network-stack">2. TUN/TAP &amp; Network Stack</a></li>
    <li><a href="#3-tun-vs-tap">3. TUN vs. TAP</a>
      <ol>
        <li><a href="#31-tun-interfaces-l3">3.1. TUN interfaces (L3)</a></li>
        <li><a href="#32-tap-interfaces-l2">3.2. TAP interfaces (L2)</a></li>
      </ol>
    </li>
    <li><a href="#4-set-up-tuntap-devices">4. Set up TUN/TAP devices</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/networking/" >
                Networking
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/tun/tap-devices/">TUN/TAP Devices</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 08, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    5 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="1-tuntap-devices">
    <a href="#1-tuntap-devices">#</a>
    1. TUN/TAP Devices
</h2><p>In computer networking, <strong>TUN</strong> and <strong>TAP</strong> are two different kernel <strong>virtual network devices</strong>. Though both are for tunneling purposes, TUN and TAP can&rsquo;t be used together because they transmit and receive packets at different layers of the network stack. TUN (network TUNnel) devices are used for IP packet-level tunneling, while TAP (network TAP) devices are used for Ethernet frame-level tunneling.</p>
<blockquote>
<p>A network interface can be a physical device, called network interface controller (NIC), such as an ethernet card or wireless adapter, or a virtual device, such as a TUN or TAP interface.</p>
<p>Source: <a class="link" href="https://www.baeldung.com/linux/create-check-network-interfaces"  target="_blank" rel="noopener"
    >https://www.baeldung.com/linux/create-check-network-interfaces</a></p>
<p>TUN/TAP provides packet reception and transmission for user space programs. It can be seen as a simple Point-to-Point or Ethernet device, which, instead of receiving packets from physical media, receives them from user space program and instead of sending packets via physical media writes them to the user space program. It interacts with user space program not the kernel.</p>
<p>Source: <a class="link" href="https://docs.kernel.org/networking/tuntap.html"  target="_blank" rel="noopener"
    >https://docs.kernel.org/networking/tuntap.html</a></p>
</blockquote>
<h2 id="2-tuntap--network-stack">
    <a href="#2-tuntap--network-stack">#</a>
    2. TUN/TAP &amp; Network Stack
</h2><p>TUN/TAP is an operating-system interface for creating network interfaces managed by userspace. This is usually used to implement userspace Virtual Private Networks[<a class="link" href="https://www.gabriel.urdhr.fr/2021/05/08/tuntap/#fn1"  target="_blank" rel="noopener"
    >1]</a> (VPNs), for example with <a class="link" href="https://openvpn.net/"  target="_blank" rel="noopener"
    >OpenVPN</a>, <a class="link" href="https://www.gabriel.urdhr.fr/2017/08/02/foo-over-ssh/#tuntap-forwarding"  target="_blank" rel="noopener"
    >OpenSSH</a> (<code>Tunnel</code> configuration or <code>-w</code> argument), <a class="link" href="https://code.ffdn.org/l2tpns/l2tpns"  target="_blank" rel="noopener"
    >l2tpns</a>, etc.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">+--------------------------------------------+
</span></span><span class="line"><span class="cl">| Processes                                  |
</span></span><span class="line"><span class="cl">+--------------------------------------------+
</span></span><span class="line"><span class="cl">  ↕ Socket interface
</span></span><span class="line"><span class="cl">+---------------------------------------------+
</span></span><span class="line"><span class="cl">| Network Stack (kernel)                      |&lt;--+
</span></span><span class="line"><span class="cl">+---------------------------------------------+   |
</span></span><span class="line"><span class="cl">  ↕ Eth. frame     ↕ Eth. frame    ↕ IP packet    |
</span></span><span class="line"><span class="cl">+--------------+ +-------------+ +------------+   |
</span></span><span class="line"><span class="cl">| enp2s0       | | tap0        | | tun0       |   |
</span></span><span class="line"><span class="cl">+--------------+ +-------------+ +------------+   |
</span></span><span class="line"><span class="cl">  ↑ Eth. frame     ↕ Eth. frame¹   ↕ IP packet¹   |
</span></span><span class="line"><span class="cl">+--------------+ +-------------+ +------------+   |
</span></span><span class="line"><span class="cl">| Driver       | | Process     | | Process    |   |
</span></span><span class="line"><span class="cl">+--------------+ +-------------+ +------------+   |
</span></span><span class="line"><span class="cl">  ↕ Eth. frame²    ↑               ↑              |
</span></span><span class="line"><span class="cl">+--------------+   +---------------+--------------+
</span></span><span class="line"><span class="cl">| Eth. Adapter  |  (encapsulated packets)
</span></span><span class="line"><span class="cl">+--------------+
</span></span><span class="line"><span class="cl">  ↕ Eth. frame
</span></span><span class="line"><span class="cl">+--------------+
</span></span><span class="line"><span class="cl">| Eth. Network |
</span></span><span class="line"><span class="cl">+--------------+
</span></span><span class="line"><span class="cl">Physical netdev    Ethernet VPN      IP VPN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">¹: via /dev/net/tun
</span></span><span class="line"><span class="cl">²: over PCI Express for example
</span></span></code></pre></td></tr></table>
</div>
</div><p>There are many applications running on our OS (reside in user space), they send network packets with socket interface (on linux). All the packets through <strong>socket interface</strong> will go to one place: the <strong>Network Stack</strong> (resides in kernel). And the packets from the Network Stack only have two direction to go, one is the physical network interfce (<strong>NIC</strong>), another direction is the virtual network devices <strong>tap/tun</strong>, and we can get the packets from tap/tun which usually used in VPN application (resides in user space). Of course, VPN applicatipn (user space) can write packet into <strong>tap/tun</strong> devices and after written into tap/tun the packet will goes to <strong>Network Stack</strong>, and there are two direction again&hellip;</p>
<p>You probably notice that if we use TUN/TAP devices to handle the packets from other normal  applications, the packet seem to go through the Network Stack twice: the normal applications write data into socket interface and these packets will go through Netwok Stack and intercepted by TUN/TAP devices, then after vpn handles these packets, these packet will be sent to Network Stack again, which probably not efficient. (Notice that in qemu-kvm, tap device works with bridge, and the packets goes to bridge directly without going through Network Stack which is more efficient)</p>
<p>Applications send or receive packet to/from socket interface:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">socket</span> <span class="o">=</span> <span class="nf">socket</span><span class="p">(</span><span class="n">AF_PACKET</span><span class="p">,</span><span class="n">SOCK_RAW</span><span class="p">,</span><span class="n">IPPROTO_IP</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>VPN application send or receive packet to/from tun devices:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// Request a TUN device
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">&#34;/dev/net/tun&#34;</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// receives a (single) packet or frame from the virtual network interface;
</span></span></span><span class="line"><span class="cl"><span class="c1">// Read an IP packet (because TUN works on IP layer):
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">ssize_t</span> <span class="n">count</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">BUFFLEN</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// sends a (single) packet or frame to the virtual network interface;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">write</span><span class="p">(...)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Source: <a class="link" href="https://www.gabriel.urdhr.fr/2021/05/08/tuntap/"  target="_blank" rel="noopener"
    >TUN/TAP interface (on Linux) - /dev/posts/</a></p>
<h2 id="3-tun-vs-tap">
    <a href="#3-tun-vs-tap">#</a>
    3. TUN vs. TAP
</h2><p>There are two types of virtual network interfaces managed by <code>/dev/net/tun</code>:</p>
<ul>
<li>TUN interfaces transport IP packets (layer 3);</li>
<li>TAP interfaces transport Ethernet frames (layer 2).</li>
</ul>
<h3 id="31-tun-interfaces-l3">
    <a href="#31-tun-interfaces-l3">#</a>
    3.1. TUN interfaces (L3)
</h3><p>TUN interfaces (<code>IFF_TUN</code>) transport layer 3 (L3) Protocol Data Units (PDUs):</p>
<ul>
<li>in practice, it transports IPv4 and/or IPv6 packets;</li>
<li><code>read()</code> gets a L3 PDU (an IP packet);</li>
<li>you must <code>write()</code> L3 PDUs (an IP packet);</li>
<li>there is no layer 2 (Ethernet, etc.) involved in the interface;</li>
</ul>
<h3 id="32-tap-interfaces-l2">
    <a href="#32-tap-interfaces-l2">#</a>
    3.2. TAP interfaces (L2)
</h3><p>TAP interfaces (<code>IFF_TUN</code>) transport layer 2 (L2) PDUs:</p>
<ul>
<li>in practice, it transports Ethernet frames (i.e. this is a virtual Ethernet adapter);</li>
<li><code>read()</code> gets a L2 PDU;</li>
<li>you must <code>write()</code> L2 PDUs.</li>
</ul>
<p>Source: <a class="link" href="https://www.gabriel.urdhr.fr/2021/05/08/tuntap/"  target="_blank" rel="noopener"
    >TUN/TAP interface (on Linux) - /dev/posts/</a></p>
<h2 id="4-set-up-tuntap-devices">
    <a href="#4-set-up-tuntap-devices">#</a>
    4. Set up TUN/TAP devices
</h2><p>Because TUN is a layer 3 connection, it acts as a point-to-point link. We’ll assign these parameters:</p>
<ul>
<li>local address (for your machine): 192.0.2.1</li>
<li>remote address (for Scapy): 192.0.2.2</li>
</ul>
<p>On Linux, you would use:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo ip link <span class="nb">set</span> tun0 up
</span></span><span class="line"><span class="cl">sudo ip addr add 192.0.2.1 peer 192.0.2.2 dev tun0 
</span></span><span class="line"><span class="cl"><span class="c1"># sudo ip addr add 192.0.2.1 peer 192.0.2.2 dev tun0  up</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>On BSD and macOS, use:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo ifconfig tun0 up
</span></span><span class="line"><span class="cl">sudo ifconfig tun0 192.0.2.1 192.0.2.2
</span></span><span class="line"><span class="cl"><span class="c1"># sudo ifconfig tun0 192.0.2.1 192.0.2.2 up</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Source: <a class="link" href="https://scapy.readthedocs.io/en/latest/layers/tuntap.html#tuntapinterface-reference"  target="_blank" rel="noopener"
    >https://scapy.readthedocs.io/en/latest/layers/tuntap.html#tuntapinterface-reference</a></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/networking/">Networking</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/cname-%E6%8C%87%E5%90%91-github-pages-%E9%97%AE%E9%A2%98/">
        
        

        <div class="article-details">
            <h2 class="article-title">CNAME 指向 GitHub Pages 问题</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/dns-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">
        
        

        <div class="article-details">
            <h2 class="article-title">DNS 基础概念</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/mpls/">
        
        

        <div class="article-details">
            <h2 class="article-title">MPLS</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/dns-spoofing-gfw/">
        
        

        <div class="article-details">
            <h2 class="article-title">DNS Spoofing - GFW</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/tools-commonly-used-in-networking/">
        
        

        <div class="article-details">
            <h2 class="article-title">Tools Commonly Used in Networking</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="shwezhu/shwezhu.github.io"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2024 David&#39;s Blogs
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.25.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
