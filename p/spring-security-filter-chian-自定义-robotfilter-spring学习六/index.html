<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="# 视频介绍 此文章参考视频的 54:35 之后, 用于做笔记, 可直接观看视频: {% youtube iJ2muJniikY %} 关于 authentication object, 可以参考上一篇或者观看视频 33:00, 关于 filter chain, 可参考视频 39:15, 或参考: FIlter Architecture Spring Security # 功能陈述 添加一个管理员角色, 可以不用登录, 通过 special header 就可访问所有需要认证的页面, 大概下面这样: curl localhost:8080/private -H &quot;x-robot-password: beep-boop&quot; -v # 项目结构 此文章所用代码在上一篇文章基础上编写, 本篇文章代码地址: https://github.com/shwezhu/springboot-learning/tree/master/spring-mr-robot-filter-demo 1 2 3 4 5 6 7 └── david └── zhu ├── RobotAuthentication.java ├── RobotFilter.java ├── SpringSecurityDemoApplication.java ├── WebController.java └── WebSecurityConfig.java 主要是为了理解 FilterChian 是一个 list 结构, 即有多个 filter, 然后每个 filter 都有 doFilter 方法, 他们是在方法体里被调用的 而不是 for loop 结构被循环调用, 这样的好处是我们可以决定在方法体的哪部分进行 doFilter 调用, doFilter 就是进入下一个 filter, 这里说的不准确, 深入理解参考: FIlter Architecture Spring Security">
<title>Spring Security Filter Chian 自定义 RobotFilter, Spring学习(六)</title>

<link rel='canonical' href='https://demo.stack.jimmycai.com/p/spring-security-filter-chian-%E8%87%AA%E5%AE%9A%E4%B9%89-robotfilter-spring%E5%AD%A6%E4%B9%A0%E5%85%AD/'>

<link rel="stylesheet" href="/scss/style.min.8e60baf4cd3fc55968717a6e39762f4d28ed7ef6007566b6c7970ad0fe907198.css"><meta property='og:title' content="Spring Security Filter Chian 自定义 RobotFilter, Spring学习(六)">
<meta property='og:description' content="# 视频介绍 此文章参考视频的 54:35 之后, 用于做笔记, 可直接观看视频: {% youtube iJ2muJniikY %} 关于 authentication object, 可以参考上一篇或者观看视频 33:00, 关于 filter chain, 可参考视频 39:15, 或参考: FIlter Architecture Spring Security # 功能陈述 添加一个管理员角色, 可以不用登录, 通过 special header 就可访问所有需要认证的页面, 大概下面这样: curl localhost:8080/private -H &quot;x-robot-password: beep-boop&quot; -v # 项目结构 此文章所用代码在上一篇文章基础上编写, 本篇文章代码地址: https://github.com/shwezhu/springboot-learning/tree/master/spring-mr-robot-filter-demo 1 2 3 4 5 6 7 └── david └── zhu ├── RobotAuthentication.java ├── RobotFilter.java ├── SpringSecurityDemoApplication.java ├── WebController.java └── WebSecurityConfig.java 主要是为了理解 FilterChian 是一个 list 结构, 即有多个 filter, 然后每个 filter 都有 doFilter 方法, 他们是在方法体里被调用的 而不是 for loop 结构被循环调用, 这样的好处是我们可以决定在方法体的哪部分进行 doFilter 调用, doFilter 就是进入下一个 filter, 这里说的不准确, 深入理解参考: FIlter Architecture Spring Security">
<meta property='og:url' content='https://demo.stack.jimmycai.com/p/spring-security-filter-chian-%E8%87%AA%E5%AE%9A%E4%B9%89-robotfilter-spring%E5%AD%A6%E4%B9%A0%E5%85%AD/'>
<meta property='og:site_name' content='David&#39;s Blogs'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Java' /><meta property='article:tag' content='Spring Boot' /><meta property='article:published_time' content='2023-08-07T20:58:53&#43;00:00'/><meta property='article:modified_time' content='2023-08-07T20:58:53&#43;00:00'/>
<meta name="twitter:title" content="Spring Security Filter Chian 自定义 RobotFilter, Spring学习(六)">
<meta name="twitter:description" content="# 视频介绍 此文章参考视频的 54:35 之后, 用于做笔记, 可直接观看视频: {% youtube iJ2muJniikY %} 关于 authentication object, 可以参考上一篇或者观看视频 33:00, 关于 filter chain, 可参考视频 39:15, 或参考: FIlter Architecture Spring Security # 功能陈述 添加一个管理员角色, 可以不用登录, 通过 special header 就可访问所有需要认证的页面, 大概下面这样: curl localhost:8080/private -H &quot;x-robot-password: beep-boop&quot; -v # 项目结构 此文章所用代码在上一篇文章基础上编写, 本篇文章代码地址: https://github.com/shwezhu/springboot-learning/tree/master/spring-mr-robot-filter-demo 1 2 3 4 5 6 7 └── david └── zhu ├── RobotAuthentication.java ├── RobotFilter.java ├── SpringSecurityDemoApplication.java ├── WebController.java └── WebSecurityConfig.java 主要是为了理解 FilterChian 是一个 list 结构, 即有多个 filter, 然后每个 filter 都有 doFilter 方法, 他们是在方法体里被调用的 而不是 for loop 结构被循环调用, 这样的好处是我们可以决定在方法体的哪部分进行 doFilter 调用, doFilter 就是进入下一个 filter, 这里说的不准确, 深入理解参考: FIlter Architecture Spring Security">
    <link rel="shortcut icon" href="/favicon.png" />

  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_huc82d7b839fc53b7a5c86bd3cdfedcac6_167937_300x0_resize_box_3.png" width="300"
                            height="274" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">✨</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">David&#39;s Blogs</a></h1>
            <h2 class="site-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/shwezhu'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/hutumaomao'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#视频介绍">视频介绍</a></li>
    <li><a href="#功能陈述">功能陈述</a></li>
    <li><a href="#项目结构">项目结构</a></li>
    <li><a href="#自定义-filter---robotfilter类">自定义 Filter - <code>RobotFilter</code>类</a></li>
    <li><a href="#实现思路">实现思路</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/java/" >
                Java
            </a>
        
            <a href="/categories/backend/" >
                Backend
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/spring-security-filter-chian-%E8%87%AA%E5%AE%9A%E4%B9%89-robotfilter-spring%E5%AD%A6%E4%B9%A0%E5%85%AD/">Spring Security Filter Chian 自定义 RobotFilter, Spring学习(六)</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 07, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    3 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="视频介绍">
    <a href="#%e8%a7%86%e9%a2%91%e4%bb%8b%e7%bb%8d">#</a>
    视频介绍
</h2><p>此文章参考视频的 54:35 之后, 用于做笔记, 可直接观看视频:</p>
<p>{% youtube iJ2muJniikY %}</p>
<ul>
<li>关于 authentication object, 可以参考<a class="link" href="https://davidzhu.xyz/2023/08/04/Java/Backend/005-spring-security/"  target="_blank" rel="noopener"
    >上一篇</a>或者观看<a class="link" href="https://youtu.be/iJ2muJniikY"  target="_blank" rel="noopener"
    >视频 33:00</a>,</li>
<li>关于 filter chain, 可参考视频 39:15, 或参考: <a class="link" href="https://docs.spring.io/spring-security/reference/servlet/architecture.html"  target="_blank" rel="noopener"
    >FIlter Architecture Spring Security</a>
<img src="/006-spring-security/1.png"
	
	
	
	loading="lazy"
	
		alt="1"
	
	
></li>
</ul>
<h2 id="功能陈述">
    <a href="#%e5%8a%9f%e8%83%bd%e9%99%88%e8%bf%b0">#</a>
    功能陈述
</h2><ul>
<li>添加一个管理员角色, 可以不用登录, 通过 special header 就可访问所有需要认证的页面, 大概下面这样:
<ul>
<li><code>curl localhost:8080/private -H &quot;x-robot-password: beep-boop&quot; -v</code></li>
</ul>
</li>
</ul>
<h2 id="项目结构">
    <a href="#%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84">#</a>
    项目结构
</h2><p>此文章所用代码在上一篇文章基础上编写, 本篇文章代码地址: <a class="link" href="https://github.com/shwezhu/springboot-learning/tree/master/spring-mr-robot-filter-demo"  target="_blank" rel="noopener"
    >https://github.com/shwezhu/springboot-learning/tree/master/spring-mr-robot-filter-demo</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">└── david
</span></span><span class="line"><span class="cl">     └── zhu
</span></span><span class="line"><span class="cl">          ├── RobotAuthentication.java
</span></span><span class="line"><span class="cl">          ├── RobotFilter.java
</span></span><span class="line"><span class="cl">          ├── SpringSecurityDemoApplication.java
</span></span><span class="line"><span class="cl">          ├── WebController.java
</span></span><span class="line"><span class="cl">          └── WebSecurityConfig.java
</span></span></code></pre></td></tr></table>
</div>
</div><p>主要是为了理解 FilterChian 是一个 list 结构, 即有多个 filter, 然后每个 filter 都有 doFilter 方法, 他们是在方法体里被调用的 而不是 for loop 结构被循环调用, 这样的好处是我们可以决定在方法体的哪部分进行 doFilter 调用, doFilter 就是进入下一个 filter, 这里说的不准确, 深入理解参考: <a class="link" href="https://docs.spring.io/spring-security/reference/servlet/architecture.html"  target="_blank" rel="noopener"
    >FIlter Architecture Spring Security</a></p>
<h2 id="自定义-filter---robotfilter类">
    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89-filter---robotfilter%e7%b1%bb">#</a>
    自定义 Filter - <code>RobotFilter</code>类
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RobotFilter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">OncePerRequestFilter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilterInternal</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">FilterChain</span><span class="w"> </span><span class="n">filterChain</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;🤖️ HELLO FORM Robot Filter~&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Every Filter has a doFilter() method,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// But they are not called by for loop over a list of filters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// but actually a chain of responsibility</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// video: https://youtu.be/iJ2muJniikY, at 00:42:53</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">filterChain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>把该 Filter 添加到 SecurityFilterChain, 在我们上篇文章常见的 <code>WebSecurityConfig</code> 类内,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">securityFilterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">authorizeConfig</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">authorizeConfig</span><span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">).</span><span class="na">permitAll</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  					</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">formLogin</span><span class="p">(</span><span class="n">withDefaults</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">oauth2Login</span><span class="p">(</span><span class="n">withDefaults</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// !!! add this line below:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">addFilterBefore</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RobotFilter</span><span class="p">(),</span><span class="w"> </span><span class="n">UsernamePasswordAuthenticationFilter</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>然后输入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl localhost:8080   
</span></span><span class="line"><span class="cl">Hello David~% 
</span></span></code></pre></td></tr></table>
</div>
</div><p>项目终端输出,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">🤖️ HELLO FORM Robot Filter~
</span></span></code></pre></td></tr></table>
</div>
</div><p>解释下为何继承 <code> OncePerRequestFilter</code> ,</p>
<p>每个 servlet 都可以有不同的 SecurityFilterChain, 也就是说一个项目可以有多个 SecurityFilterChain, 在上一篇文章中提到的一个 <code>WebSecurityConfig</code> 类, 我们在该类中配置了 SecurityFilterChain, 其实 SecurityFilterChain 可以有多个, 即我们现在的项目不够复杂, 只用了一个, 比如我们可以再加个 SecurityFilterChain 让其只处理 <code>/api/**</code> 相关 endpoints, 如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">securityFilterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// https://stackoverflow.com/a/75219552/16317008</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">securityMatcher</span><span class="p">(</span><span class="s">&#34;/api&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">authorizeConfig</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">authorizeConfig</span><span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">).</span><span class="na">permitAll</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  					</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">formLogin</span><span class="p">(</span><span class="n">withDefaults</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          			</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>写 JSP 的时候一个 servlet 负责的是一个对应的 endpoint, 我们写 spring 代码的时候只是用个简单的注解指定对应endpoint, Spring 框架在底层帮我们实现了对应的 servlet , 然后运行的时候这些 servlet 运行在 tomcat 中, tomcat 会把每个 request 分类然后转发给对应的 servlet, 说这些只是想说, servlet 才是真正处理 request 的东西, 即产生 http response, 而 filter 则是工作在 servlet 之前或者之后帮我们过滤, 认证 request, servlet 很笨, 只负责处理传给他的 request, 像是个没大脑的工厂,</p>
<p>上面我们提到, 每个 servlet 都可以有不同的 SecurityFilterChain, 于是再看下面这些解释使用 <code> OncePerRequestFilter</code> 的原因, 你就能看懂了,</p>
<blockquote>
<p>The request could be dispatched to a different (or the same) servlet using the request dispatcher. A common use-case is in Spring Security, where authentication and access control functionality is typically implemented as filters that sit in front of the main application servlets. When a request is dispatched using a request dispatcher, it has to go through the filter chain again (or possibly a different one) before it gets to the servlet that is going to deal with it. The problem is that some of the security filter actions should only be performed once for a request. Hence the need for <em>this</em> filter. <a class="link" href="https://stackoverflow.com/questions/13152946/what-is-onceperrequestfilter?answertab=scoredesc#tab-top"  target="_blank" rel="noopener"
    >What is OncePerRequestFilter? - Stack Overflow</a></p>
</blockquote>
<blockquote>
<p>A <em><a class="link" href="https://www.baeldung.com/spring-boot-add-filter"  target="_blank" rel="noopener"
    >Filter</a></em> can be called either before or after servlet execution. When a request is dispatched to a servlet, the <em><code>RequestDispatcher</code></em> may forward it to another servlet. There&rsquo;s a possibility that the other servlet also has the same filter. In such scenarios, the <strong>same filter gets invoked multiple times.</strong> Spring guarantees that the <em><code>OncePerRequestFilter</code></em> is executed only once for a given request. <a class="link" href="https://www.baeldung.com/spring-onceperrequestfilter"  target="_blank" rel="noopener"
    >What Is OncePerRequestFilter? | Baeldung</a></p>
</blockquote>
<p>其实这里还有需要深入探讨的东西, 比如 <em><code>RequestDispatcher</code></em> 是做什么的, 现在我们要知道的是, 一个项目可以有多个 FilterChain, Servlet 才是真正处理 http request的东西, FilterChain 只是帮 servlet 过滤 request, 至于 每个 request 怎么被 tomcat 分配到 对应servlet的, 这还需要深入的学习才能理解, 关于 FIlterChain 可参考: <a class="link" href="https://docs.spring.io/spring-security/reference/servlet/architecture.html"  target="_blank" rel="noopener"
    >Architecture Spring Security</a></p>
<h2 id="实现思路">
    <a href="#%e5%ae%9e%e7%8e%b0%e6%80%9d%e8%b7%af">#</a>
    实现思路
</h2><ul>
<li>创建我们的特殊 RobotFilter, 通过继承 <code>OncePerRequestFilter</code> 实现</li>
<li>因为访问的页面需要 authenticated, 因此创建特殊 RobotFilter 时, 需要新建一个 authentication object <code>RobotAuthentication</code> 来表示 robot 用户</li>
<li>在账号密码登录认证 filter 前添加我们刚自定义的 <code>RobotFilter</code>, 通过修改 <code>WebSecurityConfig::securityFilterChain</code> 方法实现</li>
</ul>
<p>本文主要参考: <a class="link" href="https://www.youtube.com/watch?v=iJ2muJniikY&amp;list=PLn7Fivb51OvJLdfD8KrhgiawFINb94j9X&amp;index=2&amp;t=3741s"  target="_blank" rel="noopener"
    >Spring Security, demystified by Daniel Garnier Moiroux</a></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/java/">Java</a>
        
            <a href="/tags/spring-boot/">Spring Boot</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/csrf-filter-providermanager-authenticationproviders-spring%E5%AD%A6%E4%B9%A0%E4%B8%83/">
        
        

        <div class="article-details">
            <h2 class="article-title">CSRF Filter &amp; ProviderManager &amp; AuthenticationProviders, Spring学习(七)</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/spring-security-authentication-spring%E5%AD%A6%E4%B9%A0%E4%BA%94/">
        
        

        <div class="article-details">
            <h2 class="article-title">Spring Security Authentication, Spring学习(五)</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/thymeleaf-spring%E5%AD%A6%E4%B9%A0%E5%9B%9B/">
        
        

        <div class="article-details">
            <h2 class="article-title">Thymeleaf, Spring学习(四)</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/maven%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4-spring%E5%AD%A6%E4%B9%A0%E4%BA%8C/">
        
        

        <div class="article-details">
            <h2 class="article-title">Maven的相关概念与常用指令 Spring学习(二)</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E5%88%9B%E5%BB%BAspring-boot%E9%A1%B9%E7%9B%AE%E5%8F%8A%E8%B8%A9%E5%9D%91%E6%80%BB%E7%BB%93-spring%E5%AD%A6%E4%B9%A0%E4%B8%80/">
        
        

        <div class="article-details">
            <h2 class="article-title">创建Spring Boot项目及踩坑总结 Spring学习(一)</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="shwezhu/shwezhu.github.io"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 David&#39;s Blogs
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.25.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
